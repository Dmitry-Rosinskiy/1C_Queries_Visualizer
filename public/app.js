(()=>{"use strict";var __webpack_modules__={79:(t,e,i)=>{i.r(e),i.d(e,{default:()=>a});var s=i(315),n=i(83);class l extends s.default{constructor(t,e,i="#FFFFFF",s="#000000",n=1){super(t,i,s,n),this.imageSrc=e,this.shadow=!1,this.preserveImageAspect=!0}getSvgScreenOffset(){return 0}apply(t){super.apply(t),this.fill=n.NONE,this.stroke=n.NONE,this.gradient=n.NONE,this.style&&null!=this.style.imageAspect&&(this.preserveImageAspect=this.style.imageAspect)}isHtmlAllowed(){return!this.preserveImageAspect}isRoundable(t,e,i,s,n){return!1}paintVertexShape(t,e,i,s,l){if(this.imageSrc){const a=this.style?.imageBackground??n.NONE,r=this.style?.imageBorder??n.NONE;a!==n.NONE&&(t.setFillColor(a),t.setStrokeColor(r),t.rect(e,i,s,l),t.fillAndStroke()),t.image(e,i,s,l,this.imageSrc,this.preserveImageAspect,!1,!1),r!==n.NONE&&(t.setShadow(!1),t.setStrokeColor(r),t.rect(e,i,s,l),t.stroke())}else this.paintBackground(t,e,i,s,l)}}const a=l},83:(t,e,i)=>{i.r(e),i.d(e,{ABSOLUTE_LINE_HEIGHT:()=>it,ALIGN:()=>mt,ARROW:()=>vt,ARROW_SIZE:()=>ct,ARROW_SPACING:()=>dt,ARROW_WIDTH:()=>ut,CONNECT_HANDLE_FILLCOLOR:()=>K,CONNECT_TARGET_COLOR:()=>P,CURSOR:()=>T,DEFAULT_FONTFAMILY:()=>Z,DEFAULT_FONTSIZE:()=>Q,DEFAULT_FONTSTYLE:()=>st,DEFAULT_HOTSPOT:()=>n,DEFAULT_IMAGESIZE:()=>at,DEFAULT_INVALID_COLOR:()=>v,DEFAULT_MARKERSIZE:()=>lt,DEFAULT_STARTSIZE:()=>nt,DEFAULT_TEXT_DIRECTION:()=>J,DEFAULT_VALID_COLOR:()=>y,DIALECT:()=>o,DIRECTION:()=>St,DIRECTION_MASK:()=>_t,DROP_TARGET_COLOR:()=>M,EDGESTYLE:()=>Tt,EDGE_SELECTION_COLOR:()=>D,EDGE_SELECTION_DASHED:()=>B,EDGE_SELECTION_STROKEWIDTH:()=>N,ELBOW:()=>xt,ENTITY_SEGMENT:()=>rt,FONT:()=>yt,GUIDE_COLOR:()=>U,GUIDE_STROKEWIDTH:()=>k,HANDLE_FILLCOLOR:()=>W,HANDLE_SIZE:()=>F,HANDLE_STROKECOLOR:()=>Y,HIGHLIGHT_COLOR:()=>b,HIGHLIGHT_OPACITY:()=>x,HIGHLIGHT_SIZE:()=>_,HIGHLIGHT_STROKEWIDTH:()=>w,IDENTITY_FIELD_NAME:()=>h,INVALID_COLOR:()=>A,INVALID_CONNECT_TARGET_COLOR:()=>I,LABEL_HANDLE_FILLCOLOR:()=>X,LABEL_HANDLE_SIZE:()=>z,LINE_ARCSIZE:()=>ht,LINE_HEIGHT:()=>tt,LOCKED_HANDLE_FILLCOLOR:()=>$,MAX_HOTSPOT_SIZE:()=>a,MIN_HOTSPOT_SIZE:()=>l,NODETYPE:()=>E,NONE:()=>Ct,NS_SVG:()=>d,NS_XLINK:()=>u,OUTLINE_COLOR:()=>V,OUTLINE_HANDLE_FILLCOLOR:()=>q,OUTLINE_HANDLE_STROKECOLOR:()=>j,OUTLINE_HIGHLIGHT_COLOR:()=>m,OUTLINE_HIGHLIGHT_STROKEWIDTH:()=>S,OUTLINE_STROKEWIDTH:()=>G,PAGE_FORMAT_A4_LANDSCAPE:()=>pt,PAGE_FORMAT_A4_PORTRAIT:()=>gt,PAGE_FORMAT_LETTER_LANDSCAPE:()=>Et,PAGE_FORMAT_LETTER_PORTRAIT:()=>ft,PERIMETER:()=>bt,RECTANGLE_ROUNDING_FACTOR:()=>ot,RENDERING_HINT:()=>r,SHADOWCOLOR:()=>c,SHADOW_OFFSET_X:()=>g,SHADOW_OFFSET_Y:()=>p,SHADOW_OPACITY:()=>f,SHAPE:()=>Pt,TEXT_DIRECTION:()=>wt,TOOLTIP_VERTICAL_OFFSET:()=>C,VALID_COLOR:()=>O,VERSION:()=>s,VERTEX_SELECTION_COLOR:()=>L,VERTEX_SELECTION_DASHED:()=>H,VERTEX_SELECTION_STROKEWIDTH:()=>R,WORD_WRAP:()=>et});const s="0.16.0",n=.3,l=8,a=0;var r,o;!function(t){t.EXACT="exact",t.FASTER="faster",t.FASTEST="fastest"}(r||(r={})),function(t){t.SVG="svg",t.MIXEDHTML="mixedHtml",t.PREFERHTML="preferHtml",t.STRICTHTML="strictHtml"}(o||(o={}));const h="mxObjectId",d="http://www.w3.org/2000/svg",u="http://www.w3.org/1999/xlink",c="gray",g=2,p=3,f=1;var E;!function(t){t[t.ELEMENT=1]="ELEMENT",t[t.ATTRIBUTE=2]="ATTRIBUTE",t[t.TEXT=3]="TEXT",t[t.CDATA=4]="CDATA",t[t.ENTITY_REFERENCE=5]="ENTITY_REFERENCE",t[t.ENTITY=6]="ENTITY",t[t.PROCESSING_INSTRUCTION=7]="PROCESSING_INSTRUCTION",t[t.COMMENT=8]="COMMENT",t[t.DOCUMENT=9]="DOCUMENT",t[t.DOCUMENTTYPE=10]="DOCUMENTTYPE",t[t.DOCUMENT_FRAGMENT=11]="DOCUMENT_FRAGMENT",t[t.NOTATION=12]="NOTATION"}(E||(E={}));const C=16,y="#00FF00",v="#FF0000",m="#00FF00",S=5,w=3,_=2,x=100;var T;!function(t){t.MOVABLE_VERTEX="move",t.MOVABLE_EDGE="move",t.LABEL_HANDLE="default",t.TERMINAL_HANDLE="pointer",t.BEND_HANDLE="crosshair",t.VIRTUAL_BEND_HANDLE="crosshair",t.CONNECT="pointer"}(T||(T={}));const b="#00FF00",P="#0000FF",I="#FF0000",M="#0000FF",O="#00FF00",A="#FF0000",D="#00FF00",L="#00FF00",R=1,N=1,H=!0,B=!0,U="#FF0000",k=1,V="#0099FF",G=3,F=6,z=4,W="#00FF00",Y="black",X="yellow",K="#0000FF",$="#FF0000",q="#00FFFF",j="#0033FF",Z="Arial,Helvetica",Q=11,J="",tt=1.2,et="normal",it=!1,st=0,nt=40,lt=6,at=24,rt=30,ot=.15,ht=20,dt=0,ut=30,ct=30,gt=[0,0,827,1169],pt=[0,0,1169,827],ft=[0,0,850,1100],Et=[0,0,1100,850],Ct="none";var yt,vt,mt,St,wt;!function(t){t[t.BOLD=1]="BOLD",t[t.ITALIC=2]="ITALIC",t[t.UNDERLINE=4]="UNDERLINE",t[t.STRIKETHROUGH=8]="STRIKETHROUGH"}(yt||(yt={})),function(t){t.CLASSIC="classic",t.CLASSIC_THIN="classicThin",t.BLOCK="block",t.BLOCK_THIN="blockThin",t.OPEN="open",t.OPEN_THIN="openThin",t.OVAL="oval",t.DIAMOND="diamond",t.DIAMOND_THIN="diamondThin"}(vt||(vt={})),function(t){t.LEFT="left",t.CENTER="center",t.RIGHT="right",t.TOP="top",t.MIDDLE="middle",t.BOTTOM="bottom"}(mt||(mt={})),function(t){t.NORTH="north",t.SOUTH="south",t.EAST="east",t.WEST="west"}(St||(St={})),function(t){t.DEFAULT="",t.AUTO="auto",t.LTR="ltr",t.RTL="rtl"}(wt||(wt={}));const _t={NONE:0,WEST:1,NORTH:2,SOUTH:4,EAST:8,ALL:15};var xt,Tt,bt,Pt;!function(t){t.VERTICAL="vertical",t.HORIZONTAL="horizontal"}(xt||(xt={})),function(t){t.ELBOW="elbowEdgeStyle",t.ENTITY_RELATION="entityRelationEdgeStyle",t.LOOP="loopEdgeStyle",t.SIDETOSIDE="sideToSideEdgeStyle",t.TOPTOBOTTOM="topToBottomEdgeStyle",t.ORTHOGONAL="orthogonalEdgeStyle",t.SEGMENT="segmentEdgeStyle",t.MANHATTAN="manhattanEdgeStyle"}(Tt||(Tt={})),function(t){t.ELLIPSE="ellipsePerimeter",t.RECTANGLE="rectanglePerimeter",t.RHOMBUS="rhombusPerimeter",t.HEXAGON="hexagonPerimeter",t.TRIANGLE="trianglePerimeter"}(bt||(bt={})),function(t){t.RECTANGLE="rectangle",t.ELLIPSE="ellipse",t.DOUBLE_ELLIPSE="doubleEllipse",t.RHOMBUS="rhombus",t.LINE="line",t.IMAGE="image",t.ARROW="arrow",t.ARROW_CONNECTOR="arrowConnector",t.LABEL="label",t.CYLINDER="cylinder",t.SWIMLANE="swimlane",t.CONNECTOR="connector",t.ACTOR="actor",t.CLOUD="cloud",t.TRIANGLE="triangle",t.HEXAGON="hexagon"}(Pt||(Pt={}))},118:(t,e,i)=>{i.r(e),i.d(e,{default:()=>n});var s=i(823);const n=class{constructor(t=null){this.eventListeners=[],this.eventsEnabled=!0,this.eventSource=null,this.eventSource=t}isEventsEnabled(){return this.eventsEnabled}setEventsEnabled(t){this.eventsEnabled=t}getEventSource(){return this.eventSource}setEventSource(t){this.eventSource=t}addListener(t,e){this.eventListeners.push({name:t,funct:e})}removeListener(t){let e=0;for(;e<this.eventListeners.length;)this.eventListeners[e].funct===t?this.eventListeners.splice(e,1):e+=1}fireEvent(t,e=null){if(this.isEventsEnabled()){t||(t=new s.default("")),e||(e=this.getEventSource()),e||(e=this);for(const i of this.eventListeners)null!==i.name&&i.name!==t.getName()||i.funct.apply(this,[e,t])}}}},127:(t,e,i)=>{i.r(e),i.d(e,{default:()=>n});class s{static putValue(t,e){s.values[t]=e}static getValue(t){return s.values[t]}static getName(t){for(const e in s.values)if(s.values[e]===t)return e;return null}}s.values={};const n=s},230:(t,e,i)=>{i.r(e),i.d(e,{Cell:()=>o,default:()=>h});var s=i(83),n=i(766),l=i(534),a=i(577),r=i(675);class o{constructor(t=null,e=null,i={}){this.invalidating=!1,this.onInit=null,this.overlays=[],this.id=null,this.value=null,this.geometry=null,this.style={},this.vertex=!1,this.edge=!1,this.connectable=!0,this.visible=!0,this.collapsed=!1,this.parent=null,this.source=null,this.target=null,this.children=[],this.edges=[],this.mxTransient=["id","value","parent","source","target","children","edges"],this.value=t,this.setGeometry(e),this.setStyle(i),this.onInit&&this.onInit()}getChildren(){return this.children||[]}getId(){return this.id}setId(t){this.id=t}getValue(){return this.value}setValue(t){this.value=t}valueChanged(t){const e=this.getValue();return this.setValue(t),e}getGeometry(){return this.geometry}setGeometry(t){this.geometry=t}getStyle(){return this.style}getClonedStyle(){return(0,n.clone)(this.getStyle())}setStyle(t){this.style=t}isVertex(){return this.vertex}setVertex(t){this.vertex=t}isEdge(){return this.edge}setEdge(t){this.edge=t}isConnectable(){return this.connectable}setConnectable(t){this.connectable=t}isVisible(){return this.visible}setVisible(t){this.visible=t}isCollapsed(){return this.collapsed}setCollapsed(t){this.collapsed=t}getParent(){return this.parent}setParent(t){this.parent=t}getTerminal(t=!1){return t?this.source:this.target}setTerminal(t,e){return e?this.source=t:this.target=t,t}getChildCount(){return this.children.length}getIndex(t){return null===t?-1:this.children.indexOf(t)}getChildAt(t){return this.children[t]}insert(t,e){return void 0===e&&(e=this.getChildCount(),t.getParent()===this&&e--),t.removeFromParent(),t.setParent(this),this.children.splice(e,0,t),t}remove(t){let e=null;return t>=0&&(e=this.getChildAt(t),e&&(this.children.splice(t,1),e.setParent(null))),e}removeFromParent(){if(this.parent){const t=this.parent.getIndex(this);this.parent.remove(t)}}getEdgeCount(){return this.edges.length}getEdgeIndex(t){return this.edges.indexOf(t)}getEdgeAt(t){return this.edges[t]}insertEdge(t,e=!1){return t.removeFromTerminal(e),t.setTerminal(this,e),(0===this.edges.length||t.getTerminal(!e)!==this||this.edges.indexOf(t)<0)&&this.edges.push(t),t}removeEdge(t,e=!1){if(null!=t){if(t.getTerminal(!e)!==this&&null!=this.edges){const e=this.getEdgeIndex(t);e>=0&&this.edges.splice(e,1)}t.setTerminal(null,e)}return t}removeFromTerminal(t){const e=this.getTerminal(t);e&&e.removeEdge(this,t)}hasAttribute(t){const e=this.getValue();return(0,r.isNotNullish)(e)&&(e.nodeType===s.NODETYPE.ELEMENT&&e.hasAttribute?e.hasAttribute(t):(0,r.isNotNullish)(e.getAttribute?.(t)))}getAttribute(t,e){const i=this.getValue();return((0,r.isNotNullish)(i)&&i.nodeType===s.NODETYPE.ELEMENT?i.getAttribute?.(t):null)??e}setAttribute(t,e){const i=this.getValue();(0,r.isNotNullish)(i)&&i.nodeType===s.NODETYPE.ELEMENT&&i.setAttribute?.(t,e)}clone(){const t=(0,n.clone)(this,this.mxTransient);return t.setValue(this.cloneValue()),t}cloneValue(){let t=this.getValue();return(0,r.isNotNullish)(t)&&("function"==typeof t.clone?t=t.clone():(0,r.isNotNullish)(t.nodeType)&&t.cloneNode&&(t=t.cloneNode(!0))),t}getNearestCommonAncestor(t){let e=a.default.create(t);if(e.length>0){let i=this,s=a.default.create(i);if(e.length<s.length){i=t;const n=s;s=e,e=n}for(;i&&s;){const t=i.getParent();if(0===e.indexOf(s+a.default.PATH_SEPARATOR)&&t)return i;s=a.default.getParentPath(s),i=t}}return null}isAncestor(t){for(;t&&t!==this;)t=t.getParent();return t===this}getChildVertices(){return this.getChildCells(!0,!1)}getChildEdges(){return this.getChildCells(!1,!0)}getChildCells(t=!1,e=!1){const i=this.getChildCount(),s=[];for(let n=0;n<i;n+=1){const i=this.getChildAt(n);(!e&&!t||e&&i.isEdge()||t&&i.isVertex())&&s.push(i)}return s}getDirectedEdgeCount(t,e=null){let i=0;const s=this.getEdgeCount();for(let n=0;n<s;n+=1){const s=this.getEdgeAt(n);s!==e&&s&&s.getTerminal(t)===this&&(i+=1)}return i}getConnections(){return this.getEdges(!0,!0,!1)}getIncomingEdges(){return this.getEdges(!0,!1,!1)}getOutgoingEdges(){return this.getEdges(!1,!0,!1)}getEdges(t=!0,e=!0,i=!0){const s=this.getEdgeCount(),n=[];for(let l=0;l<s;l+=1){const s=this.getEdgeAt(l),a=s.getTerminal(!0),r=s.getTerminal(!1);(i&&a===r||a!==r&&(t&&r===this||e&&a===this))&&n.push(s)}return n}getOrigin(){let t=new l.default;const e=this.getParent();if(e&&(t=e.getOrigin(),!this.isEdge())){const e=this.getGeometry();e&&(t.x+=e.x,t.y+=e.y)}return t}getDescendants(){return this.filterDescendants(null)}filterDescendants(t){let e=[];(null===t||t(this))&&e.push(this);const i=this.getChildCount();for(let s=0;s<i;s+=1){const i=this.getChildAt(s);e=e.concat(i.filterDescendants(t))}return e}getRoot(){let t=this,e=t;for(;t;)e=t,t=t.getParent();return e}}const h=o},272:(t,e,i)=>{i.r(e),i.d(e,{GlobalConfig:()=>l,StyleDefaultsConfig:()=>a,resetStyleDefaultsConfig:()=>o});var s=i(83),n=i(766);const l={logger:new class{debug(t){}enter(t){}error(t,...e){}info(t){}leave(t,e){}show(){}trace(t){}warn(t){}}},a={shadowColor:s.SHADOWCOLOR,shadowOffsetX:s.SHADOW_OFFSET_X,shadowOffsetY:s.SHADOW_OFFSET_Y,shadowOpacity:s.SHADOW_OPACITY},r={...a},o=()=>{(0,n.shallowCopy)(r,a)}},290:(t,e,i)=>{i.r(e),i.d(e,{default:()=>d,get:()=>a,getAll:()=>r,load:()=>l,post:()=>o,submit:()=>h});var s=i(733);class n{constructor(t,e=null,i="POST",s=!0,n=null,l=null){this.binary=!1,this.withCredentials=!1,this.request=null,this.decodeSimulateValues=!1,this.url=t,this.params=e,this.method=i||"POST",this.async=s,this.username=n,this.password=l}isBinary(){return this.binary}setBinary(t){this.binary=t}getText(){return this.request.responseText}isReady(){return 4===this.request.readyState}getDocumentElement(){const t=this.getXml();return null!=t?t.documentElement:null}getXml(){let t=this.request.responseXML;return null!=t&&null!=t.documentElement||(t=(new DOMParser).parseFromString(this.request.responseText,"text/xml")),t}getStatus(){return null!=this.request?this.request.status:null}create(){const t=new XMLHttpRequest;return this.isBinary()&&t.overrideMimeType&&t.overrideMimeType("text/plain; charset=x-user-defined"),t}send(t=null,e=null,i=null,s=null){this.request=this.create(),null!=this.request&&(null!=t&&(this.request.onreadystatechange=()=>{this.isReady()&&(t(this),this.request.onreadystatechange=null)}),this.request.open(this.method,this.url,this.async,this.username,this.password),this.setRequestHeaders(this.request,this.params),window.XMLHttpRequest&&this.withCredentials&&(this.request.withCredentials="true"),window.XMLHttpRequest&&null!=i&&null!=s&&(this.request.timeout=i,this.request.ontimeout=s),this.request.send(this.params))}setRequestHeaders(t,e){null!=e&&t.setRequestHeader("Content-Type","application/x-www-form-urlencoded")}simulate(t,e=null){let i=null;(t=t||document)===document&&(i=window.onbeforeunload,window.onbeforeunload=null);const n=t.createElement("form");n.setAttribute("method",this.method),n.setAttribute("action",this.url),null!=e&&n.setAttribute("target",e),n.style.display="none",n.style.visibility="hidden";const l=this.params,a=l.indexOf("&")>0?l.split("&"):l.split(" ");for(let e=0;e<a.length;e+=1){const i=a[e].indexOf("=");if(i>0){const l=a[e].substring(0,i);let r=a[e].substring(i+1);this.decodeSimulateValues&&(r=decodeURIComponent(r));const o=t.createElement("textarea");o.setAttribute("wrap","off"),o.setAttribute("name",l),(0,s.write)(o,r),n.appendChild(o)}}t.body.appendChild(n),n.submit(),null!=n.parentNode&&n.parentNode.removeChild(n),null!=i&&(window.onbeforeunload=i)}}const l=t=>{const e=new n(t,null,"GET",!1);return e.send(),e},a=(t,e=null,i=null,s=!1,l=null,a=null,r=null)=>{const o=new n(t,null,"GET"),{setRequestHeaders:h}=o;return r&&(o.setRequestHeaders=(t,e)=>{h.apply(void 0,[t,e]);for(const e in r)t.setRequestHeader(e,r[e])}),null!=s&&o.setBinary(s),o.send(e,i,l,a),o},r=(t,e,i)=>{let s=t.length;const n=[];let l=0;const r=()=>{0==l&&null!=i&&i(),l++};for(let i=0;i<t.length;i+=1)((t,i)=>{a(t,(t=>{const l=t.getStatus();l<200||l>299?r():(n[i]=t,s--,0==s&&e(n))}),r)})(t[i],i);0==s&&e(n)},o=(t,e=null,i,s=null)=>new n(t,e).send(i,s),h=(t,e,i,s)=>new n(t,e).simulate(i,s),d=n},301:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{default:()=>__WEBPACK_DEFAULT_EXPORT__});var _util_ObjectIdentity__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(909),_util_config__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(272),_view_geometry_Geometry__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(798),_view_geometry_Point__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(534),_util_Constants__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(83),_util_mathUtils__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(633),_util_domUtils__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(733),_util_MaxXmlRequest__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(290);class ObjectCodec{constructor(t,e=[],i=[],s={}){this.template=t,this.exclude=e,this.idrefs=i,this.mapping=s,this.reverse={};for(const t in this.mapping)this.reverse[this.mapping[t]]=t}getName(){return this.name??this.template.constructor.name}setName(t){this.name=t}cloneTemplate(){return new this.template.constructor}getFieldName(t){if(null!=t){const e=this.reverse[t];null!=e&&(t=e)}return t}getAttributeName(t){if(null!=t){const e=this.mapping[t];null!=e&&(t=e)}return t}isExcluded(t,e,i,s){return e==_util_ObjectIdentity__WEBPACK_IMPORTED_MODULE_0__.default.FIELD_NAME||this.exclude.indexOf(e)>=0}isReference(t,e,i,s){return this.idrefs.indexOf(e)>=0}encode(t,e){const i=t.document.createElement(this.getName());return e=this.beforeEncode(t,e,i),this.encodeObject(t,e,i),this.afterEncode(t,e,i)}encodeObject(t,e,i){t.setAttribute(i,"id",t.getId(e));for(const s in e){let n=s;const l=e[n];null==l||this.isExcluded(e,n,l,!0)||((0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_1__.isInteger)(n)&&(n=null),this.encodeValue(t,e,n,l,i))}}encodeValue(t,e,i,s,n){if(null!=s){if(null!=i&&this.isReference(e,i,s,!0)){const e=t.getId(s);if(null==e)return void _util_config__WEBPACK_IMPORTED_MODULE_2__.GlobalConfig.logger.warn(`ObjectCodec.encode: No ID for ${this.getName()}.${i}=${s}`);s=e}(null==i||t.encodeDefaults||this.template[i]!=s)&&(i=this.getAttributeName(i),this.writeAttribute(t,e,i,s,n))}}writeAttribute(t,e,i,s,n){"object"!=typeof s?this.writePrimitiveAttribute(t,e,i,s,n):this.writeComplexAttribute(t,e,i,s,n)}writePrimitiveAttribute(t,e,i,s,n){if(s=this.convertAttributeToXml(t,e,i,s,n),null==i){const e=t.document.createElement("add");"function"==typeof s?e.appendChild(t.document.createTextNode(s)):t.setAttribute(e,"value",s),n.appendChild(e)}else"function"!=typeof s&&t.setAttribute(n,i,s)}writeComplexAttribute(t,e,i,s,n){const l=t.encode(s);null!=l?(null!=i&&l.setAttribute("as",i),n.appendChild(l)):_util_config__WEBPACK_IMPORTED_MODULE_2__.GlobalConfig.logger.warn(`ObjectCodec.encode: No node for ${this.getName()}.${i}: ${s}`)}convertAttributeToXml(t,e,i,s,n){return this.isBooleanAttribute(t,e,i,s)&&(s=1==s?"1":"0"),s}isBooleanAttribute(t,e,i,s){return void 0===s.length&&(1==s||0==s)}convertAttributeFromXml(t,e,i){let{value:s}=e;return this.isNumericAttribute(t,e,i)&&(s=parseFloat(s),!Number.isNaN(s)&&Number.isFinite(s)||(s=0)),s}isNumericAttribute(t,e,i){return i.constructor===_view_geometry_Geometry__WEBPACK_IMPORTED_MODULE_3__.default&&("x"===e.name||"y"===e.name||"width"===e.name||"height"===e.name)||i.constructor===_view_geometry_Point__WEBPACK_IMPORTED_MODULE_4__.default&&("x"===e.name||"y"===e.name)||(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_1__.isNumeric)(e.value)}beforeEncode(t,e,i){return e}afterEncode(t,e,i){return i}decode(t,e,i){const s=e.getAttribute("id");let n=t.objects[s];null==n&&(n=i||this.cloneTemplate(),null!=s&&t.putObject(s,n));const l=this.beforeDecode(t,e,n);return this.decodeNode(t,l,n),this.afterDecode(t,l,n)}decodeNode(t,e,i){null!=e&&(this.decodeAttributes(t,e,i),this.decodeChildren(t,e,i))}decodeAttributes(t,e,i){const s=e.attributes;if(null!=s)for(let e=0;e<s.length;e+=1)this.decodeAttribute(t,s[e],i)}isIgnoredAttribute(t,e,i){return"as"===e.nodeName||"id"===e.nodeName}decodeAttribute(t,e,i){if(!this.isIgnoredAttribute(t,e,i)){const s=e.nodeName;let n=this.convertAttributeFromXml(t,e,i);const l=this.getFieldName(s);if(this.isReference(i,l,n,!1)){const e=t.getObject(n);if(null==e)return void _util_config__WEBPACK_IMPORTED_MODULE_2__.GlobalConfig.logger.warn(`ObjectCodec.decode: No object for ${this.getName()}.${s}=${n}`);n=e}this.isExcluded(i,s,n,!1)||(i[s]=n)}}decodeChildren(t,e,i){let s=e.firstChild;for(;null!=s;){const e=s.nextSibling;s.nodeType!==_util_Constants__WEBPACK_IMPORTED_MODULE_5__.NODETYPE.ELEMENT||this.processInclude(t,s,i)||this.decodeChild(t,s,i),s=e}}decodeChild(dec,child,obj){const fieldname=this.getFieldName(child.getAttribute("as"));if(null==fieldname||!this.isExcluded(obj,fieldname,child,!1)){const template=this.getFieldTemplate(obj,fieldname,child);let value=null;"add"===child.nodeName?(value=child.getAttribute("value"),null==value&&ObjectCodec.allowEval&&(value=eval((0,_util_domUtils__WEBPACK_IMPORTED_MODULE_6__.getTextContent)(child)))):value=dec.decode(child,template);try{this.addObjectValue(obj,fieldname,value,template)}catch(t){throw new Error(`${t.message} for ${child.nodeName}`)}}}getFieldTemplate(t,e,i){let s=t[e];return s instanceof Array&&s.length>0&&(s=null),s}addObjectValue(t,e,i,s){null!=i&&i!==s&&(null!=e&&e.length>0?t[e]=i:t.push(i))}processInclude(t,e,i){if("include"===e.nodeName){const s=e.getAttribute("name");if(null!=s)try{const e=(0,_util_MaxXmlRequest__WEBPACK_IMPORTED_MODULE_7__.load)(s).getDocumentElement();null!=e&&t.decode(e,i)}catch(t){}return!0}return!1}beforeDecode(t,e,i){return e}afterDecode(t,e,i){return i}}ObjectCodec.allowEval=!1;const __WEBPACK_DEFAULT_EXPORT__=ObjectCodec},306:(t,e,i)=>{i.r(e),i.d(e,{default:()=>l});var s=i(83);class n{}n.basePath=".",n.setBasePath=t=>{void 0!==t&&t.length>0?("/"===t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),n.basePath=t):n.basePath="."},n.imageBasePath=".",n.setImageBasePath=t=>{void 0!==t&&t.length>0?("/"===t.substring(t.length-1)&&(t=t.substring(0,t.length-1)),n.imageBasePath=t):n.imageBasePath=`${n.basePath}/images`},n.IS_EDGE="undefined"!=typeof window&&null!=navigator.userAgent&&!!navigator.userAgent.match(/Edge\//),n.IS_NS="undefined"!=typeof window&&null!=navigator.userAgent&&navigator.userAgent.indexOf("Mozilla/")>=0&&navigator.userAgent.indexOf("MSIE")<0&&navigator.userAgent.indexOf("Edge/")<0,n.IS_SF="undefined"!=typeof window&&/Apple Computer, Inc/.test(navigator.vendor),n.IS_ANDROID="undefined"!=typeof window&&navigator.appVersion.indexOf("Android")>=0,n.IS_IOS="undefined"!=typeof window&&/iP(hone|od|ad)/.test(navigator.platform),n.IS_GC="undefined"!=typeof window&&/Google Inc/.test(navigator.vendor),n.IS_CHROMEAPP="undefined"!=typeof window&&null!=window.chrome&&null!=chrome.app&&null!=chrome.app.runtime,n.IS_FF=navigator.userAgent.toLowerCase().indexOf("firefox")>-1,n.IS_MT="undefined"!=typeof window&&(navigator.userAgent.indexOf("Firefox/")>=0&&navigator.userAgent.indexOf("Firefox/1.")<0&&navigator.userAgent.indexOf("Firefox/2.")<0||navigator.userAgent.indexOf("Iceweasel/")>=0&&navigator.userAgent.indexOf("Iceweasel/1.")<0&&navigator.userAgent.indexOf("Iceweasel/2.")<0||navigator.userAgent.indexOf("SeaMonkey/")>=0&&navigator.userAgent.indexOf("SeaMonkey/1.")<0||navigator.userAgent.indexOf("Iceape/")>=0&&navigator.userAgent.indexOf("Iceape/1.")<0),n.IS_SVG="undefined"!=typeof window&&"MICROSOFT INTERNET EXPLORER"!==navigator.appName.toUpperCase(),n.NO_FO="undefined"!=typeof window&&(!document.createElementNS||"[object SVGForeignObjectElement]"!==document.createElementNS(s.NS_SVG,"foreignObject").toString()||navigator.userAgent.indexOf("Opera/")>=0),n.IS_WIN="undefined"!=typeof window&&navigator.appVersion.indexOf("Win")>0,n.IS_MAC="undefined"!=typeof window&&navigator.appVersion.indexOf("Mac")>0,n.IS_CHROMEOS="undefined"!=typeof window&&/\bCrOS\b/.test(navigator.appVersion),n.IS_TOUCH="undefined"!=typeof window&&"ontouchstart"in document.documentElement,n.IS_POINTER="undefined"!=typeof window&&null!=window.PointerEvent&&!(navigator.appVersion.indexOf("Mac")>0),n.IS_LOCAL="undefined"!=typeof window&&document.location.href.indexOf("http://")<0&&document.location.href.indexOf("https://")<0;const l=n},315:(t,e,i)=>{i.r(e),i.d(e,{default:()=>a});var s=i(83),n=i(341);class l extends n.default{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}isHtmlAllowed(){let t=!0;return this.style&&null!=this.style.pointerEvents&&(t=this.style.pointerEvents),!this.isRounded&&!this.glass&&0===this.rotation&&(t||this.fill!==s.NONE)}paintBackground(t,e,i,n,l){let a=!0;if(this.style&&null!=this.style.pointerEvents&&(a=this.style.pointerEvents),a||this.fill!==s.NONE||this.stroke!==s.NONE){if(a||this.fill!==s.NONE||(t.pointerEvents=!1),this.isRounded){let a=0;if(this.style?.absoluteArcSize)a=Math.min(n/2,Math.min(l/2,(this.style?.arcSize??s.LINE_ARCSIZE)/2));else{const t=(this.style?.arcSize??100*s.RECTANGLE_ROUNDING_FACTOR)/100;a=Math.min(n*t,l*t)}t.roundrect(e,i,n,l,a,a)}else t.rect(e,i,n,l);t.fillAndStroke()}}isRoundable(t,e,i,s,n){return!0}paintForeground(t,e,i,n,l){this.glass&&!this.outline&&this.fill!==s.NONE&&this.paintGlassEffect(t,e,i,n,l,this.getArcSize(n+this.strokeWidth,l+this.strokeWidth))}}const a=l},341:(t,e,i)=>{i.r(e),i.d(e,{default:()=>c});var s=i(989),n=i(675),l=i(633),a=i(83),r=i(534),o=i(730),h=i(603),d=i(306),u=i(272);const c=class{constructor(t=null){this.preserveImageAspect=!1,this.overlay=null,this.indicator=null,this.indicatorShape=null,this.opacity=100,this.isDashed=!1,this.fill=a.NONE,this.gradient=a.NONE,this.gradientDirection=a.DIRECTION.EAST,this.fillOpacity=100,this.strokeOpacity=100,this.stroke=a.NONE,this.strokeWidth=1,this.spacing=0,this.startSize=1,this.endSize=1,this.startArrow=a.NONE,this.endArrow=a.NONE,this.direction=a.DIRECTION.EAST,this.flipH=!1,this.flipV=!1,this.isShadow=!1,this.isRounded=!1,this.rotation=0,this.cursor="",this.verticalTextRotation=0,this.oldGradients={},this.glass=!1,this.dialect=null,this.scale=1,this.antiAlias=!0,this.minSvgStrokeWidth=1,this.bounds=null,this.points=[],this.state=null,this.style=null,this.boundingBox=null,this.stencil=null,this.svgStrokeTolerance=8,this.pointerEvents=!0,this.originalPointerEvents=null,this.svgPointerEvents="all",this.shapePointerEvents=!1,this.stencilPointerEvents=!1,this.outline=!1,this.visible=!0,this.useSvgBoundingBox=!0,this.image=null,this.imageSrc=null,this.indicatorColor=a.NONE,this.indicatorStrokeColor=a.NONE,this.indicatorGradientColor=a.NONE,this.indicatorDirection=a.DIRECTION.EAST,this.indicatorImageSrc=null,t&&(this.stencil=t),this.node=this.create()}init(t){this.node.parentNode||t.appendChild(this.node)}initStyles(){this.strokeWidth=1,this.rotation=0,this.opacity=100,this.fillOpacity=100,this.strokeOpacity=100,this.flipH=!1,this.flipV=!1}isHtmlAllowed(){return!1}getSvgScreenOffset(){const t=this.stencil&&"inherit"!==this.stencil.strokeWidthValue?Number(this.stencil.strokeWidthValue):this.strokeWidth??0;return 1===(0,l.mod)(Math.max(1,Math.round(t*this.scale)),2)?.5:0}create(){return document.createElementNS(a.NS_SVG,"g")}redraw(){this.updateBoundsFromPoints(),this.visible&&this.checkBounds()?(this.node.style.visibility="visible",this.clear(),this.redrawShape(),this.updateBoundingBox()):(this.node.style.visibility="hidden",this.boundingBox=null)}clear(){for(;this.node.lastChild;)this.node.removeChild(this.node.lastChild)}updateBoundsFromPoints(){const t=this.points;if(t.length>0&&t[0]){this.bounds=new s.default(Math.round(t[0].x),Math.round(t[0].y),1,1);for(const e of t)e&&this.bounds.add(new s.default(Math.round(e.x),Math.round(e.y),1,1))}}getLabelBounds(t){const e=this.style?.direction??a.DIRECTION.EAST;let i=t.clone();e!==a.DIRECTION.SOUTH&&e!==a.DIRECTION.NORTH&&this.state&&this.state.text&&this.state.text.isPaintBoundsInverted()&&(i=i.clone(),[i.width,i.height]=[i.height,i.width]);let s=this.getLabelMargins(i);if(s){s=s.clone();let e=this.style?.flipH??!1,i=this.style?.flipV??!1;if(this.state&&this.state.text&&this.state.text.isPaintBoundsInverted()){const t=s.x;s.x=s.height,s.height=s.width,s.width=s.y,s.y=t,[e,i]=[i,e]}return(0,l.getDirectedBounds)(t,s,this.style,e,i)}return t}getLabelMargins(t){return null}checkBounds(){return!Number.isNaN(this.scale)&&Number.isFinite(this.scale)&&this.scale>0&&this.bounds&&!Number.isNaN(this.bounds.x)&&!Number.isNaN(this.bounds.y)&&!Number.isNaN(this.bounds.width)&&!Number.isNaN(this.bounds.height)&&this.bounds.width>0&&this.bounds.height>0}redrawShape(){const t=this.createCanvas();t&&(t.pointerEvents=this.pointerEvents,this.beforePaint(t),this.paint(t),this.afterPaint(t),this.node!==t.root&&t.root&&this.node.insertAdjacentHTML("beforeend",t.root.outerHTML),this.destroyCanvas(t))}createCanvas(){const t=this.createSvgCanvas();return t&&this.outline&&(t.setStrokeWidth(this.strokeWidth),t.setStrokeColor(this.stroke),this.isDashed&&t.setDashed(this.isDashed),t.setStrokeWidth=()=>{},t.setStrokeColor=()=>{},t.setFillColor=()=>{},t.setGradient=()=>{},t.setDashed=()=>{},t.text=()=>{}),t}createSvgCanvas(){if(!this.node)return null;const t=new o.default(this.node,!1);t.strokeTolerance=this.pointerEvents?this.svgStrokeTolerance:0,t.pointerEventsValue=this.svgPointerEvents;const e=this.getSvgScreenOffset();return 0!==e?this.node.setAttribute("transform",`translate(${e},${e})`):this.node.removeAttribute("transform"),t.minStrokeWidth=this.minSvgStrokeWidth,this.antiAlias||(t.format=t=>Math.round(t)),t}destroyCanvas(t){if(t instanceof o.default){for(const e in t.gradients){const i=t.gradients[e];i&&(i.mxRefCount=(i.mxRefCount||0)+1)}this.releaseSvgGradients(this.oldGradients),this.oldGradients=t.gradients}}beforePaint(t){}afterPaint(t){}paint(t){let e=!1;if(t&&this.outline){const{stroke:i}=t;t.stroke=(...s)=>{e=!0,i.apply(t,s)};const{fillAndStroke:s}=t;t.fillAndStroke=(...i)=>{e=!0,s.apply(t,i)}}const i=this.scale,s=this.bounds;if(s){let l=s.x/i,a=s.y/i,o=s.width/i,h=s.height/i;if(this.isPaintBoundsInverted()){const t=(o-h)/2;l+=t,a-=t;const e=o;o=h,h=e}this.updateTransform(t,l,a,o,h),this.configureCanvas(t,l,a,o,h);let d=null;if(!this.stencil&&0===this.points.length&&this.shapePointerEvents||this.stencil&&this.stencilPointerEvents){const t=this.createBoundingBox();t&&this.node&&(d=this.createTransparentSvgRectangle(t.x,t.y,t.width,t.height),this.node.appendChild(d))}if(this.stencil)this.stencil.drawShape(t,this,l,a,o,h);else if(t.setStrokeWidth(this.strokeWidth),this.points.length>0){const e=[];for(let t=0;t<this.points.length;t+=1){const s=this.points[t];s&&e.push(new r.default(s.x/i,s.y/i))}this.paintEdgeShape(t,e)}else this.paintVertexShape(t,l,a,o,h);d&&t.state&&(0,n.isNotNullish)(t.state.transform)&&d.setAttribute("transform",t.state.transform),t&&this.outline&&!e&&(t.rect(l,a,o,h),t.stroke())}}configureCanvas(t,e,i,s,n){let l=null;if(this.style&&null!=this.style.dashPattern&&(l=this.style.dashPattern),t.setAlpha(this.opacity/100),t.setFillAlpha(this.fillOpacity/100),t.setStrokeAlpha(this.strokeOpacity/100),this.isShadow&&t.setShadow(this.isShadow),this.isDashed&&t.setDashed(this.isDashed,this.style?.fixDash??!1),l&&t.setDashPattern(l),this.fill!==a.NONE&&this.gradient!==a.NONE){const l=this.getGradientBounds(t,e,i,s,n);t.setGradient(this.fill,this.gradient,l.x,l.y,l.width,l.height,this.gradientDirection)}else t.setFillColor(this.fill);t.setStrokeColor(this.stroke)}getGradientBounds(t,e,i,n,l){return new s.default(e,i,n,l)}updateTransform(t,e,i,s,n){t.scale(this.scale),t.rotate(this.getShapeRotation(),this.flipH,this.flipV,e+s/2,i+n/2)}paintVertexShape(t,e,i,s,n){this.paintBackground(t,e,i,s,n),this.outline&&this.style&&this.style.backgroundOutline||(t.setShadow(!1),this.paintForeground(t,e,i,s,n))}paintBackground(t,e,i,s,n){}paintForeground(t,e,i,s,n){}paintEdgeShape(t,e){}getArcSize(t,e){let i=0;if(this.style?.absoluteArcSize)i=Math.min(t/2,Math.min(e/2,(this.style?.arcSize??a.LINE_ARCSIZE)/2));else{const s=(this.style?.arcSize??100*a.RECTANGLE_ROUNDING_FACTOR)/100;i=Math.min(t*s,e*s)}return i}paintGlassEffect(t,e,i,s,n,l){const a=Math.ceil((this.strokeWidth??0)/2),r=.4;t.setGradient("#ffffff","#ffffff",e,i,s,.6*n,"south",.9,.1),t.begin(),l+=2*a,this.isRounded?(t.moveTo(e-a+l,i-a),t.quadTo(e-a,i-a,e-a,i-a+l),t.lineTo(e-a,i+n*r),t.quadTo(e+.5*s,i+.7*n,e+s+a,i+n*r),t.lineTo(e+s+a,i-a+l),t.quadTo(e+s+a,i-a,e+s+a-l,i-a)):(t.moveTo(e-a,i-a),t.lineTo(e-a,i+n*r),t.quadTo(e+.5*s,i+.7*n,e+s+a,i+n*r),t.lineTo(e+s+a,i-a)),t.close(),t.fill()}addPoints(t,e,i=!1,s,n=!1,a=[],o=!0){if(e.length>0){const h=e[e.length-1];if(n&&i){const t=(e=e.slice())[0],i=new r.default(h.x+(t.x-h.x)/2,h.y+(t.y-h.y)/2);e.splice(0,0,i)}let d=e[0],u=1;for(o?t.moveTo(d.x,d.y):t.lineTo(d.x,d.y);u<(n?e.length:e.length-1);){let n=e[(0,l.mod)(u,e.length)],o=d.x-n.x,h=d.y-n.y;if(i&&(0!==o||0!==h)&&a.indexOf(u-1)<0){let i=Math.sqrt(o*o+h*h);const a=o*Math.min(s,i/2)/i,d=h*Math.min(s,i/2)/i,c=n.x+a,g=n.y+d;t.lineTo(c,g);let p=e[(0,l.mod)(u+1,e.length)];for(;u<e.length-2&&0===Math.round(p.x-n.x)&&0===Math.round(p.y-n.y);)p=e[(0,l.mod)(u+2,e.length)],u++;o=p.x-n.x,h=p.y-n.y,i=Math.max(1,Math.sqrt(o*o+h*h));const f=o*Math.min(s,i/2)/i,E=h*Math.min(s,i/2)/i,C=n.x+f,y=n.y+E;t.quadTo(n.x,n.y,C,y),n=new r.default(C,y)}else t.lineTo(n.x,n.y);d=n,u+=1}n?t.close():t.lineTo(h.x,h.y)}}resetStyles(){this.initStyles(),this.spacing=0,this.fill=a.NONE,this.gradient=a.NONE,this.gradientDirection=a.DIRECTION.EAST,this.stroke=a.NONE,this.startSize=1,this.endSize=1,this.startArrow=a.NONE,this.endArrow=a.NONE,this.direction=a.DIRECTION.EAST,this.isShadow=!1,this.isDashed=!1,this.isRounded=!1,this.glass=!1}apply(t){if(this.state=t,this.style=t.style,this.style){if(this.fill=this.style.fillColor??this.fill,this.gradient=this.style.gradientColor??this.gradient,this.gradientDirection=this.style.gradientDirection??this.gradientDirection,this.opacity=this.style.opacity??this.opacity,this.fillOpacity=this.style.fillOpacity??this.fillOpacity,this.strokeOpacity=this.style.strokeOpacity??this.strokeOpacity,this.stroke=this.style.strokeColor??this.stroke,this.strokeWidth=this.style.strokeWidth??this.strokeWidth,this.spacing=this.style.spacing??this.spacing,this.startSize=this.style.startSize??this.startSize,this.endSize=this.style.endSize??this.endSize,this.startArrow=this.style.startArrow??this.startArrow,this.endArrow=this.style.endArrow??this.endArrow,this.rotation=this.style.rotation??this.rotation,this.direction=this.style.direction??this.direction,this.flipH=!!this.style.flipH,this.flipV=!!this.style.flipV,this.direction===a.DIRECTION.NORTH||this.direction===a.DIRECTION.SOUTH){const t=this.flipH;this.flipH=this.flipV,this.flipV=t}this.isShadow=this.style.shadow??this.isShadow,this.isDashed=this.style.dashed??this.isDashed,this.isRounded=this.style.rounded??this.isRounded,this.glass=this.style.glass??this.glass}}setCursor(t){this.cursor=t,this.node.style.cursor=t}getCursor(){return this.cursor}isRoundable(t,e,i,s,n){return!1}updateBoundingBox(){if(this.useSvgBoundingBox&&this.node.ownerSVGElement)try{const t=this.node.getBBox();if(t.width>0&&t.height>0)return this.boundingBox=new s.default(t.x,t.y,t.width,t.height),void this.boundingBox.grow((this.strokeWidth??0)*this.scale/2)}catch(t){}if(this.bounds){let t=this.createBoundingBox();if(t){this.augmentBoundingBox(t);const e=this.getShapeRotation();0!==e&&(t=(0,l.getBoundingBox)(t,e))}this.boundingBox=t}}createBoundingBox(){if(!this.bounds)return null;const t=this.bounds.clone();return(this.stencil&&(this.direction===a.DIRECTION.NORTH||this.direction===a.DIRECTION.SOUTH)||this.isPaintBoundsInverted())&&t.rotate90(),t}augmentBoundingBox(t){this.isShadow&&(t.width+=Math.ceil(u.StyleDefaultsConfig.shadowOffsetX*this.scale),t.height+=Math.ceil(u.StyleDefaultsConfig.shadowOffsetX*this.scale)),t.grow((this.strokeWidth??0)*this.scale/2)}isPaintBoundsInverted(){return!this.stencil&&(this.direction===a.DIRECTION.NORTH||this.direction===a.DIRECTION.SOUTH)}getRotation(){return this.rotation??0}getTextRotation(){let t=this.getRotation();return(this.style?.horizontal??1)||(t+=this.verticalTextRotation||-90),t}getShapeRotation(){let t=this.getRotation();return this.direction===a.DIRECTION.NORTH?t+=270:this.direction===a.DIRECTION.WEST?t+=180:this.direction===a.DIRECTION.SOUTH&&(t+=90),t}createTransparentSvgRectangle(t,e,i,s){const n=document.createElementNS(a.NS_SVG,"rect");return n.setAttribute("x",String(t)),n.setAttribute("y",String(e)),n.setAttribute("width",String(i)),n.setAttribute("height",String(s)),n.setAttribute("fill",a.NONE),n.setAttribute("stroke",a.NONE),n.setAttribute("pointer-events","all"),n}redrawHtmlShape(){}setTransparentBackgroundImage(t){t.style.backgroundImage=`url('${d.default.imageBasePath}/transparent.gif')`}releaseSvgGradients(t){for(const e in t){const i=t[e];i&&(i.mxRefCount=(i.mxRefCount||0)-1,0===i.mxRefCount&&i.parentNode&&i.parentNode.removeChild(i))}}destroy(){h.default.release(this.node),this.node.parentNode&&this.node.parentNode.removeChild(this.node),this.node.innerHTML="",this.releaseSvgGradients(this.oldGradients),this.oldGradients={}}}},437:(t,e,i)=>{i.r(e),i.d(e,{getClientX:()=>l,getClientY:()=>a,getMainEvent:()=>n,getSource:()=>r,isAltDown:()=>y,isConsumed:()=>o,isControlDown:()=>v,isLeftMouseButton:()=>g,isMetaDown:()=>m,isMiddleMouseButton:()=>p,isMouseEvent:()=>c,isMultiTouchEvent:()=>u,isPenEvent:()=>d,isPopupTrigger:()=>E,isRightMouseButton:()=>f,isShiftDown:()=>C,isTouchEvent:()=>h});var s=i(306);const n=t=>{let e=t;return("touchstart"===e.type||"touchmove"===e.type)&&e.touches&&e.touches[0]?e=e.touches[0]:"touchend"===e.type&&e.changedTouches&&e.changedTouches[0]&&(e=e.changedTouches[0]),e},l=t=>n(t).clientX,a=t=>n(t).clientY,r=t=>t.target,o=t=>{const e=t;return void 0!==e.isConsumed&&e.isConsumed},h=t=>{const e=t;return e.pointerType?"touch"===e.pointerType||e.pointerType===e.MSPOINTER_TYPE_TOUCH:void 0!==e.mozInputSource?5===e.mozInputSource:0===e.type.indexOf("touch")},d=t=>{const e=t;return e.pointerType?"pen"==e.pointerType||e.pointerType===e.MSPOINTER_TYPE_PEN:void 0!==e.mozInputSource?2===e.mozInputSource:0===e.type.indexOf("pen")},u=t=>{const e=t;return e.type&&0==e.type.indexOf("touch")&&void 0!==e.touches&&e.touches.length>1},c=t=>{const e=t;return e.pointerType?"mouse"==e.pointerType||e.pointerType===e.MSPOINTER_TYPE_MOUSE:void 0!==e.mozInputSource?1===e.mozInputSource:0===e.type.indexOf("mouse")},g=t=>!("buttons"in t)||"mousedown"!==t.type&&"mousemove"!==t.type?void 0!==t.which?1===t.which:1===t.button:1===t.buttons,p=t=>4===t.button,f=t=>2===t.button,E=t=>f(t)||s.default.IS_MAC&&v(t)&&!C(t)&&!m(t)&&!y(t),C=t=>t.shiftKey,y=t=>t.altKey,v=t=>t.ctrlKey,m=t=>t.metaKey},534:(t,e,i)=>{i.r(e),i.d(e,{default:()=>n});class s{constructor(t=0,e=0){this._x=0,this._y=0,this.x=t,this.y=e}get x(){return this._x}set x(t){if(Number.isNaN(t))throw new Error("Invalid x supplied.");this._x=t}get y(){return this._y}set y(t){if(Number.isNaN(t))throw new Error("Invalid y supplied.");this._y=t}equals(t){return!!t&&t.x===this.x&&t.y===this.y}clone(){return new s(this.x,this.y)}}const n=s},568:(t,e,i)=>{i.r(e),i.d(e,{getFunctionName:()=>o,htmlEntities:()=>u,ltrim:()=>l,removeWhitespace:()=>d,replaceTrailingNewlines:()=>h,rtrim:()=>a,toString:()=>c,trim:()=>r});var s=i(83),n=i(733);const l=(t,e="\\s")=>null!=t?t.replace(new RegExp(`^[${e}]+`,"g"),""):null,a=(t,e="\\s")=>null!=t?t.replace(new RegExp(`[${e}]+$`,"g"),""):null,r=(t,e)=>l(a(t,e),e),o=t=>{let e=null;if(null!=t)if(null!=t.name)e=t.name;else if(e=r(t.toString()),null!==e&&/^function\s/.test(e)&&(e=l(e.substring(9)),null!==e)){const t=e.indexOf("(");t>0&&(e=e.substring(0,t))}return e},h=(t,e)=>{let i="";for(;t.length>0&&"\n"==t.charAt(t.length-1);)t=t.substring(0,t.length-1),i+=e;return t+i},d=(t,e)=>{let i=e?t.previousSibling:t.nextSibling;for(;null!=i&&i.nodeType===s.NODETYPE.TEXT;){const t=e?i.previousSibling:i.nextSibling,s=(0,n.getTextContent)(i);0===r(s)?.length&&i.parentNode?.removeChild(i),i=t}},u=(t,e=!0)=>(t=(t=(t=(t=(t=(t=String(t||"")).replace(/&/g,"&amp;")).replace(/"/g,"&quot;")).replace(/'/g,"&#39;")).replace(/</g,"&lt;")).replace(/>/g,"&gt;"),e&&(t=t.replace(/\n/g,"&#xa;")),t),c=t=>{let e="";for(const i in t)try{null==t[i]?e+=`${i} = [null]\n`:"function"==typeof t[i]?e+=`${i} => [Function]\n`:"object"==typeof t[i]?e+=`${i} => [${o(t[i].constructor)}]\n`:e+=`${i} = ${t[i]}\n`}catch(t){e+=`${i}=${t.message}`}return e}},577:(t,e,i)=>{i.r(e),i.d(e,{default:()=>n});class s{constructor(){throw new Error("Static class can't be instantiated!")}static create(t){let e="",i=t.getParent();for(;i;)e=i.getIndex(t)+s.PATH_SEPARATOR+e,i=(t=i).getParent();const n=e.length;return n>1&&(e=e.substring(0,n-1)),e}static getParentPath(t){const e=t.lastIndexOf(s.PATH_SEPARATOR);return e>=0?t.substring(0,e):t.length>0?"":null}static resolve(t,e){let i=t;const n=e.split(s.PATH_SEPARATOR);for(let t=0;t<n.length;t+=1)i=i.getChildAt(parseInt(n[t]));return i}static compare(t,e){const i=Math.min(t.length,e.length);let s=0;for(let n=0;n<i;n+=1)if(t[n]!==e[n]){if(0===t[n].length||0===e[n].length)s=t[n]===e[n]?0:t[n]>e[n]?1:-1;else{const i=parseInt(t[n]),l=parseInt(e[n]);s=i===l?0:i>l?1:-1}break}if(0===s){const i=t.length,n=e.length;i!==n&&(s=i>n?1:-1)}return s}}s.PATH_SEPARATOR=".";const n=s},592:(t,e,i)=>{i.r(e),i.d(e,{default:()=>l});var s=i(603),n=i(823);const l=class{constructor(t,e=!0){this.changes=[],this.significant=!0,this.undone=!1,this.redone=!1,this.source=t,this.changes=[],this.significant=e}isEmpty(){return 0===this.changes.length}isSignificant(){return this.significant}add(t){this.changes.push(t)}notify(){}die(){}undo(){if(!this.undone){this.source.fireEvent(new n.default(s.default.START_EDIT));for(let t=this.changes.length-1;t>=0;t--){const e=this.changes[t];e.execute?e.execute():e.undo&&e.undo(),this.source.fireEvent(new n.default(s.default.EXECUTED,{change:e}))}this.undone=!0,this.redone=!1,this.source.fireEvent(new n.default(s.default.END_EDIT))}this.notify()}redo(){if(!this.redone){this.source.fireEvent(new n.default(s.default.START_EDIT));const t=this.changes.length;for(let e=0;e<t;e+=1){const t=this.changes[e];null!=t.execute?t.execute():null!=t.redo&&t.redo(),this.source.fireEvent(new n.default(s.default.EXECUTED,{change:t}))}this.undone=!1,this.redone=!0,this.source.fireEvent(new n.default(s.default.END_EDIT))}this.notify()}}},603:(t,e,i)=>{i.r(e),i.d(e,{default:()=>o});var s=i(966),n=i(306),l=i(437);let a=!1;try{document.addEventListener("test",(()=>{}),Object.defineProperty&&Object.defineProperty({},"passive",{get:()=>{a=!0}}))}catch(t){}class r{static addListener(t,e,i){t.addEventListener(e,i,!!a&&{passive:!1}),t.mxListenerList||(t.mxListenerList=[]);const s={name:e,f:i};t.mxListenerList.push(s)}static removeListener(t,e,i){if(t.removeEventListener(e,i,!1),t.mxListenerList){const e=t.mxListenerList.length;for(let s=0;s<e;s+=1)if(t.mxListenerList[s].f===i){t.mxListenerList.splice(s,1);break}}}static removeAllListeners(t){const e=t.mxListenerList;if(e)for(;e.length>0;){const i=e[0];r.removeListener(t,i.name,i.f)}}static addGestureListeners(t,e=null,i=null,s=null){e&&r.addListener(t,n.default.IS_POINTER?"pointerdown":"mousedown",e),i&&r.addListener(t,n.default.IS_POINTER?"pointermove":"mousemove",i),s&&r.addListener(t,n.default.IS_POINTER?"pointerup":"mouseup",s),!n.default.IS_POINTER&&n.default.IS_TOUCH&&(e&&r.addListener(t,"touchstart",e),i&&r.addListener(t,"touchmove",i),s&&r.addListener(t,"touchend",s))}static removeGestureListeners(t,e,i,s){e&&r.removeListener(t,n.default.IS_POINTER?"pointerdown":"mousedown",e),i&&r.removeListener(t,n.default.IS_POINTER?"pointermove":"mousemove",i),s&&r.removeListener(t,n.default.IS_POINTER?"pointerup":"mouseup",s),!n.default.IS_POINTER&&n.default.IS_TOUCH&&(e&&r.removeListener(t,"touchstart",e),i&&r.removeListener(t,"touchmove",i),s&&r.removeListener(t,"touchend",s))}static redirectMouseEvents(t,e,i=null,n=null,a=null,o=null,h=null){const d=t=>"function"==typeof i?i(t):i;r.addGestureListeners(t,(t=>{n?n(t):(0,l.isConsumed)(t)||e.fireMouseEvent(r.MOUSE_DOWN,new s.default(t,d(t)))}),(t=>{a?a(t):(0,l.isConsumed)(t)||e.fireMouseEvent(r.MOUSE_MOVE,new s.default(t,d(t)))}),(t=>{o?o(t):(0,l.isConsumed)(t)||e.fireMouseEvent(r.MOUSE_UP,new s.default(t,d(t)))})),r.addListener(t,"dblclick",(t=>{if(h)h(t);else if(!(0,l.isConsumed)(t)){const i=d(t);e.dblClick(t,i?.cell)}}))}static release(t){try{r.removeAllListeners(t);const e=t.childNodes;if(void 0!==e){const t=e.length;for(let i=0;i<t;i+=1)r.release(e[i])}}catch(t){}}static addMouseWheelListener(t,e){if(null!=t){const i=e=>{e.ctrlKey&&e.preventDefault(),(Math.abs(e.deltaX)>.5||Math.abs(e.deltaY)>.5)&&t(e,0==e.deltaY?-e.deltaX>0:-e.deltaY>0)};if(e=null!=e?e:window,n.default.IS_SF&&!n.default.IS_TOUCH){let i=1;r.addListener(e,"gesturestart",(t=>{r.consume(t),i=1})),r.addListener(e,"gesturechange",(e=>{if(r.consume(e),"number"==typeof e.scale){const s=i-e.scale;Math.abs(s)>.2&&(t(e,s<0,!0),i=e.scale)}})),r.addListener(e,"gestureend",(t=>{r.consume(t)}))}else{let i=[],s=0,n=0;r.addGestureListeners(e,(t=>{(0,l.isMouseEvent)(t)||null==t.pointerId||i.push(t)}),(e=>{if(!(0,l.isMouseEvent)(e)&&2==i.length){for(let t=0;t<i.length;t+=1)if(e.pointerId==i[t].pointerId){i[t]=e;break}const l=Math.abs(i[0].clientX-i[1].clientX),a=Math.abs(i[0].clientY-i[1].clientY),o=Math.abs(l-s),h=Math.abs(a-n);if(o>r.PINCH_THRESHOLD||h>r.PINCH_THRESHOLD){const e=i[0].clientX+(i[1].clientX-i[0].clientX)/2,r=i[0].clientY+(i[1].clientY-i[0].clientY)/2;t(i[0],o>h?l>s:a>n,!0,e,r),s=l,n=a}}}),(t=>{i=[],s=0,n=0}))}r.addListener(e,"wheel",i)}}static disableContextMenu(t){r.addListener(t,"contextmenu",(t=>(t.preventDefault&&t.preventDefault(),!1)))}static consume(t,e=!0,i=!0){e&&(t.preventDefault?(i&&t.stopPropagation(),t.preventDefault()):i&&(t.cancelBubble=!0)),t.isConsumed=!0,t.preventDefault||(t.returnValue=!1)}}r.LABEL_HANDLE=-1,r.ROTATION_HANDLE=-2,r.CUSTOM_HANDLE=-100,r.VIRTUAL_HANDLE=-1e5,r.MOUSE_DOWN="mouseDown",r.MOUSE_MOVE="mouseMove",r.MOUSE_UP="mouseUp",r.ACTIVATE="activate",r.RESIZE_START="resizeStart",r.RESIZE="resize",r.RESIZE_END="resizeEnd",r.MOVE_START="moveStart",r.MOVE="move",r.MOVE_END="moveEnd",r.PAN_START="panStart",r.PAN="pan",r.PAN_END="panEnd",r.MINIMIZE="minimize",r.NORMALIZE="normalize",r.MAXIMIZE="maximize",r.HIDE="hide",r.SHOW="show",r.CLOSE="close",r.DESTROY="destroy",r.REFRESH="refresh",r.SIZE="size",r.SELECT="select",r.FIRED="fired",r.FIRE_MOUSE_EVENT="fireMouseEvent",r.GESTURE="gesture",r.TAP_AND_HOLD="tapAndHold",r.GET="get",r.RECEIVE="receive",r.CONNECT="connect",r.DISCONNECT="disconnect",r.SUSPEND="suspend",r.RESUME="resume",r.MARK="mark",r.ROOT="root",r.POST="post",r.OPEN="open",r.SAVE="save",r.BEFORE_ADD_VERTEX="beforeAddVertex",r.ADD_VERTEX="addVertex",r.AFTER_ADD_VERTEX="afterAddVertex",r.DONE="done",r.EXECUTE="execute",r.EXECUTED="executed",r.BEGIN_UPDATE="beginUpdate",r.START_EDIT="startEdit",r.END_UPDATE="endUpdate",r.END_EDIT="endEdit",r.BEFORE_UNDO="beforeUndo",r.UNDO="undo",r.REDO="redo",r.CHANGE="change",r.NOTIFY="notify",r.LAYOUT_CELLS="layoutCells",r.CLICK="click",r.SCALE="scale",r.TRANSLATE="translate",r.SCALE_AND_TRANSLATE="scaleAndTranslate",r.UP="up",r.DOWN="down",r.ADD="add",r.REMOVE="remove",r.CLEAR="clear",r.ADD_CELLS="addCells",r.CELLS_ADDED="cellsAdded",r.MOVE_CELLS="moveCells",r.CELLS_MOVED="cellsMoved",r.RESIZE_CELLS="resizeCells",r.CELLS_RESIZED="cellsResized",r.TOGGLE_CELLS="toggleCells",r.CELLS_TOGGLED="cellsToggled",r.ORDER_CELLS="orderCells",r.CELLS_ORDERED="cellsOrdered",r.REMOVE_CELLS="removeCells",r.CELLS_REMOVED="cellsRemoved",r.GROUP_CELLS="groupCells",r.UNGROUP_CELLS="ungroupCells",r.REMOVE_CELLS_FROM_PARENT="removeCellsFromParent",r.FOLD_CELLS="foldCells",r.CELLS_FOLDED="cellsFolded",r.ALIGN_CELLS="alignCells",r.LABEL_CHANGED="labelChanged",r.CONNECT_CELL="connectCell",r.CELL_CONNECTED="cellConnected",r.SPLIT_EDGE="splitEdge",r.FLIP_EDGE="flipEdge",r.START_EDITING="startEditing",r.EDITING_STARTED="editingStarted",r.EDITING_STOPPED="editingStopped",r.ADD_OVERLAY="addOverlay",r.REMOVE_OVERLAY="removeOverlay",r.UPDATE_CELL_SIZE="updateCellSize",r.ESCAPE="escape",r.DOUBLE_CLICK="doubleClick",r.START="start",r.RESET="reset",r.PINCH_THRESHOLD=10;const o=r},633:(t,e,i)=>{i.r(e),i.d(e,{arcToCurves:()=>h,contains:()=>y,findNearestSegment:()=>p,getBoundingBox:()=>d,getDirectedBounds:()=>f,getPerimeterPoint:()=>E,getPortConstraints:()=>c,getRotatedPoint:()=>u,intersection:()=>x,intersects:()=>v,intersectsHotspot:()=>m,isInteger:()=>w,isNumeric:()=>S,mod:()=>_,ptLineDist:()=>b,ptSegDistSq:()=>T,rectangleIntersectsSegment:()=>C,relativeCcw:()=>P,reversePortConstraints:()=>g,toDegree:()=>o,toRadians:()=>r});var s=i(83),n=i(534),l=i(989),a=i(675);const r=t=>Math.PI*t/180,o=t=>180*t/Math.PI,h=(t,e,i,s,n,l,a,r,o)=>{if(r-=t,o-=e,0===i||0===s)return[];const h=a,d=n;i=Math.abs(i),s=Math.abs(s);const u=-r/2,c=-o/2,g=Math.cos(d*Math.PI/180),p=Math.sin(d*Math.PI/180),f=g*u+p*c,E=-1*p*u+g*c,C=f*f,y=E*E,v=i*i,m=s*s,S=C/v+y/m;let w;if(S>1)i=Math.sqrt(S)*i,s=Math.sqrt(S)*s,w=0;else{let t=1;l===h&&(t=-1),w=t*Math.sqrt((v*m-v*y-m*C)/(v*y+m*C))}const _=w*i*E/s,x=-1*w*s*f/i,T=g*_-p*x+r/2,b=p*_+g*x+o/2;let P=Math.atan2((E-x)/s,(f-_)/i)-Math.atan2(0,1),I=P>=0?P:2*Math.PI+P;P=Math.atan2((-E-x)/s,(-f-_)/i)-Math.atan2((E-x)/s,(f-_)/i);let M=P>=0?P:2*Math.PI+P;!h&&M>0?M-=2*Math.PI:h&&M<0&&(M+=2*Math.PI);const O=2*M/Math.PI,A=Math.ceil(O<0?-1*O:O),D=M/A,L=8/3*Math.sin(D/4)*Math.sin(D/4)/Math.sin(D/2),R=g*i,N=g*s,H=p*i,B=p*s;let U=Math.cos(I),k=Math.sin(I),V=-L*(R*k+B*U),G=-L*(H*k-N*U),F=0,z=0;const W=[];for(let i=0;i<A;++i){I+=D,U=Math.cos(I),k=Math.sin(I),F=R*U-B*k+T,z=H*U+N*k+b;const s=-L*(R*k+B*U),n=-L*(H*k-N*U),l=6*i;W[l]=Number(V+t),W[l+1]=Number(G+e),W[l+2]=Number(F-s+t),W[l+3]=Number(z-n+e),W[l+4]=Number(F+t),W[l+5]=Number(z+e),V=F+s,G=z+n}return W},d=(t,e,i=null)=>{let s=null;if(t&&0!==e){const a=r(e),o=Math.cos(a),h=Math.sin(a);i=null!=i?i:new n.default(t.x+t.width/2,t.y+t.height/2);let d=new n.default(t.x,t.y),c=new n.default(t.x+t.width,t.y),g=new n.default(c.x,t.y+t.height),p=new n.default(t.x,g.y);d=u(d,o,h,i),c=u(c,o,h,i),g=u(g,o,h,i),p=u(p,o,h,i),s=new l.default(d.x,d.y,0,0),s.add(new l.default(c.x,c.y,0,0)),s.add(new l.default(g.x,g.y,0,0)),s.add(new l.default(p.x,p.y,0,0))}return s},u=(t,e,i,s=new n.default)=>{const l=t.x-s.x,a=t.y-s.y,r=l*e-a*i,o=a*e+l*i;return new n.default(r+s.x,o+s.y)},c=(t,e,i,n)=>{const l=t.style.portConstraint??(i?e.style.sourcePortConstraint:e.style.targetPortConstraint)??null;if((0,a.isNullish)(l))return n;const r=l.toString();let o=s.DIRECTION_MASK.NONE,h=0;t.style.portConstraintRotation&&(h=t.style.rotation??0);let d=0;if(h>45?(d=1,h>=135&&(d=2)):h<-45&&(d=3,h<=-135&&(d=2)),r.indexOf(s.DIRECTION.NORTH)>=0)switch(d){case 0:o|=s.DIRECTION_MASK.NORTH;break;case 1:o|=s.DIRECTION_MASK.EAST;break;case 2:o|=s.DIRECTION_MASK.SOUTH;break;case 3:o|=s.DIRECTION_MASK.WEST}if(r.indexOf(s.DIRECTION.WEST)>=0)switch(d){case 0:o|=s.DIRECTION_MASK.WEST;break;case 1:o|=s.DIRECTION_MASK.NORTH;break;case 2:o|=s.DIRECTION_MASK.EAST;break;case 3:o|=s.DIRECTION_MASK.SOUTH}if(r.indexOf(s.DIRECTION.SOUTH)>=0)switch(d){case 0:o|=s.DIRECTION_MASK.SOUTH;break;case 1:o|=s.DIRECTION_MASK.WEST;break;case 2:o|=s.DIRECTION_MASK.NORTH;break;case 3:o|=s.DIRECTION_MASK.EAST}if(r.indexOf(s.DIRECTION.EAST)>=0)switch(d){case 0:o|=s.DIRECTION_MASK.EAST;break;case 1:o|=s.DIRECTION_MASK.SOUTH;break;case 2:o|=s.DIRECTION_MASK.WEST;break;case 3:o|=s.DIRECTION_MASK.NORTH}return o},g=t=>{let e=0;return e=(t&s.DIRECTION_MASK.WEST)<<3,e|=(t&s.DIRECTION_MASK.NORTH)<<1,e|=(t&s.DIRECTION_MASK.SOUTH)>>1,e|=(t&s.DIRECTION_MASK.EAST)>>3,e},p=(t,e,i)=>{let s=-1;if(t.absolutePoints.length>0){let n=t.absolutePoints[0],l=null;for(let a=1;a<t.absolutePoints.length;a+=1){const r=t.absolutePoints[a];if(!n||!r)continue;const o=T(n.x,n.y,r.x,r.y,e,i);(null==l||o<l)&&(l=o,s=a-1),n=r}}return s},f=(t,e,i,n,a)=>{const r=i?.direction??"east";if(n??(n=i?.flipH??!1),a??(a=i?.flipV??!1),e.x=Math.round(Math.max(0,Math.min(t.width,e.x))),e.y=Math.round(Math.max(0,Math.min(t.height,e.y))),e.width=Math.round(Math.max(0,Math.min(t.width,e.width))),e.height=Math.round(Math.max(0,Math.min(t.height,e.height))),a&&(r===s.DIRECTION.SOUTH||r===s.DIRECTION.NORTH)||n&&(r===s.DIRECTION.EAST||r===s.DIRECTION.WEST)){const t=e.x;e.x=e.width,e.width=t}if(n&&(r===s.DIRECTION.SOUTH||r===s.DIRECTION.NORTH)||a&&(r===s.DIRECTION.EAST||r===s.DIRECTION.WEST)){const t=e.y;e.y=e.height,e.height=t}const o=l.default.fromRectangle(e);return r===s.DIRECTION.SOUTH?(o.y=e.x,o.x=e.height,o.width=e.y,o.height=e.width):r===s.DIRECTION.WEST?(o.y=e.height,o.x=e.width,o.width=e.x,o.height=e.y):r===s.DIRECTION.NORTH&&(o.y=e.width,o.x=e.y,o.width=e.height,o.height=e.x),new l.default(t.x+o.x,t.y+o.y,t.width-o.width-o.x,t.height-o.height-o.y)},E=(t,e,i)=>{let s=null;for(let n=0;n<t.length-1;n+=1){const l=x(t[n].x,t[n].y,t[n+1].x,t[n+1].y,e.x,e.y,i.x,i.y);if(null!=l){const t=i.x-l.x,e=i.y-l.y,n={p:l,distSq:e*e+t*t};null!=n&&(null==s||s.distSq>n.distSq)&&(s=n)}}return null!=s?s.p:null},C=(t,e,i)=>{const s=t.y,n=t.x,l=s+t.height,a=n+t.width;let r=e.x,o=i.x;if(e.x>i.x&&(r=i.x,o=e.x),o>a&&(o=a),r<n&&(r=n),r>o)return!1;let h=e.y,d=i.y;const u=i.x-e.x;if(Math.abs(u)>1e-7){const t=(i.y-e.y)/u,s=e.y-t*e.x;h=t*r+s,d=t*o+s}if(h>d){const t=d;d=h,h=t}return d>l&&(d=l),h<s&&(h=s),!(h>d)},y=(t,e,i)=>t.x<=e&&t.x+t.width>=e&&t.y<=i&&t.y+t.height>=i,v=(t,e)=>{let i=t.width,s=t.height,n=e.width,l=e.height;if(n<=0||l<=0||i<=0||s<=0)return!1;const a=t.x,r=t.y,o=e.x,h=e.y;return n+=o,l+=h,i+=a,s+=r,(n<o||n>a)&&(l<h||l>r)&&(i<a||i>o)&&(s<r||s>h)},m=(t,e,i,s,a,o)=>{if(a=null!=a?a:0,o=null!=o?o:0,(s=null!=s?s:1)>0){let h=t.getCenterX(),d=t.getCenterY(),c=t.width,g=t.height;const p=t.style,f=(p?.startSize??0)*t.view.scale;f>0&&(p?.horizontal??1?(d=t.y+f/2,g=f):(h=t.x+f/2,c=f)),c=Math.max(a,c*s),g=Math.max(a,g*s),o>0&&(c=Math.min(c,o),g=Math.min(g,o));const E=new l.default(h-c/2,d-g/2,c,g),C=r(p?.rotation??0);if(0!=C){const s=Math.cos(-C),l=Math.sin(-C),a=new n.default(t.getCenterX(),t.getCenterY()),r=u(new n.default(e,i),s,l,a);e=r.x,i=r.y}return y(E,e,i)}return!0},S=t=>!Number.isNaN(parseFloat(t))&&isFinite(+t)&&("string"!=typeof t||t.toLowerCase().indexOf("0x")<0),w=t=>String(parseInt(t))===String(t),_=(t,e)=>(t%e+e)%e,x=(t,e,i,s,l,a,r,o)=>{const h=(o-a)*(i-t)-(r-l)*(s-e),d=((r-l)*(e-a)-(o-a)*(t-l))/h,u=((i-t)*(e-a)-(s-e)*(t-l))/h;if(d>=0&&d<=1&&u>=0&&u<=1){const l=t+d*(i-t),a=e+d*(s-e);return new n.default(l,a)}return null},T=(t,e,i,s,n,l)=>{let a,r=(n-=t)*(i-=t)+(l-=e)*(s-=e);r<=0?a=0:(r=(n=i-n)*i+(l=s-l)*s,a=r<=0?0:r*r/(i*i+s*s));let o=n*n+l*l-a;return o<0&&(o=0),o},b=(t,e,i,s,n,l)=>Math.abs((s-e)*n-(i-t)*l+i*e-s*t)/Math.sqrt((s-e)*(s-e)+(i-t)*(i-t)),P=(t,e,i,s,n,l)=>{let a=(n-=t)*(s-=e)-(l-=e)*(i-=t);return 0==a&&(a=n*i+l*s,a>0&&(a=(n-=i)*i+(l-=s)*s,a<0&&(a=0))),a<0?-1:a>0?1:0}},675:(t,e,i)=>{i.r(e),i.d(e,{copyTextToClipboard:()=>h,isNotNullish:()=>r,isNullish:()=>a,mixInto:()=>o,utils:()=>l});var s=i(306),n=i(272);const l={errorResource:"error",closeResource:"close",errorImage:`${s.default.imageBasePath}/error.gif`},a=t=>null==t,r=t=>!a(t),o=t=>e=>{const i=Reflect.ownKeys(e);try{for(const s of i)Object.defineProperty(t.prototype,s,{value:e[s],writable:!0})}catch(t){n.GlobalConfig.logger.error("Error while mixing",t)}},h=t=>{navigator.clipboard.writeText(t).then((function(){n.GlobalConfig.logger.info("Async: Copying to clipboard was successful!")}),(function(t){n.GlobalConfig.logger.error("Async: Could not copy text: ",t)}))}},686:(t,e,i)=>{i.r(e),i.d(e,{equalEntries:()=>a,equalPoints:()=>l,remove:()=>n,removeDuplicates:()=>r});var s=i(944);const n=(t,e)=>{let i=null;if("object"==typeof e){let s=e.indexOf(t);for(;s>=0;)e.splice(s,1),i=t,s=e.indexOf(t)}for(const s in e)e[s]==t&&(delete e[s],i=t);return i},l=(t,e)=>{if(!t&&e||t&&!e||t&&e&&t.length!=e.length)return!1;if(t&&e)for(let i=0;i<t.length;i+=1){const s=t[i];if(!s||s&&!s.equals(e[i]))return!1}return!0},a=(t,e)=>{let i=0;if(!t&&e||t&&!e||t&&e&&t.length!=e.length)return!1;if(t&&e){for(const t in e)i++;for(const s in t)if(i--,!(Number.isNaN(t[s])&&Number.isNaN(e[s])||t[s]===e[s]))return!1}return 0===i},r=t=>{const e=new s.default,i=[];for(let s=0;s<t.length;s+=1)e.get(t[s])||(i.push(t[s]),e.put(t[s],!0));return i}},730:(t,e,i)=>{i.r(e),i.d(e,{default:()=>m});var s=i(675),n=i(633),l=i(906),a=i(306),r=i(83),o=i(989);const h=class{constructor(){this.enabled=!0,this.baseUrl=null,this.baseDomain=null}updateBaseUrl(){this.baseDomain=`${location.protocol}//${location.host}`,this.baseUrl=this.baseDomain+location.pathname;const t=this.baseUrl.lastIndexOf("/");t>0&&(this.baseUrl=this.baseUrl.substring(0,t+1))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}getBaseUrl(){return this.baseUrl}setBaseUrl(t){this.baseUrl=t}getBaseDomain(){return this.baseDomain}setBaseDomain(t){this.baseDomain=t}isRelativeUrl(t){return t&&"//"!==t.substring(0,2)&&"http://"!==t.substring(0,7)&&"https://"!==t.substring(0,8)&&"data:image"!==t.substring(0,10)&&"file://"!==t.substring(0,7)}convert(t){return this.isEnabled()&&this.isRelativeUrl(t)&&(this.getBaseUrl()||this.updateBaseUrl(),t="/"===t.charAt(0)?this.getBaseDomain()+t:this.getBaseUrl()+t),t}};var d=i(534),u=i(766),c=i(272);const g=class{constructor(){this.state=this.createState(),this.states=[],this.path=[],this.rotateHtml=!0,this.lastX=0,this.lastY=0,this.moveOp="M",this.lineOp="L",this.quadOp="Q",this.curveOp="C",this.closeOp="Z",this.pointerEvents=!1,this.pointerEventsValue=null,this.addOp=(t,...e)=>{if(this.path.push(t),e.length>1){const t=this.state;for(let i=1;i<e.length;i+=2)this.lastX=e[i-1],this.lastY=e[i],this.path.push(this.format((this.lastX+t.dx)*t.scale)),this.path.push(this.format((this.lastY+t.dy)*t.scale))}},this.converter=this.createUrlConverter(),this.reset()}createUrlConverter(){return new h}reset(){this.state=this.createState(),this.states=[]}createState(){return{dx:0,dy:0,scale:1,alpha:1,fillAlpha:1,strokeAlpha:1,fillColor:r.NONE,gradientFillAlpha:1,gradientColor:r.NONE,gradientAlpha:1,gradientDirection:r.DIRECTION.EAST,strokeColor:r.NONE,strokeWidth:1,dashed:!1,dashPattern:"3 3",fixDash:!1,lineCap:"flat",lineJoin:"miter",miterLimit:10,fontColor:"#000000",fontBackgroundColor:r.NONE,fontBorderColor:r.NONE,fontSize:r.DEFAULT_FONTSIZE,fontFamily:r.DEFAULT_FONTFAMILY,fontStyle:0,shadow:!1,shadowColor:c.StyleDefaultsConfig.shadowColor,shadowAlpha:c.StyleDefaultsConfig.shadowOpacity,shadowDx:c.StyleDefaultsConfig.shadowOffsetX,shadowDy:c.StyleDefaultsConfig.shadowOffsetY,rotation:0,rotationCx:0,rotationCy:0}}format(t){return Math.round(t)}rotatePoint(t,e,i,s,l){const a=i*(Math.PI/180);return(0,n.getRotatedPoint)(new d.default(t,e),Math.cos(a),Math.sin(a),new d.default(s,l))}save(){this.states.push(this.state),this.state=(0,u.clone)(this.state)}restore(){const t=this.states.pop();t&&(this.state=t)}setLink(t){}scale(t){this.state.scale*=t,null!==this.state.strokeWidth&&(this.state.strokeWidth*=t)}translate(t,e){this.state.dx+=t,this.state.dy+=e}rotate(t,e,i,s,n){}setAlpha(t){this.state.alpha=t}setFillAlpha(t){this.state.fillAlpha=t}setStrokeAlpha(t){this.state.strokeAlpha=t}setFillColor(t){this.state.fillColor=t??r.NONE,this.state.gradientColor=r.NONE}setGradient(t,e,i,s,n,l,a,r=1,o=1){const h=this.state;h.fillColor=t,h.gradientFillAlpha=r,h.gradientColor=e,h.gradientAlpha=o,h.gradientDirection=a}setStrokeColor(t){this.state.strokeColor=t??r.NONE}setStrokeWidth(t){this.state.strokeWidth=t}setDashed(t,e=!1){this.state.dashed=t,this.state.fixDash=e}setDashPattern(t){this.state.dashPattern=t}setLineCap(t){this.state.lineCap=t}setLineJoin(t){this.state.lineJoin=t}setMiterLimit(t){this.state.miterLimit=t}setFontColor(t){this.state.fontColor=t??r.NONE}setFontBackgroundColor(t){this.state.fontBackgroundColor=t??r.NONE}setFontBorderColor(t){this.state.fontBorderColor=t??r.NONE}setFontSize(t){this.state.fontSize=t}setFontFamily(t){this.state.fontFamily=t}setFontStyle(t){this.state.fontStyle=t}setShadow(t){this.state.shadow=t}setShadowColor(t){this.state.shadowColor=t??r.NONE}setShadowAlpha(t){this.state.shadowAlpha=t}setShadowOffset(t,e){this.state.shadowDx=t,this.state.shadowDy=e}begin(){this.lastX=0,this.lastY=0,this.path=[]}moveTo(t,e){this.addOp(this.moveOp,t,e)}lineTo(t,e){this.addOp(this.lineOp,t,e)}quadTo(t,e,i,s){this.addOp(this.quadOp,t,e,i,s)}curveTo(t,e,i,s,n,l){this.addOp(this.curveOp,t,e,i,s,n,l)}arcTo(t,e,i,s,l,a,r){const o=(0,n.arcToCurves)(this.lastX,this.lastY,t,e,i,s,l,a,r);if(null!=o)for(let t=0;t<o.length;t+=6)this.curveTo(o[t],o[t+1],o[t+2],o[t+3],o[t+4],o[t+5])}close(t,e,i,s,n,l){this.addOp(this.closeOp)}};var p=i(568);i(944);var f=i(733),E=(i(577),i(301));class C{static register(t,e=!0){if(null!=t){const i=t.getName();C.codecs[i]=t;const s=t.template.constructor.name;e&&s!==i&&C.addAlias(s,i)}return t}static addAlias(t,e){C.aliases[t]=e}static getCodec(t){if(null==t)return null;let e=null,i="string"==typeof t?t:t.name;const s=C.aliases[i];if(null!=s&&(i=s),e=C.codecs[i]??null,null==e)try{e=new E.default(new t),C.register(e)}catch(t){}return e}static getCodecByName(t){let e=C.codecs[t];if(!e){const i=C.aliases[t];i&&(e=C.codecs[i])}return e??null}}C.codecs={},C.aliases={},i(230);const y="function"==typeof DOMParser&&!a.default.IS_CHROMEAPP&&!a.default.IS_EDGE&&document.getElementsByTagName("base").length>0;class v extends g{constructor(t,e){super(),this.defs=null,this.styleEnabled=!0,this.node=null,this.matchHtmlAlignment=!0,this.textEnabled=!0,this.foEnabled=!0,this.foAltText="[Object]",this.foOffset=0,this.textOffset=0,this.imageOffset=0,this.strokeTolerance=0,this.minStrokeWidth=1,this.refCount=0,this.lineHeightCorrection=1,this.pointerEventsValue="all",this.fontMetricsPadding=10,this.cacheOffsetSize=!0,this.originalRoot=null,this.root=t,this.gradients={},this.defs=null,this.styleEnabled=null!=e&&e;let i=null;if(t.ownerDocument!==document){let e=t;for(;e&&"svg"!==e.nodeName;)e=e.parentElement;i=e}i&&(i.getElementsByTagName("defs").length>0&&(this.defs=i.getElementsByTagName("defs")[0]),this.defs||(this.defs=this.createElement("defs"),null!=i.firstChild?i.insertBefore(this.defs,i.firstChild):i.appendChild(this.defs)),this.styleEnabled&&this.defs.appendChild(this.createStyle()))}format(t){return parseFloat(t.toFixed(2))}getBaseUrl(){let{href:t}=window.location;const e=t.lastIndexOf("#");return e>0&&(t=t.substring(0,e)),t}reset(){super.reset(),this.gradients={}}end(){}createStyle(){const t=this.createElement("style");return t.setAttribute("type","text/css"),(0,f.write)(t,`svg{font-family:${r.DEFAULT_FONTFAMILY};font-size:${r.DEFAULT_FONTSIZE};fill:none;stroke-miterlimit:10}`),t}createElement(t,e){return this.root?.ownerDocument.createElementNS(e||r.NS_SVG,t)}getAlternateText(t,e,i,n,l,a,r,o,h,d,u,c,g){return(0,s.isNotNullish)(a)?this.foAltText:null}createAlternateContent(t,e,i,n,a,o,h,d,u,c,g,p,E){const C=this.getAlternateText(t,e,i,n,a,o,h,d,u,c,g,p,E),y=this.state;if((0,s.isNotNullish)(C)&&y.fontSize>0){const t=d===r.ALIGN.TOP?1:d===r.ALIGN.BOTTOM?0:.3,s=h===r.ALIGN.RIGHT?"end":h===r.ALIGN.LEFT?"start":"middle",n=this.createElement("text");n.setAttribute("x",String(Math.round(e+y.dx))),n.setAttribute("y",String(Math.round(i+y.dy+t*y.fontSize))),n.setAttribute("fill",y.fontColor||"black"),n.setAttribute("font-family",y.fontFamily),n.setAttribute("font-size",`${Math.round(y.fontSize)}px`),"start"!==s&&n.setAttribute("text-anchor",s);const a=y.fontStyle;(0,l.matchBinaryMask)(a,r.FONT.BOLD)&&n.setAttribute("font-weight","bold"),(0,l.matchBinaryMask)(a,r.FONT.ITALIC)&&n.setAttribute("font-style","italic");const o=[];return(0,l.matchBinaryMask)(a,r.FONT.UNDERLINE)&&o.push("underline"),(0,l.matchBinaryMask)(a,r.FONT.STRIKETHROUGH)&&o.push("line-through"),o.length>0&&n.setAttribute("text-decoration",o.join(" ")),(0,f.write)(n,C),n}return null}createGradientId(t,e,i,s,n){"#"===t.charAt(0)&&(t=t.substring(1)),"#"===e.charAt(0)&&(e=e.substring(1)),t=`${t.toLowerCase()}-${i}`,e=`${e.toLowerCase()}-${s}`;let l=null;if(null==n||n===r.DIRECTION.SOUTH)l="s";else if(n===r.DIRECTION.EAST)l="e";else{const i=t;t=e,e=i,n===r.DIRECTION.NORTH?l="s":n===r.DIRECTION.WEST&&(l="e")}return`mx-gradient-${t}-${e}-${l}`}getSvgGradient(t,e,i,s,n){const l=this.createGradientId(t,e,i,s,n);let a=this.gradients[l];if(!a){const r=this.root.ownerSVGElement;let o=0,h=`${l}-${o}`;if(r)for(a=r.ownerDocument.getElementById(h);a&&a.ownerSVGElement!==r;)h=`${l}-${o++}`,a=r.ownerDocument.getElementById(h);else h="id"+ ++this.refCount;a||(a=this.createSvgGradient(t,e,i,s,n),a.setAttribute("id",h),this.defs?this.defs.appendChild(a):r&&r.appendChild(a)),this.gradients[l]=a}return a.getAttribute("id")}createSvgGradient(t,e,i,s,n){const l=this.createElement("linearGradient");l.setAttribute("x1","0%"),l.setAttribute("y1","0%"),l.setAttribute("x2","0%"),l.setAttribute("y2","0%"),null==n||n===r.DIRECTION.SOUTH?l.setAttribute("y2","100%"):n===r.DIRECTION.EAST?l.setAttribute("x2","100%"):n===r.DIRECTION.NORTH?l.setAttribute("y1","100%"):n===r.DIRECTION.WEST&&l.setAttribute("x1","100%");let a=i<1?`;stop-opacity:${i}`:"",o=this.createElement("stop");return o.setAttribute("offset","0%"),o.setAttribute("style",`stop-color:${t}${a}`),l.appendChild(o),a=s<1?`;stop-opacity:${s}`:"",o=this.createElement("stop"),o.setAttribute("offset","100%"),o.setAttribute("style",`stop-color:${e}${a}`),l.appendChild(o),l}addNode(t,e){const{node:i}=this,s=this.state;if(i){if("path"===i.nodeName){if(!(this.path&&this.path.length>0))return;i.setAttribute("d",this.path.join(" "))}t&&s.fillColor!==r.NONE?this.updateFill():this.styleEnabled||("ellipse"===i.nodeName&&a.default.IS_FF?i.setAttribute("fill","transparent"):i.setAttribute("fill",r.NONE),t=!1),e&&s.strokeColor!==r.NONE?this.updateStroke():this.styleEnabled||i.setAttribute("stroke",r.NONE),s.transform&&s.transform.length>0&&i.setAttribute("transform",s.transform),s.shadow&&this.root.appendChild(this.createShadow(i)),this.strokeTolerance>0&&!t&&this.root.appendChild(this.createTolerance(i)),this.pointerEvents?i.setAttribute("pointer-events",this.pointerEventsValue):this.pointerEvents||this.originalRoot||i.setAttribute("pointer-events",r.NONE),("rect"!==i.nodeName&&"path"!==i.nodeName&&"ellipse"!==i.nodeName||i.getAttribute("fill")!==r.NONE&&"transparent"!==i.getAttribute("fill")||i.getAttribute("stroke")!==r.NONE||i.getAttribute("pointer-events")!==r.NONE)&&this.root.appendChild(i),this.node=null}}updateFill(){const t=this.state;if((t.alpha<1||t.fillAlpha<1)&&this.node.setAttribute("fill-opacity",String(t.alpha*t.fillAlpha)),t.fillColor!==r.NONE)if(t.gradientColor!==r.NONE){const e=this.getSvgGradient(t.fillColor,t.gradientColor,t.gradientFillAlpha,t.gradientAlpha,t.gradientDirection);if(this.root?.ownerDocument===document&&y){const t=this.getBaseUrl().replace(/([()])/g,"\\$1");this.node.setAttribute("fill",`url(${t}#${e})`)}else this.node.setAttribute("fill",`url(#${e})`)}else this.node.setAttribute("fill",t.fillColor.toLowerCase())}getCurrentStrokeWidth(){return Math.max(this.minStrokeWidth,Math.max(.01,this.format(this.state.strokeWidth*this.state.scale)))}updateStroke(){const t=this.state;t.strokeColor&&t.strokeColor!==r.NONE&&this.node.setAttribute("stroke",t.strokeColor.toLowerCase()),(t.alpha<1||t.strokeAlpha<1)&&this.node.setAttribute("stroke-opacity",String(t.alpha*t.strokeAlpha));const e=this.getCurrentStrokeWidth();1!==e&&this.node.setAttribute("stroke-width",String(e)),"path"===this.node.nodeName&&this.updateStrokeAttributes(),t.dashed&&this.node.setAttribute("stroke-dasharray",this.createDashPattern((t.fixDash?1:t.strokeWidth)*t.scale))}updateStrokeAttributes(){const t=this.state;if(t.lineJoin&&"miter"!==t.lineJoin&&this.node.setAttribute("stroke-linejoin",t.lineJoin),t.lineCap){let e=t.lineCap;"flat"===e&&(e="butt"),"butt"!==e&&this.node.setAttribute("stroke-linecap",e)}null==t.miterLimit||this.styleEnabled&&10===t.miterLimit||this.node.setAttribute("stroke-miterlimit",String(t.miterLimit))}createDashPattern(t){const e=[];if("string"==typeof this.state.dashPattern){const i=this.state.dashPattern.split(" ");if(i.length>0)for(let s=0;s<i.length;s+=1)e[s]=Number(i[s])*t}return e.join(" ")}createTolerance(t){const e=t.cloneNode(!0),i=parseFloat(e.getAttribute("stroke-width")||"1")+this.strokeTolerance;return e.setAttribute("pointer-events","stroke"),e.setAttribute("visibility","hidden"),e.removeAttribute("stroke-dasharray"),e.setAttribute("stroke-width",String(i)),e.setAttribute("fill","none"),e.setAttribute("stroke","white"),e}createShadow(t){const e=t.cloneNode(!0),i=this.state;return"none"===e.getAttribute("fill")||a.default.IS_FF&&"transparent"===e.getAttribute("fill")||e.setAttribute("fill",i.shadowColor),"none"!==e.getAttribute("stroke")&&i.shadowColor&&i.shadowColor!==r.NONE&&e.setAttribute("stroke",i.shadowColor),e.setAttribute("transform",`translate(${this.format(i.shadowDx*i.scale)},${this.format(i.shadowDy*i.scale)})${i.transform||""}`),e.setAttribute("opacity",String(i.shadowAlpha)),e}setLink(t){if(t){this.originalRoot=this.root;const e=this.createElement("a");null==e.setAttributeNS||this.root.ownerDocument!==document?e.setAttribute("xlink:href",t):e.setAttributeNS(r.NS_XLINK,"xlink:href",t),this.root.appendChild(e),this.root=e}else this.root=this.originalRoot}rotate(t,e,i,s,n){if(0!==t||e||i){const l=this.state;if(s+=l.dx,n+=l.dy,s*=l.scale,n*=l.scale,l.transform=l.transform||"",e&&i)t+=180;else if(e!==i){const t=e?s:0,a=e?-1:1,r=i?n:0,o=i?-1:1;l.transform+=`translate(${this.format(t)},${this.format(r)})scale(${this.format(a)},${this.format(o)})translate(${this.format(-t)},${this.format(-r)})`}(e?!i:i)&&(t*=-1),0!==t&&(l.transform+=`rotate(${this.format(t)},${this.format(s)},${this.format(n)})`),l.rotation+=t,l.rotationCx=s,l.rotationCy=n}}begin(){super.begin(),this.node=this.createElement("path")}rect(t,e,i,s){const n=this.state,l=this.createElement("rect");l.setAttribute("x",String(this.format((t+n.dx)*n.scale))),l.setAttribute("y",String(this.format((e+n.dy)*n.scale))),l.setAttribute("width",String(this.format(i*n.scale))),l.setAttribute("height",String(this.format(s*n.scale))),this.node=l}roundrect(t,e,i,s,n,l){this.rect(t,e,i,s),n>0&&this.node.setAttribute("rx",String(this.format(n*this.state.scale))),l>0&&this.node.setAttribute("ry",String(this.format(l*this.state.scale)))}ellipse(t,e,i,s){const n=this.state,l=this.createElement("ellipse");l.setAttribute("cx",String(this.format((t+i/2+n.dx)*n.scale))),l.setAttribute("cy",String(this.format((e+s/2+n.dy)*n.scale))),l.setAttribute("rx",String(i/2*n.scale)),l.setAttribute("ry",String(s/2*n.scale)),this.node=l}image(t,e,i,s,n,l=!0,a=!1,o=!1){n=this.converter.convert(n);const h=this.state;t+=h.dx,e+=h.dy;const d=this.createElement("image");d.setAttribute("x",String(this.format(t*h.scale)+this.imageOffset)),d.setAttribute("y",String(this.format(e*h.scale)+this.imageOffset)),d.setAttribute("width",String(this.format(i*h.scale))),d.setAttribute("height",String(this.format(s*h.scale))),d.setAttributeNS?d.setAttributeNS(r.NS_XLINK,"xlink:href",n):d.setAttribute("xlink:href",n),l||d.setAttribute("preserveAspectRatio","none"),(h.alpha<1||h.fillAlpha<1)&&d.setAttribute("opacity",String(h.alpha*h.fillAlpha));let u=this.state.transform||"";if(a||o){let n=1,l=1,r=0,d=0;a&&(n=-1,r=-i-2*t),o&&(l=-1,d=-s-2*e),u+=`scale(${n},${l})translate(${r*h.scale},${d*h.scale})`}u.length>0&&d.setAttribute("transform",u),this.pointerEvents||d.setAttribute("pointer-events","none"),this.root.appendChild(d)}convertHtml(t){const e=(new DOMParser).parseFromString(t,"text/html");return null!=e&&("<body"===(t=(new XMLSerializer).serializeToString(e.body)).substring(0,5)&&(t=t.substring(t.indexOf(">",5)+1)),"</body>"===t.substring(t.length-7,t.length)&&(t=t.substring(0,t.length-7))),t}createDiv(t){let e=t;if((0,f.isNode)(e)||(e=`<div><div>${this.convertHtml(e)}</div></div>`),document.createElementNS){const t=document.createElementNS("http://www.w3.org/1999/xhtml","div");if((0,f.isNode)(e)){const i=e,s=document.createElement("div"),n=s.cloneNode(!1);this.root.ownerDocument!==document?s.appendChild(i.cloneNode(!0)):s.appendChild(i),n.appendChild(s),t.appendChild(n)}else t.innerHTML=e;return t}return(0,f.isNode)(e)&&(e=`<div><div>${((t,e="&#xa;")=>{let i=(new XMLSerializer).serializeToString(t);return i=i.replace(/\n/g,e),i})(e)}</div></div>`),e=`<div xmlns="http://www.w3.org/1999/xhtml">${e}</div>`,(new DOMParser).parseFromString(e,"text/xml").documentElement}updateText(t,e,i,s,n,l,a,r,o,h,d){d&&d.firstChild&&d.firstChild.firstChild&&this.updateTextNodes(t,e,i,s,n,l,a,r,o,h,d.firstChild)}addForeignObject(t,e,i,s,n,l,a,r,o,h,d,u,c,g,p){const f=this.createElement("g"),E=this.createElement("foreignObject");if(E.setAttribute("style","overflow: visible; text-align: left;"),E.setAttribute("pointer-events","none"),E.appendChild(g),f.appendChild(E),this.updateTextNodes(t,e,i,s,l,a,r,h,d,u,f),this.root?.ownerDocument!==document){const c=this.createAlternateContent(E,t,e,i,s,n,l,a,r,o,h,d,u);if(null!=c){E.setAttribute("requiredFeatures","http://www.w3.org/TR/SVG11/feature#Extensibility");const t=this.createElement("switch");t.appendChild(E),t.appendChild(c),f.appendChild(t)}}p.appendChild(f)}updateTextNodes(t,e,i,s,n,l,a,o,h,d,u){const c=this.state.scale;v.createCss(i+2,s,n,l,a,o,h,null!=this.state.fontBackgroundColor?this.state.fontBackgroundColor:null,null!=this.state.fontBorderColor?this.state.fontBorderColor:null,`display: flex; align-items: unsafe ${l===r.ALIGN.TOP?"flex-start":l===r.ALIGN.BOTTOM?"flex-end":"center"}; justify-content: unsafe ${n===r.ALIGN.LEFT?"flex-start":n===r.ALIGN.RIGHT?"flex-end":"center"}; `,this.getTextCss(),c,((i,s,n,l,a)=>{t+=this.state.dx,e+=this.state.dy;const r=u.firstChild,o=r.firstChild,h=o.firstChild,g=h.firstChild,p=(this.rotateHtml?this.state.rotation:0)+(null!=d?d:0);let f=(0!==this.foOffset?`translate(${this.foOffset} ${this.foOffset})`:"")+(1!==c?`scale(${c})`:"");g.setAttribute("style",a),h.setAttribute("style",l),r.setAttribute("width",`${Math.ceil(1/Math.min(1,c)*100)}%`),r.setAttribute("height",`${Math.ceil(1/Math.min(1,c)*100)}%`);const E=Math.round(e+s);E<0?r.setAttribute("y",String(E)):(r.removeAttribute("y"),n+=`padding-top: ${E}px; `),o.setAttribute("style",`${n}margin-left: ${Math.round(t+i)}px;`),f+=0!==p?`rotate(${p} ${t} ${e})`:"",""!==f?u.setAttribute("transform",f):u.removeAttribute("transform"),1!==this.state.alpha?u.setAttribute("opacity",String(this.state.alpha)):u.removeAttribute("opacity")}))}getTextCss(){const t=this.state,e=r.ABSOLUTE_LINE_HEIGHT?t.fontSize*r.LINE_HEIGHT+"px":r.LINE_HEIGHT*this.lineHeightCorrection;let i=`display: inline-block; font-size: ${t.fontSize}px; font-family: ${t.fontFamily}; color: ${t.fontColor}; line-height: ${e}; pointer-events: ${this.pointerEvents?this.pointerEventsValue:"none"}; `;const s=t.fontStyle;(0,l.matchBinaryMask)(s,r.FONT.BOLD)&&(i+="font-weight: bold; "),(0,l.matchBinaryMask)(s,r.FONT.ITALIC)&&(i+="font-style: italic; ");const n=[];return(0,l.matchBinaryMask)(s,r.FONT.UNDERLINE)&&n.push("underline"),(0,l.matchBinaryMask)(s,r.FONT.STRIKETHROUGH)&&n.push("line-through"),n.length>0&&(i+=`text-decoration: ${n.join(" ")}; `),i}text(t,e,i,s,n,l,a,r,o,h,d,u=0,c){if(this.textEnabled&&null!=n)if(u=null!=u?u:0,this.foEnabled&&"html"===o){const g=this.createDiv(n);null!=g&&(null!=c&&g.setAttribute("dir",c),this.addForeignObject(t,e,i,s,n,l,a,r,o,h,d,u,c,g,this.root))}else this.plainText(t+this.state.dx,e+this.state.dy,i,s,n,l,a,r,h,d,u,c)}createClip(t,e,i,s){const n=`mx-clip-${t=Math.round(t)}-${e=Math.round(e)}-${i=Math.round(i)}-${s=Math.round(s)}`;let l=0,a=`${n}-${l}`;for(;null!=document.getElementById(a);)a=`${n}-${++l}`;const r=this.createElement("clipPath");r.setAttribute("id",a);const o=this.createElement("rect");return o.setAttribute("x",String(t)),o.setAttribute("y",String(e)),o.setAttribute("width",String(i)),o.setAttribute("height",String(s)),r.appendChild(o),r}plainText(t,e,i,s,n,l,o,h,d,u,c=0,g){const E=this.state,C=E.fontSize,y=this.createElement("g");let v=E.transform||"";if(this.updateFont(y),this.pointerEvents||null!=this.originalRoot||y.setAttribute("pointer-events","none"),0!==c&&(v+=`rotate(${c},${this.format(t*E.scale)},${this.format(e*E.scale)})`),null!=g&&y.setAttribute("direction",g),u&&i>0&&s>0){let n=t,h=e;l===r.ALIGN.CENTER?n-=i/2:l===r.ALIGN.RIGHT&&(n-=i),"fill"!==d&&(o===r.ALIGN.MIDDLE?h-=s/2:o===r.ALIGN.BOTTOM&&(h-=s));const u=this.createClip(n*E.scale-2,h*E.scale-2,i*E.scale+4,s*E.scale+4);if(null!=this.defs?this.defs.appendChild(u):this.root.appendChild(u),a.default.IS_CHROMEAPP||a.default.IS_EDGE||this.root.ownerDocument!==document)y.setAttribute("clip-path",`url(#${u.getAttribute("id")})`);else{const t=this.getBaseUrl().replace(/([()])/g,"\\$1");y.setAttribute("clip-path",`url(${t}#${u.getAttribute("id")})`)}}const m=l===r.ALIGN.RIGHT?"end":l===r.ALIGN.CENTER?"middle":"start";"start"!==m&&y.setAttribute("text-anchor",m),this.styleEnabled&&C===r.DEFAULT_FONTSIZE||y.setAttribute("font-size",C*E.scale+"px"),v.length>0&&y.setAttribute("transform",v),E.alpha<1&&y.setAttribute("opacity",String(E.alpha));const S=n.split("\n"),w=Math.round(C*r.LINE_HEIGHT),_=C+(S.length-1)*w;let x=e+C-1;o===r.ALIGN.MIDDLE?x-="fill"===d?s/2:(this.matchHtmlAlignment&&u&&s>0?Math.min(_,s):_)/2:o===r.ALIGN.BOTTOM&&(x-="fill"===d?s:(this.matchHtmlAlignment&&u&&s>0?Math.min(_,s):_)+1);for(let e=0;e<S.length;e+=1){const i=(0,p.trim)(S[e]);if(i){const e=this.createElement("text");e.setAttribute("x",String(this.format(t*E.scale)+this.textOffset)),e.setAttribute("y",String(this.format(x*E.scale)+this.textOffset)),(0,f.write)(e,i),y.appendChild(e)}x+=w}this.root.appendChild(y),this.addTextBackground(y,n,t,e,i,"fill"===d?s:_,l,o,d)}updateFont(t){const e=this.state;e.fontColor&&e.fontColor!==r.NONE&&t.setAttribute("fill",e.fontColor),this.styleEnabled&&e.fontFamily===r.DEFAULT_FONTFAMILY||t.setAttribute("font-family",e.fontFamily);const i=e.fontStyle;(0,l.matchBinaryMask)(i,r.FONT.BOLD)&&t.setAttribute("font-weight","bold"),(0,l.matchBinaryMask)(i,r.FONT.ITALIC)&&t.setAttribute("font-style","italic");const s=[];(0,l.matchBinaryMask)(i,r.FONT.UNDERLINE)&&s.push("underline"),(0,l.matchBinaryMask)(i,r.FONT.STRIKETHROUGH)&&s.push("line-through"),s.length>0&&t.setAttribute("text-decoration",s.join(" "))}addTextBackground(t,e,i,s,a,h,d,u,c){const g=this.state;if(null!=g.fontBackgroundColor||null!=g.fontBorderColor){let f=null;if("fill"===c||"width"===c)d===r.ALIGN.CENTER?i-=a/2:d===r.ALIGN.RIGHT&&(i-=a),u===r.ALIGN.MIDDLE?s-=h/2:u===r.ALIGN.BOTTOM&&(s-=h),f=new o.default((i+1)*g.scale,s*g.scale,(a-2)*g.scale,(h+2)*g.scale);else if(null!=t.getBBox&&this.root.ownerDocument===document)try{f=t.getBBox(),f=new o.default(f.x,f.y+1,f.width,f.height+0)}catch(t){}if(null==f||0===f.width||0===f.height){const t=document.createElement("div");t.style.lineHeight=r.ABSOLUTE_LINE_HEIGHT?g.fontSize*r.LINE_HEIGHT+"px":String(r.LINE_HEIGHT),t.style.fontSize=`${g.fontSize}px`,t.style.fontFamily=g.fontFamily,t.style.whiteSpace="nowrap",t.style.position="absolute",t.style.visibility="hidden",t.style.display="inline-block",(0,l.matchBinaryMask)(g.fontStyle,r.FONT.BOLD)&&(t.style.fontWeight="bold"),(0,l.matchBinaryMask)(g.fontStyle,r.FONT.ITALIC)&&(t.style.fontStyle="italic"),e=(0,p.htmlEntities)(e,!1),t.innerHTML=e.replace(/\n/g,"<br/>"),document.body.appendChild(t);const n=t.offsetWidth,a=t.offsetHeight;document.body.removeChild(t),d===r.ALIGN.CENTER?i-=n/2:d===r.ALIGN.RIGHT&&(i-=n),u===r.ALIGN.MIDDLE?s-=a/2:u===r.ALIGN.BOTTOM&&(s-=a),f=new o.default((i+1)*g.scale,(s+2)*g.scale,n*g.scale,(a+1)*g.scale)}if(null!=f){const e=this.createElement("rect");e.setAttribute("fill",g.fontBackgroundColor||"none"),e.setAttribute("stroke",g.fontBorderColor||"none"),e.setAttribute("x",String(Math.floor(f.x-1))),e.setAttribute("y",String(Math.floor(f.y-1))),e.setAttribute("width",String(Math.ceil(f.width+2))),e.setAttribute("height",String(Math.ceil(f.height)));const i=g.fontBorderColor?Math.max(1,this.format(g.scale)):0;e.setAttribute("stroke-width",String(i)),this.root?.ownerDocument===document&&1===(0,n.mod)(i,2)&&e.setAttribute("transform","translate(0.5, 0.5)"),t.insertBefore(e,t.firstChild)}}}stroke(){this.addNode(!1,!0)}fill(){this.addNode(!0,!1)}fillAndStroke(){this.addNode(!0,!0)}}v.createCss=(t,e,i,s,n,a,o,h,d,u,c,g,p)=>{let f=`box-sizing: border-box; font-size: 0; text-align: ${i===r.ALIGN.LEFT?"left":i===r.ALIGN.RIGHT?"right":"center"}; `;const E=(0,l.getAlignmentAsPoint)(i,s);let C="overflow: hidden; ",y="width: 1px; ",v="height: 1px; ",m=E.x*t,S=E.y*e;o?(y=`width: ${Math.round(t)}px; `,f+=`max-height: ${Math.round(e)}px; `,S=0):"fill"===a?(y=`width: ${Math.round(t)}px; `,v=`height: ${Math.round(e)}px; `,c+="width: 100%; height: 100%; ",f+=y+v):"width"===a?(y=`width: ${Math.round(t)}px; `,c+="width: 100%; ",f+=y,S=0,e>0&&(f+=`max-height: ${Math.round(e)}px; `)):(C="",S=0);let w="";h&&(w+=`background-color: ${h}; `),d&&(w+=`border: 1px solid ${d}; `),""==C||o?c+=w:f+=w,n&&t>0?(c+=`white-space: normal; word-wrap: ${r.WORD_WRAP}; `,y=`width: ${Math.round(t)}px; `,""!==C&&"fill"!==a&&(S=0)):(c+="white-space: nowrap; ",""===C&&(m=0)),p(m,S,u+y+v,f+C,c,C)};const m=v},733:(t,e,i)=>{i.r(e),i.d(e,{addLinkToHead:()=>v,br:()=>u,clearSelection:()=>C,createImage:()=>y,extractTextWithWhitespace:()=>n,getChildNodes:()=>f,getInnerHtml:()=>r,getOuterHtml:()=>o,getTextContent:()=>l,importNode:()=>E,isAncestorNode:()=>p,isNode:()=>g,para:()=>c,setTextContent:()=>a,write:()=>h,writeln:()=>d});var s=i(83);const n=t=>{const e=["BLOCKQUOTE","DIV","H1","H2","H3","H4","H5","H6","OL","P","PRE","TABLE","UL"],i=[];return function t(s){if(1!=s.length||"BR"!=s[0].nodeName&&"\n"!=s[0].innerHTML)for(let n=0;n<s.length;n+=1){const l=s[n];"BR"==l.nodeName||"\n"==l.innerHTML||(1==s.length||0==n)&&"DIV"==l.nodeName&&"<br>"==l.innerHTML.toLowerCase()?i.push("\n"):(3===l.nodeType||4===l.nodeType?l.nodeValue&&l.nodeValue.length>0&&i.push(l.nodeValue):8!==l.nodeType&&l.childNodes.length>0&&t(Array.from(l.childNodes)),n<s.length-1&&e.indexOf(s[n+1].nodeName)>=0&&i.push("\n"))}}(t),i.join("")},l=t=>null!=t&&t.textContent?t.textContent:"",a=(t,e)=>{"innerText"in t?t.innerText=e:t.textContent=e},r=t=>null!=t?(new XMLSerializer).serializeToString(t):"",o=t=>null!=t?(new XMLSerializer).serializeToString(t):"",h=(t,e)=>{const i=t.ownerDocument.createTextNode(e);return null!=t&&t.appendChild(i),i},d=(t,e)=>{const i=t.ownerDocument.createTextNode(e);return null!=t&&(t.appendChild(i),t.appendChild(document.createElement("br"))),i},u=(t,e=1)=>{let i=null;for(let s=0;s<e;s+=1)null!=t&&(i=t.ownerDocument.createElement("br"),t.appendChild(i));return i},c=(t,e)=>{const i=document.createElement("p");return h(i,e),null!=t&&t.appendChild(i),i},g=(t,e=null,i,s)=>!(null==t||isNaN(t.nodeType)||null!=e&&t.nodeName.toLowerCase()!=e.toLowerCase()||null!=i&&t.getAttribute(i)!=s),p=(t,e)=>{let i=e;for(;null!=i;){if(i===t)return!0;i=i.parentNode}return!1},f=(t,e=s.NODETYPE.ELEMENT)=>{e=e||s.NODETYPE.ELEMENT;const i=[];let n=t.firstChild;for(;null!=n;)n.nodeType===e&&i.push(n),n=n.nextSibling;return i},E=(t,e,i)=>t.importNode(e,i),C=()=>{const t=window.getSelection?window.getSelection():document.selection;t&&(t.removeAllRanges?t.removeAllRanges():t.empty&&t.empty())},y=t=>{let e=null;return e=document.createElement("img"),e.setAttribute("src",t),e.setAttribute("border","0"),e},v=(t,e,i=null,s=null)=>{const n=(i=i||document).createElement("link");n.setAttribute("rel",t),n.setAttribute("href",e),n.setAttribute("charset","UTF-8"),n.setAttribute("type","text/css"),s&&n.setAttribute("id",s),i.getElementsByTagName("head")[0].appendChild(n)}},766:(t,e,i)=>{i.r(e),i.d(e,{clone:()=>n,shallowCopy:()=>l});var s=i(909);const n=function t(e,i=null,n=!1){n=null!=n&&n;let l=null;if(null!=e&&"function"==typeof e.constructor){l=new e.constructor;for(const a in e)a!=s.default.FIELD_NAME&&(null==i||i.indexOf(a)<0)&&(n||"object"!=typeof e[a]?l[a]=e[a]:l[a]=t(e[a]))}return l},l=(t,e)=>{for(const i in t)if(Object.prototype.hasOwnProperty.call(t,i)){const s=t[i];Array.isArray(s)?e[i]=[...s]:e[i]=s}}},798:(t,e,i)=>{i.r(e),i.d(e,{default:()=>h});var s=i(534),n=i(989),l=i(633),a=i(686),r=i(766);class o extends n.default{constructor(t=0,e=0,i=0,s=0){super(t,e,i,s),this.TRANSLATE_CONTROL_POINTS=!0,this.alternateBounds=null,this.sourcePoint=null,this.targetPoint=null,this.points=null,this.offset=null,this.relative=!1}setRelative(t){this.relative=t}swap(){if(this.alternateBounds){const t=new n.default(this.x,this.y,this.width,this.height);this.x=this.alternateBounds.x,this.y=this.alternateBounds.y,this.width=this.alternateBounds.width,this.height=this.alternateBounds.height,this.alternateBounds=t}}getTerminalPoint(t){return t?this.sourcePoint:this.targetPoint}setTerminalPoint(t,e){return e?this.sourcePoint=t:this.targetPoint=t,t}rotate(t,e){const i=(0,l.toRadians)(t),n=Math.cos(i),a=Math.sin(i);if(!this.relative){const t=new s.default(this.getCenterX(),this.getCenterY()),i=(0,l.getRotatedPoint)(t,n,a,e);this.x=Math.round(i.x-this.width/2),this.y=Math.round(i.y-this.height/2)}if(this.sourcePoint){const t=(0,l.getRotatedPoint)(this.sourcePoint,n,a,e);this.sourcePoint.x=Math.round(t.x),this.sourcePoint.y=Math.round(t.y)}if(this.targetPoint){const t=(0,l.getRotatedPoint)(this.targetPoint,n,a,e);this.targetPoint.x=Math.round(t.x),this.targetPoint.y=Math.round(t.y)}if(this.points)for(let t=0;t<this.points.length;t+=1)if(this.points[t]){const i=(0,l.getRotatedPoint)(this.points[t],n,a,e);this.points[t].x=Math.round(i.x),this.points[t].y=Math.round(i.y)}}translate(t,e){if(this.relative||(this.x+=t,this.y+=e),this.sourcePoint&&(this.sourcePoint.x=this.sourcePoint.x+t,this.sourcePoint.y=this.sourcePoint.y+e),this.targetPoint&&(this.targetPoint.x=this.targetPoint.x+t,this.targetPoint.y=this.targetPoint.y+e),this.TRANSLATE_CONTROL_POINTS&&this.points)for(let i=0;i<this.points.length;i+=1)this.points[i]&&(this.points[i].x=this.points[i].x+t,this.points[i].y=this.points[i].y+e)}scale(t,e,i){if(this.sourcePoint&&(this.sourcePoint.x=this.sourcePoint.x*t,this.sourcePoint.y=this.sourcePoint.y*e),this.targetPoint&&(this.targetPoint.x=this.targetPoint.x*t,this.targetPoint.y=this.targetPoint.y*e),this.points)for(let i=0;i<this.points.length;i+=1)this.points[i]&&(this.points[i].x=this.points[i].x*t,this.points[i].y=this.points[i].y*e);this.relative||(this.x*=t,this.y*=e,i&&(e=t=Math.min(t,e)),this.width*=t,this.height*=e)}equals(t){return!!t&&super.equals(t)&&this.relative===t.relative&&(null===this.sourcePoint&&null===t.sourcePoint||!!this.sourcePoint?.equals(t.sourcePoint))&&(null===this.targetPoint&&null===t.targetPoint||!!this.targetPoint?.equals(t.targetPoint))&&(0,a.equalPoints)(this.points,t.points)&&(null===this.alternateBounds&&null===t.alternateBounds||!!this.alternateBounds?.equals(t.alternateBounds))&&(null===this.offset&&null===t.offset||!!this.offset?.equals(t.offset))}clone(){return(0,r.clone)(this)}}const h=o},823:(t,e,i)=>{i.r(e),i.d(e,{default:()=>s});const s=class{constructor(t="",...e){if(this.consumed=!1,this.name=t,this.properties={},e[0]&&e[0].constructor===Object)for(const[t,i]of Object.entries(e[0]))this.properties[t]=i;else for(let t=0;t<e.length;t+=2)null!==e[t+1]&&(this.properties[e[t]]=e[t+1])}getName(){return this.name}getProperties(){return this.properties}getProperty(t){return this.properties[t]}isConsumed(){return this.consumed}consume(){this.consumed=!0}}},902:(t,e,i)=>{i.r(e),i.d(e,{TranslationsConfig:()=>h,resetTranslationsConfig:()=>o});var s=i(675),n=i(766);function l(){return"undefined"!=typeof window?navigator.language:"en"}const a={defaultLanguage:"en",language:l(),languages:[]},r={};(0,n.shallowCopy)(a,r);const o=()=>{(0,n.shallowCopy)(r,a)},h={isEnabled(){return"none"!==this.getLanguage()},getLanguage:()=>a.language,setLanguage(t){a.language=(0,s.isNullish)(t)?l():t},getLanguages:()=>a.languages,setLanguages(t){(0,s.isNullish)(t)||(a.languages=t)},getDefaultLanguage:()=>a.defaultLanguage,setDefaultLanguage(t){a.defaultLanguage=(0,s.isNullish)(t)?"en":t}}},906:(t,e,i)=>{i.r(e),i.d(e,{convertPoint:()=>v,fit:()=>f,getAlignmentAsPoint:()=>P,getCurrentStyle:()=>d,getDocumentScrollOrigin:()=>C,getDocumentSize:()=>p,getOffset:()=>E,getScrollOrigin:()=>y,getSizeForString:()=>T,hasScrollbars:()=>g,matchBinaryMask:()=>x,parseCssNumber:()=>u,removeCursors:()=>h,setCellStyleFlags:()=>S,setCellStyles:()=>m,setOpacity:()=>_,setPrefixedStyle:()=>c,setStyleFlag:()=>w,sortCells:()=>b});var s=i(306),n=i(83),l=i(534),a=i(944),r=i(577),o=i(989);const h=t=>{t.style&&(t.style.cursor="");const e=t.children;if(e){const t=e.length;for(let i=0;i<t;i+=1)h(e[i])}},d=t=>t&&"[object ShadowRoot]"!==t.toString()?window.getComputedStyle(t,""):null,u=t=>{"thin"===t?t="2":"medium"===t?t="4":"thick"===t&&(t="6");let e=parseFloat(t);return Number.isNaN(e)&&(e=0),e},c=(t,e,i)=>{let n=null;s.default.IS_SF||s.default.IS_GC?n="Webkit":s.default.IS_MT&&(n="Moz"),t.setProperty(e,i),null!==n&&e.length>0&&(e=n+e.substring(0,1).toUpperCase()+e.substring(1),t.setProperty(e,i))},g=t=>{const e=d(t);return!!e&&("scroll"===e.overflow||"auto"===e.overflow)},p=()=>{const t=document.body,e=document.documentElement;try{return new o.default(0,0,t.clientWidth??e.clientWidth,Math.max(t.clientHeight??0,e.clientHeight))}catch(t){return new o.default}},f=t=>{const e=p(),i=t.offsetLeft,s=t.offsetWidth,n=C(t.ownerDocument),l=n.x,a=n.y,r=l+e.width;i+s>r&&(t.style.left=`${Math.max(l,r-s)}px`);const o=t.offsetTop,h=t.offsetHeight,d=a+e.height;o+h>d&&(t.style.top=`${Math.max(a,d-h)}px`)},E=(t,e=!1)=>{let i=0,s=0,n=!1,a=t;const r=document.body,o=document.documentElement;for(;null!=a&&a!=r&&a!=o&&!n;){const t=d(a);null!=t&&(n=n||"fixed"==t.position),a=a.parentNode}if(!e&&!n){const e=C(t.ownerDocument);i+=e.x,s+=e.y}const h=t.getBoundingClientRect();return null!=h&&(i+=h.left,s+=h.top),new l.default(i,s)},C=t=>{const e=t.defaultView||t.parentWindow,i=null!=e&&void 0!==window.pageXOffset?window.pageXOffset:(document.documentElement||document.body.parentNode||document.body).scrollLeft,s=null!=e&&void 0!==window.pageYOffset?window.pageYOffset:(document.documentElement||document.body.parentNode||document.body).scrollTop;return new l.default(i,s)},y=(t=null,e=!1,i=!0)=>{const s=null!=t?t.ownerDocument:document,n=s.body,a=s.documentElement,r=new l.default;let o=!1;for(;null!=t&&t!=n&&t!=a;){Number.isNaN(t.scrollLeft)||Number.isNaN(t.scrollTop)||(r.x+=t.scrollLeft,r.y+=t.scrollTop);const i=d(t);null!=i&&(o=o||"fixed"==i.position),t=e?t.parentNode:null}if(!o&&i){const t=C(s);r.x+=t.x,r.y+=t.y}return r},v=(t,e,i)=>{const s=y(t,!1),n=E(t);return n.x-=s.x,n.y-=s.y,new l.default(e-n.x,i-n.y)},m=(t,e,i,s)=>{e.length>0&&t.batchUpdate((()=>{for(let n=0;n<e.length;n+=1){const l=e[n];if(l){const e=l.getClonedStyle();e[i]=s,t.setStyle(l,e)}}}))},S=(t,e,i,s,n)=>{e.length>0&&t.batchUpdate((()=>{for(let l=0;l<e.length;l+=1){const a=e[l];if(a){const e=w(a.getClonedStyle(),i,s,n);t.setStyle(a,e)}}}))},w=(t,e,i,s)=>{const n=t[e];return t[e]=void 0===n?void 0===s||s?i:0:void 0===s?n^i:s?n|i:n&~i,t},_=(t,e)=>{t.style.opacity=String(e/100)},x=(t,e)=>(t&e)===e,T=(t,e=n.DEFAULT_FONTSIZE,i=n.DEFAULT_FONTFAMILY,s=null,l=null)=>{const a=document.createElement("div");if(a.style.fontFamily=i,a.style.fontSize=`${Math.round(e)}px`,a.style.lineHeight=`${Math.round(e*n.LINE_HEIGHT)}px`,null!==l){x(l,n.FONT.BOLD)&&(a.style.fontWeight="bold"),x(l,n.FONT.ITALIC)&&(a.style.fontWeight="italic");const t=[];x(l,n.FONT.UNDERLINE)&&t.push("underline"),x(l,n.FONT.STRIKETHROUGH)&&t.push("line-through"),t.length>0&&(a.style.textDecoration=t.join(" "))}a.style.position="absolute",a.style.visibility="hidden",a.style.display="inline-block",null!==s?(a.style.width=`${s}px`,a.style.whiteSpace="normal"):a.style.whiteSpace="nowrap",a.innerHTML=t,document.body.appendChild(a);const r=new o.default(0,0,a.offsetWidth,a.offsetHeight);return document.body.removeChild(a),r},b=(t,e=!0)=>{const i=new a.default;return t.sort(((t,s)=>{let n=i.get(t);null==n&&(n=r.default.create(t).split(r.default.PATH_SEPARATOR),i.put(t,n));let l=i.get(s);null==l&&(l=r.default.create(s).split(r.default.PATH_SEPARATOR),i.put(s,l));const a=r.default.compare(n,l);return 0==a?0:a>0==e?1:-1})),t},P=(t,e)=>{let i=-.5,s=-.5;return t===n.ALIGN.LEFT?i=0:t===n.ALIGN.RIGHT&&(i=-1),e===n.ALIGN.TOP?s=0:e===n.ALIGN.BOTTOM&&(s=-1),new l.default(i,s)}},909:(t,e,i)=>{i.r(e),i.d(e,{default:()=>a});var s=i(83),n=i(568);class l{static get(t){if(t){if(null===t[s.IDENTITY_FIELD_NAME]||void 0===t[s.IDENTITY_FIELD_NAME])if("object"==typeof t){const e=(0,n.getFunctionName)(t.constructor);t[s.IDENTITY_FIELD_NAME]=`${e}#${l.counter++}`}else"function"==typeof t&&(t[s.IDENTITY_FIELD_NAME]="Function#"+l.counter++);return t[s.IDENTITY_FIELD_NAME]}return null}static clear(t){delete t[s.IDENTITY_FIELD_NAME]}}l.FIELD_NAME=s.IDENTITY_FIELD_NAME,l.counter=0;const a=l},937:(t,e,i)=>{i.r(e),i.d(e,{default:()=>a});var s=i(823),n=i(534),l=i(603);const a=class{constructor(t,e){if(this.view=t,this.root=e,this.previous=e,this.isUp=null===e,!this.isUp){let t=this.view.currentRoot;for(;t;){if(t===e){this.isUp=!0;break}t=t.getParent()}}}execute(){const t=this.view.currentRoot;this.view.currentRoot=this.previous,this.previous=t;const e=this.view.graph.getTranslateForRoot(this.view.currentRoot);e&&(this.view.translate=new n.default(-e.x,-e.y)),this.isUp?(this.view.clear(this.view.currentRoot,!0,!0),this.view.validate(null)):this.view.refresh();const i=this.isUp?l.default.UP:l.default.DOWN;this.view.fireEvent(new s.default(i,{root:this.view.currentRoot,previous:this.previous})),this.isUp=!this.isUp}}},944:(t,e,i)=>{i.r(e),i.d(e,{default:()=>n});var s=i(909);const n=class{constructor(){this.map={},this.clear()}clear(){this.map={}}get(t){const e=s.default.get(t);return this.map[e]??null}put(t,e){const i=s.default.get(t),n=this.map[i];return this.map[i]=e,n??null}remove(t){const e=s.default.get(t),i=this.map[e];return delete this.map[e],i??null}getKeys(){const t=[];for(const e in this.map)t.push(e);return t}getValues(){const t=[];for(const e in this.map)t.push(this.map[e]);return t}visit(t){for(const e in this.map)t(e,this.map[e])}}},953:(t,e,i)=>{i.r(e),i.d(e,{default:()=>o});var s=i(534),n=i(989),l=i(944),a=i(83);class r extends n.default{constructor(t=null,e=null,i=null){super(),this.node=null,this.cellBounds=null,this.paintBounds=null,this.boundingBox=null,this.control=null,this.overlays=new l.default,this.invalidStyle=!1,this.invalid=!0,this.absolutePoints=[],this.visibleSourceState=null,this.visibleTargetState=null,this.terminalDistance=0,this.length=0,this.segments=[],this.shape=null,this.text=null,this.unscaledWidth=0,this.unscaledHeight=0,this.parentHighlight=null,this.point=null,t&&(this.view=t),e&&(this.cell=e),this.style=i??{},this.origin=new s.default,this.absoluteOffset=new s.default}getPerimeterBounds(t=0,e=new n.default(this.x,this.y,this.width,this.height)){if("fixed"===this.shape?.stencil?.aspect){const t=this.shape.stencil.computeAspect(this.shape,e.x,e.y,e.width,e.height);e.x=t.x,e.y=t.y,e.width=this.shape.stencil.w0*t.width,e.height=this.shape.stencil.h0*t.height}return 0!==t&&e.grow(t),e}setAbsoluteTerminalPoint(t,e=!1){e?0===this.absolutePoints.length?this.absolutePoints.push(t):this.absolutePoints[0]=t:0===this.absolutePoints.length?(this.absolutePoints.push(null),this.absolutePoints.push(t)):1===this.absolutePoints.length?this.absolutePoints.push(t):this.absolutePoints[this.absolutePoints.length-1]=t}setCursor(t){this.shape&&this.shape.setCursor(t),this.text&&this.text.setCursor(t)}getVisibleTerminal(t=!1){return this.getVisibleTerminalState(t)?.cell??null}getVisibleTerminalState(t=!1){return t?this.visibleSourceState:this.visibleTargetState}setVisibleTerminalState(t,e=!1){e?this.visibleSourceState=t:this.visibleTargetState=t}getCellBounds(){return this.cellBounds}getPaintBounds(){return this.paintBounds}updateCachedBounds(){const t=this.view,e=t.translate,i=t.scale;this.cellBounds=new n.default(this.x/i-e.x,this.y/i-e.y,this.width/i,this.height/i),this.paintBounds=n.default.fromRectangle(this.cellBounds),this.shape&&this.shape.isPaintBoundsInverted()&&this.paintBounds.rotate90()}setState(t){this.view=t.view,this.cell=t.cell,this.style=t.style,this.absolutePoints=t.absolutePoints,this.origin=t.origin,this.absoluteOffset=t.absoluteOffset,this.boundingBox=t.boundingBox,this.terminalDistance=t.terminalDistance,this.segments=t.segments,this.length=t.length,this.x=t.x,this.y=t.y,this.width=t.width,this.height=t.height,this.unscaledWidth=t.unscaledWidth,this.unscaledHeight=t.unscaledHeight}clone(){const t=new r(this.view,this.cell,this.style);for(let e=0;e<this.absolutePoints.length;e+=1){const i=this.absolutePoints[e];t.absolutePoints[e]=i?i.clone():null}return this.origin&&(t.origin=this.origin.clone()),this.absoluteOffset&&(t.absoluteOffset=this.absoluteOffset.clone()),this.boundingBox&&(t.boundingBox=this.boundingBox.clone()),t.terminalDistance=this.terminalDistance,t.segments=this.segments,t.length=this.length,t.x=this.x,t.y=this.y,t.width=this.width,t.height=this.height,t.unscaledWidth=this.unscaledWidth,t.unscaledHeight=this.unscaledHeight,t}destroy(){this.view.graph.cellRenderer.destroy(this)}isLoop(t){const e=this.getVisibleTerminalState(!0);return e&&e===this.getVisibleTerminalState(!1)}getVerticalAlign(){return this.style.verticalAlign??a.ALIGN.MIDDLE}isTransparentState(){return(this.style.strokeColor??a.NONE)===a.NONE&&(this.style.fillColor??a.NONE)===a.NONE&&!this.getImageSrc()}getImageSrc(){return this.style.image||null}getIndicatorColor(){return this.style.indicatorColor||null}getIndicatorGradientColor(){return this.style.gradientColor||null}getIndicatorShape(){return this.style.indicatorShape||null}getIndicatorImageSrc(){return this.style.indicatorImage||null}}const o=r},954:(__unused_webpack_module,__webpack_exports__,__webpack_require__)=>{__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{GraphView:()=>GraphView,default:()=>__WEBPACK_DEFAULT_EXPORT__});var _geometry_Point__WEBPACK_IMPORTED_MODULE_1__=__webpack_require__(534),_geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__=__webpack_require__(989),_util_Dictionary__WEBPACK_IMPORTED_MODULE_4__=__webpack_require__(944),_event_EventSource__WEBPACK_IMPORTED_MODULE_0__=__webpack_require__(118),_event_EventObject__WEBPACK_IMPORTED_MODULE_5__=__webpack_require__(823),_geometry_node_RectangleShape__WEBPACK_IMPORTED_MODULE_10__=__webpack_require__(315),_util_Constants__WEBPACK_IMPORTED_MODULE_15__=__webpack_require__(83),_Client__WEBPACK_IMPORTED_MODULE_20__=__webpack_require__(306),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__=__webpack_require__(603),_util_styleUtils__WEBPACK_IMPORTED_MODULE_19__=__webpack_require__(906),_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__=__webpack_require__(633),_util_config__WEBPACK_IMPORTED_MODULE_9__=__webpack_require__(272),_cell_CellState__WEBPACK_IMPORTED_MODULE_18__=__webpack_require__(953),_undoable_changes_UndoableEdit__WEBPACK_IMPORTED_MODULE_8__=__webpack_require__(592),_geometry_node_ImageShape__WEBPACK_IMPORTED_MODULE_11__=__webpack_require__(79),_event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__=__webpack_require__(966),_undoable_changes_CurrentRootChange__WEBPACK_IMPORTED_MODULE_7__=__webpack_require__(937),_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__=__webpack_require__(437),_util_cloneUtils__WEBPACK_IMPORTED_MODULE_16__=__webpack_require__(766),_style_StyleRegistry__WEBPACK_IMPORTED_MODULE_17__=__webpack_require__(127),_i18n_config__WEBPACK_IMPORTED_MODULE_2__=__webpack_require__(902);class GraphView extends _event_EventSource__WEBPACK_IMPORTED_MODULE_0__.default{constructor(t){super(),this.backgroundImage=null,this.backgroundPageShape=null,this.EMPTY_POINT=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default,this.doneResource=_i18n_config__WEBPACK_IMPORTED_MODULE_2__.TranslationsConfig.isEnabled()?"done":"",this.updatingDocumentResource=_i18n_config__WEBPACK_IMPORTED_MODULE_2__.TranslationsConfig.isEnabled()?"updatingDocument":"",this.allowEval=!1,this.captureDocumentGesture=!0,this.rendering=!0,this.currentRoot=null,this.graphBounds=new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.default,this.scale=1,this.translate=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default,this.states=new _util_Dictionary__WEBPACK_IMPORTED_MODULE_4__.default,this.updateStyle=!1,this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null,this.endHandler=null,this.moveHandler=null,this.graph=t}getGraphBounds(){return this.graphBounds}setGraphBounds(t){this.graphBounds=t}getScale(){return this.scale}setScale(t){const e=this.scale;e!==t&&(this.scale=t,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new _event_EventObject__WEBPACK_IMPORTED_MODULE_5__.default(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.SCALE,{scale:t,previousScale:e}))}getTranslate(){return this.translate}isRendering(){return this.rendering}setRendering(t){this.rendering=t}setTranslate(t,e){const i=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default(this.translate.x,this.translate.y);this.translate.x===t&&this.translate.y===e||(this.translate.x=t,this.translate.y=e,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new _event_EventObject__WEBPACK_IMPORTED_MODULE_5__.default(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.TRANSLATE,{translate:this.translate,previousTranslate:i}))}isAllowEval(){return this.allowEval}setAllowEval(t){this.allowEval=t}getStates(){return this.states}setStates(t){this.states=t}getCanvas(){return this.canvas}getBackgroundPane(){return this.backgroundPane}getDrawPane(){return this.drawPane}getOverlayPane(){return this.overlayPane}getDecoratorPane(){return this.decoratorPane}getBounds(t){let e=null;if(t.length>0)for(let i=0;i<t.length;i+=1)if(t[i].isVertex()||t[i].isEdge()){const s=this.getState(t[i]);s&&(e?e.add(s):e=_geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.default.fromRectangle(s))}return e}setCurrentRoot(t){if(this.currentRoot!==t){const e=new _undoable_changes_CurrentRootChange__WEBPACK_IMPORTED_MODULE_7__.default(this,t);e.execute();const i=new _undoable_changes_UndoableEdit__WEBPACK_IMPORTED_MODULE_8__.default(this,!0);i.add(e),this.fireEvent(new _event_EventObject__WEBPACK_IMPORTED_MODULE_5__.default(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.UNDO,{edit:i})),this.graph.sizeDidChange(),this.currentRoot=t}return t}scaleAndTranslate(t,e,i){const s=this.scale,n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default(this.translate.x,this.translate.y);this.scale===t&&this.translate.x===e&&this.translate.y===i||(this.scale=t,this.translate.x=e,this.translate.y=i,this.isEventsEnabled()&&this.viewStateChanged()),this.fireEvent(new _event_EventObject__WEBPACK_IMPORTED_MODULE_5__.default(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.SCALE_AND_TRANSLATE,{scale:t,previousScale:s,translate:this.translate,previousTranslate:n}))}viewStateChanged(){this.revalidate(),this.graph.sizeDidChange()}refresh(){this.currentRoot&&this.clear(),this.revalidate()}revalidate(){this.invalidate(),this.validate()}clear(t,e=!1,i=!0){if(t||(t=this.graph.getDataModel().getRoot()),t)if(this.removeState(t),i&&(e||t!==this.currentRoot)){const i=t.getChildCount();for(let s=0;s<i;s+=1)this.clear(t.getChildAt(s),e)}else this.invalidate(t)}invalidate(t=null,e=!0,i=!0){const s=this.graph.getDataModel();if(t=t??s.getRoot()){const s=this.getState(t);if(s&&(s.invalid=!0),!t.invalidating){if(t.invalidating=!0,e){const s=t.getChildCount();for(let n=0;n<s;n+=1){const s=t.getChildAt(n);this.invalidate(s,e,i)}}if(i){const s=t.getEdgeCount();for(let n=0;n<s;n+=1)this.invalidate(t.getEdgeAt(n),e,i)}t.invalidating=!1}}}validate(t=null){const e=_util_config__WEBPACK_IMPORTED_MODULE_9__.GlobalConfig.logger.enter("GraphView.validate");this.resetValidationState();const i=t||(this.currentRoot??this.graph.getDataModel().getRoot());if(i){const t=this.getBoundingBox(this.validateCellState(i?this.validateCell(i):null));this.setGraphBounds(t??this.getEmptyBounds()),this.validateBackground(),this.resetValidationState()}_util_config__WEBPACK_IMPORTED_MODULE_9__.GlobalConfig.logger.leave("GraphView.validate",e)}getEmptyBounds(){return new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.default(this.translate.x*this.scale,this.translate.y*this.scale)}getBoundingBox(t=null,e=!0){let i=null;if(t&&(t.shape&&t.shape.boundingBox&&(i=t.shape.boundingBox.clone()),t.text&&t.text.boundingBox&&(i?i.add(t.text.boundingBox):i=t.text.boundingBox.clone()),e)){const e=t.cell.getChildCount();for(let s=0;s<e;s+=1){const e=this.getBoundingBox(this.getState(t.cell.getChildAt(s)));e&&(i?i.add(e):i=e)}}return i}createBackgroundPageShape(t){return new _geometry_node_RectangleShape__WEBPACK_IMPORTED_MODULE_10__.default(t,"white","black")}validateBackground(){this.validateBackgroundImage(),this.validateBackgroundPage()}validateBackgroundImage(){const t=this.graph.getBackgroundImage();if(t){if(!this.backgroundImage||this.backgroundImage.imageSrc!==t.src){this.backgroundImage&&this.backgroundImage.destroy();const e=new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.default(0,0,1,1);this.backgroundImage=new _geometry_node_ImageShape__WEBPACK_IMPORTED_MODULE_11__.default(e,t.src),this.backgroundImage.dialect=this.graph.dialect,this.backgroundImage.init(this.backgroundPane),this.backgroundImage.redraw()}this.redrawBackgroundImage(this.backgroundImage,t)}else this.backgroundImage&&(this.backgroundImage.destroy(),this.backgroundImage=null)}validateBackgroundPage(){const t=this.graph;if(t.pageVisible){const e=this.getBackgroundPageBounds();null==this.backgroundPageShape?(this.backgroundPageShape=this.createBackgroundPageShape(e),this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.isShadow=!0,this.backgroundPageShape.dialect=this.graph.dialect,this.backgroundPageShape.init(this.backgroundPane),this.backgroundPageShape.redraw(),this.backgroundPageShape.node&&(t.isNativeDblClickEnabled()&&_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.addListener(this.backgroundPageShape.node,"dblclick",(e=>{t.dblClick(e)})),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.addGestureListeners(this.backgroundPageShape.node,(e=>{t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.MOUSE_DOWN,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.default(e))}),(e=>{const i=t.getPlugin("TooltipHandler");i&&i.isHideOnHover()&&i.hide(),t.isMouseDown&&!(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.isConsumed)(e)&&t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.MOUSE_MOVE,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.default(e))}),(e=>{t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.MOUSE_UP,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.default(e))})))):(this.backgroundPageShape.scale=this.scale,this.backgroundPageShape.bounds=e,this.backgroundPageShape.redraw())}else this.backgroundPageShape&&(this.backgroundPageShape.destroy(),this.backgroundPageShape=null)}getBackgroundPageBounds(){const t=this.graph.pageFormat,e=this.scale*this.graph.pageScale;return new _geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.default(this.scale*this.translate.x,this.scale*this.translate.y,t.width*e,t.height*e)}redrawBackgroundImage(t,e){if(t.scale=this.scale,t.bounds){const i=t.bounds;i.x=this.scale*this.translate.x,i.y=this.scale*this.translate.y,i.width=this.scale*e.width,i.height=this.scale*e.height}t.redraw()}validateCell(t,e=!0){if(e=e&&t.isVisible(),this.getState(t,e)&&!e)this.removeState(t);else{const i=t.getChildCount();for(let s=0;s<i;s+=1)this.validateCell(t.getChildAt(s),e&&(!t.isCollapsed()||t===this.currentRoot))}return t}validateCellState(t,e=!0){let i=null;if(t&&(i=this.getState(t),i&&(i.invalid&&(i.invalid=!1,i.style&&!i.invalidStyle||(i.style=this.graph.getCellStyle(i.cell),i.invalidStyle=!1),t!==this.currentRoot&&this.validateCellState(t.getParent(),!1),i.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(t,!0),!1),!0),i.setVisibleTerminalState(this.validateCellState(this.getVisibleTerminal(t,!1),!1),!1),this.updateCellState(i),t===this.currentRoot||i.invalid||(this.graph.cellRenderer.redraw(i,!1,this.isRendering()),i.updateCachedBounds())),e&&!i.invalid))){i.shape&&this.stateValidated(i);const e=t.getChildCount();for(let i=0;i<e;i+=1)this.validateCellState(t.getChildAt(i))}return i}updateCellState(t){const e=t.absoluteOffset,i=t.origin;if(e.x=0,e.y=0,i.x=0,i.y=0,t.length=0,t.cell!==this.currentRoot){const s=t.cell.getParent(),n=s?this.getState(s):null;n&&n.cell!==this.currentRoot&&(i.x+=n.origin.x,i.y+=n.origin.y);let l=this.graph.getChildOffsetForCell(t.cell);l&&(i.x+=l.x,i.y+=l.y);const a=t.cell.getGeometry();if(a){if(!t.cell.isEdge())if(l=a.offset?a.offset:this.EMPTY_POINT,a.relative&&n)if(n.cell.isEdge()){const t=this.getPoint(n,a);t&&(i.x+=t.x/this.scale-n.origin.x-this.translate.x,i.y+=t.y/this.scale-n.origin.y-this.translate.y)}else i.x+=a.x*n.unscaledWidth+l.x,i.y+=a.y*n.unscaledHeight+l.y;else e.x=this.scale*l.x,e.y=this.scale*l.y,i.x+=a.x,i.y+=a.y;t.x=this.scale*(this.translate.x+i.x),t.y=this.scale*(this.translate.y+i.y),t.width=this.scale*a.width,t.unscaledWidth=a.width,t.height=this.scale*a.height,t.unscaledHeight=a.height,t.cell.isVertex()&&this.updateVertexState(t,a),t.cell.isEdge()&&this.updateEdgeState(t,a)}}t.updateCachedBounds()}updateVertexState(t,e){const i=t.cell.getParent(),s=i?this.getState(i):null;if(e.relative&&s&&!s.cell.isEdge()){const e=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.toRadians)(s.style.rotation??0);if(0!==e){const i=Math.cos(e),n=Math.sin(e),l=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default(t.getCenterX(),t.getCenterY()),a=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default(s.getCenterX(),s.getCenterY()),r=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.getRotatedPoint)(l,i,n,a);t.x=r.x-t.width/2,t.y=r.y-t.height/2}}this.updateVertexLabelOffset(t)}updateEdgeState(t,e){const i=t.getVisibleTerminalState(!0),s=t.getVisibleTerminalState(!1);if(t.cell.getTerminal(!0)&&!i||!i&&!e.getTerminalPoint(!0)||t.cell.getTerminal(!1)&&!s||!s&&!e.getTerminalPoint(!1))this.clear(t.cell,!0);else{this.updateFixedTerminalPoints(t,i,s),this.updatePoints(t,e.points,i,s),this.updateFloatingTerminalPoints(t,i,s);const n=t.absolutePoints;t.cell!==this.currentRoot&&(null==n||n.length<2||null==n[0]||null==n[n.length-1])?this.clear(t.cell,!0):(this.updateEdgeBounds(t),this.updateEdgeLabelOffset(t))}}updateVertexLabelOffset(t){const e=t.style.labelPosition??_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.CENTER;if(e===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.LEFT){let e=t.style.labelWidth??null;null!=e?e*=this.scale:e=t.width,t.absoluteOffset.x-=e}else if(e===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.RIGHT)t.absoluteOffset.x+=t.width;else if(e===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.CENTER){const e=t.style.labelWidth??null;if(null!=e){const i=t.style.align??_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.CENTER;let s=0;i===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.CENTER?s=.5:i===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.RIGHT&&(s=1),0!==s&&(t.absoluteOffset.x-=(e*this.scale-t.width)*s)}}const i=t.style.verticalLabelPosition??_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.MIDDLE;i===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.TOP?t.absoluteOffset.y-=t.height:i===_util_Constants__WEBPACK_IMPORTED_MODULE_15__.ALIGN.BOTTOM&&(t.absoluteOffset.y+=t.height)}resetValidationState(){this.lastNode=null,this.lastHtmlNode=null,this.lastForegroundNode=null,this.lastForegroundHtmlNode=null}stateValidated(t){const e=this.graph,i=t.cell.isEdge()&&e.keepEdgesInForeground||t.cell.isVertex()&&e.keepEdgesInBackground,s=i&&this.lastForegroundHtmlNode||this.lastHtmlNode,n=i&&this.lastForegroundNode||this.lastNode,l=e.cellRenderer.insertStateAfter(t,n,s);i?(this.lastForegroundHtmlNode=l[1],this.lastForegroundNode=l[0]):(this.lastHtmlNode=l[1],this.lastNode=l[0])}updateFixedTerminalPoints(t,e,i){this.updateFixedTerminalPoint(t,e,!0,this.graph.getConnectionConstraint(t,e,!0)),this.updateFixedTerminalPoint(t,i,!1,this.graph.getConnectionConstraint(t,i,!1))}updateFixedTerminalPoint(t,e,i,s){t.setAbsoluteTerminalPoint(this.getFixedTerminalPoint(t,e,i,s),i)}getFixedTerminalPoint(t,e,i,s){let n=null;if(s&&e&&(n=this.graph.getConnectionPoint(e,s,!1)),!n&&!e){const e=this.scale,s=this.translate,l=t.origin;n=t.cell.getGeometry().getTerminalPoint(i),n&&(n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default(e*(s.x+n.x+l.x),e*(s.y+n.y+l.y)))}return n}updateBoundsFromStencil(t){let e=null;if(t&&t.shape&&t.shape.stencil&&"fixed"===t.shape.stencil.aspect){e=_geometry_Rectangle__WEBPACK_IMPORTED_MODULE_3__.default.fromRectangle(t);const i=t.shape.stencil.computeAspect(null,t.x,t.y,t.width,t.height);t.setRect(i.x,i.y,t.shape.stencil.w0*i.width,t.shape.stencil.h0*i.height)}return e}updatePoints(t,e,i,s){const n=[];n.push(t.absolutePoints[0]);const l=this.getEdgeStyle(t,e,i,s);if(l&&i){const a=this.getTerminalPort(t,i,!0),r=s?this.getTerminalPort(t,s,!1):null,o=this.updateBoundsFromStencil(a),h=this.updateBoundsFromStencil(r);l(t,a,r,e,n),a&&o&&a.setRect(o.x,o.y,o.width,o.height),r&&h&&r.setRect(h.x,h.y,h.width,h.height)}else if(e)for(let i=0;i<e.length;i+=1)if(e[i]){const s=(0,_util_cloneUtils__WEBPACK_IMPORTED_MODULE_16__.clone)(e[i]);n.push(this.transformControlPoint(t,s))}const a=t.absolutePoints;n.push(a[a.length-1]),t.absolutePoints=n}transformControlPoint(t,e,i=!1){if(t&&e){const s=t.origin,n=i?1:this.scale;return new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default(n*(e.x+this.translate.x+s.x),n*(e.y+this.translate.y+s.y))}return null}isLoopStyleEnabled(t,e=[],i=null,s=null){const n=this.graph.getConnectionConstraint(t,i,!0),l=this.graph.getConnectionConstraint(t,s,!1);return(null==e||e.length<2)&&!t.style.orthogonalLoop&&(null!=n&&null!=n.point||null!=l&&null!=l.point)&&null!=i&&i===s}getEdgeStyle(edge,points=[],source=null,target=null){let edgeStyle=this.isLoopStyleEnabled(edge,points,source,target)?edge.style.loopStyle??this.graph.defaultLoopStyle:edge.style.noEdgeStyle?null:edge.style.edgeStyle;if("string"==typeof edgeStyle){let tmp=_style_StyleRegistry__WEBPACK_IMPORTED_MODULE_17__.default.getValue(edgeStyle);!tmp&&this.isAllowEval()&&(tmp=eval(edgeStyle)),edgeStyle=tmp}return"function"==typeof edgeStyle?edgeStyle:null}updateFloatingTerminalPoints(t,e,i){const s=t.absolutePoints,n=s[0];!s[s.length-1]&&i&&this.updateFloatingTerminalPoint(t,i,e,!1),!n&&e&&this.updateFloatingTerminalPoint(t,e,i,!0)}updateFloatingTerminalPoint(t,e,i,s){t.setAbsoluteTerminalPoint(this.getFloatingTerminalPoint(t,e,i,s),s)}getFloatingTerminalPoint(t,e,i,s){e=this.getTerminalPort(t,e,s);let n=this.getNextPoint(t,i,s);const l=this.graph.isOrthogonal(t),a=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.toRadians)(e.style.rotation??0),r=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default(e.getCenterX(),e.getCenterY());if(0!==a){const t=Math.cos(-a),e=Math.sin(-a);n=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.getRotatedPoint)(n,t,e,r)}let o=t.style.perimeterSpacing??0;o+=t.style[s?"sourcePerimeterSpacing":"targetPerimeterSpacing"]??0;let h=this.getPerimeterPoint(e,n,0===a&&l,o);if(h&&0!==a){const t=Math.cos(a),e=Math.sin(a);h=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.getRotatedPoint)(h,t,e,r)}return h}getTerminalPort(t,e,i=!1){const s=i?"sourcePort":"targetPort",n=t.style[s];if(n){const t=this.graph.getDataModel().getCell(n);if(t){const i=this.getState(t,!1);i&&(e=i)}}return e}getPerimeterPoint(t,e,i,s=0){let n=null;if(null!=t){const l=this.getPerimeterFunction(t);if(null!=l&&null!=e){const a=this.getPerimeterBounds(t,s);if(a.width>0||a.height>0){n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default(e.x,e.y);let s=!1,r=!1;t.cell.isVertex()&&(s=!!t.style.flipH,r=!!t.style.flipV,s&&(n.x=2*a.getCenterX()-n.x),r&&(n.y=2*a.getCenterY()-n.y)),n=l(a,t,n,i),null!=n&&(s&&(n.x=2*a.getCenterX()-n.x),r&&(n.y=2*a.getCenterY()-n.y))}}null==n&&(n=this.getPoint(t))}return n}getRoutingCenterX(t){const e=t.style?t.style.routingCenterX??0:0;return t.getCenterX()+e*t.width}getRoutingCenterY(t){const e=t.style?t.style.routingCenterY??0:0;return t.getCenterY()+e*t.height}getPerimeterBounds(t,e=0){return e+=t.style.perimeterSpacing??0,t.getPerimeterBounds(e*this.scale)}getPerimeterFunction(state){let perimeter=state.style.perimeter;if("string"==typeof perimeter){let tmp=_style_StyleRegistry__WEBPACK_IMPORTED_MODULE_17__.default.getValue(perimeter);null==tmp&&this.isAllowEval()&&(tmp=eval(perimeter)),perimeter=tmp}return"function"==typeof perimeter?perimeter:null}getNextPoint(t,e,i=!1){const s=t.absolutePoints;let n=null;if(s.length>=2){const t=s.length;n=s[i?Math.min(1,t-1):Math.max(0,t-2)]}return!n&&e&&(n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default(e.getCenterX(),e.getCenterY())),n}getVisibleTerminal(t,e){const i=this.graph.getDataModel();let s=t.getTerminal(e),n=s;for(;s&&s!==this.currentRoot;)(n&&!n.isVisible()||s.isCollapsed())&&(n=s),s=s.getParent();return!n||i.contains(n)&&n.getParent()!==i.getRoot()&&n!==this.currentRoot||(n=null),n}updateEdgeBounds(t){const e=t.absolutePoints,i=e[0],s=e[e.length-1];if(i&&s&&(i.x!==s.x||i.y!==s.y)){const e=s.x-i.x,n=s.y-i.y;t.terminalDistance=Math.sqrt(e*e+n*n)}else t.terminalDistance=0;let n=0;const l=[];let a=i;if(a){let i=a.x,s=a.y,r=i,o=s;for(let t=1;t<e.length;t+=1){const h=e[t];if(h){const t=a.x-h.x,e=a.y-h.y,d=Math.sqrt(t*t+e*e);l.push(d),n+=d,a=h,i=Math.min(a.x,i),s=Math.min(a.y,s),r=Math.max(a.x,r),o=Math.max(a.y,o)}}t.length=n,t.segments=l;const h=1;t.x=i,t.y=s,t.width=Math.max(h,r-i),t.height=Math.max(h,o-s)}}getPoint(t,e=null){let i=t.getCenterX(),s=t.getCenterY();if(null==t.segments||null!=e&&!e.relative){if(null!=e){const{offset:t}=e;null!=t&&(i+=t.x,s+=t.y)}}else{const n=null!=e?e.x/2:0,l=t.absolutePoints.length,a=Math.round((n+.5)*t.length);let r=t.segments[0],o=0,h=1;for(;a>=Math.round(o+r)&&h<l-1;)o+=r,r=t.segments[h++];const d=0===r?0:(a-o)/r,u=t.absolutePoints[h-1],c=t.absolutePoints[h];if(null!=u&&null!=c){let t=0,n=0,l=0;if(null!=e){t=e.y;const{offset:i}=e;null!=i&&(n=i.x,l=i.y)}const a=c.x-u.x,o=c.y-u.y,h=0===r?0:o/r,g=0===r?0:a/r;i=u.x+a*d+(h*t+n)*this.scale,s=u.y+o*d-(g*t-l)*this.scale}}return new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default(i,s)}getRelativePoint(t,e,i){const s=t.cell.getGeometry();if(s){const n=t.absolutePoints,l=n.length;if(s.relative&&l>1){const s=t.length,{segments:a}=t;let r=n[0],o=n[1],h=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.ptSegDistSq)(r.x,r.y,o.x,o.y,e,i),d=0,u=0,c=0;for(let t=2;t<l;t+=1){r=o,o=n[t];const s=(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.ptSegDistSq)(r.x,r.y,o.x,o.y,e,i);c+=a[t-2],s<=h&&(h=s,u=t-1,d=c)}const g=a[u];r=n[u],o=n[u+1];const p=r.x,f=r.y,E=o.x,C=o.y;let y=e,v=i;const m=p-E,S=f-C;y-=E,v-=C;let w=0;y=m-y,v=S-v;const _=y*m+v*S;w=_<=0?0:_*_/(m*m+S*S);let x=Math.sqrt(w);x>g&&(x=g);let T=Math.sqrt((0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.ptSegDistSq)(r.x,r.y,o.x,o.y,e,i));return-1===(0,_util_mathUtils__WEBPACK_IMPORTED_MODULE_14__.relativeCcw)(r.x,r.y,o.x,o.y,e,i)&&(T=-T),new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default((s/2-d-x)/s*-2,T/this.scale)}}return new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default}updateEdgeLabelOffset(t){const e=t.absolutePoints,i=t.absoluteOffset;if(i.x=t.getCenterX(),i.y=t.getCenterY(),e.length>0&&t.segments){const s=t.cell.getGeometry();if(s)if(s.relative){const e=this.getPoint(t,s);t.absoluteOffset=e}else{const t=e[0],n=e[e.length-1];if(t&&n){const e=n.x-t.x,l=n.y-t.y;let a=0,r=0;const o=s.offset;o&&(a=o.x,r=o.y);const h=t.x+e/2+a*this.scale,d=t.y+l/2+r*this.scale;i.x=h,i.y=d}}}}getState(t,e=!1){let i=this.states.get(t);return e&&(!i||this.updateStyle)&&t.isVisible()&&(i?i.style=this.graph.getCellStyle(t):(i=this.createState(t),this.states.put(t,i))),i}getCellStates(t=null){if(!t)return this.states.getValues();const e=[];for(const i of t){const t=this.getState(i);t&&e.push(t)}return e}removeState(t){const e=this.states.remove(t);return e&&(this.graph.cellRenderer.destroy(e),e.invalid=!0,e.destroy()),e}createState(t){return new _cell_CellState__WEBPACK_IMPORTED_MODULE_18__.default(this,t,this.graph.getCellStyle(t))}isContainerEvent(t){const e=(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.getSource)(t);return e&&(e===this.graph.container||e.parentNode===this.backgroundPane||e.parentNode&&e.parentNode.parentNode===this.backgroundPane||e===this.canvas.parentNode||e===this.canvas||e===this.backgroundPane||e===this.drawPane||e===this.overlayPane||e===this.decoratorPane)}isScrollEvent(t){const e=this.graph,i=(0,_util_styleUtils__WEBPACK_IMPORTED_MODULE_19__.getOffset)(e.container),s=t instanceof MouseEvent?[t.clientX,t.clientY]:[t.touches[0].clientX,t.touches[0].clientY],n=new _geometry_Point__WEBPACK_IMPORTED_MODULE_1__.default(s[0]-i.x,s[1]-i.y),l=e.container,a=l.offsetWidth,r=l.clientWidth;if(a>r&&n.x>r+2&&n.x<=a)return!0;const o=l.offsetHeight,h=l.clientHeight;return o>h&&n.y>h+2&&n.y<=o}init(){this.installListeners(),this.createSvg()}installListeners(){const t=this.graph,{container:e}=t;_Client__WEBPACK_IMPORTED_MODULE_20__.default.IS_TOUCH&&(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.addListener(e,"gesturestart",(e=>{t.fireGestureEvent(e),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.consume(e)})),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.addListener(e,"gesturechange",(e=>{t.fireGestureEvent(e),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.consume(e)})),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.addListener(e,"gestureend",(e=>{t.fireGestureEvent(e),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.consume(e)})));let i=null;_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.addGestureListeners(e,(e=>{!this.isContainerEvent(e)||(_Client__WEBPACK_IMPORTED_MODULE_20__.default.IS_GC||_Client__WEBPACK_IMPORTED_MODULE_20__.default.IS_SF)&&this.isScrollEvent(e)||(t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.MOUSE_DOWN,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.default(e)),i=e.pointerId)}),(e=>{!this.isContainerEvent(e)||null!==i&&e.pointerId!==i||t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.MOUSE_MOVE,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.default(e))}),(e=>{this.isContainerEvent(e)&&t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.MOUSE_UP,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.default(e)),i=null})),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.addListener(e,"dblclick",(e=>{this.isContainerEvent(e)&&t.dblClick(e)})),t.addMouseListener({mouseDown:(e,i)=>{const s=t.getPlugin("PopupMenuHandler");s?.hideMenu()},mouseMove:()=>{},mouseUp:()=>{}}),this.moveHandler=i=>{const s=t.getPlugin("TooltipHandler");s&&s.isHideOnHover()&&s.hide(),this.captureDocumentGesture&&t.isMouseDown&&null!=t.container&&!this.isContainerEvent(i)&&"none"!==t.container.style.display&&"hidden"!==t.container.style.visibility&&!(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.isConsumed)(i)&&t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.MOUSE_MOVE,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.default(i,(i=>{let s=null;if(_Client__WEBPACK_IMPORTED_MODULE_20__.default.IS_TOUCH){const n=(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.getClientX)(i),l=(0,_util_EventUtils__WEBPACK_IMPORTED_MODULE_13__.getClientY)(i),a=(0,_util_styleUtils__WEBPACK_IMPORTED_MODULE_19__.convertPoint)(e,n,l),r=t.getCellAt(a.x,a.y);r&&(s=t.view.getState(r))}return s})(i)))},this.endHandler=e=>{this.captureDocumentGesture&&t.isMouseDown&&null!=t.container&&!this.isContainerEvent(e)&&"none"!==t.container.style.display&&"hidden"!==t.container.style.visibility&&t.fireMouseEvent(_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.MOUSE_UP,new _event_InternalMouseEvent__WEBPACK_IMPORTED_MODULE_12__.default(e))},_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.addGestureListeners(document,null,this.moveHandler,this.endHandler)}createSvg(){const{container:t}=this.graph,e=this.canvas=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.NS_SVG,"g");this.backgroundPane=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.NS_SVG,"g"),e.appendChild(this.backgroundPane),this.drawPane=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.NS_SVG,"g"),e.appendChild(this.drawPane),this.overlayPane=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.NS_SVG,"g"),e.appendChild(this.overlayPane),this.decoratorPane=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.NS_SVG,"g"),e.appendChild(this.decoratorPane);const i=document.createElementNS(_util_Constants__WEBPACK_IMPORTED_MODULE_15__.NS_SVG,"svg");i.style.left="0px",i.style.top="0px",i.style.width="100%",i.style.height="100%",i.style.display="block",i.appendChild(this.canvas),null!=t&&(t.appendChild(i),this.updateContainerStyle(t))}createHtml(){const t=this.graph.container;null!=t&&(this.canvas=this.createHtmlPane("100%","100%"),this.canvas.style.overflow="hidden",this.backgroundPane=this.createHtmlPane("1px","1px"),this.drawPane=this.createHtmlPane("1px","1px"),this.overlayPane=this.createHtmlPane("1px","1px"),this.decoratorPane=this.createHtmlPane("1px","1px"),this.canvas.appendChild(this.backgroundPane),this.canvas.appendChild(this.drawPane),this.canvas.appendChild(this.overlayPane),this.canvas.appendChild(this.decoratorPane),t.appendChild(this.canvas),this.updateContainerStyle(t))}updateHtmlCanvasSize(t,e){if(null!=this.graph.container){const i=this.graph.container.offsetWidth,s=this.graph.container.offsetHeight;this.canvas.style.width=i<t?t+"px":"100%",this.canvas.style.height=s<e?e+"px":"100%"}}createHtmlPane(t,e){const i=document.createElement("DIV");return null!=t&&null!=e?(i.style.position="absolute",i.style.left="0px",i.style.top="0px",i.style.width=t,i.style.height=e):i.style.position="relative",i}updateContainerStyle(t){const e=(0,_util_styleUtils__WEBPACK_IMPORTED_MODULE_19__.getCurrentStyle)(t);null!=e&&"static"==e.position&&(t.style.position="relative"),_Client__WEBPACK_IMPORTED_MODULE_20__.default.IS_POINTER&&(t.style.touchAction="none")}destroy(){let t=null;this.canvas&&this.canvas instanceof SVGElement&&(t=this.canvas.ownerSVGElement),t||(t=this.canvas),t&&t.parentNode&&(this.clear(this.currentRoot,!0),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.removeGestureListeners(document,null,this.moveHandler,this.endHandler),_event_InternalEvent__WEBPACK_IMPORTED_MODULE_6__.default.release(this.graph.container),t.parentNode.removeChild(t),this.moveHandler=null,this.endHandler=null,this.canvas=null,this.backgroundPane=null,this.drawPane=null,this.overlayPane=null,this.decoratorPane=null)}}const __WEBPACK_DEFAULT_EXPORT__=GraphView},966:(t,e,i)=>{i.r(e),i.d(e,{default:()=>l});var s=i(437),n=i(733);const l=class{constructor(t,e=null){this.consumed=!1,this.evt=t,this.state=e,this.sourceState=e,this.graphX=0,this.graphY=0}getEvent(){return this.evt}getSource(){return(0,s.getSource)(this.evt)}isSource(t){return!!t&&(0,n.isAncestorNode)(t.node,this.getSource())}getX(){return(0,s.getClientX)(this.getEvent())}getY(){return(0,s.getClientY)(this.getEvent())}getGraphX(){return this.graphX}getGraphY(){return this.graphY}getState(){return this.state}getCell(){const t=this.getState();return t?t.cell:null}isPopupTrigger(){return(0,s.isPopupTrigger)(this.getEvent())}isConsumed(){return this.consumed}consume(t){(t=t||window.TouchEvent&&this.evt instanceof TouchEvent||(0,s.isMouseEvent)(this.evt))&&this.evt.preventDefault&&this.evt.preventDefault(),this.consumed=!0}}},989:(t,e,i)=>{i.r(e),i.d(e,{default:()=>l});var s=i(534);class n extends s.default{constructor(t=0,e=0,i=0,s=0){super(t,e),this._width=0,this._height=0,this.width=i,this.height=s}get width(){return this._width}set width(t){if(Number.isNaN(t))throw new Error("Invalid width supplied.");this._width=t}get height(){return this._height}set height(t){if(Number.isNaN(t))throw new Error("Invalid height supplied.");this._height=t}setRect(t,e,i,s){this.x=t,this.y=e,this.width=i,this.height=s}getCenterX(){return this.x+this.width/2}getCenterY(){return this.y+this.height/2}add(t){const e=Math.min(this.x,t.x),i=Math.min(this.y,t.y),s=Math.max(this.x+this.width,t.x+t.width),n=Math.max(this.y+this.height,t.y+t.height);this.x=e,this.y=i,this.width=s-e,this.height=n-i}intersect(t){const e=this.x+this.width,i=t.x+t.width,s=this.y+this.height,n=t.y+t.height;this.x=Math.max(this.x,t.x),this.y=Math.max(this.y,t.y),this.width=Math.min(e,i)-this.x,this.height=Math.min(s,n)-this.y}grow(t){this.x-=t,this.y-=t,this.width+=2*t,this.height+=2*t}getPoint(){return new s.default(this.x,this.y)}rotate90(){const t=(this.width-this.height)/2;this.x+=t,this.y-=t;const e=this.width;this.width=this.height,this.height=e}equals(t){return!!t&&t.x===this.x&&t.y===this.y&&t.width===this.width&&t.height===this.height}clone(){return new n(this.x,this.y,this.width,this.height)}}n.fromRectangle=t=>new n(t.x,t.y,t.width,t.height);const l=n}},__webpack_module_cache__={};function __webpack_require__(t){var e=__webpack_module_cache__[t];if(void 0!==e)return e.exports;var i=__webpack_module_cache__[t]={exports:{}};return __webpack_modules__[t](i,i.exports,__webpack_require__),i.exports}__webpack_require__.d=(t,e)=>{for(var i in e)__webpack_require__.o(e,i)&&!__webpack_require__.o(t,i)&&Object.defineProperty(t,i,{enumerable:!0,get:e[i]})},__webpack_require__.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),__webpack_require__.r=t=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})};var __webpack_exports__={};__webpack_require__.r(__webpack_exports__),__webpack_require__.d(__webpack_exports__,{appModelVisualizer:()=>appModelVisualizer});const COMPOSITE_FIELD_ABSENT_VALUE=null;var Sort,JoinType,DSQueryType;!function(t){t.DESC="desc",t.ASC="asc",t.NONE="none"}(Sort||(Sort={})),function(t){t.inner="inner",t.left="left",t.right="right",t.full="full"}(JoinType||(JoinType={})),function(t){t.select="select",t.join="join",t.union="union",t.system="system",t.constant="constant"}(DSQueryType||(DSQueryType={}));const{constant:QT_CONSTANT,join:QT_JOIN,select:QT_SELECT,system:QT_SYSTEM,union:QT_UNION}=DSQueryType,EDITABLE_QUERY_TYPES=[QT_CONSTANT,QT_JOIN,QT_SELECT,QT_UNION],READ_ONLY_QUERY_TYPES=[QT_SYSTEM],FlatConstant={queries:{"520f4ac13e284c7f89f5aeedc5ce54ed":{type:DSQueryType.constant,select:[{role:"dimension",expression:'"Строковая констранта"',name:"СтроковаяКонстранта",synonym:"Строковая констранта",sort:Sort.NONE},{role:"measure",expression:"42",name:"Число",synonym:"Число",sort:Sort.NONE}]}},rootId:"520f4ac13e284c7f89f5aeedc5ce54ed"},FlatSelect={queries:{"604d5c2b247f4ef19fceb0bad659b62e":{type:DSQueryType.select,from:"b04382fb55b248608ef43cf9b055a361",fromAs:"Продажи",select:[{role:"dimension",expression:"Покупатель.Наименование",name:"Покупатель",synonym:"Покупатель",sort:Sort.NONE},{role:"dimension",expression:"Товар.Наименование",name:"Товар",synonym:"Товар",sort:Sort.NONE},{role:"measure",expression:"SUM(Количество)",name:"Количество",synonym:"Количество",sort:Sort.NONE}],groupBy:[0,1],where:[{id:"13f5550942ba4c3e9cc61f62d655505e",expression:'Товар.Наименование = "Йогурт"'}]},b04382fb55b248608ef43cf9b055a361:{type:DSQueryType.system,from:"РегистрНакопления.Продажи"}},rootId:"604d5c2b247f4ef19fceb0bad659b62e"},FlatJoin={queries:{"70652d9d935342ba8ba0f93f0577221e":{type:DSQueryType.join,select:[{role:"dimension",expression:"Продажи.Товар",name:"Товар",synonym:"Товар",sort:Sort.NONE},{role:"measure",expression:"SUM(Продажи.Количество)",name:"КоличествоПроданных",synonym:"Количество проданных",sort:Sort.NONE},{role:"measure",expression:"SUM(ТоварныеЗапасы.Количество)",name:"КоличествоЗапасов",synonym:"Количество запасов",sort:Sort.NONE}],joinSources:{root:{source:{from:"2b658a5fe79a4f62833b6bd8a58adcf9",fromAs:"Продажи"},relations:["f9f26afd86c04220a08666032ebb21b0"]},relationIndex:{f9f26afd86c04220a08666032ebb21b0:{source:{from:"74f8d65af8d4417b9f115fbc7a8cbae9",fromAs:"ТоварныеЗапасы"},condition:"Продажи.Товар = ТоварныеЗапасы.Товар AND Продажи.Период = ТоварныеЗапасы.Период",type:JoinType.left,relations:[]}}},groupBy:[0]},"2b658a5fe79a4f62833b6bd8a58adcf9":{type:DSQueryType.system,from:"РегистрНакопления.Продажи"},"74f8d65af8d4417b9f115fbc7a8cbae9":{type:DSQueryType.system,from:"РегистрНакопления.ТоварныеЗапасы"}},rootId:"70652d9d935342ba8ba0f93f0577221e"},FlatUnion={queries:{"604d5c2b247f4ef19fceb0bad659b62e":{type:DSQueryType.union,select:[{role:"dimension",expressionUnion:['"Расход"','"Приход"'],name:"ТипДвижения",synonym:"Тип движения",sort:Sort.NONE},{role:"dimension",expressionUnion:["Дата","Дата"],name:"Дата",synonym:"Дата",sort:Sort.NONE}],unions:[{from:"997e4a4a6a2544408a0e9ff5956839f8",fromAs:"РасходТовара"},{from:"a43c1eb1276d483fac139b6de8644fc8",fromAs:"ПриходТовара"}],withDuplicates:!0},"997e4a4a6a2544408a0e9ff5956839f8":{type:DSQueryType.system,from:"Документ.РасходТовара"},a43c1eb1276d483fac139b6de8644fc8:{type:DSQueryType.system,from:"Документ.ПриходТовара"}},rootId:"604d5c2b247f4ef19fceb0bad659b62e"},model=FlatJoin;class ImageBox{constructor(t,e,i){this.src=t,this.width=e,this.height=i}}const image_ImageBox=ImageBox;var EventObject=__webpack_require__(823),EventSource=__webpack_require__(118),InternalEvent=__webpack_require__(603),Rectangle=__webpack_require__(989),Client=__webpack_require__(306),GraphView=__webpack_require__(954),RectangleShape=__webpack_require__(315),Constants=__webpack_require__(83),Shape=__webpack_require__(341);class PolylineShape extends Shape.default{constructor(t,e,i=1){super(),this.points=t,this.stroke=e,this.strokeWidth=i}getRotation(){return 0}getShapeRotation(){return 0}isPaintBoundsInverted(){return!1}paintEdgeShape(t,e){const i=t.pointerEventsValue;t.pointerEventsValue="stroke",this.style&&this.style.curved?this.paintCurvedLine(t,e):this.paintLine(t,e,this.isRounded),t.pointerEventsValue=i}paintLine(t,e,i){const s=this.style?.arcSize??Constants.LINE_ARCSIZE;t.begin(),this.addPoints(t,e,i,s,!1),t.stroke()}paintCurvedLine(t,e){t.begin();const i=e[0],s=e.length;t.moveTo(i.x,i.y);for(let i=1;i<s-2;i+=1){const s=e[i],n=e[i+1],l=(s.x+n.x)/2,a=(s.y+n.y)/2;t.quadTo(s.x,s.y,l,a)}const n=e[s-2],l=e[s-1];t.quadTo(n.x,n.y,l.x,l.y),t.stroke()}}const edge_PolylineShape=PolylineShape;class MarkerShape{static addMarker(t,e){MarkerShape.markers[t]=e}static createMarker(t,e,i,s,n,l,a,r,o,h){const d=MarkerShape.markers[i];return d?d(t,e,i,s,n,l,a,r,o,h):null}}MarkerShape.markers={};const edge_MarkerShape=MarkerShape;function createArrow(t){return(e,i,s,n,l,a,r,o,h,d)=>{const u=l*h*1.118,c=a*h*1.118;l*=r+h,a*=r+h;const g=n.clone();g.x-=u,g.y-=c;const p=s!==Constants.ARROW.CLASSIC&&s!==Constants.ARROW.CLASSIC_THIN?1:3/4;return n.x+=-l*p-u,n.y+=-a*p-c,()=>{e.begin(),e.moveTo(g.x,g.y),e.lineTo(g.x-l-a/t,g.y-a+l/t),s!==Constants.ARROW.CLASSIC&&s!==Constants.ARROW.CLASSIC_THIN||e.lineTo(g.x-3*l/4,g.y-3*a/4),e.lineTo(g.x+a/t-l,g.y-a-l/t),e.close(),d?e.fillAndStroke():e.stroke()}}}function createOpenArrow(t){return(e,i,s,n,l,a,r,o,h,d)=>{const u=l*h*1.118,c=a*h*1.118;l*=r+h,a*=r+h;const g=n.clone();return g.x-=u,g.y-=c,n.x+=2*-u,n.y+=2*-c,()=>{e.begin(),e.moveTo(g.x-l-a/t,g.y-a+l/t),e.lineTo(g.x,g.y),e.lineTo(g.x+a/t-l,g.y-a-l/t),e.stroke()}}}const oval=(t,e,i,s,n,l,a,r,o,h)=>{const d=a/2,u=s.clone();return s.x-=n*d,s.y-=l*d,()=>{t.ellipse(u.x-d,u.y-d,a,a),h?t.fillAndStroke():t.stroke()}};function diamond(t,e,i,s,n,l,a,r,o,h){const d=i===Constants.ARROW.DIAMOND?.7071:.9862,u=n*o*d,c=l*o*d;n*=a+o,l*=a+o;const g=s.clone();g.x-=u,g.y-=c,s.x+=-n-u,s.y+=-l-c;const p=i===Constants.ARROW.DIAMOND?2:3.4;return()=>{t.begin(),t.moveTo(g.x,g.y),t.lineTo(g.x-n/2-l/p,g.y+n/p-l/2),t.lineTo(g.x-n,g.y-l),t.lineTo(g.x-n/2+l/p,g.y-l/2-n/p),t.close(),h?t.fillAndStroke():t.stroke()}}let isDefaultMarkersRegistered=!1;const registerDefaultEdgeMarkers=()=>{isDefaultMarkersRegistered||(MarkerShape.addMarker("classic",createArrow(2)),MarkerShape.addMarker("classicThin",createArrow(3)),MarkerShape.addMarker("block",createArrow(2)),MarkerShape.addMarker("blockThin",createArrow(3)),MarkerShape.addMarker("open",createOpenArrow(2)),MarkerShape.addMarker("openThin",createOpenArrow(3)),MarkerShape.addMarker("oval",oval),MarkerShape.addMarker("diamond",diamond),MarkerShape.addMarker("diamondThin",diamond),isDefaultMarkersRegistered=!0)};class ConnectorShape extends edge_PolylineShape{constructor(t,e,i){super(t,e,i)}updateBoundingBox(){this.useSvgBoundingBox=!!this.style?.curved,super.updateBoundingBox()}paintEdgeShape(t,e){const i=this.createMarker(t,e,!0),s=this.createMarker(t,e,!1);if(super.paintEdgeShape(t,e),t.setShadow(!1),t.setDashed(!1),i){const e=this.style?.startStrokeColor??this.stroke;t.setStrokeColor(e),t.setFillColor(this.style?.startFillColor??e),i()}if(s){const e=this.style?.endStrokeColor??this.stroke;t.setStrokeColor(e),t.setFillColor(this.style?.endFillColor??e),s()}}createMarker(t,e,i){if(!this.style)return null;let s=null;const n=e.length,l=(i?this.style.startArrow:this.style.endArrow)||Constants.NONE;let a=i?e[1]:e[n-2];const r=i?e[0]:e[n-1];if(l!==Constants.NONE&&null!==a&&null!==r){let o=1;for(;o<n-1&&0===Math.round(a.x-r.x)&&0===Math.round(a.y-r.y);)a=i?e[1+o]:e[n-2-o],o++;const h=r.x-a.x,d=r.y-a.y,u=Math.max(1,Math.sqrt(h*h+d*d)),c=h/u,g=d/u,p=(i?this.style.startSize:this.style.endSize)??Constants.DEFAULT_MARKERSIZE,f=(i?this.style.startFill:this.style.endFill)??!0;s=edge_MarkerShape.createMarker(t,this,l,r,c,g,p,i,this.strokeWidth,f)}return s}augmentBoundingBox(t){if(super.augmentBoundingBox(t),!this.style)return;let e=0;this.style.startArrow!==Constants.NONE&&(e=(this.style.startSize??Constants.DEFAULT_MARKERSIZE)+1),this.style.endArrow!==Constants.NONE&&(e=Math.max(e,this.style.endSize??Constants.DEFAULT_MARKERSIZE)+1),t.grow(e*this.scale)}}const edge_ConnectorShape=ConnectorShape;var ImageShape=__webpack_require__(79),mathUtils=__webpack_require__(633),styleUtils=__webpack_require__(906),Point=__webpack_require__(534),StringUtils=__webpack_require__(568),domUtils=__webpack_require__(733),SvgCanvas2D=__webpack_require__(730);class TextShape extends Shape.default{constructor(t,e,i=Constants.ALIGN.CENTER,s=Constants.ALIGN.MIDDLE,n="black",l=Constants.DEFAULT_FONTFAMILY,a=Constants.DEFAULT_FONTSIZE,r=Constants.DEFAULT_FONTSTYLE,o=2,h=0,d=0,u=0,c=0,g=!0,p=Constants.NONE,f=Constants.NONE,E=!1,C=!1,y="visible",v=0,m=Constants.DEFAULT_TEXT_DIRECTION){super(),this.margin=null,this.unrotatedBoundingBox=null,this.flipH=!1,this.flipV=!1,this.baseSpacingTop=0,this.baseSpacingBottom=0,this.baseSpacingLeft=0,this.baseSpacingRight=0,this.replaceLinefeeds=!0,this.verticalTextRotation=-90,this.ignoreClippedStringSize=!0,this.ignoreStringSize=!1,this.lastValue=null,this.cacheEnabled=!0,this.value=t,this.bounds=e,this.color=n??"black",this.align=i??Constants.ALIGN.CENTER,this.valign=s??Constants.ALIGN.MIDDLE,this.family=l??Constants.DEFAULT_FONTFAMILY,this.size=a??Constants.DEFAULT_FONTSIZE,this.fontStyle=r??Constants.DEFAULT_FONTSTYLE,this.spacing=o??2,this.spacingTop=this.spacing+(h??0),this.spacingRight=this.spacing+(d??0),this.spacingBottom=this.spacing+(u??0),this.spacingLeft=this.spacing+(c??0),this.horizontal=g??!0,this.background=p,this.border=f,this.wrap=E??!1,this.clipped=C??!1,this.overflow=y??"visible",this.labelPadding=v??0,this.textDirection=m,this.rotation=0,this.updateMargin()}getSvgScreenOffset(){return 0}checkBounds(){return!isNaN(this.scale)&&isFinite(this.scale)&&this.scale>0&&this.bounds&&!isNaN(this.bounds.x)&&!isNaN(this.bounds.y)&&!isNaN(this.bounds.width)&&!isNaN(this.bounds.height)}paint(t,e=!1){const i=this.scale,s=this.bounds.x/i,n=this.bounds.y/i,l=this.bounds.width/i,a=this.bounds.height/i;if(this.updateTransform(t,s,n,l,a),this.configureCanvas(t,s,n,l,a),e)t.updateText(s,n,l,a,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.getTextRotation(),this.node);else{const e=(0,domUtils.isNode)(this.value)||this.dialect===Constants.DIALECT.STRICTHTML,i=e?"html":"";let r=this.value;e||"html"!==i||(r=(0,StringUtils.htmlEntities)(r,!1)),"html"!==i||(0,domUtils.isNode)(this.value)||(r=(0,StringUtils.replaceTrailingNewlines)(r,"<div><br></div>")),r=!(0,domUtils.isNode)(this.value)&&this.replaceLinefeeds&&"html"===i?r.replace(/\n/g,"<br/>"):r;let o=this.textDirection;o!==Constants.TEXT_DIRECTION.AUTO||e||(o=this.getAutoDirection()),o!==Constants.TEXT_DIRECTION.LTR&&o!==Constants.TEXT_DIRECTION.RTL&&(o=Constants.TEXT_DIRECTION.DEFAULT),t.text(s,n,l,a,r,this.align,this.valign,this.wrap,i,this.overflow,this.clipped,this.getTextRotation(),o)}}redraw(){if(this.visible&&this.checkBounds()&&this.cacheEnabled&&this.lastValue===this.value&&((0,domUtils.isNode)(this.value)||this.dialect===Constants.DIALECT.STRICTHTML))if("DIV"===this.node.nodeName)this.redrawHtmlShape(),this.updateBoundingBox();else{const t=this.createCanvas();t&&(t.pointerEvents=this.pointerEvents,this.paint(t,!0),this.destroyCanvas(t),this.updateBoundingBox())}else super.redraw(),(0,domUtils.isNode)(this.value)||this.dialect===Constants.DIALECT.STRICTHTML?this.lastValue=this.value:this.lastValue=null}resetStyles(){super.resetStyles(),this.color="black",this.align=Constants.ALIGN.CENTER,this.valign=Constants.ALIGN.MIDDLE,this.family=Constants.DEFAULT_FONTFAMILY,this.size=Constants.DEFAULT_FONTSIZE,this.fontStyle=Constants.DEFAULT_FONTSTYLE,this.spacing=2,this.spacingTop=2,this.spacingRight=2,this.spacingBottom=2,this.spacingLeft=2,this.horizontal=!0,this.background=Constants.NONE,this.border=Constants.NONE,this.textDirection=Constants.DEFAULT_TEXT_DIRECTION,this.margin=null}apply(t){const e=this.spacing;super.apply(t),this.style&&(this.fontStyle=this.style.fontStyle??this.fontStyle,this.family=this.style.fontFamily??this.family,this.size=this.style.fontSize??this.size,this.color=this.style.fontColor??this.color,this.align=this.style.align??this.align,this.valign=this.style.verticalAlign??this.valign,this.spacing=this.style.spacing??this.spacing,this.spacingTop=(this.style.spacingTop??this.spacingTop-e)+this.spacing,this.spacingRight=(this.style.spacingRight??this.spacingRight-e)+this.spacing,this.spacingBottom=(this.style.spacingBottom??this.spacingBottom-e)+this.spacing,this.spacingLeft=(this.style.spacingLeft??this.spacingLeft-e)+this.spacing,this.horizontal=this.style.horizontal??this.horizontal,this.background=this.style.labelBackgroundColor??this.background,this.border=this.style.labelBorderColor??this.border,this.textDirection=this.style.textDirection??Constants.DEFAULT_TEXT_DIRECTION,this.opacity=this.style.textOpacity??100,this.updateMargin()),this.flipV=!1,this.flipH=!1}getAutoDirection(){const t=/[A-Za-z\u05d0-\u065f\u066a-\u06ef\u06fa-\u07ff\ufb1d-\ufdff\ufe70-\ufefc]/.exec(String(this.value));return t&&t.length>0&&t[0]>"z"?Constants.TEXT_DIRECTION.RTL:Constants.TEXT_DIRECTION.LTR}getContentNode(){let t=this.node;return t&&(t=t.ownerSVGElement?t.firstChild.firstChild.firstChild.firstChild.firstChild:this.node.firstChild.firstChild),t}updateBoundingBox(){let{node:t}=this;this.boundingBox=this.bounds.clone();const e=this.getTextRotation(),i=this.style?.labelPosition??Constants.ALIGN.CENTER,s=this.style?.verticalLabelPosition??Constants.ALIGN.MIDDLE;if(!this.ignoreStringSize&&t&&"fill"!==this.overflow&&(!this.clipped||!this.ignoreClippedStringSize||i!==Constants.ALIGN.CENTER||s!==Constants.ALIGN.MIDDLE)){let e=null,i=null;if(t.firstChild&&t.firstChild.firstChild&&"foreignObject"===t.firstChild.firstChild.nodeName)t=t.firstChild.firstChild.firstChild.firstChild,i=t.offsetHeight*this.scale,e="width"===this.overflow?this.boundingBox.width:t.offsetWidth*this.scale;else try{const e=t.getBBox();return void("string"==typeof this.value&&0===(0,StringUtils.trim)(this.value)?.length||0===e.width&&0===e.height?this.boundingBox=null:this.boundingBox=new Rectangle.default(e.x,e.y,e.width,e.height))}catch(t){}e&&i&&(this.boundingBox=new Rectangle.default(this.bounds.x,this.bounds.y,e,i))}if(this.boundingBox){const t=this.margin;if(0!==e){const i=(0,mathUtils.getBoundingBox)(new Rectangle.default(t.x*this.boundingBox.width,t.y*this.boundingBox.height,this.boundingBox.width,this.boundingBox.height),e,new Point.default(0,0));this.unrotatedBoundingBox=Rectangle.default.fromRectangle(this.boundingBox),this.unrotatedBoundingBox.x+=t.x*this.unrotatedBoundingBox.width,this.unrotatedBoundingBox.y+=t.y*this.unrotatedBoundingBox.height,this.boundingBox.x+=i.x,this.boundingBox.y+=i.y,this.boundingBox.width=i.width,this.boundingBox.height=i.height}else this.boundingBox.x+=t.x*this.boundingBox.width,this.boundingBox.y+=t.y*this.boundingBox.height,this.unrotatedBoundingBox=null}}getShapeRotation(){return 0}getTextRotation(){return this.state&&this.state.shape?this.state.shape.getTextRotation():0}isPaintBoundsInverted(){return!this.horizontal&&!!this.state&&this.state.cell.isVertex()}configureCanvas(t,e,i,s,n){super.configureCanvas(t,e,i,s,n),t.setFontColor(this.color),t.setFontBackgroundColor(this.background),t.setFontBorderColor(this.border),t.setFontFamily(this.family),t.setFontSize(this.size),t.setFontStyle(this.fontStyle)}getHtmlValue(){let t=this.value;return this.dialect!==Constants.DIALECT.STRICTHTML&&(t=(0,StringUtils.htmlEntities)(t,!1)),t=(0,StringUtils.replaceTrailingNewlines)(t,"<div><br></div>"),t=this.replaceLinefeeds?t.replace(/\n/g,"<br/>"):t,t}getTextCss(){const t=Constants.ABSOLUTE_LINE_HEIGHT?this.size*Constants.LINE_HEIGHT+"px":Constants.LINE_HEIGHT;let e=`display: inline-block; font-size: ${this.size}px; font-family: ${this.family}; color: ${this.color}; line-height: ${t}; pointer-events: ${this.pointerEvents?"all":"none"}; `;(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.BOLD)&&(e+="font-weight: bold; "),(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.ITALIC)&&(e+="font-style: italic; ");const i=[];return(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.UNDERLINE)&&i.push("underline"),(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.STRIKETHROUGH)&&i.push("line-through"),i.length>0&&(e+=`text-decoration: ${i.join(" ")}; `),e}redrawHtmlShape(){const t=Math.max(0,Math.round(this.bounds.width/this.scale)),e=Math.max(0,Math.round(this.bounds.height/this.scale)),i=`position: absolute; left: ${Math.round(this.bounds.x)}px; top: ${Math.round(this.bounds.y)}px; pointer-events: none; `,s=this.getTextCss(),n=this.margin,l=this.node;SvgCanvas2D.default.createCss(t+2,e,this.align,this.valign,this.wrap,this.overflow,this.clipped,this.background!==Constants.NONE?(0,StringUtils.htmlEntities)(this.background,!0):null,this.border!==Constants.NONE?(0,StringUtils.htmlEntities)(this.border,!0):null,i,s,this.scale,((t,e,i,s,a,r)=>{const o=this.getTextRotation();let h=(1!==this.scale?`scale(${this.scale}) `:"")+(0!==o?`rotate(${o}deg) `:"")+(0!==n.x||0!==n.y?`translate(${100*n.x}%,${100*n.y}%)`:"");""!==h&&(h=`transform-origin: 0 0; transform: ${h}; `),""===r?(i+=s,s=`display:inline-block; min-width: 100%; ${h}`):(s+=h,Client.default.IS_SF&&(s+="-webkit-clip-path: content-box;")),this.opacity<100&&(a+=`opacity: ${this.opacity/100}; `),l.setAttribute("style",i);const d=(0,domUtils.isNode)(this.value)?this.value.outerHTML:this.getHtmlValue();l.firstChild||(l.innerHTML=`<div><div>${d}</div></div>`),l.firstChild.firstChild.setAttribute("style",a),l.firstChild.setAttribute("style",s)}))}updateInnerHtml(t){if((0,domUtils.isNode)(this.value))t.innerHTML=this.value.outerHTML;else{let e=this.value;this.dialect!==Constants.DIALECT.STRICTHTML&&(e=(0,StringUtils.htmlEntities)(e,!1)),e=(0,StringUtils.replaceTrailingNewlines)(e,"<div>&nbsp;</div>"),e=this.replaceLinefeeds?e.replace(/\n/g,"<br/>"):e,e=`<div style="display:inline-block;_display:inline;">${e}</div>`,t.innerHTML=e}}updateValue(){const t=this.node;if((0,domUtils.isNode)(this.value))t.innerHTML="",t.appendChild(this.value);else{let e=this.value;this.dialect!==Constants.DIALECT.STRICTHTML&&(e=(0,StringUtils.htmlEntities)(e,!1)),e=(0,StringUtils.replaceTrailingNewlines)(e,"<div><br></div>"),e=this.replaceLinefeeds?e.replace(/\n/g,"<br/>"):e;const i=this.background!==Constants.NONE?this.background:null,s=this.border!==Constants.NONE?this.border:null;if("fill"===this.overflow||"width"===this.overflow)i&&(t.style.backgroundColor=i),s&&(t.style.border=`1px solid ${s}`);else{let t="";i&&(t+=`background-color:${(0,StringUtils.htmlEntities)(i,!0)};`),s&&(t+=`border:1px solid ${(0,StringUtils.htmlEntities)(s,!0)};`),e=`<div style="zoom:1;${t}display:inline-block;_display:inline;text-decoration:inherit;padding-bottom:1px;padding-right:1px;line-height:${Constants.ABSOLUTE_LINE_HEIGHT?this.size*Constants.LINE_HEIGHT+"px":Constants.LINE_HEIGHT}">${e}</div>`}t.innerHTML=e;const n=t.getElementsByTagName("div");if(n.length>0){let t=this.textDirection;t===Constants.TEXT_DIRECTION.AUTO&&this.dialect!==Constants.DIALECT.STRICTHTML&&(t=this.getAutoDirection()),t===Constants.TEXT_DIRECTION.LTR||t===Constants.TEXT_DIRECTION.RTL?n[n.length-1].setAttribute("dir",t):n[n.length-1].removeAttribute("dir")}}}updateFont(t){const{style:e}=t;e.lineHeight=Constants.ABSOLUTE_LINE_HEIGHT?this.size*Constants.LINE_HEIGHT+"px":Constants.LINE_HEIGHT,e.fontSize=`${this.size}px`,e.fontFamily=this.family,e.verticalAlign="top",e.color=this.color,(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.BOLD)?e.fontWeight="bold":e.fontWeight="",(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.ITALIC)?e.fontStyle="italic":e.fontStyle="";const i=[];(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.UNDERLINE)&&i.push("underline"),(0,styleUtils.matchBinaryMask)(this.fontStyle,Constants.FONT.STRIKETHROUGH)&&i.push("line-through"),i.length>0&&(e.textDecoration=i.join(" ")),this.align===Constants.ALIGN.CENTER?e.textAlign="center":this.align===Constants.ALIGN.RIGHT?e.textAlign="right":e.textAlign="left"}updateSize(t,e=!1){const i=Math.max(0,Math.round(this.bounds.width/this.scale)),s=Math.max(0,Math.round(this.bounds.height/this.scale)),{style:n}=t;if(this.clipped?(n.overflow="hidden",n.maxHeight=`${s}px`,n.maxWidth=`${i}px`):"fill"===this.overflow?(n.width=`${i+1}px`,n.height=`${s+1}px`,n.overflow="hidden"):"width"===this.overflow&&(n.width=`${i+1}px`,n.maxHeight=`${s+1}px`,n.overflow="hidden"),this.wrap&&i>0){if(n.wordWrap=Constants.WORD_WRAP,n.whiteSpace="normal",n.width=`${i}px`,e&&"fill"!==this.overflow&&"width"!==this.overflow){let e=t;null!=e.firstChild&&"DIV"===e.firstChild.nodeName&&(e=e.firstChild,"break-word"===t.style.wordWrap&&(e.style.width="100%"));let s=e.offsetWidth;if(0===s){const i=t.parentNode;t.style.visibility="hidden",document.body.appendChild(t),s=e.offsetWidth,t.style.visibility="",i.appendChild(t)}s+=3,this.clipped&&(s=Math.min(s,i)),n.width=`${s}px`}}else n.whiteSpace="nowrap"}updateMargin(){this.margin=(0,styleUtils.getAlignmentAsPoint)(this.align,this.valign)}getSpacing(){let t=0,e=0;return t=this.align===Constants.ALIGN.CENTER?(this.spacingLeft-this.spacingRight)/2:this.align===Constants.ALIGN.RIGHT?-this.spacingRight-this.baseSpacingRight:this.spacingLeft+this.baseSpacingLeft,e=this.valign===Constants.ALIGN.MIDDLE?(this.spacingTop-this.spacingBottom)/2:this.valign===Constants.ALIGN.BOTTOM?-this.spacingBottom-this.baseSpacingBottom:this.spacingTop+this.baseSpacingTop,new Point.default(t,e)}}const node_TextShape=TextShape;var arrayUtils=__webpack_require__(686);class StencilShapeRegistry{static addStencil(t,e){StencilShapeRegistry.stencils[t]=e}static getStencil(t){return StencilShapeRegistry.stencils[t]}}StencilShapeRegistry.stencils={};const node_StencilShapeRegistry=StencilShapeRegistry;var InternalMouseEvent=__webpack_require__(966),Dictionary=__webpack_require__(944),EventUtils=__webpack_require__(437);const placeholderStyleValues=["inherit","swimlane","indicated"],placeholderStyleProperties=["fillColor","strokeColor","gradientColor","fontColor"];class CellRenderer{constructor(){this.defaultEdgeShape=edge_ConnectorShape,this.defaultVertexShape=RectangleShape.default,this.defaultTextShape=node_TextShape,this.legacyControlPosition=!0,this.legacySpacing=!0,this.antiAlias=!0,this.minSvgStrokeWidth=1,this.forceControlClickHandler=!1}static registerShape(t,e){CellRenderer.defaultShapes[t]=e}initializeShape(t){t.shape&&(t.shape.dialect=t.view.graph.dialect,this.configureShape(t),t.shape.init(t.view.getDrawPane()))}createShape(t){const e=node_StencilShapeRegistry.getStencil(t.style.shape);return e?new Shape.default(e):new(this.getShapeConstructor(t))}createIndicatorShape(t){t.shape&&(t.shape.indicatorShape=this.getShape(t.getIndicatorShape()))}getShape(t){return t?CellRenderer.defaultShapes[t]:null}getShapeConstructor(t){let e=this.getShape(t.style.shape||null);return e||(e=t.cell.isEdge()?this.defaultEdgeShape:this.defaultVertexShape),e}configureShape(t){const e=t.shape;e&&(e.apply(t),e.imageSrc=t.getImageSrc()||null,e.indicatorColor=t.getIndicatorColor()||Constants.NONE,e.indicatorStrokeColor=t.style.indicatorStrokeColor||Constants.NONE,e.indicatorGradientColor=t.getIndicatorGradientColor()||Constants.NONE,t.style.indicatorDirection&&(e.indicatorDirection=t.style.indicatorDirection),e.indicatorImageSrc=t.getIndicatorImageSrc()||null,this.postConfigureShape(t))}postConfigureShape(t){t.shape&&(this.resolveColor(t,"indicatorGradientColor","gradientColor"),this.resolveColor(t,"indicatorColor","fillColor"),this.resolveColor(t,"gradient","gradientColor"),this.resolveColor(t,"stroke","strokeColor"),this.resolveColor(t,"fill","fillColor"))}checkPlaceholderStyles(t){for(const e of placeholderStyleProperties)if(placeholderStyleValues.includes(t.style[e]))return!0;return!1}resolveColor(t,e,i){const s="fontColor"===i?t.text:t.shape;if(s){const n=t.view.graph,l=s[e];let a=null;if("inherit"===l?a=t.cell.getParent():"swimlane"===l?(s[e]="strokeColor"===i||"fontColor"===i?"#000000":"#ffffff",a=t.cell.getTerminal(!1)?t.cell.getTerminal(!1):t.cell,a=n.getSwimlane(a),i=n.swimlaneIndicatorColorAttribute):"indicated"===l&&t.shape?s[e]=t.shape.indicatorColor:"fillColor"!==i&&"fillColor"===l&&t.shape?s[e]=t.style.fillColor:"strokeColor"!==i&&"strokeColor"===l&&t.shape&&(s[e]=t.style.strokeColor),a){const t=n.getView().getState(a);if(s[e]=null,t){const n="fontColor"===i?t.text:t.shape;s[e]=n&&"indicatorColor"!==e?n[e]:t.style[i]}}}}getLabelValue(t){return t.view.graph.getLabel(t.cell)}createLabel(t,e){const i=t.view.graph;if((t.style.fontSize||0)>0||null==t.style.fontSize){const s=i.isHtmlLabel(t.cell)||(0,domUtils.isNode)(e);t.text=new this.defaultTextShape(e,new Rectangle.default,t.style.align??Constants.ALIGN.CENTER,t.getVerticalAlign(),t.style.fontColor,t.style.fontFamily,t.style.fontSize,t.style.fontStyle,t.style.spacing,t.style.spacingTop,t.style.spacingRight,t.style.spacingBottom,t.style.spacingLeft,t.style.horizontal,t.style.labelBackgroundColor,t.style.labelBorderColor,i.isWrapping(t.cell)&&i.isHtmlLabel(t.cell),i.isLabelClipped(t.cell),t.style.overflow,t.style.labelPadding,t.style.textDirection??Constants.DEFAULT_TEXT_DIRECTION),t.text.opacity=t.style.textOpacity??100,t.text.dialect=s?Constants.DIALECT.STRICTHTML:i.dialect,t.text.style=t.style,t.text.state=t,this.initializeLabel(t,t.text);let n=!1;const l=e=>{let s=t;if(Client.default.IS_TOUCH||n){const t=(0,EventUtils.getClientX)(e),n=(0,EventUtils.getClientY)(e),l=(0,styleUtils.convertPoint)(i.container,t,n);s=i.view.getState(i.getCellAt(l.x,l.y))}return s};InternalEvent.default.addGestureListeners(t.text.node,(e=>{if(this.isLabelEvent(t,e)){i.fireMouseEvent(InternalEvent.default.MOUSE_DOWN,new InternalMouseEvent.default(e,t));const s=(0,EventUtils.getSource)(e);n=i.dialect!==Constants.DIALECT.SVG&&"IMG"===s.nodeName}}),(e=>{this.isLabelEvent(t,e)&&i.fireMouseEvent(InternalEvent.default.MOUSE_MOVE,new InternalMouseEvent.default(e,l(e)))}),(e=>{this.isLabelEvent(t,e)&&(i.fireMouseEvent(InternalEvent.default.MOUSE_UP,new InternalMouseEvent.default(e,l(e))),n=!1)})),i.isNativeDblClickEnabled()&&InternalEvent.default.addListener(t.text.node,"dblclick",(e=>{this.isLabelEvent(t,e)&&(i.dblClick(e,t.cell),InternalEvent.default.consume(e))}))}}initializeLabel(t,e){if(Client.default.IS_SVG&&Client.default.NO_FO&&e.dialect!==Constants.DIALECT.SVG){const i=t.view.graph;e.init(i.container)}else e.init(t.view.getDrawPane())}createCellOverlays(t){const e=t.view.graph,i=e.getCellOverlays(t.cell),s=new Dictionary.default;for(const n of i){const i=t.overlays.remove(n);if(i){s.put(n,i);continue}const l=this.createOverlayShape(t,n);l.dialect=e.dialect,l.overlay=n,this.initializeOverlay(t,l),this.installCellOverlayListeners(t,n,l),this.configureOverlayShape(t,n,l),s.put(n,l)}t.overlays.visit(((t,e)=>{e.destroy()})),t.overlays=s}createOverlayShape(t,e){const i=new ImageShape.default(new Rectangle.default,e.image.src);return i.preserveImageAspect=!1,i}initializeOverlay(t,e){e.init(t.view.getOverlayPane())}installCellOverlayListeners(t,e,i){const s=t.view.graph;InternalEvent.default.addListener(i.node,"click",(i=>{s.isEditing()&&s.stopEditing(!s.isInvokesStopCellEditing()),e.fireEvent(new EventObject.default(InternalEvent.default.CLICK,{event:i,cell:t.cell}))})),InternalEvent.default.addGestureListeners(i.node,(t=>{InternalEvent.default.consume(t)}),(e=>{s.fireMouseEvent(InternalEvent.default.MOUSE_MOVE,new InternalMouseEvent.default(e,t))})),Client.default.IS_TOUCH&&InternalEvent.default.addListener(i.node,"touchend",(i=>{e.fireEvent(new EventObject.default(InternalEvent.default.CLICK,{event:i,cell:t.cell}))}))}configureOverlayShape(t,e,i){e.cursor&&(i.node.style.cursor=e.cursor)}createControl(t){const e=t.view.graph,i=e.getFoldingImage(t);if(e.isFoldingEnabled()&&i){if(!t.control){const s=new Rectangle.default(0,0,i.width,i.height);t.control=new ImageShape.default(s,i.src),t.control.preserveImageAspect=!1,t.control.dialect=e.dialect,this.initControl(t,t.control,!0,this.createControlClickHandler(t))}}else t.control&&(t.control.destroy(),t.control=null)}createControlClickHandler(t){const e=t.view.graph;return i=>{if(this.forceControlClickHandler||e.isEnabled()){const s=!t.cell.isCollapsed();e.foldCells(s,!1,[t.cell],!1,i),InternalEvent.default.consume(i)}}}initControl(t,e,i,s){const n=t.view.graph;n.isHtmlLabel(t.cell)&&Client.default.NO_FO&&n.dialect===Constants.DIALECT.SVG?(e.dialect=Constants.DIALECT.PREFERHTML,e.init(n.container),e.node.style.zIndex=String(1)):e.init(t.view.getOverlayPane());const l=e.node;if(s&&!Client.default.IS_IOS&&(n.isEnabled()&&(l.style.cursor="pointer"),InternalEvent.default.addListener(l,"click",s)),i){let e=null;InternalEvent.default.addGestureListeners(l,(i=>{e=new Point.default((0,EventUtils.getClientX)(i),(0,EventUtils.getClientY)(i)),n.fireMouseEvent(InternalEvent.default.MOUSE_DOWN,new InternalMouseEvent.default(i,t)),InternalEvent.default.consume(i)}),(e=>{n.fireMouseEvent(InternalEvent.default.MOUSE_MOVE,new InternalMouseEvent.default(e,t))}),(e=>{n.fireMouseEvent(InternalEvent.default.MOUSE_UP,new InternalMouseEvent.default(e,t)),InternalEvent.default.consume(e)})),s&&Client.default.IS_IOS&&l.addEventListener("touchend",(t=>{if(e){const i=n.getEventTolerance();Math.abs(e.x-(0,EventUtils.getClientX)(t))<i&&Math.abs(e.y-(0,EventUtils.getClientY)(t))<i&&(s.call(s,t),InternalEvent.default.consume(t))}}),!0)}return l}isShapeEvent(t,e){return!0}isLabelEvent(t,e){return!0}installListeners(t){const e=t.view.graph,i=i=>{let s=t;const n=(0,EventUtils.getSource)(i);if(n&&e.dialect!==Constants.DIALECT.SVG&&"IMG"===n.nodeName||Client.default.IS_TOUCH){const t=(0,EventUtils.getClientX)(i),n=(0,EventUtils.getClientY)(i),l=(0,styleUtils.convertPoint)(e.container,t,n),a=e.getCellAt(l.x,l.y);s=a?e.view.getState(a):null}return s};t.shape&&(InternalEvent.default.addGestureListeners(t.shape.node,(i=>{this.isShapeEvent(t,i)&&e.fireMouseEvent(InternalEvent.default.MOUSE_DOWN,new InternalMouseEvent.default(i,t))}),(s=>{this.isShapeEvent(t,s)&&e.fireMouseEvent(InternalEvent.default.MOUSE_MOVE,new InternalMouseEvent.default(s,i(s)))}),(s=>{this.isShapeEvent(t,s)&&e.fireMouseEvent(InternalEvent.default.MOUSE_UP,new InternalMouseEvent.default(s,i(s)))})),e.isNativeDblClickEnabled()&&InternalEvent.default.addListener(t.shape.node,"dblclick",(i=>{this.isShapeEvent(t,i)&&(e.dblClick(i,t.cell),InternalEvent.default.consume(i))})))}redrawLabel(t,e){const i=t.view.graph,s=this.getLabelValue(t),n=i.isWrapping(t.cell),l=i.isLabelClipped(t.cell),a=i.isHtmlLabel(t.cell)||s&&(0,domUtils.isNode)(s)?Constants.DIALECT.STRICTHTML:i.dialect,r=t.style.overflow??"visible";if(!t.text||t.text.wrap===n&&t.text.clipped===l&&t.text.overflow===r&&t.text.dialect===a||(t.text.destroy(),t.text=null),null==t.text&&null!=s&&((0,domUtils.isNode)(s)||s.length>0)?this.createLabel(t,s):null==t.text||null!=s&&0!=s.length||(t.text.destroy(),t.text=null),null!=t.text){e&&(null!=t.text.lastValue&&this.isTextShapeInvalid(t,t.text)&&(t.text.lastValue=null),t.text.resetStyles(),t.text.apply(t),t.text.valign=t.getVerticalAlign());const i=this.getLabelBounds(t),o=this.getTextScale(t);if(this.resolveColor(t,"color","fontColor"),e||t.text.value!==s||t.text.wrap!==n||t.text.overflow!==r||t.text.clipped!==l||t.text.scale!==o||t.text.dialect!==a||null==t.text.bounds||!t.text.bounds.equals(i)){t.text.dialect=a,t.text.value=s,t.text.bounds=i,t.text.scale=o,t.text.wrap=n,t.text.clipped=l,t.text.overflow=r;const e=t.text.node.style.visibility;this.redrawLabelShape(t.text),t.text.node.style.visibility=e}}}isTextShapeInvalid(t,e){function i(i,s,n){let l=!1;return l="spacingTop"===s||"spacingRight"===s||"spacingBottom"===s||"spacingLeft"===s?parseFloat(String(e[i]))-parseFloat(String(e.spacing))!==(t.style[s]||n):e[i]!==(t.style[s]||n),l}return i("fontStyle","fontStyle",Constants.DEFAULT_FONTSTYLE)||i("family","fontFamily",Constants.DEFAULT_FONTFAMILY)||i("size","fontSize",Constants.DEFAULT_FONTSIZE)||i("color","fontColor","black")||i("align","align","")||i("valign","verticalAlign","")||i("spacing","spacing",2)||i("spacingTop","spacingTop",0)||i("spacingRight","spacingRight",0)||i("spacingBottom","spacingBottom",0)||i("spacingLeft","spacingLeft",0)||i("horizontal","horizontal",!0)||i("background","labelBackgroundColor",null)||i("border","labelBorderColor",null)||i("opacity","textOpacity",100)||i("textDirection","textDirection",Constants.DEFAULT_TEXT_DIRECTION)}redrawLabelShape(t){t.redraw()}getTextScale(t){return t.view.scale}getLabelBounds(t){const{scale:e}=t.view,i=t.cell.isEdge();let s=new Rectangle.default(t.absoluteOffset.x,t.absoluteOffset.y);if(i){const i=t.text.getSpacing();s.x+=i.x*e,s.y+=i.y*e;const n=t.cell.getGeometry();null!=n&&(s.width=Math.max(0,n.width*e),s.height=Math.max(0,n.height*e))}else{if(t.text.isPaintBoundsInverted()){const t=s.x;s.x=s.y,s.y=t}s.x+=t.x,s.y+=t.y,s.width=Math.max(1,t.width),s.height=Math.max(1,t.height)}if(t.text.isPaintBoundsInverted()){const e=(t.width-t.height)/2;s.x+=e,s.y-=e;const i=s.width;s.width=s.height,s.height=i}if(null!=t.shape){const e=t.style.labelPosition??Constants.ALIGN.CENTER,i=t.style.verticalLabelPosition??Constants.ALIGN.MIDDLE;e===Constants.ALIGN.CENTER&&i===Constants.ALIGN.MIDDLE&&(s=t.shape.getLabelBounds(s))}const n=t.style.labelWidth??null;return null!=n&&(s.width=n*e),i||this.rotateLabelBounds(t,s),s}rotateLabelBounds(t,e){if(e.y-=t.text.margin.y*e.height,e.x-=t.text.margin.x*e.width,!this.legacySpacing||"fill"!==t.style.overflow&&"width"!==t.style.overflow){const i=t.view.scale,s=t.text.getSpacing();e.x+=s.x*i,e.y+=s.y*i;const n=t.style.labelPosition??Constants.ALIGN.CENTER,l=t.style.verticalLabelPosition??Constants.ALIGN.MIDDLE,a=t.style.labelWidth??null;e.width=Math.max(0,e.width-(n===Constants.ALIGN.CENTER&&null==a?t.text.spacingLeft*i+t.text.spacingRight*i:0)),e.height=Math.max(0,e.height-(l===Constants.ALIGN.MIDDLE?t.text.spacingTop*i+t.text.spacingBottom*i:0))}const i=t.text.getTextRotation();if(0!==i&&null!=t&&t.cell.isVertex()){const s=t.getCenterX(),n=t.getCenterY();if(e.x!==s||e.y!==n){const t=i*(Math.PI/180),l=(0,mathUtils.getRotatedPoint)(new Point.default(e.x,e.y),Math.cos(t),Math.sin(t),new Point.default(s,n));e.x=l.x,e.y=l.y}}}redrawCellOverlays(t,e=!1){if(this.createCellOverlays(t),null!=t.overlays){const i=(0,mathUtils.mod)(t.style.rotation??0,90),s=(0,mathUtils.toRadians)(i),n=Math.cos(s),l=Math.sin(s);t.overlays.visit(((s,a)=>{const r=a.overlay.getBounds(t);if(!t.cell.isEdge()&&null!=t.shape&&0!==i){let e=r.getCenterX(),i=r.getCenterY();const s=(0,mathUtils.getRotatedPoint)(new Point.default(e,i),n,l,new Point.default(t.getCenterX(),t.getCenterY()));e=s.x,i=s.y,r.x=Math.round(e-r.width/2),r.y=Math.round(i-r.height/2)}!e&&null!=a.bounds&&a.scale===t.view.scale&&a.bounds.equals(r)||(a.bounds=r,a.scale=t.view.scale,a.redraw())}))}}redrawControl(t,e=!1){const i=t.view.graph.getFoldingImage(t);if(null!=t.control&&null!=i){const s=this.getControlBounds(t,i.width,i.height),n=this.legacyControlPosition?t.style.rotation??0:t.shape.getTextRotation(),l=t.view.scale;!e&&t.control.scale===l&&t.control.bounds.equals(s)&&t.control.rotation===n||(t.control.rotation=n,t.control.bounds=s,t.control.scale=l,t.control.redraw())}}getControlBounds(t,e,i){if(null!=t.control){const s=t.view.scale;let n=t.getCenterX(),l=t.getCenterY();if(!t.cell.isEdge()&&(n=t.x+e*s,l=t.y+i*s,null!=t.shape)){let e=t.shape.getShapeRotation();if(this.legacyControlPosition)e=t.style.rotation??0;else if(t.shape.isPaintBoundsInverted()){const e=(t.width-t.height)/2;n+=e,l-=e}if(0!==e){const i=(0,mathUtils.toRadians)(e),s=Math.cos(i),a=Math.sin(i),r=(0,mathUtils.getRotatedPoint)(new Point.default(n,l),s,a,new Point.default(t.getCenterX(),t.getCenterY()));n=r.x,l=r.y}}return t.cell.isEdge(),new Rectangle.default(Math.round(n-e/2*s),Math.round(l-i/2*s),Math.round(e*s),Math.round(i*s))}return null}insertStateAfter(t,e,i){const s=t.view.graph,n=this.getShapesForState(t);for(let l=0;l<n.length;l+=1)if(null!=n[l]&&null!=n[l].node){const a=n[l].node.parentNode!==t.view.getDrawPane()&&n[l].node.parentNode!==t.view.getOverlayPane(),r=a?i:e;if(null!=r&&r.nextSibling!==n[l].node)null==r.nextSibling?r.parentNode.appendChild(n[l].node):r.parentNode.insertBefore(n[l].node,r.nextSibling);else if(null==r){const e=n[l].node;if(e.parentNode===s.container){let{canvas:i}=t.view;for(;null!=i&&i.parentNode!==s.container;)i=i.parentNode;null!=i&&null!=i.nextSibling?i.nextSibling!==e&&e.parentNode.insertBefore(e,i.nextSibling):e.parentNode.appendChild(e)}else null!=e.parentNode&&null!=e.parentNode.firstChild&&e.parentNode.firstChild!=e&&e.parentNode.insertBefore(e,e.parentNode.firstChild)}a?i=n[l].node:e=n[l].node}return[e,i]}getShapesForState(t){return[t.shape,t.text,t.control]}redraw(t,e=!1,i=!0){const s=this.redrawShape(t,e,i);null!=t.shape&&i&&(this.redrawLabel(t,s),this.redrawCellOverlays(t,s),this.redrawControl(t,s))}redrawShape(t,e=!1,i=!0){let s=!1;const n=t.view.graph;if(null!=t.shape&&null!=t.shape.style&&null!=t.style&&t.shape.style.shape!==t.style.shape&&(t.shape.destroy(),t.shape=null),null==t.shape&&null!=n.container&&t.cell!==t.view.currentRoot&&(t.cell.isVertex()||t.cell.isEdge())){if(t.shape=this.createShape(t),null!=t.shape){t.shape.minSvgStrokeWidth=this.minSvgStrokeWidth,t.shape.antiAlias=this.antiAlias,this.createIndicatorShape(t),this.initializeShape(t),this.createCellOverlays(t),this.installListeners(t);const e=n.getPlugin("SelectionCellsHandler");e?.updateHandler(t)}}else if(!e&&null!=t.shape&&(!(0,arrayUtils.equalEntries)(t.shape.style,t.style)||this.checkPlaceholderStyles(t))){t.shape.resetStyles(),this.configureShape(t);const i=n.getPlugin("SelectionCellsHandler");i?.updateHandler(t),e=!0}return null!=t.shape&&t.shape.indicatorShape!=this.getShape(t.getIndicatorShape())&&(null!=t.shape.indicator&&(t.shape.indicator.destroy(),t.shape.indicator=null),this.createIndicatorShape(t),null!=t.shape.indicatorShape&&(t.shape.indicator=new t.shape.indicatorShape,t.shape.indicator.dialect=t.shape.dialect,t.shape.indicator.init(t.node),e=!0)),t.shape&&(this.createControl(t),(e||this.isShapeInvalid(t,t.shape))&&(t.absolutePoints.length>0?(t.shape.points=t.absolutePoints.slice(),t.shape.bounds=null):(t.shape.points=[],t.shape.bounds=new Rectangle.default(t.x,t.y,t.width,t.height)),t.shape.scale=t.view.scale,null==i||i?this.doRedrawShape(t):t.shape.updateBoundingBox(),s=!0)),s}doRedrawShape(t){t.shape?.redraw()}isShapeInvalid(t,e){return null==e.bounds||e.scale!==t.view.scale||0===t.absolutePoints.length&&!e.bounds.equals(t)||t.absolutePoints.length>0&&!(0,arrayUtils.equalPoints)(e.points,t.absolutePoints)}destroy(t){t.shape&&(t.text&&(t.text.destroy(),t.text=null),t.overlays.visit(((t,e)=>{e.destroy()})),t.overlays=new Dictionary.default,t.control&&(t.control.destroy(),t.control=null),t.shape.destroy(),t.shape=null)}}CellRenderer.defaultShapes={};const cell_CellRenderer=CellRenderer;var Cell=__webpack_require__(230),UndoableEdit=__webpack_require__(592),CellPath=__webpack_require__(577);class ChildChange{constructor(t,e,i,s=0){this.model=t,this.parent=e,this.previous=e,this.child=i,this.index=s,this.previousIndex=s}execute(){let t=this.child.getParent();const e=t?t.getIndex(this.child):0;this.previous||this.connect(this.child,!1),t=this.model.parentForCellChanged(this.child,this.previous,this.previousIndex),this.previous&&this.connect(this.child,!0),this.parent=this.previous,this.previous=t,this.index=this.previousIndex,this.previousIndex=e}connect(t,e=!0){const i=t.getTerminal(!0),s=t.getTerminal(!1);i&&(e?this.model.terminalForCellChanged(t,i,!0):this.model.terminalForCellChanged(t,null,!0)),s&&(e?this.model.terminalForCellChanged(t,s,!1):this.model.terminalForCellChanged(t,null,!1)),t.setTerminal(i,!0),t.setTerminal(s,!1);const n=t.getChildCount();for(let i=0;i<n;i+=1)this.connect(t.getChildAt(i),e)}}const undoable_changes_ChildChange=ChildChange;class CollapseChange{constructor(t,e,i){this.model=t,this.cell=e,this.collapsed=i,this.previous=i}execute(){this.collapsed=this.previous,this.previous=this.model.collapsedStateForCellChanged(this.cell,this.previous)}}const undoable_changes_CollapseChange=CollapseChange;class GeometryChange{constructor(t,e,i){this.model=t,this.cell=e,this.geometry=i,this.previous=i}execute(){this.geometry=this.previous,this.previous=this.model.geometryForCellChanged(this.cell,this.previous)}}const undoable_changes_GeometryChange=GeometryChange;class RootChange{constructor(t,e){this.model=t,this.root=e,this.previous=e}execute(){this.root=this.previous,this.previous=this.model.rootChanged(this.previous)}}const undoable_changes_RootChange=RootChange;class StyleChange{constructor(t,e,i){this.model=t,this.cell=e,this.style=i,this.previous=i}execute(){this.style=this.previous,this.previous=this.model.styleForCellChanged(this.cell,this.previous)}}const undoable_changes_StyleChange=StyleChange;class TerminalChange{constructor(t,e,i,s){this.model=t,this.cell=e,this.terminal=i,this.previous=i,this.source=s}execute(){this.terminal=this.previous,this.previous=this.model.terminalForCellChanged(this.cell,this.previous,this.source)}}const undoable_changes_TerminalChange=TerminalChange;class ValueChange{constructor(t,e,i){this.model=t,this.cell=e,this.value=i,this.previous=i}execute(){this.value=this.previous,this.previous=this.model.valueForCellChanged(this.cell,this.previous)}}const undoable_changes_ValueChange=ValueChange;class VisibleChange{constructor(t,e,i){this.model=t,this.cell=e,this.visible=i,this.previous=i}execute(){this.visible=this.previous,this.previous=this.model.visibleStateForCellChanged(this.cell,this.previous)}}const undoable_changes_VisibleChange=VisibleChange;var ObjectIdentity=__webpack_require__(909);const filterCells=t=>e=>{const i=[];for(let s=0;s<e.length;s+=1)t(e[s])&&i.push(e[s]);return i},getOpposites=(t,e,i=!0,s=!0)=>t.reduce(((t,n)=>{const l=n.getTerminal(!0),a=n.getTerminal(!1);return l===e&&null!=a&&a!==e&&s?t.push(a):a===e&&null!=l&&l!==e&&i&&t.push(l),t}),[]),getTopmostCells=t=>{const e=new Dictionary.default,i=[];for(let i=0;i<t.length;i+=1)e.put(t[i],!0);for(let s=0;s<t.length;s+=1){const n=t[s];let l=!0,a=n.getParent();for(;null!=a;){if(e.get(a)){l=!1;break}a=a.getParent()}l&&i.push(n)}return i},getParents=t=>{const e=[],i=new Dictionary.default;for(const s of t){const t=s.getParent();null==t||i.get(t)||(i.put(t,!0),e.push(t))}return e},cloneCell=(t=null,e=!0)=>t?cloneCells([t],e)[0]:null,cloneCells=(t,e=!0,i={})=>{const s=[];for(const n of t)s.push(cloneCellImpl(n,i,e));for(let e=0;e<s.length;e+=1)null!=s[e]&&restoreClone(s[e],t[e],i);return s},cloneCellImpl=(t,e={},i=!1)=>{const s=ObjectIdentity.default.get(t);let n=e?e[s]:null;if(null==n&&(n=t.clone(),e[s]=n,i)){const i=t.getChildCount();for(let s=0;s<i;s+=1){const i=cloneCellImpl(t.getChildAt(s),e,!0);n.insert(i)}}return n},restoreClone=(t,e,i)=>{const s=e.getTerminal(!0);if(null!=s){const e=i[ObjectIdentity.default.get(s)];null!=e&&e.insertEdge(t,!0)}const n=e.getTerminal(!1);if(null!=n){const e=i[ObjectIdentity.default.get(n)];null!=e&&e.insertEdge(t,!1)}const l=t.getChildCount();for(let s=0;s<l;s+=1)restoreClone(t.getChildAt(s),e.getChildAt(s),i)};class GraphDataModel extends EventSource.default{constructor(t=null){super(),this.root=null,this.cells={},this.maintainEdgeParent=!0,this.ignoreRelativeEdgeParent=!0,this.createIds=!0,this.prefix="",this.postfix="",this.nextId=0,this.currentEdit=null,this.updateLevel=0,this.endingUpdate=!1,this.currentEdit=this.createUndoableEdit(),null!=t?this.setRoot(t):this.clear()}clear(){this.setRoot(this.createRoot())}isCreateIds(){return this.createIds}setCreateIds(t){this.createIds=t}createRoot(){const t=new Cell.default;return t.insert(new Cell.default),t}getCell(t){return this.cells?this.cells[t]:null}filterCells(t,e){return filterCells(e)(t)}getRoot(t=null){return t?t.getRoot():this.root}setRoot(t){return this.execute(new undoable_changes_RootChange(this,t)),t}rootChanged(t){const e=this.root;return this.root=t,this.nextId=0,this.cells=null,this.cellAdded(t),e}isRoot(t=null){return null!=t&&this.root===t}isLayer(t){return!!t&&this.isRoot(t.getParent())}contains(t){return this.root.isAncestor(t)}add(t,e,i=null){if(e!==t&&null!=t&&null!=e){null==i&&(i=t.getChildCount());const s=t!==e.getParent();this.execute(new undoable_changes_ChildChange(this,t,e,i)),this.maintainEdgeParent&&s&&this.updateEdgeParents(e)}return e}cellAdded(t){if(null!=t){if(null==t.getId()&&this.createIds&&t.setId(this.createId(t)),null!=t.getId()){let e=this.getCell(t.getId());if(e!==t){for(;null!=e;)t.setId(this.createId(t)),e=this.getCell(t.getId());null==this.cells&&(this.cells={}),this.cells[t.getId()]=t}}(0,mathUtils.isNumeric)(String(t.getId()))&&(this.nextId=Math.max(this.nextId,parseInt(t.getId())));for(const e of t.getChildren())this.cellAdded(e)}}createId(t){const e=this.nextId;return this.nextId++,this.prefix+e+this.postfix}updateEdgeParents(t,e=this.getRoot(t)){const i=t.getChildCount();for(let s=0;s<i;s+=1){const i=t.getChildAt(s);this.updateEdgeParents(i,e)}const s=t.getEdgeCount(),n=[];for(let e=0;e<s;e+=1)n.push(t.getEdgeAt(e));for(let t=0;t<n.length;t+=1){const i=n[t];e.isAncestor(i)&&this.updateEdgeParent(i,e)}}updateEdgeParent(t,e){let i=t.getTerminal(!0),s=t.getTerminal(!1),n=null;for(;null!=i&&!i.isEdge()&&null!=i.geometry&&i.geometry.relative;)i=i.getParent();for(;null!=s&&this.ignoreRelativeEdgeParent&&!s.isEdge()&&null!=s.geometry&&s.geometry.relative;)s=s.getParent();if(e.isAncestor(i)&&e.isAncestor(s)&&(i===s?n=i?i.getParent():null:i&&(n=i.getNearestCommonAncestor(s)),null!=n&&(n.getParent()!==this.root||n.isAncestor(t))&&t&&t.getParent()!==n)){let e=t.getGeometry();if(null!=e){const i=t.getParent().getOrigin(),s=n.getOrigin(),l=s.x-i.x,a=s.y-i.y;e=e.clone(),e.translate(-l,-a),this.setGeometry(t,e)}this.add(n,t,n.getChildCount())}}remove(t){return t===this.root?this.setRoot(null):null!=t.getParent()&&this.execute(new undoable_changes_ChildChange(this,null,t)),t}cellRemoved(t){if(null!=t&&null!=this.cells){for(let e=t.getChildCount()-1;e>=0;e--)this.cellRemoved(t.getChildAt(e));null!=this.cells&&null!=t.getId()&&delete this.cells[t.getId()]}}parentForCellChanged(t,e,i){const s=t.getParent();if(null!=e)e===s&&s.getIndex(t)===i||e.insert(t,i);else if(null!=s){const e=s.getIndex(t);s.remove(e)}const n=e?this.contains(e):null,l=this.contains(s);return n&&!l?this.cellAdded(t):l&&!n&&this.cellRemoved(t),s}setTerminal(t,e,i){const s=e!==t.getTerminal(i);return this.execute(new undoable_changes_TerminalChange(this,t,e,i)),this.maintainEdgeParent&&s&&this.updateEdgeParent(t,this.getRoot()),e}setTerminals(t,e,i){this.beginUpdate();try{this.setTerminal(t,e,!0),this.setTerminal(t,i,!1)}finally{this.endUpdate()}}terminalForCellChanged(t,e,i=!1){const s=t.getTerminal(i);return null!=e?e.insertEdge(t,i):null!=s&&s.removeEdge(t,i),s}getEdgesBetween(t,e,i=!1){const s=t.getEdgeCount(),n=e.getEdgeCount();let l=t,a=s;n<s&&(a=n,l=e);const r=[];for(let s=0;s<a;s+=1){const n=l.getEdgeAt(s),a=n.getTerminal(!0),o=n.getTerminal(!1);(a===t&&o===e||!i&&o===t&&a===e)&&r.push(n)}return r}setValue(t,e){return this.execute(new undoable_changes_ValueChange(this,t,e)),e}valueForCellChanged(t,e){return t.valueChanged(e)}setGeometry(t,e){return e!==t.getGeometry()&&this.execute(new undoable_changes_GeometryChange(this,t,e)),e}geometryForCellChanged(t,e){const i=t.getGeometry();return t.setGeometry(e),i}setStyle(t,e){e!==t.getStyle()&&this.execute(new undoable_changes_StyleChange(this,t,e))}styleForCellChanged(t,e){const i=t.getStyle();return t.setStyle(e),i}setCollapsed(t,e){return e!==t.isCollapsed()&&this.execute(new undoable_changes_CollapseChange(this,t,e)),e}collapsedStateForCellChanged(t,e){const i=t.isCollapsed();return t.setCollapsed(e),i}setVisible(t,e){return e!==t.isVisible()&&this.execute(new undoable_changes_VisibleChange(this,t,e)),e}visibleStateForCellChanged(t,e){const i=t.isVisible();return t.setVisible(e),i}execute(t){t.execute(),this.beginUpdate(),this.currentEdit.add(t),this.fireEvent(new EventObject.default(InternalEvent.default.EXECUTE,{change:t})),this.fireEvent(new EventObject.default(InternalEvent.default.EXECUTED,{change:t})),this.endUpdate()}batchUpdate(t){this.beginUpdate();try{t()}finally{this.endUpdate()}}beginUpdate(){this.updateLevel+=1,this.fireEvent(new EventObject.default(InternalEvent.default.BEGIN_UPDATE)),1===this.updateLevel&&this.fireEvent(new EventObject.default(InternalEvent.default.START_EDIT))}endUpdate(){if(this.updateLevel-=1,0===this.updateLevel&&this.fireEvent(new EventObject.default(InternalEvent.default.END_EDIT)),!this.endingUpdate){this.endingUpdate=0===this.updateLevel,this.fireEvent(new EventObject.default(InternalEvent.default.END_UPDATE,{edit:this.currentEdit}));try{if(this.endingUpdate&&!this.currentEdit.isEmpty()){this.fireEvent(new EventObject.default(InternalEvent.default.BEFORE_UNDO,{edit:this.currentEdit}));const t=this.currentEdit;this.currentEdit=this.createUndoableEdit(),t.notify(),this.fireEvent(new EventObject.default(InternalEvent.default.UNDO,{edit:t}))}}finally{this.endingUpdate=!1}}}createUndoableEdit(t=!0){const e=new UndoableEdit.default(this,t);return e.notify=()=>{e.source.fireEvent(new EventObject.default(InternalEvent.default.CHANGE,{edit:e,changes:e.changes})),e.source.fireEvent(new EventObject.default(InternalEvent.default.NOTIFY,{edit:e,changes:e.changes}))},e}mergeChildren(t,e,i=!0){this.beginUpdate();try{const s={};this.mergeChildrenImpl(t,e,i,s);for(const t in s){const e=s[t];let i=e.getTerminal(!0);null!=i&&(i=s[CellPath.default.create(i)],this.setTerminal(e,i,!0)),i=e.getTerminal(!1),null!=i&&(i=s[CellPath.default.create(i)],this.setTerminal(e,i,!1))}}finally{this.endUpdate()}}mergeChildrenImpl(t,e,i,s={}){this.beginUpdate();try{const n=t.getChildCount();for(let l=0;l<n;l+=1){const n=t.getChildAt(l);if("function"==typeof n.getId){const t=n.getId();let l=null==t||n.isEdge()&&i?null:this.getCell(t);if(null==l){const i=n.clone();i.setId(t),i.setTerminal(n.getTerminal(!0),!0),i.setTerminal(n.getTerminal(!1),!1),l=e.insert(i),this.cellAdded(l)}s[CellPath.default.create(n)]=l,this.mergeChildrenImpl(n,l,i,s)}}}finally{this.endUpdate()}}}const view_GraphDataModel=GraphDataModel;class Stylesheet{constructor(){this.styles=new Map,this.putDefaultVertexStyle(this.createDefaultVertexStyle()),this.putDefaultEdgeStyle(this.createDefaultEdgeStyle())}createDefaultVertexStyle(){const t={};return t.shape=Constants.SHAPE.RECTANGLE,t.perimeter="rectanglePerimeter",t.verticalAlign=Constants.ALIGN.MIDDLE,t.align=Constants.ALIGN.CENTER,t.fillColor="#C3D9FF",t.strokeColor="#6482B9",t.fontColor="#774400",t}createDefaultEdgeStyle(){const t={};return t.shape=Constants.SHAPE.CONNECTOR,t.endArrow=Constants.ARROW.CLASSIC,t.verticalAlign=Constants.ALIGN.MIDDLE,t.align=Constants.ALIGN.CENTER,t.strokeColor="#6482B9",t.fontColor="#446299",t}putDefaultVertexStyle(t){this.putCellStyle("defaultVertex",t)}putDefaultEdgeStyle(t){this.putCellStyle("defaultEdge",t)}getDefaultVertexStyle(){return this.styles.get("defaultVertex")}getDefaultEdgeStyle(){return this.styles.get("defaultEdge")}putCellStyle(t,e){this.styles.set(t,e)}getCellStyle(t,e){let i=t.ignoreDefaultStyle?{}:{...e};t.baseStyleNames&&(i=t.baseStyleNames.reduce(((t,e)=>({...t,...this.styles.get(e)})),i));for(const e of Object.keys(t))void 0!==t[e]&&(t[e]==Constants.NONE?delete i[e]:i[e]=t[e]);return"baseStyleNames"in i&&delete i.baseStyleNames,"ignoreDefaultStyle"in i&&delete i.ignoreDefaultStyle,i}}var CellState=__webpack_require__(953);const SideToSide=(t,e,i,s,n)=>{const{view:l}=t;let a=null!=s&&s.length>0?s[0]:null;const r=t.absolutePoints,o=r[0],h=r[r.length-1];if(null!=a&&(a=l.transformControlPoint(t,a)),null!=o&&((e=new CellState.default).x=o.x,e.y=o.y),null!=h&&((i=new CellState.default).x=h.x,i.y=h.y),null!=e&&null!=i){const t=Math.max(e.x,i.x),s=Math.min(e.x+e.width,i.x+i.width),r=null!=a?a.x:Math.round(s+(t-s)/2);let o=l.getRoutingCenterY(e),h=l.getRoutingCenterY(i);if(null!=a&&(a.y>=e.y&&a.y<=e.y+e.height&&(o=a.y),a.y>=i.y&&a.y<=i.y+i.height&&(h=a.y)),(0,mathUtils.contains)(i,r,o)||(0,mathUtils.contains)(e,r,o)||n.push(new Point.default(r,o)),(0,mathUtils.contains)(i,r,h)||(0,mathUtils.contains)(e,r,h)||n.push(new Point.default(r,h)),1===n.length)if(null!=a)(0,mathUtils.contains)(i,r,a.y)||(0,mathUtils.contains)(e,r,a.y)||n.push(new Point.default(r,a.y));else{const t=Math.max(e.y,i.y),s=Math.min(e.y+e.height,i.y+i.height);n.push(new Point.default(r,t+(s-t)/2))}}},TopToBottom=(t,e,i,s,n)=>{const{view:l}=t;let a=null!=s&&s.length>0?s[0]:null;const r=t.absolutePoints,o=r[0],h=r[r.length-1];if(null!=a&&(a=l.transformControlPoint(t,a)),null!=o&&((e=new CellState.default).x=o.x,e.y=o.y),null!=h&&((i=new CellState.default).x=h.x,i.y=h.y),null!=e&&null!=i){const t=Math.max(e.y,i.y),s=Math.min(e.y+e.height,i.y+i.height);let r=l.getRoutingCenterX(e);null!=a&&a.x>=e.x&&a.x<=e.x+e.width&&(r=a.x);const o=null!=a?a.y:Math.round(s+(t-s)/2);if((0,mathUtils.contains)(i,r,o)||(0,mathUtils.contains)(e,r,o)||n.push(new Point.default(r,o)),r=null!=a&&a.x>=i.x&&a.x<=i.x+i.width?a.x:l.getRoutingCenterX(i),(0,mathUtils.contains)(i,r,o)||(0,mathUtils.contains)(e,r,o)||n.push(new Point.default(r,o)),1===n.length)if(null!=a&&1===n.length)(0,mathUtils.contains)(i,a.x,o)||(0,mathUtils.contains)(e,a.x,o)||n.push(new Point.default(a.x,o));else{const t=Math.max(e.x,i.x),s=Math.min(e.x+e.width,i.x+i.width);n.push(new Point.default(t+(s-t)/2,o))}}},ElbowConnector=(t,e,i,s,n)=>{let l=null!=s&&s.length>0?s[0]:null,a=!1,r=!1;if(null!=e&&null!=i)if(null!=l){const s=Math.min(e.x,i.x),n=Math.max(e.x+e.width,i.x+i.width),o=Math.min(e.y,i.y),h=Math.max(e.y+e.height,i.y+i.height);l=t.view.transformControlPoint(t,l),a=l.y<o||l.y>h,r=l.x<s||l.x>n}else a=Math.max(e.x,i.x)===Math.min(e.x+e.width,i.x+i.width),a||(r=Math.max(e.y,i.y)===Math.min(e.y+e.height,i.y+i.height));r||!a&&t.style.elbow!==Constants.ELBOW.VERTICAL?SideToSide(t,e,i,s,n):TopToBottom(t,e,i,s,n)};var cloneUtils=__webpack_require__(766);const EntityRelationConnectorConfig={segment:Constants.ENTITY_SEGMENT},resetEntityRelationConnectorConfig=()=>{EntityRelationConnectorConfig.segment=Constants.ENTITY_SEGMENT},OrthogonalConnectorConfig={buffer:10,pointsFallback:!0},originalOrthogonalConnectorConfig={...OrthogonalConnectorConfig},resetOrthogonalConnectorConfig=()=>{(0,cloneUtils.shallowCopy)(originalOrthogonalConnectorConfig,OrthogonalConnectorConfig)},ManhattanConnectorConfig={maxAllowedDirectionChange:90,maxLoops:2e3,endDirections:Object.values(Constants.DIRECTION),startDirections:Object.values(Constants.DIRECTION),step:12},originalManhattanConnectorConfig={};(0,cloneUtils.shallowCopy)(ManhattanConnectorConfig,originalManhattanConnectorConfig);const resetManhattanConnectorConfig=()=>{(0,cloneUtils.shallowCopy)(originalManhattanConnectorConfig,ManhattanConnectorConfig)},EntityRelation=(t,e,i,s,n)=>{const{view:l}=t,a=(t.style?.segment??EntityRelationConnectorConfig.segment)*l.scale,r=t.absolutePoints,o=r[0],h=r[r.length-1];let d=!1;if(null!=e){const t=e.cell.getGeometry();t.relative?d=t.x<=.5:null!=i&&(d=(null!=h?h.x:i.x+i.width)<(null!=o?o.x:e.x))}if(null!=o)(e=new CellState.default).x=o.x,e.y=o.y;else{if(null==e)return;{const i=(0,mathUtils.getPortConstraints)(e,t,!0,Constants.DIRECTION_MASK.NONE);i!==Constants.DIRECTION_MASK.NONE&&i!==Constants.DIRECTION_MASK.WEST+Constants.DIRECTION_MASK.EAST&&(d=i===Constants.DIRECTION_MASK.WEST)}}let u=!0;if(null!=i){const t=i.cell.getGeometry();t.relative?u=t.x<=.5:null!=e&&(u=(null!=o?o.x:e.x+e.width)<(null!=h?h.x:i.x))}if(null!=h)(i=new CellState.default).x=h.x,i.y=h.y;else if(null!=i){const e=(0,mathUtils.getPortConstraints)(i,t,!1,Constants.DIRECTION_MASK.NONE);e!==Constants.DIRECTION_MASK.NONE&&e!=Constants.DIRECTION_MASK.WEST+Constants.DIRECTION_MASK.EAST&&(u=e===Constants.DIRECTION_MASK.WEST)}if(null!=e&&null!=i){const t=d?e.x:e.x+e.width,s=l.getRoutingCenterY(e),r=u?i.x:i.x+i.width,o=l.getRoutingCenterY(i),h=a;let c=d?-h:h;const g=new Point.default(t+c,s);c=u?-h:h;const p=new Point.default(r+c,o);if(d===u){const e=d?Math.min(t,r)-a:Math.max(t,r)+a;n.push(new Point.default(e,s)),n.push(new Point.default(e,o))}else if(g.x<p.x===d){const t=s+(o-s)/2;n.push(g),n.push(new Point.default(g.x,t)),n.push(new Point.default(p.x,t)),n.push(p)}else n.push(g),n.push(p)}},Loop=(t,e,i,s,n)=>{const l=t.absolutePoints,a=l[0],r=l[l.length-1];if(null==a||null==r){if(null!=e){const{view:i}=t,{graph:l}=i;let a=null!=s&&s.length>0?s[0]:null;null!=a&&(a=i.transformControlPoint(t,a),(0,mathUtils.contains)(e,a.x,a.y)&&(a=null));let r=0,o=0,h=0,d=0;const u=(t.style.segment??l.gridSize)*i.scale,c=t.style?.direction??Constants.DIRECTION.WEST;c===Constants.DIRECTION.NORTH||c===Constants.DIRECTION.SOUTH?(r=i.getRoutingCenterX(e),o=u):(h=i.getRoutingCenterY(e),d=u),null==a||a.x<e.x||a.x>e.x+e.width?null!=a?(r=a.x,d=Math.max(Math.abs(h-a.y),d)):c===Constants.DIRECTION.NORTH?h=e.y-2*o:c===Constants.DIRECTION.SOUTH?h=e.y+e.height+2*o:r=c===Constants.DIRECTION.EAST?e.x-2*d:e.x+e.width+2*d:null!==a&&(r=i.getRoutingCenterX(e),o=Math.max(Math.abs(r-a.x),d),h=a.y,d=0),n.push(new Point.default(r-o,h-d)),n.push(new Point.default(r+o,h+d))}}else if(null!=s&&s.length>0)for(let e=0;e<s.length;e+=1){let i=s[e];i=t.view.transformControlPoint(t,i),n.push(new Point.default(i.x,i.y))}};var Geometry=__webpack_require__(798);function scalePointArray(t,e){let i=[];if(null!=t)for(let s=0;s<t.length;s+=1)null!=t[s]?i[s]=new Point.default(Math.round(t[s].x/e*10)/10,Math.round(t[s].y/e*10)/10):i[s]=null;else i=null;return i}function scaleCellState(t,e){let i=null;return null!=t&&(i=t.clone(),i.setRect(Math.round(t.x/e*10)/10,Math.round(t.y/e*10)/10,Math.round(t.width/e*10)/10,Math.round(t.height/e*10)/10)),i}const SegmentConnector=(t,e,i,s,n)=>{const l=scalePointArray(t.absolutePoints,t.view.scale),a=scaleCellState(e,t.view.scale),r=scaleCellState(i,t.view.scale);let o=n.length>0?n[0]:null,h=!0,d=null;function u(e){return e.x=Math.round(e.x*t.view.scale*10)/10,e.y=Math.round(e.y*t.view.scale*10)/10,(null==o||Math.abs(o.x-e.x)>=1||Math.abs(o.y-e.y)>=Math.max(1,t.view.scale))&&(n.push(e),o=e),o}let c=l[0];null==c&&null!=a?c=new Point.default(t.view.getRoutingCenterX(a),t.view.getRoutingCenterY(a)):null!=c&&(c=c.clone());const g=l.length-1;let p=null;if(null!=s&&s.length>0){let e=[];for(let i=0;i<s.length;i+=1){const n=t.view.transformControlPoint(t,s[i],!0);null!=n&&e.push(n)}if(0===e.length)return;null!=c&&null!=e[0]&&(Math.abs(e[0].x-c.x)<1&&(e[0].x=c.x),Math.abs(e[0].y-c.y)<1&&(e[0].y=c.y)),p=l[g],null!=p&&null!=e[e.length-1]&&(Math.abs(e[e.length-1].x-p.x)<1&&(e[e.length-1].x=p.x),Math.abs(e[e.length-1].y-p.y)<1&&(e[e.length-1].y=p.y)),d=e[0];let i=a,n=l[0],o=!1,f=!1,E=d;null!=n&&(i=null);for(let t=0;t<2;t+=1){const s=null!=n&&n.x===E.x,a=null!=n&&n.y===E.y,d=null!=i&&E.y>=i.y&&E.y<=i.y+i.height,u=null!=i&&E.x>=i.x&&E.x<=i.x+i.width;if(o=a||null==n&&d,f=s||null==n&&u,0!=t||!(o&&f||s&&a)){if(null!=n&&!a&&!s&&(d||u)){h=!d;break}if(f||o){h=o,1===t&&(h=e.length%2==0?o:f);break}}i=r,n=l[g],null!=n&&(i=null),E=e[e.length-1],s&&a&&(e=e.slice(1))}h&&(null!=l[0]&&l[0].y!==d.y||null==l[0]&&null!=a&&(d.y<a.y||d.y>a.y+a.height))?u(new Point.default(c.x,d.y)):!h&&(null!=l[0]&&l[0].x!==d.x||null==l[0]&&null!=a&&(d.x<a.x||d.x>a.x+a.width))&&u(new Point.default(d.x,c.y)),h?c.y=d.y:c.x=d.x;for(let t=0;t<e.length;t+=1)h=!h,d=e[t],h?c.y=d.y:c.x=d.x,u(c.clone())}else d=c,h=!0;if(c=l[g],null==c&&null!=r&&(c=new Point.default(t.view.getRoutingCenterX(r),t.view.getRoutingCenterY(r))),null!=c&&null!=d&&(h&&(null!=l[g]&&l[g].y!==d.y||null==l[g]&&null!=r&&(d.y<r.y||d.y>r.y+r.height))?u(new Point.default(c.x,d.y)):!h&&(null!=l[g]&&l[g].x!==d.x||null==l[g]&&null!=r&&(d.x<r.x||d.x>r.x+r.width))&&u(new Point.default(d.x,c.y))),null==l[0]&&null!=a)for(;n.length>1&&null!=n[1]&&(0,mathUtils.contains)(a,n[1].x,n[1].y);)n.splice(1,1);if(null==l[g]&&null!=r)for(;n.length>1&&null!=n[n.length-1]&&(0,mathUtils.contains)(r,n[n.length-1].x,n[n.length-1].y);)n.splice(n.length-1,1);null!=p&&null!=n[n.length-1]&&Math.abs(p.x-n[n.length-1].x)<=1&&Math.abs(p.y-n[n.length-1].y)<=1&&(n.splice(n.length-1,1),null!=n[n.length-1]&&(Math.abs(n[n.length-1].x-p.x)<1&&(n[n.length-1].x=p.x),Math.abs(n[n.length-1].y-p.y)<1&&(n[n.length-1].y=p.y)))},dirVectors=[[-1,0],[0,-1],[1,0],[0,1],[-1,0],[0,-1],[1,0]],wayPoints1=[[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0],[0,0]],routePatterns=[[[513,2308,2081,2562],[513,1090,514,2184,2114,2561],[513,1090,514,2564,2184,2562],[513,2308,2561,1090,514,2568,2308]],[[514,1057,513,2308,2081,2562],[514,2184,2114,2561],[514,2184,2562,1057,513,2564,2184],[514,1057,513,2568,2308,2561]],[[1090,514,1057,513,2308,2081,2562],[2114,2561],[1090,2562,1057,513,2564,2184],[1090,514,1057,513,2308,2561,2568]],[[2081,2562],[1057,513,1090,514,2184,2114,2561],[1057,513,1090,514,2184,2562,2564],[1057,2561,1090,514,2568,2308]]],vertexSeparations=[],limits=[[0,0,0,0,0,0,0,0,0],[0,0,0,0,0,0,0,0,0]],SIDE_MASK=480,CENTER_MASK=512,SOURCE_MASK=1024,TARGET_MASK=2048,VERTEX_MASK=3072;function getJettySize(t,e){const i=OrthogonalConnectorConfig.buffer;let s=(e?t.style.sourceJettySize:t.style.targetJettySize)??t.style.jettySize??i;if("auto"===s)if(((e?t.style.startArrow:t.style.endArrow)??Constants.NONE)!==Constants.NONE){const n=(e?t.style.startSize:t.style.endSize)??Constants.DEFAULT_MARKERSIZE;s=Math.max(2,Math.ceil((n+i)/i))*i}else s=2*i;return s}const OrthogonalConnector=(t,e,i,s,n)=>{const l=scalePointArray(t.absolutePoints,t.view.scale),a=scaleCellState(e,t.view.scale),r=scaleCellState(i,t.view.scale),o=null!=a&&a.cell.isEdge(),h=null!=r&&r.cell.isEdge(),d=l[0],u=l[l.length-1];let c=null!=a?a.x:d.x,g=null!=a?a.y:d.y,p=null!=a?a.width:0,f=null!=a?a.height:0,E=null!=r?r.x:u.x,C=null!=r?r.y:u.y,y=null!=r?r.width:0,v=null!=r?r.height:0,m=getJettySize(t,!0),S=getJettySize(t,!1);null!=a&&r===a&&(S=Math.max(m,S),m=S);const w=S+m;let _=!1;if(null!=d&&null!=u){const t=u.x-d.x,e=u.y-d.y;_=t*t+e*e<w*w}if(_||OrthogonalConnectorConfig.pointsFallback&&null!=s&&s.length>0||o||h)return void SegmentConnector(t,e,i,s,n);const x=[Constants.DIRECTION_MASK.ALL,Constants.DIRECTION_MASK.ALL];let T=0;if(null!=a&&(x[0]=(0,mathUtils.getPortConstraints)(a,t,!0,Constants.DIRECTION_MASK.ALL),T=a.style.rotation??0,0!==T)){const t=(0,mathUtils.getBoundingBox)(new Rectangle.default(c,g,p,f),T);c=t.x,g=t.y,p=t.width,f=t.height}if(null!=r&&(x[1]=(0,mathUtils.getPortConstraints)(r,t,!1,Constants.DIRECTION_MASK.ALL),T=r.style.rotation??0,0!==T)){const t=(0,mathUtils.getBoundingBox)(new Rectangle.default(E,C,y,v),T);E=t.x,C=t.y,y=t.width,v=t.height}const b=[0,0],P=[[c,g,p,f],[E,C,y,v]],I=[m,S];for(let t=0;t<2;t+=1)limits[t][1]=P[t][0]-I[t],limits[t][2]=P[t][1]-I[t],limits[t][4]=P[t][0]+P[t][2]+I[t],limits[t][8]=P[t][1]+P[t][3]+I[t];const M=P[0][0]+P[0][2]/2,O=P[0][1]+P[0][3]/2,A=M-(P[1][0]+P[1][2]/2),D=O-(P[1][1]+P[1][3]/2);let L=0;A<0?L=D<0?2:1:D<=0&&(L=3,0===A&&(L=2));let R=null;null!=a&&(R=d);const N=[[.5,.5],[.5,.5]];for(let t=0;t<2;t+=1)null!=R&&(N[t][0]=(R.x-P[t][0])/P[t][2],Math.abs(R.x-P[t][0])<=1?b[t]=Constants.DIRECTION_MASK.WEST:Math.abs(R.x-P[t][0]-P[t][2])<=1&&(b[t]=Constants.DIRECTION_MASK.EAST),N[t][1]=(R.y-P[t][1])/P[t][3],Math.abs(R.y-P[t][1])<=1?b[t]=Constants.DIRECTION_MASK.NORTH:Math.abs(R.y-P[t][1]-P[t][3])<=1&&(b[t]=Constants.DIRECTION_MASK.SOUTH)),R=null,null!=r&&(R=u);const H=P[0][1]-(P[1][1]+P[1][3]),B=P[0][0]-(P[1][0]+P[1][2]),U=P[1][1]-(P[0][1]+P[0][3]),k=P[1][0]-(P[0][0]+P[0][2]);vertexSeparations[1]=Math.max(B-w,0),vertexSeparations[2]=Math.max(H-w,0),vertexSeparations[4]=Math.max(U-w,0),vertexSeparations[3]=Math.max(k-w,0);const V=[],G=[],F=[];G[0]=B>=k?Constants.DIRECTION_MASK.WEST:Constants.DIRECTION_MASK.EAST,F[0]=H>=U?Constants.DIRECTION_MASK.NORTH:Constants.DIRECTION_MASK.SOUTH,G[1]=(0,mathUtils.reversePortConstraints)(G[0]),F[1]=(0,mathUtils.reversePortConstraints)(F[0]);const z=B>=k?B:k,W=H>=U?H:U,Y=[[0,0],[0,0]];let X=!1;for(let t=0;t<2;t+=1)0===b[t]&&(G[t]&x[t]||(G[t]=(0,mathUtils.reversePortConstraints)(G[t])),F[t]&x[t]||(F[t]=(0,mathUtils.reversePortConstraints)(F[t])),Y[t][0]=F[t],Y[t][1]=G[t]);W>0&&z>0&&((G[0]&x[0])>0&&(F[1]&x[1])>0?(Y[0][0]=G[0],Y[0][1]=F[0],Y[1][0]=F[1],Y[1][1]=G[1],X=!0):(F[0]&x[0])>0&&(G[1]&x[1])>0&&(Y[0][0]=F[0],Y[0][1]=G[0],Y[1][0]=G[1],Y[1][1]=F[1],X=!0)),W>0&&!X&&(Y[0][0]=F[0],Y[0][1]=G[0],Y[1][0]=F[1],Y[1][1]=G[1],X=!0),z>0&&!X&&(Y[0][0]=G[0],Y[0][1]=F[0],Y[1][0]=G[1],Y[1][1]=F[1],X=!0);for(let t=0;t<2;t+=1)0===b[t]&&(Y[t][0]&x[t]||(Y[t][0]=Y[t][1]),V[t]=Y[t][0]&x[t],V[t]|=(Y[t][1]&x[t])<<8,V[t]|=(Y[1-t][t]&x[t])<<16,V[t]|=(Y[1-t][1-t]&x[t])<<24,15&V[t]||(V[t]=V[t]<<8),3840&V[t]||(V[t]=15&V[t]|V[t]>>8),983040&V[t]||(V[t]=65535&V[t]|(251658240&V[t])>>8),b[t]=15&V[t],x[t]!==Constants.DIRECTION_MASK.WEST&&x[t]!==Constants.DIRECTION_MASK.NORTH&&x[t]!==Constants.DIRECTION_MASK.EAST&&x[t]!==Constants.DIRECTION_MASK.SOUTH||(b[t]=x[t]));let K=b[0]===Constants.DIRECTION_MASK.EAST?3:b[0],$=b[1]===Constants.DIRECTION_MASK.EAST?3:b[1];K-=L,$-=L,K<1&&(K+=4),$<1&&($+=4);const q=routePatterns[K-1][$-1];switch(wayPoints1[0][0]=P[0][0],wayPoints1[0][1]=P[0][1],b[0]){case Constants.DIRECTION_MASK.WEST:wayPoints1[0][0]-=m,wayPoints1[0][1]+=N[0][1]*P[0][3];break;case Constants.DIRECTION_MASK.SOUTH:wayPoints1[0][0]+=N[0][0]*P[0][2],wayPoints1[0][1]+=P[0][3]+m;break;case Constants.DIRECTION_MASK.EAST:wayPoints1[0][0]+=P[0][2]+m,wayPoints1[0][1]+=N[0][1]*P[0][3];break;case Constants.DIRECTION_MASK.NORTH:wayPoints1[0][0]+=N[0][0]*P[0][2],wayPoints1[0][1]-=m}let j=0,Z=(b[0]&(Constants.DIRECTION_MASK.EAST|Constants.DIRECTION_MASK.WEST))>0?0:1;const Q=Z;let J=0;for(let t=0;t<q.length;t+=1){const e=15&q[t];let i=e===Constants.DIRECTION_MASK.EAST?3:e;i+=L,i>4&&(i-=4);const s=dirVectors[i-1];J=i%2>0?0:1,J!==Z&&(j++,wayPoints1[j][0]=wayPoints1[j-1][0],wayPoints1[j][1]=wayPoints1[j-1][1]);const n=(q[t]&TARGET_MASK)>0,l=(q[t]&SOURCE_MASK)>0;let a=(q[t]&SIDE_MASK)>>5;a<<=L,a>15&&(a>>=4);const r=(q[t]&CENTER_MASK)>0;if((l||n)&&a<9){let t=0;const e=l?0:1;if(t=r&&0===J?P[e][0]+N[e][0]*P[e][2]:r?P[e][1]+N[e][1]*P[e][3]:limits[e][a],0===J){const e=(t-wayPoints1[j][0])*s[0];e>0&&(wayPoints1[j][0]+=s[0]*e)}else{const e=(t-wayPoints1[j][1])*s[1];e>0&&(wayPoints1[j][1]+=s[1]*e)}}else r&&(wayPoints1[j][0]+=s[0]*Math.abs(vertexSeparations[i]/2),wayPoints1[j][1]+=s[1]*Math.abs(vertexSeparations[i]/2));j>0&&wayPoints1[j][J]===wayPoints1[j-1][J]?j--:Z=J}for(let e=0;e<=j&&(e!==j||(((b[1]&(Constants.DIRECTION_MASK.EAST|Constants.DIRECTION_MASK.WEST))>0?0:1)===Q?0:1)==(j+1)%2);e+=1)n.push(new Point.default(Math.round(wayPoints1[e][0]*t.view.scale*10)/10,Math.round(wayPoints1[e][1]*t.view.scale*10)/10));let tt=1;for(;tt<n.length;)null==n[tt-1]||null==n[tt]||n[tt-1].x!==n[tt].x||n[tt-1].y!==n[tt].y?tt++:n.splice(tt,1)},ManhattanConnector=(t,e,i,s,n)=>{function l(t,e){return t.x+=e.x||0,t.y+=e.y||0,t.width+=e.width||0,t.height+=e.height||0,t}function a(t,e){return e*Math.round(t/e)}function r(t,e,i){return t.x=a(t.x,e),t.y=a(t.y,i||e),t}function o(t,e){return e.x>=t.x&&e.x<=t.x+t.width&&e.y>=t.y&&e.y<=t.y+t.height}function h(t){return new Point.default(t.x+t.width/2,t.y+t.height/2)}function d(t,e){return new Point.default(t.x-e.x,t.y-e.y)}function u(t,e,i){return t.x+=e||0,t.y+=i||0,t}function c(t,e){const i=e.clone(),s=-(i.y-t.y),n=i.x-t.x;return 180*("0"==s.toFixed(10)&&"0"==n.toFixed(10)?0:Math.atan2(s,n))/Math.PI}function g(t){return new Point.default(0===t.x?0:Math.abs(t.x)/t.x,0===t.y?0:Math.abs(t.y)/t.y)}function p(t){const e=t.split(-1===t.indexOf("@")?" ":"@");return new Point.default(parseInt(e[0],10),parseInt(e[1],10))}function f(t){return`${t.x}@${t.y}`}function E(t){const e=t.view.graph,i=e.getCellBounds(t.cell,!1,!1)?.clone();if(!i)return;const s=e.view,{scale:n,translate:l}=s,{x:a,y:r}=l,o=t=>Math.round(10*t)/10;return new Rectangle.default(o(i.x/n-a),o(i.y/n-r),o(i.width/n),o(i.height/n))}const C=ManhattanConnectorConfig.step,y={paddingBox:new Geometry.default(-C,-C,2*C,2*C),directions:[{offsetX:C,offsetY:0,cost:C,angle:_(c(new Point.default(0,0),new Point.default(C,0)))},{offsetX:0,offsetY:C,cost:C,angle:_(c(new Point.default(0,0),new Point.default(0,C)))},{offsetX:-C,offsetY:0,cost:C,angle:_(c(new Point.default(0,0),new Point.default(-C,0)))},{offsetX:0,offsetY:-C,cost:C,angle:_(c(new Point.default(0,0),new Point.default(0,-C)))}],directionMap:{east:{x:1,y:0},south:{x:0,y:1},west:{x:-1,y:0},north:{x:0,y:-1}},penaltiesGenerator:t=>45==t||90==t||180==t?C/2:0,draggingRoute:null,previousDirAngle:0};class v{constructor(t){this.options=t,this.mapGridSize=100,this.map=new Map}build(t,e){const i=t?.view.graph||e?.view.graph;if(i)return Array.from(i.getView().getCellStates()).filter((t=>t.cell&&t.cell.isVertex()&&!t.cell.isEdge())).map((t=>E(t))).map((t=>t?l(t,this.options.paddingBox):null)).forEach((t=>{if(!t)return;const e=r(new Point.default(t.x,t.y),this.mapGridSize),i=r(new Point.default(t.x+t.width,t.y+t.height),this.mapGridSize);for(let s=e.x;s<=i.x;s+=this.mapGridSize)for(let n=e.y;n<=i.y;n+=this.mapGridSize){const e=s+"@"+n,i=this.map.get(e)||[];this.map.has(e)||this.map.set(e,i),i.push(t)}}))}isPointAccessible(t){const e=f(r(t.clone(),this.mapGridSize)),i=this.map.get(e);return!i||i.every((e=>!o(e,t)))}}class m{constructor(){this.items=[],this.hash=new Map}add(t,e){const i=this.hash.get(t);i?(i.value=e,this.items.splice(this.items.indexOf(t),1)):this.hash.set(t,{value:e,open:!0}),this.items.push(t),this.items.sort(((t,e)=>{const i=this.hash.get(t),s=this.hash.get(e);return i&&s?i.value-s.value:0}))}remove(t){const e=this.hash.get(t);e&&(e.open=!1)}isOpen(t){const e=this.hash.get(t);return e&&1==e.open}isClose(t){const e=this.hash.get(t);return e&&0==e.open}isEmpty(){return 0==this.items.length}pop(){const t=this.items.shift();return t&&this.remove(t),t}}function S(t,e,i,s){const n=[];let l,a=g(d(s,e)),r=e;for(;t[f(r)];){if(l=t[f(r)],!l)continue;const e=g(d(r,l));e.equals(a)||(n.unshift(r),a=e),r=l}return g(d(r,i)).equals(a)||n.unshift(r),n}function w(t,e,i){const s=ManhattanConnectorConfig.step,n=h(t),l=[];for(const a of e){const e=i.directionMap[a],h=e.x*t.width/2,d=e.y*t.height/2,c=u(n.clone(),h,d);o(t,c)&&u(c,e.x*s,e.y*s),l.push(r(c,s))}return l}function _(t){return t%360+(t<0?360:0)}function x(t,e,i){const s=360/i;return Math.floor(_(c(t,e)+s/2)/s)*s}function T(t,e){const i=Math.abs(t-e);return i>180?360-i:i}function b(t,e){let i=1/0;for(let l=0,a=e.length;l<a;l++){const a=(s=t,n=e[l],Math.abs(n.x-s.x)+Math.abs(n.y-s.y));a<i&&(i=a)}var s,n;return i}function P(t,e,i,s){const n=E(i),l=s?e.style.exitY:e.style.entryY,a=s?ManhattanConnectorConfig.startDirections.every((t=>t!=Constants.DIRECTION.NORTH&&t!=Constants.DIRECTION.SOUTH)):ManhattanConnectorConfig.endDirections.every((t=>t!=Constants.DIRECTION.NORTH&&t!=Constants.DIRECTION.SOUTH));if(null!=l&&a){const e=n?.height||0;t.y=null!=n?.y?n?.y+e*l:t.y-e/2+e*l}const r=s?e.style.exitX:e.style.entryX,o=s?ManhattanConnectorConfig.startDirections.every((t=>t!=Constants.DIRECTION.WEST&&t!=Constants.DIRECTION.EAST)):ManhattanConnectorConfig.endDirections.every((t=>t!=Constants.DIRECTION.WEST&&t!=Constants.DIRECTION.EAST));if(null!=r&&o){const e=n?.width||0;t.x=null!=n?.x?n?.x+e*r:t.x-e/2+e*(r||0)}}!function(t,e,i,s,n,a){if(null!=s&&s.length>0||null==e||null==i)return void SegmentConnector(t,e,i,s,n);let o=E(e);o=o?l(o,a.paddingBox):void 0;let d=E(i);d=d?l(d,a.paddingBox):void 0;const c=new v(a);if(c.build(e,i),!o||!d)return OrthogonalConnector(t,e,i,s,n);const g=function(t,e,i,s){const n=ManhattanConnectorConfig.step,l=w(t,ManhattanConnectorConfig.startDirections,s).filter((t=>i.isPointAccessible(t))),a=r(h(t),n),o=w(e,ManhattanConnectorConfig.endDirections,s).filter((t=>i.isPointAccessible(t))),d=r(h(e),n);if(l.length>0&&o.length>0){const t=new m,e={},n={};l.forEach((e=>{const i=f(e);t.add(i,b(e,o)),n[i]=0}));let r=ManhattanConnectorConfig.maxLoops;const h=o.map((t=>f(t)));let c,g;for(;!t.isEmpty()&&r>0;){const l=t.pop();if(null==l)continue;const E=p(l),C=n[l];if(g=c,c=e[l]?x(e[l],E,s.directions.length):0!=s.previousDirAngle?s.previousDirAngle:x(a,E,s.directions.length),h.indexOf(l)>=0){const t=T(c,x(E,d,s.directions.length));if(E.equals(d)||t<180)return s.previousDirAngle=c,S(e,E,a,d)}for(let l=0;l<s.directions.length;l++){const a=s.directions[l],r=T(c,a.angle);if(g&&r>ManhattanConnectorConfig.maxAllowedDirectionChange)continue;const h=u(E.clone(),a.offsetX,a.offsetY),d=f(h);if(t.isClose(d)||!i.isPointAccessible(h))continue;const p=C+a.cost+s.penaltiesGenerator(r);(!t.isOpen(d)||p<n[d])&&(e[d]=E,n[d]=p,t.add(d,p+b(h,o)))}r--}return null}return null}(o,d,c,a);if(null==g||0==g.length)return OrthogonalConnector(t,e,i,s,n);t.style&&(t.visibleSourceState&&g.length>0&&P(g[0],t,t.visibleSourceState,!0),t.visibleTargetState&&g.length>1&&P(g[g.length-1],t,t.visibleTargetState,!1));const C=t.view.scale;g.forEach((e=>n.push(new Point.default(Math.round((e.x+t.view.translate.x)*C*10)/10,Math.round((e.y+t.view.translate.y)*C*10)/10))))}(t,e,i,s,n,y)};class EdgeStyle{}EdgeStyle.EntityRelation=EntityRelation,EdgeStyle.Loop=Loop,EdgeStyle.ElbowConnector=ElbowConnector,EdgeStyle.SideToSide=SideToSide,EdgeStyle.TopToBottom=TopToBottom,EdgeStyle.SegmentConnector=SegmentConnector,EdgeStyle.OrthConnector=OrthogonalConnector,EdgeStyle.ManhattanConnector=ManhattanConnector;const style_EdgeStyle=EdgeStyle;class CellHighlight{constructor(t,e,i,s){this.strokeWidth=0,this.dashed=!1,this.opacity=100,this.shape=null,this.keepOnTop=!1,this.state=null,this.spacing=2,this.graph=t,this.highlightColor=e??Constants.DEFAULT_VALID_COLOR,this.strokeWidth=i??Constants.HIGHLIGHT_STROKEWIDTH,this.dashed=s??!1,this.opacity=Constants.HIGHLIGHT_OPACITY,this.repaintHandler=()=>{if(this.state){const t=this.graph.view.getState(this.state.cell);t?(this.state=t,this.repaint()):this.hide()}},this.graph.getView().addListener(InternalEvent.default.SCALE,this.repaintHandler),this.graph.getView().addListener(InternalEvent.default.TRANSLATE,this.repaintHandler),this.graph.getView().addListener(InternalEvent.default.SCALE_AND_TRANSLATE,this.repaintHandler),this.graph.getDataModel().addListener(InternalEvent.default.CHANGE,this.repaintHandler),this.resetHandler=()=>{this.hide()},this.graph.getView().addListener(InternalEvent.default.DOWN,this.resetHandler),this.graph.getView().addListener(InternalEvent.default.UP,this.resetHandler)}setHighlightColor(t){this.highlightColor=t,this.shape&&(this.shape.stroke=t)}drawHighlight(){if(this.shape=this.createShape(),this.repaint(),this.shape){const t=this.shape.node;!this.keepOnTop&&t?.parentNode?.firstChild!==t&&t.parentNode&&t.parentNode.insertBefore(t,t.parentNode.firstChild)}}createShape(){if(!this.state)return null;const t=this.graph.cellRenderer.createShape(this.state);return t.svgStrokeTolerance=this.graph.getEventTolerance(),t.points=this.state.absolutePoints,t.apply(this.state),t.stroke=this.highlightColor,t.opacity=this.opacity,t.isDashed=this.dashed,t.isShadow=!1,t.dialect=Constants.DIALECT.SVG,t.init(this.graph.getView().getOverlayPane()),InternalEvent.default.redirectMouseEvents(t.node,this.graph,this.state),this.graph.dialect!==Constants.DIALECT.SVG?t.pointerEvents=!1:t.svgPointerEvents="stroke",t}getStrokeWidth(t=null){return this.strokeWidth}repaint(){this.state&&this.shape&&(this.shape.scale=this.state.view.scale,this.state.cell.isEdge()?(this.shape.strokeWidth=this.getStrokeWidth(),this.shape.points=this.state.absolutePoints,this.shape.outline=!1):(this.shape.bounds=new Rectangle.default(this.state.x-this.spacing,this.state.y-this.spacing,this.state.width+2*this.spacing,this.state.height+2*this.spacing),this.shape.rotation=this.state.style.rotation??0,this.shape.strokeWidth=this.getStrokeWidth()/this.state.view.scale,this.shape.outline=!0),this.state.shape&&this.shape.setCursor(this.state.shape.getCursor()),this.shape.redraw())}hide(){this.highlight(null)}highlight(t=null){this.state!==t&&(this.shape&&(this.shape.destroy(),this.shape=null),this.state=t,this.state&&this.drawHighlight())}isHighlightAt(t,e){let i=!1;if(this.shape&&document.elementFromPoint){let s=document.elementFromPoint(t,e);for(;s;){if(s===this.shape.node){i=!0;break}s=s.parentNode}}return i}destroy(){const t=this.graph;t.getView().removeListener(this.resetHandler),t.getView().removeListener(this.repaintHandler),t.getDataModel().removeListener(this.repaintHandler),this.shape&&(this.shape.destroy(),this.shape=null)}}const cell_CellHighlight=CellHighlight;class CellMarker extends EventSource.default{constructor(t,e=Constants.DEFAULT_VALID_COLOR,i=Constants.DEFAULT_INVALID_COLOR,s=Constants.DEFAULT_HOTSPOT){super(),this.enabled=!0,this.hotspot=Constants.DEFAULT_HOTSPOT,this.hotspotEnabled=!1,this.currentColor=Constants.NONE,this.validState=null,this.markedState=null,this.graph=t,this.validColor=e,this.invalidColor=i,this.hotspot=s,this.highlight=new cell_CellHighlight(t)}setEnabled(t){this.enabled=t}isEnabled(){return this.enabled}setHotspot(t){this.hotspot=t}getHotspot(){return this.hotspot}setHotspotEnabled(t){this.hotspotEnabled=t}isHotspotEnabled(){return this.hotspotEnabled}hasValidState(){return!!this.validState}getValidState(){return this.validState}getMarkedState(){return this.markedState}reset(){this.validState=null,this.markedState&&(this.markedState=null,this.unmark())}process(t){let e=null;return this.isEnabled()&&(e=this.getState(t),this.setCurrentState(e,t)),e}setCurrentState(t,e,i){const s=!!t&&this.isValidState(t);i=i??this.getMarkerColor(e.getEvent(),t,s),this.validState=s?t:null,t===this.markedState&&i===this.currentColor||(this.currentColor=i,t&&this.currentColor!==Constants.NONE?(this.markedState=t,this.mark()):this.markedState&&(this.markedState=null,this.unmark()))}markCell(t,e){const i=this.graph.getView().getState(t);i&&(this.currentColor=e??this.validColor,this.markedState=i,this.mark())}mark(){this.highlight.setHighlightColor(this.currentColor),this.highlight.highlight(this.markedState),this.fireEvent(new EventObject.default(InternalEvent.default.MARK,"state",this.markedState))}unmark(){this.mark()}isValidState(t){return!0}getMarkerColor(t,e,i){return i?this.validColor:this.invalidColor}getState(t){const e=this.graph.getView(),i=this.getCell(t);if(!i)return null;const s=this.getStateToMark(e.getState(i));return s&&this.intersects(s,t)?s:null}getCell(t){return t.getCell()}getStateToMark(t){return t}intersects(t,e){const i=e.getGraphX(),s=e.getGraphY();return!this.hotspotEnabled||(0,mathUtils.intersectsHotspot)(t,i,s,this.hotspot,Constants.MIN_HOTSPOT_SIZE,Constants.MAX_HOTSPOT_SIZE)}destroy(){this.highlight.destroy()}}const cell_CellMarker=CellMarker;class EllipseShape extends Shape.default{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintVertexShape(t,e,i,s,n){t.ellipse(e,i,s,n),t.fillAndStroke()}}const node_EllipseShape=EllipseShape;class ConnectionConstraint{constructor(t,e=!0,i=null,s=0,n=0){this.perimeter=!0,this.name=null,this.dx=0,this.dy=0,this.point=t,this.perimeter=e,this.name=i,this.dx=s,this.dy=n}}const other_ConnectionConstraint=ConnectionConstraint;class ConstraintHandler{constructor(t){this.pointImage=new image_ImageBox(`${Client.default.imageBasePath}/point.gif`,5,5),this.currentFocus=null,this.currentFocusArea=null,this.focusIcons=[],this.constraints=null,this.currentConstraint=null,this.focusHighlight=null,this.focusPoints=[],this.currentPoint=null,this.enabled=!0,this.highlightColor=Constants.DEFAULT_VALID_COLOR,this.mouseleaveHandler=null,this.graph=t,this.resetHandler=()=>{this.currentFocus&&!this.graph.view.getState(this.currentFocus.cell)?this.reset():this.redraw()},this.graph.model.addListener(InternalEvent.default.CHANGE,this.resetHandler),this.graph.view.addListener(InternalEvent.default.SCALE_AND_TRANSLATE,this.resetHandler),this.graph.view.addListener(InternalEvent.default.TRANSLATE,this.resetHandler),this.graph.view.addListener(InternalEvent.default.SCALE,this.resetHandler),this.graph.addListener(InternalEvent.default.ROOT,this.resetHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}reset(){for(let t=0;t<this.focusIcons.length;t+=1)this.focusIcons[t].destroy();this.focusIcons=[],this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null),this.currentConstraint=null,this.currentFocusArea=null,this.currentPoint=null,this.currentFocus=null,this.focusPoints=[]}getTolerance(t){return this.graph.getEventTolerance()}getImageForConstraint(t,e,i){return this.pointImage}isEventIgnored(t,e=!1){return!1}isStateIgnored(t,e=!1){return!1}destroyIcons(){for(let t=0;t<this.focusIcons.length;t+=1)this.focusIcons[t].destroy();this.focusIcons=[],this.focusPoints=[]}destroyFocusHighlight(){this.focusHighlight&&(this.focusHighlight.destroy(),this.focusHighlight=null)}isKeepFocusEvent(t){return(0,EventUtils.isShiftDown)(t.getEvent())}getCellForEvent(t,e){let i=t.getCell();if(i||!e||t.getGraphX()===e.x&&t.getGraphY()===e.y||(i=this.graph.getCellAt(e.x,e.y)),i&&!i.isConnectable()){const t=i.getParent();t&&t.isVertex()&&t.isConnectable()&&(i=t)}return i?this.graph.isCellLocked(i)?null:i:null}update(t,e,i,s){if(this.isEnabled()&&!this.isEventIgnored(t)){!this.mouseleaveHandler&&this.graph.container&&(this.mouseleaveHandler=()=>{this.reset()},InternalEvent.default.addListener(this.graph.container,"mouseleave",this.resetHandler));const n=this.getTolerance(t),l=s?s.x:t.getGraphX(),a=s?s.y:t.getGraphY(),r=new Rectangle.default(l-n,a-n,2*n,2*n),o=new Rectangle.default(t.getGraphX()-n,t.getGraphY()-n,2*n,2*n),h=this.graph.view.getState(this.getCellForEvent(t,s));this.isKeepFocusEvent(t)||this.currentFocusArea&&this.currentFocus&&!h&&this.currentFocus.cell.isVertex()&&(0,mathUtils.intersects)(this.currentFocusArea,o)||h===this.currentFocus||(this.currentFocusArea=null,this.currentFocus=null,this.setFocus(t,h,e)),this.currentConstraint=null,this.currentPoint=null;let d,u=null;if(this.focusIcons.length>0&&this.constraints&&(!h||this.currentFocus===h)){const t=o.getCenterX(),n=o.getCenterY();for(let l=0;l<this.focusIcons.length;l+=1){const a=t-this.focusIcons[l].bounds.getCenterX(),c=n-this.focusIcons[l].bounds.getCenterY();if(d=a*a+c*c,(this.intersects(this.focusIcons[l],o,e,i)||s&&this.intersects(this.focusIcons[l],r,e,i))&&(null===u||d<u)){if(this.currentConstraint=this.constraints[l],this.currentPoint=this.focusPoints[l],u=d,d=this.focusIcons[l].bounds.clone(),d.grow(Constants.HIGHLIGHT_SIZE+1),d.width-=1,d.height-=1,!this.focusHighlight){const t=this.createHighlightShape();t.dialect=Constants.DIALECT.SVG,t.pointerEvents=!1,t.init(this.graph.getView().getOverlayPane()),this.focusHighlight=t;const e=()=>this.currentFocus?this.currentFocus:h;InternalEvent.default.redirectMouseEvents(t.node,this.graph,e)}this.focusHighlight.bounds=d,this.focusHighlight.redraw()}}}this.currentConstraint||this.destroyFocusHighlight()}else this.currentConstraint=null,this.currentFocus=null,this.currentPoint=null}redraw(){if(this.currentFocus&&this.constraints&&this.focusIcons.length>0){const t=this.graph.view.getState(this.currentFocus.cell);this.currentFocus=t,this.currentFocusArea=new Rectangle.default(t.x,t.y,t.width,t.height);for(let e=0;e<this.constraints.length;e+=1){const i=this.graph.getConnectionPoint(t,this.constraints[e]),s=this.getImageForConstraint(t,this.constraints[e],i),n=new Rectangle.default(Math.round(i.x-s.width/2),Math.round(i.y-s.height/2),s.width,s.height);this.focusIcons[e].bounds=n,this.focusIcons[e].redraw(),this.currentFocusArea.add(this.focusIcons[e].bounds),this.focusPoints[e]=i}}}setFocus(t,e,i){if(this.constraints=e&&!this.isStateIgnored(e,i)&&e.cell.isConnectable()?this.isEnabled()?this.graph.getAllConnectionConstraints(e,i)??[]:[]:null,this.constraints&&e){this.currentFocus=e,this.currentFocusArea=new Rectangle.default(e.x,e.y,e.width,e.height);for(let t=0;t<this.focusIcons.length;t+=1)this.focusIcons[t].destroy();this.focusIcons=[],this.focusPoints=[];for(let t=0;t<this.constraints.length;t+=1){const i=this.graph.getConnectionPoint(e,this.constraints[t]),s=this.getImageForConstraint(e,this.constraints[t],i),{src:n}=s,l=new Rectangle.default(Math.round(i.x-s.width/2),Math.round(i.y-s.height/2),s.width,s.height),a=new ImageShape.default(l,n);a.dialect=this.graph.dialect!==Constants.DIALECT.SVG?Constants.DIALECT.MIXEDHTML:Constants.DIALECT.SVG,a.preserveImageAspect=!1,a.init(this.graph.getView().getDecoratorPane()),a.node.previousSibling&&a.node.parentNode?.insertBefore(a.node,a.node.parentNode.firstChild);const r=()=>this.currentFocus?this.currentFocus:e;a.redraw(),InternalEvent.default.redirectMouseEvents(a.node,this.graph,r),this.currentFocusArea.add(a.bounds),this.focusIcons.push(a),this.focusPoints.push(i)}this.currentFocusArea.grow(this.getTolerance(t))}else this.destroyIcons(),this.destroyFocusHighlight()}createHighlightShape(){const t=new RectangleShape.default(new Rectangle.default,this.highlightColor,this.highlightColor,Constants.HIGHLIGHT_STROKEWIDTH);return t.opacity=Constants.HIGHLIGHT_OPACITY,t}intersects(t,e,i,s){return(0,mathUtils.intersects)(t.bounds,e)}onDestroy(){this.reset(),this.graph.model.removeListener(this.resetHandler),this.graph.view.removeListener(this.resetHandler),this.graph.removeListener(this.resetHandler),this.mouseleaveHandler&&this.graph.container&&(InternalEvent.default.removeListener(this.graph.container,"mouseleave",this.mouseleaveHandler),this.mouseleaveHandler=null)}}const handler_ConstraintHandler=ConstraintHandler,EdgeHandlerConfig={addBendOnShiftClickEnabled:!1,connectFillColor:Constants.CONNECT_HANDLE_FILLCOLOR,handleShape:"square",removeBendOnShiftClickEnabled:!1,selectionColor:Constants.EDGE_SELECTION_COLOR,selectionDashed:Constants.EDGE_SELECTION_DASHED,selectionStrokeWidth:Constants.EDGE_SELECTION_STROKEWIDTH,virtualBendOpacity:20,virtualBendsEnabled:!1},defaultEdgeHandlerConfig={...EdgeHandlerConfig},resetEdgeHandlerConfig=()=>{(0,cloneUtils.shallowCopy)(defaultEdgeHandlerConfig,EdgeHandlerConfig)},HandleConfig={fillColor:Constants.HANDLE_FILLCOLOR,labelFillColor:Constants.LABEL_HANDLE_FILLCOLOR,labelSize:Constants.LABEL_HANDLE_SIZE,size:Constants.HANDLE_SIZE,strokeColor:Constants.HANDLE_STROKECOLOR},defaultHandleConfig={...HandleConfig},resetHandleConfig=()=>{(0,cloneUtils.shallowCopy)(defaultHandleConfig,HandleConfig)},VertexHandlerConfig={rotationEnabled:!1,selectionColor:Constants.VERTEX_SELECTION_COLOR,selectionStrokeWidth:Constants.VERTEX_SELECTION_STROKEWIDTH,selectionDashed:Constants.VERTEX_SELECTION_DASHED},defaultVertexHandlerConfig={...VertexHandlerConfig},resetVertexHandlerConfig=()=>{(0,cloneUtils.shallowCopy)(defaultVertexHandlerConfig,VertexHandlerConfig)};class EdgeHandler{constructor(t){if(this.error=null,this.bends=[],this.cloneEnabled=!0,this.dblClickRemoveEnabled=!1,this.mergeRemoveEnabled=!1,this.straightRemoveEnabled=!1,this.parentHighlightEnabled=!1,this.preferHtml=!1,this.allowHandleBoundsCheck=!0,this.snapToTerminals=!1,this.handleImage=null,this.labelHandleImage=null,this.tolerance=0,this.outlineConnect=!1,this.manageLabelHandle=!1,this.currentPoint=null,this.parentHighlight=null,this.index=null,this.isSource=!1,this.isTarget=!1,this.isLabel=!1,this.points=[],this.snapPoint=null,this.abspoints=[],this.startX=0,this.startY=0,this.outline=!0,this.active=!0,this.state=t,this.graph=this.state.view.graph,this.marker=this.createMarker(),this.constraintHandler=new handler_ConstraintHandler(this.graph),this.points=[],this.abspoints=this.getSelectionPoints(this.state),this.shape=this.createSelectionShape(this.abspoints),this.shape.dialect=this.graph.dialect!==Constants.DIALECT.SVG?Constants.DIALECT.MIXEDHTML:Constants.DIALECT.SVG,this.shape.init(this.graph.getView().getOverlayPane()),this.shape.pointerEvents=!1,this.shape.setCursor(Constants.CURSOR.MOVABLE_EDGE),InternalEvent.default.redirectMouseEvents(this.shape.node,this.graph,this.state),this.preferHtml=null!=this.state.text&&this.state.text.node.parentNode===this.graph.container,!this.preferHtml){const t=this.state.getVisibleTerminalState(!0);if(null!=t&&(this.preferHtml=null!=t.text&&t.text.node.parentNode===this.graph.container),!this.preferHtml){const t=this.state.getVisibleTerminalState(!1);null!=t&&(this.preferHtml=null!=t.text&&t.text.node.parentNode===this.graph.container)}}const e=this.graph.getPlugin("SelectionHandler");e&&(this.graph.getSelectionCount()<e.maxCells||e.maxCells<=0)&&(this.bends=this.createBends(),this.isVirtualBendsEnabled()&&(this.virtualBends=this.createVirtualBends())),this.label=new Point.default(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape=this.createLabelHandleShape(),this.initBend(this.labelShape),this.labelShape.setCursor(Constants.CURSOR.LABEL_HANDLE),this.customHandles=this.createCustomHandles(),this.updateParentHighlight(),this.redraw(),this.escapeHandler=(e,i)=>{const s=null!=this.index;this.reset(),s&&this.graph.cellRenderer.redraw(this.state,!1,t.view.isRendering())},this.state.view.graph.addListener(InternalEvent.default.ESCAPE,this.escapeHandler)}isParentHighlightVisible(){const t=this.state.cell.getParent();return t?!this.graph.isCellSelected(t):null}updateParentHighlight(){if(!this.isDestroyed()){const t=this.isParentHighlightVisible(),e=this.state.cell.getParent(),i=e?this.graph.view.getState(e):null;if(this.parentHighlight)if(e&&e.isVertex()&&t){const t=this.parentHighlight.bounds;i&&t&&(t.x!==i.x||t.y!==i.y||t.width!==i.width||t.height!==i.height)&&(this.parentHighlight.bounds=Rectangle.default.fromRectangle(i),this.parentHighlight.redraw())}else i&&i.parentHighlight===this.parentHighlight&&(i.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null;else this.parentHighlightEnabled&&t&&e&&e.isVertex()&&i&&!i.parentHighlight&&(this.parentHighlight=this.createParentHighlightShape(i),this.parentHighlight.dialect=Constants.DIALECT.SVG,this.parentHighlight.pointerEvents=!1,i.style.rotation&&(this.parentHighlight.rotation=i.style.rotation),this.parentHighlight.init(this.graph.getView().getOverlayPane()),this.parentHighlight.redraw(),i.parentHighlight=this.parentHighlight)}}createCustomHandles(){return[]}isVirtualBendsEnabled(t){return EdgeHandlerConfig.virtualBendsEnabled&&(null==this.state.style.edgeStyle||this.state.style.edgeStyle===Constants.NONE||this.state.style.noEdgeStyle)&&"arrow"!==this.state.style.shape}isCellEnabled(t){return!0}isAddPointEvent(t){return(0,EventUtils.isShiftDown)(t)}isRemovePointEvent(t){return(0,EventUtils.isShiftDown)(t)}getSelectionPoints(t){return t.absolutePoints}createParentHighlightShape(t){const e=new RectangleShape.default(Rectangle.default.fromRectangle(t),Constants.NONE,this.getSelectionColor());return e.strokeWidth=this.getSelectionStrokeWidth(),e.isDashed=this.isSelectionDashed(),e}createSelectionShape(t){const e=new(0,this.state.shape.constructor);return e.outline=!0,e.apply(this.state),e.isDashed=this.isSelectionDashed(),e.stroke=this.getSelectionColor(),e.isShadow=!1,e}getSelectionColor(){return EdgeHandlerConfig.selectionColor}getSelectionStrokeWidth(){return EdgeHandlerConfig.selectionStrokeWidth}isSelectionDashed(){return EdgeHandlerConfig.selectionDashed}isConnectableCell(t){return!0}getCellAt(t,e){return this.outlineConnect?null:this.graph.getCellAt(t,e)}createMarker(){return new EdgeHandlerCellMarker(this.graph,this)}validateConnection(t,e){return this.graph.getEdgeValidationError(this.state.cell,t,e)}createBends(){const{cell:t}=this.state,e=[];for(let i=0;i<this.abspoints.length;i+=1)if(this.isHandleVisible(i)){const s=0===i,n=i===this.abspoints.length-1,l=s||n;(l||this.graph.isCellBendable(t))&&(t=>{const s=this.createHandleShape(t);this.initBend(s,(()=>{this.dblClickRemoveEnabled&&this.removePoint(this.state,t)})),this.isHandleEnabled(i)&&s.setCursor(l?Constants.CURSOR.TERMINAL_HANDLE:Constants.CURSOR.BEND_HANDLE),e.push(s),l||(this.points.push(new Point.default(0,0)),s.node.style.visibility="hidden")})(i)}return e}createVirtualBends(){const{cell:t}=this.state,e=(this.abspoints[0],[]);if(this.graph.isCellBendable(t))for(let t=1;t<this.abspoints.length;t+=1)(t=>{this.initBend(t),t.setCursor(Constants.CURSOR.VIRTUAL_BEND_HANDLE),e.push(t)})(this.createHandleShape());return e}isHandleEnabled(t){return!0}isHandleVisible(t){const e=this.state.getVisibleTerminalState(!0),i=this.state.getVisibleTerminalState(!1),s=this.state.cell.getGeometry();return(s?this.graph.view.getEdgeStyle(this.state,s.points||void 0,e,i):null)!==style_EdgeStyle.EntityRelation||0===t||t===this.abspoints.length-1}createHandleShape(t){if(this.handleImage){const t=new ImageShape.default(new Rectangle.default(0,0,this.handleImage.width,this.handleImage.height),this.handleImage.src);return t.preserveImageAspect=!1,t}let e=HandleConfig.size;return this.preferHtml&&(e-=1),new("circle"===EdgeHandlerConfig.handleShape?node_EllipseShape:RectangleShape.default)(new Rectangle.default(0,0,e,e),HandleConfig.fillColor,HandleConfig.strokeColor)}createLabelHandleShape(){if(this.labelHandleImage){const t=new ImageShape.default(new Rectangle.default(0,0,this.labelHandleImage.width,this.labelHandleImage.height),this.labelHandleImage.src);return t.preserveImageAspect=!1,t}const t=HandleConfig.labelSize;return new RectangleShape.default(new Rectangle.default(0,0,t,t),HandleConfig.labelFillColor,HandleConfig.strokeColor)}initBend(t,e){this.preferHtml?(t.dialect=Constants.DIALECT.STRICTHTML,t.init(this.graph.container)):(t.dialect=this.graph.dialect!==Constants.DIALECT.SVG?Constants.DIALECT.MIXEDHTML:Constants.DIALECT.SVG,t.init(this.graph.getView().getOverlayPane())),InternalEvent.default.redirectMouseEvents(t.node,this.graph,this.state,null,null,null,e),Client.default.IS_TOUCH&&t.node.setAttribute("pointer-events","none")}getHandleForEvent(t){let e=null;const i=(0,EventUtils.isMouseEvent)(t.getEvent())?1:this.tolerance,s=this.allowHandleBoundsCheck&&i>0?new Rectangle.default(t.getGraphX()-i,t.getGraphY()-i,2*i,2*i):null;let n=Number.POSITIVE_INFINITY;function l(e){if(e&&e.bounds&&e.node&&"none"!==e.node.style.display&&"hidden"!==e.node.style.visibility&&(t.isSource(e)||s&&(0,mathUtils.intersects)(e.bounds,s))){const i=t.getGraphX()-e.bounds.getCenterX(),s=t.getGraphY()-e.bounds.getCenterY(),l=i*i+s*s;if(l<=n)return n=l,!0}return!1}if(this.isCustomHandleEvent(t)&&this.customHandles)for(let t=this.customHandles.length-1;t>=0;t--)if(l(this.customHandles[t].shape))return InternalEvent.default.CUSTOM_HANDLE-t;(t.isSource(this.state.text)||l(this.labelShape))&&(e=InternalEvent.default.LABEL_HANDLE);for(let t=0;t<this.bends.length;t+=1)l(this.bends[t])&&(e=t);if(this.virtualBends&&this.isAddVirtualBendEvent(t))for(let t=0;t<this.virtualBends.length;t+=1)l(this.virtualBends[t])&&(e=InternalEvent.default.VIRTUAL_HANDLE-t);return e}isAddVirtualBendEvent(t){return!0}isCustomHandleEvent(t){return!0}mouseDown(t,e){const i=this.getHandleForEvent(e);if(null!==i&&this.bends[i]){const t=this.bends[i].bounds;t&&(this.snapPoint=new Point.default(t.getCenterX(),t.getCenterY()))}if(EdgeHandlerConfig.addBendOnShiftClickEnabled&&null===i&&this.isAddPointEvent(e.getEvent()))this.addPoint(this.state,e.getEvent()),e.consume();else if(null!==i&&!e.isConsumed()&&this.graph.isEnabled()){const t=e.getCell();EdgeHandlerConfig.removeBendOnShiftClickEnabled&&this.isRemovePointEvent(e.getEvent())?this.removePoint(this.state,i):(i!==InternalEvent.default.LABEL_HANDLE||t&&this.graph.isLabelMovable(t))&&(this.virtualBends&&i<=InternalEvent.default.VIRTUAL_HANDLE&&(0,styleUtils.setOpacity)(this.virtualBends[InternalEvent.default.VIRTUAL_HANDLE-i].node,100),this.start(e.getX(),e.getY(),i)),e.consume()}}start(t,e,i){if(this.startX=t,this.startY=e,this.isSource=0!==this.bends.length&&0===i,this.isTarget=0!==this.bends.length&&i===this.bends.length-1,this.isLabel=i===InternalEvent.default.LABEL_HANDLE,this.isSource||this.isTarget){const{cell:t}=this.state,e=t.getTerminal(this.isSource);(null==e&&this.graph.isTerminalPointMovable(t,this.isSource)||null!=e&&this.graph.isCellDisconnectable(t,e,this.isSource))&&(this.index=i)}else this.index=i;if(null!==this.index&&this.index<=InternalEvent.default.CUSTOM_HANDLE&&this.index>InternalEvent.default.VIRTUAL_HANDLE&&null!=this.customHandles)for(let t=0;t<this.customHandles.length;t+=1)t!==InternalEvent.default.CUSTOM_HANDLE-this.index&&this.customHandles[t].setVisible(!1)}clonePreviewState(t,e){return this.state.clone()}getSnapToTerminalTolerance(){return this.graph.getGridSize()*this.graph.getView().scale/2}updateHint(t,e){}removeHint(){}roundLength(t){return Math.round(t)}isSnapToTerminalsEvent(t){return this.snapToTerminals&&!(0,EventUtils.isAltDown)(t.getEvent())}getPointForEvent(t){const e=this.graph.getView(),{scale:i}=e,s=new Point.default(this.roundLength(t.getGraphX()/i)*i,this.roundLength(t.getGraphY()/i)*i),n=this.getSnapToTerminalTolerance();let l=!1,a=!1;if(n>0&&this.isSnapToTerminalsEvent(t)){const t=t=>{if(t){const{x:e}=t;Math.abs(s.x-e)<n&&(s.x=e,l=!0);const{y:i}=t;Math.abs(s.y-i)<n&&(s.y=i,a=!0)}},i=i=>{i&&t(new Point.default(e.getRoutingCenterX(i),e.getRoutingCenterY(i)))};i(this.state.getVisibleTerminalState(!0)),i(this.state.getVisibleTerminalState(!1));for(let e=0;e<this.state.absolutePoints.length;e+=1)t(this.state.absolutePoints[e])}if(this.graph.isGridEnabledEvent(t.getEvent())){const t=e.translate;l||(s.x=(this.graph.snap(s.x/i-t.x)+t.x)*i),a||(s.y=(this.graph.snap(s.y/i-t.y)+t.y)*i)}return s}getPreviewTerminalState(t){if(this.constraintHandler.update(t,this.isSource,!0,t.isSource(this.marker.highlight.shape)?null:this.currentPoint),this.constraintHandler.currentFocus&&this.constraintHandler.currentConstraint){this.marker.highlight&&this.marker.highlight.shape&&this.marker.highlight.state&&this.marker.highlight.state.cell===this.constraintHandler.currentFocus.cell?"transparent"!==this.marker.highlight.shape.stroke&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent");const t=this.graph.view.getTerminalPort(this.state,this.graph.view.getState(this.state.cell.getTerminal(!this.isSource)),!this.isSource),e=t?t.cell:null,i=this.isSource?this.constraintHandler.currentFocus.cell:e,s=this.isSource?e:this.constraintHandler.currentFocus.cell;this.error=this.validateConnection(i,s);let n=null;return null===this.error&&(n=this.constraintHandler.currentFocus),(null!==this.error||n&&!this.isCellEnabled(n.cell))&&this.constraintHandler.reset(),n}if(!this.graph.isIgnoreTerminalEvent(t.getEvent())){this.marker.process(t);const e=this.marker.getValidState();return e&&!this.isCellEnabled(e.cell)&&(this.constraintHandler.reset(),this.marker.reset()),this.marker.getValidState()}return this.marker.reset(),null}getPreviewPoints(t,e){const i=this.state.cell.getGeometry();if(!i)return null;let s=(i.points||[]).slice();const n=new Point.default(t.x,t.y);let l=null;if(this.isSource||this.isTarget||null===this.index)this.graph.isResetEdgesOnConnect()&&(s=[]);else{if(this.convertPoint(n,!1),this.index<=InternalEvent.default.VIRTUAL_HANDLE&&s.splice(InternalEvent.default.VIRTUAL_HANDLE-this.index,0,n),!this.isSource&&!this.isTarget){for(let e=0;e<this.bends.length;e+=1)if(e!==this.index){const i=this.bends[e];i&&(0,mathUtils.contains)(i.bounds,t.x,t.y)&&(this.index<=InternalEvent.default.VIRTUAL_HANDLE?s.splice(InternalEvent.default.VIRTUAL_HANDLE-this.index,1):s.splice(this.index-1,1),l=s)}if(!l&&this.straightRemoveEnabled&&(!e||!(0,EventUtils.isAltDown)(e.getEvent()))){const e=this.graph.getEventTolerance()*this.graph.getEventTolerance(),i=this.state.absolutePoints.slice();i[this.index]=t;const n=this.state.getVisibleTerminalState(!0);if(null!=n){const t=this.graph.getConnectionConstraint(this.state,n,!0);null!=t&&null!=this.graph.getConnectionPoint(n,t)||(i[0]=new Point.default(n.view.getRoutingCenterX(n),n.view.getRoutingCenterY(n)))}const o=this.state.getVisibleTerminalState(!1);if(null!=o){const t=this.graph.getConnectionConstraint(this.state,o,!1);null!=t&&null!=this.graph.getConnectionPoint(o,t)||(i[i.length-1]=new Point.default(o.view.getRoutingCenterX(o),o.view.getRoutingCenterY(o)))}a=this.index,r=t,a>0&&a<i.length-1&&(0,mathUtils.ptSegDistSq)(i[a-1].x,i[a-1].y,i[a+1].x,i[a+1].y,r.x,r.y)<e&&(s.splice(a-1,1),l=s)}}null==l&&this.index>InternalEvent.default.VIRTUAL_HANDLE&&(s[this.index-1]=n)}var a,r;return null!=l?l:s}isOutlineConnectEvent(t){if(!this.currentPoint)return!1;const e=(0,styleUtils.getOffset)(this.graph.container),i=t.getEvent(),s=(0,EventUtils.getClientX)(i),n=(0,EventUtils.getClientY)(i),l=document.documentElement,a=(window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),r=(window.pageYOffset||l.scrollTop)-(l.clientTop||0),o=this.currentPoint.x-this.graph.container.scrollLeft+e.x-a,h=this.currentPoint.y-this.graph.container.scrollTop+e.y-r;return this.outlineConnect&&!(0,EventUtils.isShiftDown)(t.getEvent())&&(t.isSource(this.marker.highlight.shape)||(0,EventUtils.isAltDown)(t.getEvent())&&null!=t.getState()||this.marker.highlight.isHighlightAt(s,n)||(o!==s||h!==n)&&null==t.getState()&&this.marker.highlight.isHighlightAt(o,h))}updatePreviewState(t,e,i,s,n=!1){const l=this.isSource?i:this.state.getVisibleTerminalState(!0),a=this.isTarget?i:this.state.getVisibleTerminalState(!1);let r=this.graph.getConnectionConstraint(t,l,!0),o=this.graph.getConnectionConstraint(t,a,!1),h=this.constraintHandler.currentConstraint;if(null==h&&n&&(null!=i?(s.isSource(this.marker.highlight.shape)&&(e=new Point.default(s.getGraphX(),s.getGraphY())),h=this.graph.getOutlineConstraint(e,i,s),this.constraintHandler.setFocus(s,i,this.isSource),this.constraintHandler.currentConstraint=h,this.constraintHandler.currentPoint=e):h=new other_ConnectionConstraint(null)),this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape){const t=this.graph.view.scale;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus)this.marker.highlight.shape.stroke=n?Constants.OUTLINE_HIGHLIGHT_COLOR:"transparent",this.marker.highlight.shape.strokeWidth=Constants.OUTLINE_HIGHLIGHT_STROKEWIDTH/t/t,this.marker.highlight.repaint();else if(this.marker.hasValidState()){const e=s.getCell();this.marker.highlight.shape.stroke=e&&e.isConnectable()&&this.marker.getValidState()!==s.getState()?"transparent":Constants.DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokeWidth=Constants.HIGHLIGHT_STROKEWIDTH/t/t,this.marker.highlight.repaint()}}this.isSource?r=h:this.isTarget&&(o=h),(this.isSource||this.isTarget)&&(null!=h&&null!=h.point?(t.style[this.isSource?"exitX":"entryX"]=h.point.x,t.style[this.isSource?"exitY":"entryY"]=h.point.y):(delete t.style[this.isSource?"exitX":"entryX"],delete t.style[this.isSource?"exitY":"entryY"])),t.setVisibleTerminalState(l,!0),t.setVisibleTerminalState(a,!1),this.isSource&&null==l||t.view.updateFixedTerminalPoint(t,l,!0,r),this.isTarget&&null==a||t.view.updateFixedTerminalPoint(t,a,!1,o),(this.isSource||this.isTarget)&&null==i&&(t.setAbsoluteTerminalPoint(e,this.isSource),null==this.marker.getMarkedState()&&(this.error=this.graph.isAllowDanglingEdges()?null:"")),t.view.updatePoints(t,this.points,l,a),t.view.updateFloatingTerminalPoints(t,l,a)}mouseMove(t,e){if(null!=this.index&&null!=this.marker){if(this.currentPoint=this.getPointForEvent(e),this.error=null,!this.graph.isIgnoreTerminalEvent(e.getEvent())&&(0,EventUtils.isShiftDown)(e.getEvent())&&null!=this.snapPoint&&(Math.abs(this.snapPoint.x-this.currentPoint.x)<Math.abs(this.snapPoint.y-this.currentPoint.y)?this.currentPoint.x=this.snapPoint.x:this.currentPoint.y=this.snapPoint.y),this.index<=InternalEvent.default.CUSTOM_HANDLE&&this.index>InternalEvent.default.VIRTUAL_HANDLE)null!=this.customHandles&&(this.customHandles[InternalEvent.default.CUSTOM_HANDLE-this.index].processEvent(e),this.customHandles[InternalEvent.default.CUSTOM_HANDLE-this.index].positionChanged(),null!=this.shape&&null!=this.shape.node&&(this.shape.node.style.display="none"));else if(this.isLabel&&this.label)this.label.x=this.currentPoint.x,this.label.y=this.currentPoint.y;else{this.points=this.getPreviewPoints(this.currentPoint,e);let t=this.isSource||this.isTarget?this.getPreviewTerminalState(e):null;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentPoint?this.currentPoint=this.constraintHandler.currentPoint.clone():this.outlineConnect&&((this.isSource||this.isTarget)&&this.isOutlineConnectEvent(e)?t=this.marker.highlight.state:null!=t&&t!==e.getState()&&e.getCell()?.isConnectable()&&null!=this.marker.highlight.shape&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint(),t=null)),null==t||this.isCellEnabled(t.cell)||(t=null,this.marker.reset()),this.currentPoint){const i=this.clonePreviewState(this.currentPoint,null!=t?t.cell:null);this.updatePreviewState(i,this.currentPoint,t,e,this.outline);const s=null==this.error?this.marker.validColor:this.marker.invalidColor;this.setPreviewColor(s),this.abspoints=i.absolutePoints,this.active=!0,this.updateHint(e,this.currentPoint)}}this.drawPreview(),InternalEvent.default.consume(e.getEvent()),e.consume()}}mouseUp(t,e){if(null!=this.index&&null!=this.marker){null!=this.shape&&null!=this.shape.node&&(this.shape.node.style.display="");let t=this.state.cell;const{index:i}=this;if(this.index=null,e.getX()!==this.startX||e.getY()!==this.startY){const s=!this.graph.isIgnoreTerminalEvent(e.getEvent())&&this.graph.isCloneEvent(e.getEvent())&&this.cloneEnabled&&this.graph.isCellsCloneable();if(null!=this.error)this.error.length>0&&this.graph.validationAlert(this.error);else if(i<=InternalEvent.default.CUSTOM_HANDLE&&i>InternalEvent.default.VIRTUAL_HANDLE){if(null!=this.customHandles){const t=this.graph.getDataModel();t.beginUpdate();try{this.customHandles[InternalEvent.default.CUSTOM_HANDLE-i].execute(e),null!=this.shape&&null!=this.shape.node&&(this.shape.apply(this.state),this.shape.redraw())}finally{t.endUpdate()}}}else if(this.isLabel&&this.label)this.moveLabel(this.state,this.label.x,this.label.y);else if(this.isSource||this.isTarget){let i=null;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus&&(i=this.constraintHandler.currentFocus.cell),!i&&this.marker.hasValidState()&&null!=this.marker.highlight&&null!=this.marker.highlight.shape&&"transparent"!==this.marker.highlight.shape.stroke&&"white"!==this.marker.highlight.shape.stroke&&(i=this.marker.validState.cell),i){const n=this.graph.getDataModel(),l=t.getParent();n.beginUpdate();try{if(s){let e=t.getGeometry();const i=this.graph.cloneCell(t);n.add(l,i,l.getChildCount()),null!=e&&(e=e.clone(),n.setGeometry(i,e));const s=t.getTerminal(!this.isSource);this.graph.connectCell(i,s,!this.isSource),t=i}t=this.connect(t,i,this.isSource,s,e)}finally{n.endUpdate()}}else if(this.graph.isAllowDanglingEdges()){const e=this.abspoints[this.isSource?0:this.abspoints.length-1];e.x=this.roundLength(e.x/this.graph.view.scale-this.graph.view.translate.x),e.y=this.roundLength(e.y/this.graph.view.scale-this.graph.view.translate.y);const i=t.getParent(),n=i?this.graph.getView().getState(i):null;null!=n&&(e.x-=n.origin.x,e.y-=n.origin.y),e.x-=this.graph.getPanDx()/this.graph.view.scale,e.y-=this.graph.getPanDy()/this.graph.view.scale,t=this.changeTerminalPoint(t,e,this.isSource,s)}}else this.active?t=this.changePoints(t,this.points,s):(this.graph.getView().invalidate(this.state.cell),this.graph.getView().validate(this.state.cell))}else this.graph.isToggleEvent(e.getEvent())&&this.graph.selectCellForEvent(this.state.cell,e.getEvent());null!=this.marker&&(this.reset(),t!==this.state.cell&&this.graph.setSelectionCell(t)),e.consume()}}reset(){if(this.active&&this.refresh(),this.error=null,this.index=null,this.points=[],this.snapPoint=null,this.isLabel=!1,this.isSource=!1,this.isTarget=!1,this.active=!1,this.marker&&this.marker.reset(),this.constraintHandler.reset(),this.customHandles)for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].reset();this.setPreviewColor(EdgeHandlerConfig.selectionColor),this.removeHint(),this.redraw()}setPreviewColor(t){this.shape.stroke=t}convertPoint(t,e){const i=this.graph.getView().getScale(),s=this.graph.getView().getTranslate();e&&(t.x=this.graph.snap(t.x),t.y=this.graph.snap(t.y)),t.x=Math.round(t.x/i-s.x),t.y=Math.round(t.y/i-s.y);const n=this.state.cell.getParent(),l=n?this.graph.getView().getState(n):n;return l&&(t.x-=l.origin.x,t.y-=l.origin.y),t}moveLabel(t,e,i){const s=this.graph.getDataModel();let n=t.cell.getGeometry();if(null!=n){const{scale:l}=this.graph.getView();if(n=n.clone(),n.relative){let s=this.graph.getView().getRelativePoint(t,e,i);n.x=Math.round(1e4*s.x)/1e4,n.y=Math.round(s.y),n.offset=new Point.default(0,0),s=this.graph.view.getPoint(t,n),n.offset=new Point.default(Math.round((e-s.x)/l),Math.round((i-s.y)/l))}else{const s=t.absolutePoints,a=s[0],r=s[s.length-1];if(null!=a&&null!=r){const t=a.x+(r.x-a.x)/2,s=a.y+(r.y-a.y)/2;n.offset=new Point.default(Math.round((e-t)/l),Math.round((i-s)/l)),n.x=0,n.y=0}}s.setGeometry(t.cell,n)}}connect(t,e,i,s,n){return t.getParent(),this.graph.batchUpdate((()=>{let s=this.constraintHandler.currentConstraint;null==s&&(s=new other_ConnectionConstraint(null)),this.graph.connectCell(t,e,i,s)})),t}changeTerminalPoint(t,e,i,s){const n=this.graph.getDataModel();return n.batchUpdate((()=>{if(s){const e=t.getParent(),s=t.getTerminal(!i);t=this.graph.cloneCell(t),n.add(e,t,e.getChildCount()),n.setTerminal(t,s,!i)}let l=t.getGeometry();null!=l&&(l=l.clone(),l.setTerminalPoint(e,i),n.setGeometry(t,l),this.graph.connectCell(t,null,i,new other_ConnectionConstraint(null)))})),t}changePoints(t,e,i){const s=this.graph.getDataModel();return s.batchUpdate((()=>{if(i){const e=t.getParent(),i=t.getTerminal(!0),n=t.getTerminal(!1);t=this.graph.cloneCell(t),s.add(e,t,e.getChildCount()),s.setTerminal(t,i,!0),s.setTerminal(t,n,!1)}let n=t.getGeometry();null!=n&&(n=n.clone(),n.points=e,s.setGeometry(t,n))})),t}addPoint(t,e){const i=(0,styleUtils.convertPoint)(this.graph.container,(0,EventUtils.getClientX)(e),(0,EventUtils.getClientY)(e)),s=this.graph.isGridEnabledEvent(e);this.convertPoint(i,s),this.addPointAt(t,i.x,i.y),InternalEvent.default.consume(e)}addPointAt(t,e,i){let s=t.cell.getGeometry();const n=new Point.default(e,i);if(null!=s){s=s.clone();const e=this.graph.view.translate,i=this.graph.view.scale;let l=new Point.default(e.x*i,e.y*i);const a=this.state.cell.getParent();if(a&&a.isVertex()){const t=this.graph.view.getState(a);t&&(l=new Point.default(t.x,t.y))}const r=(0,mathUtils.findNearestSegment)(t,n.x*i+l.x,n.y*i+l.y);null==s.points?s.points=[n]:s.points.splice(r,0,n),this.graph.getDataModel().setGeometry(t.cell,s),this.refresh(),this.redraw()}}removePoint(t,e){if(e>0&&e<this.abspoints.length-1){let i=this.state.cell.getGeometry();null!=i&&null!=i.points&&(i=i.clone(),(i.points||[]).splice(e-1,1),this.graph.getDataModel().setGeometry(t.cell,i),this.refresh(),this.redraw())}}getHandleFillColor(t){const e=0===t,{cell:i}=this.state,s=i.getTerminal(e);let n=HandleConfig.fillColor;return null!=s&&!this.graph.isCellDisconnectable(i,s,e)||null==s&&!this.graph.isTerminalPointMovable(i,e)?n=Constants.LOCKED_HANDLE_FILLCOLOR:null!=s&&this.graph.isCellDisconnectable(i,s,e)&&(n=EdgeHandlerConfig.connectFillColor),n}redraw(t){this.abspoints=this.state.absolutePoints.slice();const e=this.state.cell.getGeometry();if(e){const t=e.points;if(null!=this.bends&&this.bends.length>0&&null!=t){null==this.points&&(this.points=[]);for(let e=1;e<this.bends.length-1;e+=1)null!=this.bends[e]&&null!=this.abspoints[e]&&(this.points[e-1]=t[e-1])}}this.drawPreview(),t||this.redrawHandles()}redrawHandles(){const{cell:t}=this.state;let e=this.labelShape.bounds;this.label=new Point.default(this.state.absoluteOffset.x,this.state.absoluteOffset.y),this.labelShape.bounds=new Rectangle.default(Math.round(this.label.x-e.width/2),Math.round(this.label.y-e.height/2),e.width,e.height);const i=this.graph.getLabel(t);if(this.labelShape.visible=null!=i&&i.length>0&&this.graph.isLabelMovable(t),null!=this.bends&&this.bends.length>0){const t=this.abspoints.length-1,i=this.abspoints[0],s=i.x,n=i.y;e=this.bends[0].bounds,this.bends[0].bounds=new Rectangle.default(Math.floor(s-e.width/2),Math.floor(n-e.height/2),e.width,e.height),this.bends[0].fill=this.getHandleFillColor(0),this.bends[0].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[0].bounds);const l=this.abspoints[t],a=l.x,r=l.y,o=this.bends.length-1;e=this.bends[o].bounds,this.bends[o].bounds=new Rectangle.default(Math.floor(a-e.width/2),Math.floor(r-e.height/2),e.width,e.height),this.bends[o].fill=this.getHandleFillColor(o),this.bends[o].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[o].bounds),this.redrawInnerBends(i,l)}if(this.virtualBends&&this.virtualBends.length>0){let t=this.abspoints[0];for(let e=0;e<this.virtualBends.length;e+=1)if(null!=this.virtualBends[e]&&null!=this.abspoints[e+1]){const i=this.abspoints[e+1],s=this.virtualBends[e],n=t.x+(i.x-t.x)/2,l=t.y+(i.y-t.y)/2;s.bounds&&(s.bounds=new Rectangle.default(Math.floor(n-s.bounds.width/2),Math.floor(l-s.bounds.height/2),s.bounds.width,s.bounds.height),s.redraw()),(0,styleUtils.setOpacity)(s.node,EdgeHandlerConfig.virtualBendOpacity),t=i,this.manageLabelHandle&&this.checkLabelHandle(s.bounds)}}if(this.labelShape.redraw(),this.customHandles)for(let t=0;t<this.customHandles.length;t+=1){const e=this.customHandles[t].shape;if(e){const i=e.node.style.display;this.customHandles[t].redraw(),e.node.style.display=i,e.node.style.visibility=this.isCustomHandleVisible(this.customHandles[t])?"":"hidden"}}}isCustomHandleVisible(t){return!this.graph.isEditing()&&1===this.state.view.graph.getSelectionCount()}setHandlesVisible(t){for(let e=0;e<this.bends.length;e+=1)this.bends[e].node.style.display=t?"":"none";if(this.virtualBends)for(let e=0;e<this.virtualBends.length;e+=1)this.virtualBends[e].node.style.display=t?"":"none";if(this.labelShape.node.style.display=t?"":"none",this.customHandles)for(let e=0;e<this.customHandles.length;e+=1)this.customHandles[e].setVisible(t)}redrawInnerBends(t,e){for(let t=1;t<this.bends.length-1;t+=1)if(null!=this.bends[t])if(null!=this.abspoints[t]){const{x:e}=this.abspoints[t],{y:i}=this.abspoints[t],s=this.bends[t].bounds;if(this.bends[t].node.style.visibility="visible",this.bends[t].bounds=new Rectangle.default(Math.round(e-s.width/2),Math.round(i-s.height/2),s.width,s.height),this.manageLabelHandle)this.checkLabelHandle(this.bends[t].bounds);else if(null==this.handleImage&&this.labelShape.visible&&(0,mathUtils.intersects)(this.bends[t].bounds,this.labelShape.bounds)){const s=HandleConfig.size+3,n=s;this.bends[t].bounds=new Rectangle.default(Math.round(e-s/2),Math.round(i-n/2),s,n)}this.bends[t].redraw()}else this.bends[t].destroy()}checkLabelHandle(t){const e=this.labelShape.bounds;(0,mathUtils.intersects)(t,e)&&(t.getCenterY()<e.getCenterY()?e.y=t.y+t.height:e.y=t.y-e.height)}drawPreview(){try{if(this.isLabel){const t=this.labelShape.bounds,e=new Rectangle.default(Math.round(this.label.x-t.width/2),Math.round(this.label.y-t.height/2),t.width,t.height);t.equals(e)||(this.labelShape.bounds=e,this.labelShape.redraw())}null==this.shape||(0,arrayUtils.equalPoints)(this.shape.points,this.abspoints)||(this.shape.apply(this.state),this.shape.points=this.abspoints.slice(),this.shape.scale=this.state.view.scale,this.shape.isDashed=this.isSelectionDashed(),this.shape.stroke=this.getSelectionColor(),this.shape.strokeWidth=this.getSelectionStrokeWidth()/this.shape.scale/this.shape.scale,this.shape.isShadow=!1,this.shape.redraw()),this.updateParentHighlight()}catch(t){}}refresh(){null!=this.state&&(this.abspoints=this.getSelectionPoints(this.state),this.points=[],this.destroyBends(this.bends),this.bends=this.createBends(),this.virtualBends&&(this.destroyBends(this.virtualBends),this.virtualBends=this.createVirtualBends()),this.customHandles&&(this.destroyBends(this.customHandles),this.customHandles=this.createCustomHandles()),null!=this.labelShape&&null!=this.labelShape.node&&null!=this.labelShape.node.parentNode&&this.labelShape.node.parentNode.appendChild(this.labelShape.node))}isDestroyed(){return null==this.shape}destroyBends(t){if(null!=t)for(let e=0;e<t.length;e+=1)null!=t[e]&&t[e].destroy()}onDestroy(){if(this.state.view.graph.removeListener(this.escapeHandler),this.marker.destroy(),this.marker=null,this.shape.destroy(),this.shape=null,this.parentHighlight){const t=this.state.cell.getParent(),e=t?this.graph.view.getState(t):null;e&&e.parentHighlight===this.parentHighlight&&(e.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null}this.labelShape.destroy(),this.labelShape=null,this.constraintHandler.onDestroy(),this.constraintHandler=null,this.virtualBends&&(this.destroyBends(this.virtualBends),this.virtualBends=[]),this.customHandles&&(this.destroyBends(this.customHandles),this.customHandles=[]),this.destroyBends(this.bends),this.bends=[],this.removeHint()}}class EdgeHandlerCellMarker extends cell_CellMarker{constructor(t,e,i=Constants.DEFAULT_VALID_COLOR,s=Constants.DEFAULT_INVALID_COLOR,n=Constants.DEFAULT_HOTSPOT){super(t,i,s,n),this.getCell=t=>{let e=super.getCell(t);if(e!==this.edgeHandler.state.cell&&e||!this.edgeHandler.currentPoint||(e=this.edgeHandler.graph.getCellAt(this.edgeHandler.currentPoint.x,this.edgeHandler.currentPoint.y)),e&&!e.isConnectable()){const t=e.getParent();t&&t.isVertex()&&t.isConnectable()&&(e=t)}return e&&(this.graph.isSwimlane(e)&&this.edgeHandler.currentPoint&&this.graph.hitsSwimlaneContent(e,this.edgeHandler.currentPoint.x,this.edgeHandler.currentPoint.y)||!this.edgeHandler.isConnectableCell(e)||e===this.edgeHandler.state.cell||e&&!this.edgeHandler.graph.connectableEdges&&e.isEdge()||this.edgeHandler.state.cell.isAncestor(e))&&(e=null),e&&!e.isConnectable()&&(e=null),e},this.isValidState=t=>{const e=this.edgeHandler.state.cell.getTerminal(!this.edgeHandler.isSource),i=this.edgeHandler.graph.view.getState(e),s=this.edgeHandler.graph.view.getTerminalPort(t,i,!this.edgeHandler.isSource),n=s?s.cell:null,l=this.edgeHandler.isSource?t.cell:n,a=this.edgeHandler.isSource?n:t.cell;return this.edgeHandler.error=this.edgeHandler.validateConnection(l,a),!this.edgeHandler.error},this.edgeHandler=e}}const handler_EdgeHandler=EdgeHandler;class VertexHandler{isRotationEnabled(){return VertexHandlerConfig.rotationEnabled}constructor(t){this.sizers=[],this.singleSizer=!1,this.index=null,this.allowHandleBoundsCheck=!0,this.handleImage=null,this.handlesVisible=!0,this.tolerance=0,this.parentHighlightEnabled=!1,this.rotationRaster=!0,this.rotationCursor="crosshair",this.livePreview=!1,this.movePreviewToFront=!1,this.manageSizers=!1,this.constrainGroupByChildren=!1,this.rotationHandleVSpacing=-16,this.horizontalOffset=0,this.verticalOffset=0,this.minBounds=null,this.x0=0,this.y0=0,this.customHandles=[],this.inTolerance=!1,this.startX=0,this.startY=0,this.rotationShape=null,this.currentAlpha=null,this.startAngle=0,this.startDist=0,this.ghostPreview=null,this.livePreviewActive=!1,this.childOffsetX=0,this.childOffsetY=0,this.parentState=null,this.parentHighlight=null,this.unscaledBounds=null,this.preview=null,this.labelShape=null,this.edgeHandlers=[],this.EMPTY_POINT=new Point.default,this.state=t,this.graph=this.state.view.graph,this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new Rectangle.default(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.selectionBorder=this.createSelectionShape(this.bounds),this.selectionBorder.dialect=Constants.DIALECT.SVG,this.selectionBorder.pointerEvents=!1,this.selectionBorder.rotation=this.state.style.rotation??0,this.selectionBorder.init(this.graph.getView().getOverlayPane()),InternalEvent.default.redirectMouseEvents(this.selectionBorder.node,this.graph,this.state),this.graph.isCellMovable(this.state.cell)&&this.selectionBorder.setCursor(Constants.CURSOR.MOVABLE_VERTEX);const e=this.graph.getPlugin("SelectionHandler");if(e&&(e.maxCells<=0||this.graph.getSelectionCount()<e.maxCells)){const t=this.graph.isCellResizable(this.state.cell);if(this.sizers=[],t||this.graph.isLabelMovable(this.state.cell)&&this.state.width>=2&&this.state.height>=2){let e=0;t&&(this.singleSizer||(this.sizers.push(this.createSizer("nw-resize",e++)),this.sizers.push(this.createSizer("n-resize",e++)),this.sizers.push(this.createSizer("ne-resize",e++)),this.sizers.push(this.createSizer("w-resize",e++)),this.sizers.push(this.createSizer("e-resize",e++)),this.sizers.push(this.createSizer("sw-resize",e++)),this.sizers.push(this.createSizer("s-resize",e++))),this.sizers.push(this.createSizer("se-resize",e++)));const i=this.state.cell.getGeometry();null==i||i.relative||this.graph.isSwimlane(this.state.cell)||!this.graph.isLabelMovable(this.state.cell)||(this.labelShape=this.createSizer(Constants.CURSOR.LABEL_HANDLE,InternalEvent.default.LABEL_HANDLE,HandleConfig.labelSize,HandleConfig.labelFillColor),this.sizers.push(this.labelShape))}else this.graph.isCellMovable(this.state.cell)&&!this.graph.isCellResizable(this.state.cell)&&this.state.width<2&&this.state.height<2&&(this.labelShape=this.createSizer(Constants.CURSOR.MOVABLE_VERTEX,InternalEvent.default.LABEL_HANDLE,void 0,HandleConfig.labelFillColor),this.sizers.push(this.labelShape))}this.isRotationHandleVisible()&&(this.rotationShape=this.createSizer(this.rotationCursor,InternalEvent.default.ROTATION_HANDLE,HandleConfig.size+3,HandleConfig.fillColor),this.sizers.push(this.rotationShape)),this.customHandles=this.createCustomHandles(),this.redraw(),this.constrainGroupByChildren&&this.updateMinBounds(),this.escapeHandler=(t,e)=>{this.livePreview&&null!=this.index&&(this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate()),this.reset()},this.state.view.graph.addListener(InternalEvent.default.ESCAPE,this.escapeHandler)}isRotationHandleVisible(){const t=this.graph.getPlugin("SelectionHandler"),e=!t||t.maxCells<=0||this.graph.getSelectionCount()<t.maxCells;return this.graph.isEnabled()&&this.isRotationEnabled()&&this.graph.isCellRotatable(this.state.cell)&&e}isConstrainedEvent(t){return(0,EventUtils.isShiftDown)(t.getEvent())||"fixed"===this.state.style.aspect}isCenteredEvent(t,e){return!1}createCustomHandles(){return[]}updateMinBounds(){const t=this.graph.getChildCells(this.state.cell);if(t.length>0&&(this.minBounds=this.graph.view.getBounds(t),this.minBounds)){const t=this.state.view.scale,e=this.state.view.translate;this.minBounds.x-=this.state.x,this.minBounds.y-=this.state.y,this.minBounds.x/=t,this.minBounds.y/=t,this.minBounds.width/=t,this.minBounds.height/=t,this.x0=this.state.x/t-e.x,this.y0=this.state.y/t-e.y}}getSelectionBounds(t){return new Rectangle.default(Math.round(t.x),Math.round(t.y),Math.round(t.width),Math.round(t.height))}createParentHighlightShape(t){return this.createSelectionShape(t)}createSelectionShape(t){const e=new RectangleShape.default(Rectangle.default.fromRectangle(t),Constants.NONE,this.getSelectionColor());return e.strokeWidth=this.getSelectionStrokeWidth(),e.isDashed=this.isSelectionDashed(),e}getSelectionColor(){return VertexHandlerConfig.selectionColor}getSelectionStrokeWidth(){return VertexHandlerConfig.selectionStrokeWidth}isSelectionDashed(){return VertexHandlerConfig.selectionDashed}createSizer(t,e,i=HandleConfig.size,s=HandleConfig.fillColor){const n=new Rectangle.default(0,0,i,i),l=this.createSizerShape(n,e,s);return l.bounds&&l.isHtmlAllowed()&&this.state.text&&this.state.text.node.parentNode===this.graph.container?(l.bounds.height-=1,l.bounds.width-=1,l.dialect=Constants.DIALECT.STRICTHTML,l.init(this.graph.container)):(l.dialect=this.graph.dialect!==Constants.DIALECT.SVG?Constants.DIALECT.MIXEDHTML:Constants.DIALECT.SVG,l.init(this.graph.getView().getOverlayPane())),InternalEvent.default.redirectMouseEvents(l.node,this.graph,this.state),this.graph.isEnabled()&&l.setCursor(t),this.isSizerVisible(e)||(l.visible=!1),l}isSizerVisible(t){return!0}createSizerShape(t,e,i=HandleConfig.fillColor){if(this.handleImage){t=new Rectangle.default(t.x,t.y,this.handleImage.width,this.handleImage.height);const e=new ImageShape.default(t,this.handleImage.src);return e.preserveImageAspect=!1,e}const s=HandleConfig.strokeColor;return e===InternalEvent.default.ROTATION_HANDLE?new node_EllipseShape(t,i,s):new RectangleShape.default(t,i,s)}moveSizerTo(t,e,i){t&&t.bounds&&(t.bounds.x=Math.floor(e-t.bounds.width/2),t.bounds.y=Math.floor(i-t.bounds.height/2),t.node&&"none"!==t.node.style.display&&t.redraw())}getHandleForEvent(t){const e=(0,EventUtils.isMouseEvent)(t.getEvent())?1:this.tolerance,i=this.allowHandleBoundsCheck&&e>0?new Rectangle.default(t.getGraphX()-e,t.getGraphY()-e,2*e,2*e):null,s=e=>{const s=e&&e.constructor!==ImageShape.default&&this.allowHandleBoundsCheck?e.strokeWidth+e.svgStrokeTolerance:null,n=s?new Rectangle.default(t.getGraphX()-Math.floor(s/2),t.getGraphY()-Math.floor(s/2),s,s):i;return e&&e.bounds&&(t.isSource(e)||n&&(0,mathUtils.intersects)(e.bounds,n)&&"none"!==e.node.style.display&&"hidden"!==e.node.style.visibility)};if(s(this.rotationShape))return InternalEvent.default.ROTATION_HANDLE;if(s(this.labelShape))return InternalEvent.default.LABEL_HANDLE;for(let t=0;t<this.sizers.length;t+=1)if(s(this.sizers[t]))return t;if(null!=this.customHandles&&this.isCustomHandleEvent(t))for(let t=this.customHandles.length-1;t>=0;t--)if(s(this.customHandles[t].shape))return InternalEvent.default.CUSTOM_HANDLE-t;return null}isCustomHandleEvent(t){return!0}mouseDown(t,e){if(!e.isConsumed()&&this.graph.isEnabled()){const t=this.getHandleForEvent(e);t&&(this.start(e.getGraphX(),e.getGraphY(),t),e.consume())}}isLivePreviewBorder(){return this.state.shape&&this.state.shape.fill===Constants.NONE&&this.state.shape.stroke===Constants.NONE}start(t,e,i){if(this.livePreviewActive=this.livePreview&&0===this.state.cell.getChildCount(),this.inTolerance=!0,this.childOffsetX=0,this.childOffsetY=0,this.index=i,this.startX=t,this.startY=e,this.index<=InternalEvent.default.CUSTOM_HANDLE&&this.isGhostPreview())this.ghostPreview=this.createGhostPreview();else{const{model:t}=this.state.view.graph,e=this.state.cell.getParent();if(this.state.view.currentRoot!==e&&e&&(e.isVertex()||e.isEdge())&&(this.parentState=this.state.view.graph.view.getState(e)),this.selectionBorder.node.style.display=i===InternalEvent.default.ROTATION_HANDLE?"inline":"none",this.livePreviewActive&&!this.isLivePreviewBorder()||(this.preview=this.createSelectionShape(this.bounds),Client.default.IS_SVG&&0!=(this.state.style.rotation??0)||null==this.state.text||this.state.text.node.parentNode!==this.graph.container?(this.preview.dialect=Constants.DIALECT.SVG,this.preview.init(this.graph.view.getOverlayPane())):(this.preview.dialect=Constants.DIALECT.STRICTHTML,this.preview.init(this.graph.container))),i===InternalEvent.default.ROTATION_HANDLE){const t=this.getRotationHandlePosition(),e=t.x-this.state.getCenterX(),i=t.y-this.state.getCenterY();this.startAngle=0!==e?180*Math.atan(i/e)/Math.PI+90:0,this.startDist=Math.sqrt(e*e+i*i)}if(this.livePreviewActive){this.hideSizers(),i===InternalEvent.default.ROTATION_HANDLE&&this.rotationShape?this.rotationShape.node.style.display="":i===InternalEvent.default.LABEL_HANDLE&&this.labelShape?this.labelShape.node.style.display="":this.sizers[i]?this.sizers[i].node.style.display="":i<=InternalEvent.default.CUSTOM_HANDLE&&this.customHandles[InternalEvent.default.CUSTOM_HANDLE-i].setVisible(!0);const t=this.state.cell.getEdges();this.edgeHandlers=[];const e=this.graph.getPlugin("SelectionCellsHandler");for(let i=0;i<t.length;i+=1){const s=e?.getHandler(t[i]);s&&this.edgeHandlers.push(s)}}}}createGhostPreview(){const t=this.graph.cellRenderer.createShape(this.state);return t.init(this.graph.view.getOverlayPane()),t.scale=this.state.view.scale,t.bounds=this.bounds,t.outline=!0,t}setHandlesVisible(t){this.handlesVisible=t;for(let e=0;e<this.sizers.length;e+=1)this.sizers[e].node.style.display=t?"":"none";for(let e=0;e<this.customHandles.length;e+=1)this.customHandles[e].setVisible(t)}hideSizers(){this.setHandlesVisible(!1)}checkTolerance(t){this.inTolerance&&null!==this.startX&&null!==this.startY&&((0,EventUtils.isMouseEvent)(t.getEvent())||Math.abs(t.getGraphX()-this.startX)>this.graph.getEventTolerance()||Math.abs(t.getGraphY()-this.startY)>this.graph.getEventTolerance())&&(this.inTolerance=!1)}updateHint(t){}removeHint(){}roundAngle(t){return Math.round(10*t)/10}roundLength(t){return Math.round(100*t)/100}mouseMove(t,e){e.isConsumed()||null==this.index?!this.graph.isMouseDown&&this.getHandleForEvent(e)&&e.consume(!1):(this.checkTolerance(e),this.inTolerance||(this.index<=InternalEvent.default.CUSTOM_HANDLE?null!=this.customHandles&&(this.customHandles[InternalEvent.default.CUSTOM_HANDLE-this.index].processEvent(e),this.customHandles[InternalEvent.default.CUSTOM_HANDLE-this.index].active=!0,null!=this.ghostPreview?(this.ghostPreview.apply(this.state),this.ghostPreview.strokeWidth=this.getSelectionStrokeWidth()/this.ghostPreview.scale/this.ghostPreview.scale,this.ghostPreview.isDashed=this.isSelectionDashed(),this.ghostPreview.stroke=this.getSelectionColor(),this.ghostPreview.redraw(),null!=this.selectionBounds&&(this.selectionBorder.node.style.display="none")):(this.movePreviewToFront&&this.moveToFront(),this.customHandles[InternalEvent.default.CUSTOM_HANDLE-this.index].positionChanged())):this.index===InternalEvent.default.LABEL_HANDLE?this.moveLabel(e):(this.index===InternalEvent.default.ROTATION_HANDLE?this.rotateVertex(e):this.resizeVertex(e),this.updateHint(e))),e.consume())}isGhostPreview(){return this.state.cell.getChildCount()>0}moveLabel(t){const e=new Point.default(t.getGraphX(),t.getGraphY()),i=this.graph.view.translate,{scale:s}=this.graph.view;this.graph.isGridEnabledEvent(t.getEvent())&&(e.x=(this.graph.snap(e.x/s-i.x)+i.x)*s,e.y=(this.graph.snap(e.y/s-i.y)+i.y)*s);const n=this.rotationShape?this.sizers.length-2:this.sizers.length-1;this.moveSizerTo(this.sizers[n],e.x,e.y)}rotateVertex(t){const e=new Point.default(t.getGraphX(),t.getGraphY());let i=this.state.x+this.state.width/2-e.x,s=this.state.y+this.state.height/2-e.y;if(this.currentAlpha=0!==i?180*Math.atan(s/i)/Math.PI+90:s<0?180:0,i>0&&(this.currentAlpha-=180),this.currentAlpha-=this.startAngle,this.rotationRaster&&this.graph.isGridEnabledEvent(t.getEvent())){let t;i=e.x-this.state.getCenterX(),s=e.y-this.state.getCenterY();const n=Math.sqrt(i*i+s*s);t=n-this.startDist<2?15:n-this.startDist<25?5:1,this.currentAlpha=Math.round(this.currentAlpha/t)*t}else this.currentAlpha=this.roundAngle(this.currentAlpha);this.selectionBorder.rotation=this.currentAlpha,this.selectionBorder.redraw(),this.livePreviewActive&&this.redrawHandles()}resizeVertex(t){const e=new Point.default(this.state.getCenterX(),this.state.getCenterY()),i=(0,mathUtils.toRadians)(this.state.style.rotation??0),s=new Point.default(t.getGraphX(),t.getGraphY()),n=this.graph.view.translate,{scale:l}=this.graph.view;let a=Math.cos(-i),r=Math.sin(-i),o=s.x-this.startX,h=s.y-this.startY;const d=r*o+a*h;o=a*o-r*h,h=d;const u=this.state.cell.getGeometry();if(u&&null!==this.index&&(this.unscaledBounds=this.union(u,o/l,h/l,this.index,this.graph.isGridEnabledEvent(t.getEvent()),1,new Point.default(0,0),this.isConstrainedEvent(t),this.isCenteredEvent(this.state,t))),u&&!u.relative){let t=this.graph.getMaximumGraphBounds();if(null!=t&&null!=this.parentState&&(t=Rectangle.default.fromRectangle(t),t.x-=(this.parentState.x-n.x*l)/l,t.y-=(this.parentState.y-n.y*l)/l),this.graph.isConstrainChild(this.state.cell)){let e=this.graph.getCellContainmentArea(this.state.cell);if(null!=e){const i=this.graph.getOverlap(this.state.cell);i>0&&(e=Rectangle.default.fromRectangle(e),e.x-=e.width*i,e.y-=e.height*i,e.width+=2*e.width*i,e.height+=2*e.height*i),t?(t=Rectangle.default.fromRectangle(t),t.intersect(e)):t=e}}t&&this.unscaledBounds&&(this.unscaledBounds.x<t.x&&(this.unscaledBounds.width-=t.x-this.unscaledBounds.x,this.unscaledBounds.x=t.x),this.unscaledBounds.y<t.y&&(this.unscaledBounds.height-=t.y-this.unscaledBounds.y,this.unscaledBounds.y=t.y),this.unscaledBounds.x+this.unscaledBounds.width>t.x+t.width&&(this.unscaledBounds.width-=this.unscaledBounds.x+this.unscaledBounds.width-t.x-t.width),this.unscaledBounds.y+this.unscaledBounds.height>t.y+t.height&&(this.unscaledBounds.height-=this.unscaledBounds.y+this.unscaledBounds.height-t.y-t.height))}if(this.unscaledBounds){const s=this.bounds;this.bounds=new Rectangle.default((this.parentState?this.parentState.x:n.x*l)+this.unscaledBounds.x*l,(this.parentState?this.parentState.y:n.y*l)+this.unscaledBounds.y*l,this.unscaledBounds.width*l,this.unscaledBounds.height*l),u&&u.relative&&this.parentState&&(this.bounds.x+=this.state.x-this.parentState.x,this.bounds.y+=this.state.y-this.parentState.y),a=Math.cos(i),r=Math.sin(i);const d=new Point.default(this.bounds.getCenterX(),this.bounds.getCenterY());o=d.x-e.x,h=d.y-e.y;const c=a*o-r*h-o,g=r*o+a*h-h,p=this.bounds.x-this.state.x,f=this.bounds.y-this.state.y,E=a*p-r*f,C=r*p+a*f;this.bounds.x+=c,this.bounds.y+=g,this.unscaledBounds.x=this.roundLength(this.unscaledBounds.x+c/l),this.unscaledBounds.y=this.roundLength(this.unscaledBounds.y+g/l),this.unscaledBounds.width=this.roundLength(this.unscaledBounds.width),this.unscaledBounds.height=this.roundLength(this.unscaledBounds.height),this.state.cell.isCollapsed()||0===c&&0===g?(this.childOffsetX=0,this.childOffsetY=0):(this.childOffsetX=this.state.x-this.bounds.x+E,this.childOffsetY=this.state.y-this.bounds.y+C),s.equals(this.bounds)||(this.livePreviewActive&&this.updateLivePreview(t),null!=this.preview?this.drawPreview():this.updateParentHighlight())}}updateLivePreview(t){const{scale:e}=this.graph.view,i=this.graph.view.translate,s=this.state.clone();this.state.x=this.bounds.x,this.state.y=this.bounds.y,this.state.origin=new Point.default(this.state.x/e-i.x,this.state.y/e-i.y),this.state.width=this.bounds.width,this.state.height=this.bounds.height;let n=this.state.absoluteOffset;n=new Point.default(n.x,n.y),this.state.absoluteOffset.x=0,this.state.absoluteOffset.y=0;const l=this.state.cell.getGeometry();if(null!=l){const t=l.offset||this.EMPTY_POINT;null==t||l.relative||(this.state.absoluteOffset.x=this.state.view.scale*t.x,this.state.absoluteOffset.y=this.state.view.scale*t.y),this.state.view.updateVertexLabelOffset(this.state)}this.state.view.graph.cellRenderer.redraw(this.state,!0),this.state.view.invalidate(this.state.cell),this.state.invalid=!1,this.state.view.validate(),this.redrawHandles(),this.movePreviewToFront&&this.moveToFront(),null!=this.state.control&&null!=this.state.control.node&&(this.state.control.node.style.visibility="hidden"),this.state.setState(s)}moveToFront(){(this.state.text&&this.state.text.node&&this.state.text.node.nextSibling||this.state.shape&&this.state.shape.node&&this.state.shape.node.nextSibling&&(!this.state.text||this.state.shape.node.nextSibling!==this.state.text.node))&&(this.state.shape&&this.state.shape.node&&this.state.shape.node.parentNode&&this.state.shape.node.parentNode.appendChild(this.state.shape.node),this.state.text&&this.state.text.node&&this.state.text.node.parentNode&&this.state.text.node.parentNode.appendChild(this.state.text.node))}mouseUp(t,e){if(null!=this.index&&null!=this.state){const t=new Point.default(e.getGraphX(),e.getGraphY()),{index:i}=this;this.index=null,null==this.ghostPreview&&(this.state.view.invalidate(this.state.cell,!1,!1),this.state.view.validate()),this.graph.batchUpdate((()=>{if(i<=InternalEvent.default.CUSTOM_HANDLE){if(null!=this.customHandles){const t=this.state.view.graph.getCellStyle(this.state.cell);this.customHandles[InternalEvent.default.CUSTOM_HANDLE-i].active=!1,this.customHandles[InternalEvent.default.CUSTOM_HANDLE-i].execute(e),null!=this.customHandles&&null!=this.customHandles[InternalEvent.default.CUSTOM_HANDLE-i]&&(this.state.style=t,this.customHandles[InternalEvent.default.CUSTOM_HANDLE-i].positionChanged())}}else if(i===InternalEvent.default.ROTATION_HANDLE)if(null!=this.currentAlpha){const t=this.currentAlpha-(this.state.style.rotation??0);0!==t&&this.rotateCell(this.state.cell,t)}else this.rotateClick();else{const s=this.graph.isGridEnabledEvent(e.getEvent()),n=(0,mathUtils.toRadians)(this.state.style.rotation??0),l=Math.cos(-n),a=Math.sin(-n);let r=t.x-this.startX,o=t.y-this.startY;const h=a*r+l*o;r=l*r-a*o,o=h;const d=this.graph.view.scale,u=this.isRecursiveResize(this.state,e);this.resizeCell(this.state.cell,this.roundLength(r/d),this.roundLength(o/d),i,s,this.isConstrainedEvent(e),u)}})),e.consume(),this.reset(),this.redrawHandles()}}isRecursiveResize(t,e){return this.graph.isRecursiveResize(this.state)}rotateClick(){}rotateCell(t,e,i){if(0!==e){const s=this.graph.getDataModel();if(t.isVertex()||t.isEdge()){if(!t.isEdge()){const i=(this.graph.getCurrentCellStyle(t).rotation??0)+e;this.graph.setCellStyles("rotation",i,[t])}let n=t.getGeometry();if(n&&i){const l=i.getGeometry();if(null==l||i.isEdge()||(n=n.clone(),n.rotate(e,new Point.default(l.width/2,l.height/2)),s.setGeometry(t,n)),t.isVertex()&&!n.relative||t.isEdge()){const i=t.getChildCount();for(let s=0;s<i;s+=1)this.rotateCell(t.getChildAt(s),e,t)}}}}}reset(){if(null!==this.index&&"none"===this.sizers[this.index].node.style.display&&(this.sizers[this.index].node.style.display=""),this.index=null,this.currentAlpha=null,this.preview&&(this.preview.destroy(),this.preview=null),this.ghostPreview&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.livePreviewActive){for(let t=0;t<this.sizers.length;t+=1)this.sizers[t].node.style.display="";this.state.control&&this.state.control.node&&(this.state.control.node.style.visibility="")}for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].active?(this.customHandles[t].active=!1,this.customHandles[t].reset()):this.customHandles[t].setVisible(!0);this.selectionBorder.node.style.display="inline",this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new Rectangle.default(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview(),this.removeHint(),this.redrawHandles(),this.edgeHandlers=[],this.handlesVisible=!0,this.unscaledBounds=null}resizeCell(t,e,i,s,n,l,a){let r=t.getGeometry();if(r)if(s===InternalEvent.default.LABEL_HANDLE&&this.labelShape&&this.labelShape.bounds){const e=-(0,mathUtils.toRadians)(this.state.style.rotation??0),i=Math.cos(e),s=Math.sin(e),{scale:n}=this.graph.view,l=(0,mathUtils.getRotatedPoint)(new Point.default(Math.round((this.labelShape.bounds.getCenterX()-this.startX)/n),Math.round((this.labelShape.bounds.getCenterY()-this.startY)/n)),i,s);r=r.clone(),null==r.offset?r.offset=l:(r.offset.x+=l.x,r.offset.y+=l.y),this.graph.model.setGeometry(t,r)}else if(this.unscaledBounds){const{scale:e}=this.graph.view;0===this.childOffsetX&&0===this.childOffsetY||this.moveChildren(t,Math.round(this.childOffsetX/e),Math.round(this.childOffsetY/e)),this.graph.resizeCell(t,this.unscaledBounds,a)}}moveChildren(t,e,i){const s=this.graph.getDataModel(),n=t.getChildCount();for(let l=0;l<n;l+=1){const n=t.getChildAt(l);let a=n.getGeometry();null!=a&&(a=a.clone(),a.translate(e,i),s.setGeometry(n,a))}}union(t,e,i,s,n,l,a,r,o){if(n=n&&this.graph.isGridEnabled(),this.singleSizer){let s=t.x+t.width+e,a=t.y+t.height+i;n&&(s=this.graph.snap(s/l)*l,a=this.graph.snap(a/l)*l);const r=new Rectangle.default(t.x,t.y,0,0);return r.add(new Rectangle.default(s,a,0,0)),r}const h=t.width,d=t.height;let u=t.x-a.x*l,c=u+h,g=t.y-a.y*l,p=g+d;const f=u+h/2,E=g+d/2;s>4?(p+=i,p=n?this.graph.snap(p/l)*l:Math.round(p/l)*l):s<3&&(g+=i,g=n?this.graph.snap(g/l)*l:Math.round(g/l)*l),0===s||3===s||5===s?(u+=e,u=n?this.graph.snap(u/l)*l:Math.round(u/l)*l):2!==s&&4!==s&&7!==s||(c+=e,c=n?this.graph.snap(c/l)*l:Math.round(c/l)*l);let C=c-u,y=p-g;if(r){const t=this.state.cell.getGeometry();if(null!=t){const e=t.width/t.height;1===s||2===s||7===s||6===s?C=y*e:y=C/e,0===s&&(u=c-C,g=p-y)}}if(o){C+=C-h,y+=y-d;const t=f-(u+C/2),e=E-(g+y/2);u+=t,g+=e,c+=t,p+=e}C<0&&(u+=C,C=Math.abs(C)),y<0&&(g+=y,y=Math.abs(y));const v=new Rectangle.default(u+a.x*l,g+a.y*l,C,y);return null!=this.minBounds&&(v.width=Math.max(v.width,this.minBounds.x*l+this.minBounds.width*l+Math.max(0,this.x0*l-v.x)),v.height=Math.max(v.height,this.minBounds.y*l+this.minBounds.height*l+Math.max(0,this.y0*l-v.y))),v}redraw(t){this.selectionBounds=this.getSelectionBounds(this.state),this.bounds=new Rectangle.default(this.selectionBounds.x,this.selectionBounds.y,this.selectionBounds.width,this.selectionBounds.height),this.drawPreview(),t||this.redrawHandles()}getHandlePadding(){const t=new Point.default(0,0);let e=this.tolerance;return this.sizers.length>0&&this.sizers[0].bounds&&(this.bounds.width<2*this.sizers[0].bounds.width+2*e||this.bounds.height<2*this.sizers[0].bounds.height+2*e)&&(e/=2,t.x=this.sizers[0].bounds.width+e,t.y=this.sizers[0].bounds.height+e),t}getSizerBounds(){return this.bounds}redrawHandles(){let t=this.getSizerBounds();const e=this.tolerance;this.horizontalOffset=0,this.verticalOffset=0;for(let t=0;t<this.customHandles.length;t+=1){const e=this.customHandles[t].shape;if(e){const i=e.node.style.display;this.customHandles[t].redraw(),e.node.style.display=i,e.node.style.visibility=this.handlesVisible&&this.isCustomHandleVisible(this.customHandles[t])?"":"hidden"}}if(this.sizers.length>0&&this.sizers[0]){if(null===this.index&&this.manageSizers&&this.sizers.length>=8){const i=this.getHandlePadding();this.horizontalOffset=i.x,this.verticalOffset=i.y,0===this.horizontalOffset&&0===this.verticalOffset||(t=new Rectangle.default(t.x,t.y,t.width,t.height),t.x-=this.horizontalOffset/2,t.width+=this.horizontalOffset,t.y-=this.verticalOffset/2,t.height+=this.verticalOffset),this.sizers.length>=8&&(this.sizers[0].bounds&&(t.width<2*this.sizers[0].bounds.width+2*e||t.height<2*this.sizers[0].bounds.height+2*e)?(this.sizers[0].node.style.display="none",this.sizers[2].node.style.display="none",this.sizers[5].node.style.display="none",this.sizers[7].node.style.display="none"):this.handlesVisible&&(this.sizers[0].node.style.display="",this.sizers[2].node.style.display="",this.sizers[5].node.style.display="",this.sizers[7].node.style.display=""))}const i=t.x+t.width,s=t.y+t.height;if(this.singleSizer)this.moveSizerTo(this.sizers[0],i,s);else{const e=t.x+t.width/2,n=t.y+t.height/2;if(this.sizers.length>=8){const l=["nw-resize","n-resize","ne-resize","e-resize","se-resize","s-resize","sw-resize","w-resize"],a=(0,mathUtils.toRadians)(this.state.style.rotation??0),r=Math.cos(a),o=Math.sin(a),h=Math.round(4*a/Math.PI),d=new Point.default(t.getCenterX(),t.getCenterY());let u=(0,mathUtils.getRotatedPoint)(new Point.default(t.x,t.y),r,o,d);this.moveSizerTo(this.sizers[0],u.x,u.y),this.sizers[0].setCursor(l[(0,mathUtils.mod)(0+h,l.length)]),u.x=e,u.y=t.y,u=(0,mathUtils.getRotatedPoint)(u,r,o,d),this.moveSizerTo(this.sizers[1],u.x,u.y),this.sizers[1].setCursor(l[(0,mathUtils.mod)(1+h,l.length)]),u.x=i,u.y=t.y,u=(0,mathUtils.getRotatedPoint)(u,r,o,d),this.moveSizerTo(this.sizers[2],u.x,u.y),this.sizers[2].setCursor(l[(0,mathUtils.mod)(2+h,l.length)]),u.x=t.x,u.y=n,u=(0,mathUtils.getRotatedPoint)(u,r,o,d),this.moveSizerTo(this.sizers[3],u.x,u.y),this.sizers[3].setCursor(l[(0,mathUtils.mod)(7+h,l.length)]),u.x=i,u.y=n,u=(0,mathUtils.getRotatedPoint)(u,r,o,d),this.moveSizerTo(this.sizers[4],u.x,u.y),this.sizers[4].setCursor(l[(0,mathUtils.mod)(3+h,l.length)]),u.x=t.x,u.y=s,u=(0,mathUtils.getRotatedPoint)(u,r,o,d),this.moveSizerTo(this.sizers[5],u.x,u.y),this.sizers[5].setCursor(l[(0,mathUtils.mod)(6+h,l.length)]),u.x=e,u.y=s,u=(0,mathUtils.getRotatedPoint)(u,r,o,d),this.moveSizerTo(this.sizers[6],u.x,u.y),this.sizers[6].setCursor(l[(0,mathUtils.mod)(5+h,l.length)]),u.x=i,u.y=s,u=(0,mathUtils.getRotatedPoint)(u,r,o,d),this.moveSizerTo(this.sizers[7],u.x,u.y),this.sizers[7].setCursor(l[(0,mathUtils.mod)(4+h,l.length)]),u.x=e+this.state.absoluteOffset.x,u.y=n+this.state.absoluteOffset.y,u=(0,mathUtils.getRotatedPoint)(u,r,o,d),this.moveSizerTo(this.sizers[8],u.x,u.y)}else this.state.width>=2&&this.state.height>=2?this.moveSizerTo(this.sizers[0],e+this.state.absoluteOffset.x,n+this.state.absoluteOffset.y):this.moveSizerTo(this.sizers[0],this.state.x,this.state.y)}}if(this.rotationShape){const t=(0,mathUtils.toRadians)(this.currentAlpha??this.state.style.rotation??0),e=Math.cos(t),i=Math.sin(t),s=new Point.default(this.state.getCenterX(),this.state.getCenterY()),n=(0,mathUtils.getRotatedPoint)(this.getRotationHandlePosition(),e,i,s);null!=this.rotationShape.node&&(this.moveSizerTo(this.rotationShape,n.x,n.y),this.rotationShape.node.style.visibility=this.state.view.graph.isEditing()||!this.handlesVisible?"hidden":"")}if(null!=this.selectionBorder&&(this.selectionBorder.rotation=this.state.style.rotation??0),null!=this.edgeHandlers)for(let t=0;t<this.edgeHandlers.length;t+=1)this.edgeHandlers[t].redraw()}isCustomHandleVisible(t){return!this.graph.isEditing()&&1===this.state.view.graph.getSelectionCount()}getRotationHandlePosition(){return new Point.default(this.bounds.x+this.bounds.width/2,this.bounds.y+this.rotationHandleVSpacing)}isParentHighlightVisible(){const t=this.state.cell.getParent();return!!t&&!this.graph.isCellSelected(t)}updateParentHighlight(){if(!this.isDestroyed()){const t=this.isParentHighlightVisible(),e=this.state.cell.getParent(),i=e?this.graph.view.getState(e):null;if(this.parentHighlight)if(e&&e.isVertex()&&t){const t=this.parentHighlight.bounds;i&&t&&(t.x!==i.x||t.y!==i.y||t.width!==i.width||t.height!==i.height)&&(this.parentHighlight.bounds=Rectangle.default.fromRectangle(i),this.parentHighlight.redraw())}else null!=i&&i.parentHighlight===this.parentHighlight&&(i.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null;else this.parentHighlightEnabled&&t&&e&&e.isVertex()&&null!=i&&null==i.parentHighlight&&(this.parentHighlight=this.createParentHighlightShape(i),this.parentHighlight.dialect=Constants.DIALECT.SVG,this.parentHighlight.pointerEvents=!1,this.parentHighlight.rotation=i.style.rotation??0,this.parentHighlight.init(this.graph.getView().getOverlayPane()),this.parentHighlight.redraw(),i.parentHighlight=this.parentHighlight)}}drawPreview(){null!=this.preview&&(this.preview.bounds=this.bounds,this.preview.node.parentNode===this.graph.container&&(this.preview.bounds.width=Math.max(0,this.preview.bounds.width-1),this.preview.bounds.height=Math.max(0,this.preview.bounds.height-1)),this.preview.rotation=this.state.style.rotation??0,this.preview.redraw()),this.selectionBorder.bounds=this.getSelectionBorderBounds(),this.selectionBorder.redraw(),this.updateParentHighlight()}getSelectionBorderBounds(){return this.bounds}isDestroyed(){return null==this.selectionBorder}onDestroy(){if(this.state.view.graph.removeListener(this.escapeHandler),this.escapeHandler=()=>{},this.preview&&(this.preview.destroy(),this.preview=null),this.parentHighlight){const t=this.state.cell.getParent(),e=t?this.graph.view.getState(t):null;e&&e.parentHighlight===this.parentHighlight&&(e.parentHighlight=null),this.parentHighlight.destroy(),this.parentHighlight=null}this.ghostPreview&&(this.ghostPreview.destroy(),this.ghostPreview=null),this.selectionBorder&&this.selectionBorder.destroy(),this.labelShape=null,this.removeHint();for(let t=0;t<this.sizers.length;t+=1)this.sizers[t].destroy();this.sizers=[];for(let t=0;t<this.customHandles.length;t+=1)this.customHandles[t].destroy();this.customHandles=[]}}const handler_VertexHandler=VertexHandler;var MaxXmlRequest=__webpack_require__(290),config=__webpack_require__(902);class Translations{}Translations.resources={},Translations.extension=".txt",Translations.resourcesEncoded=!1,Translations.loadDefaultBundle=!0,Translations.loadSpecialBundle=!0,Translations.isLanguageSupported=t=>{const e=config.TranslationsConfig.getLanguages();return!e||e.indexOf(t)>=0},Translations.getDefaultBundle=(t,e)=>Translations.loadDefaultBundle||!Translations.isLanguageSupported(e)?t+Translations.extension:null,Translations.getSpecialBundle=(t,e)=>{if(!config.TranslationsConfig.getLanguages()||!Translations.isLanguageSupported(e)){const t=e.indexOf("-");t>0&&(e=e.substring(0,t))}return Translations.loadSpecialBundle&&Translations.isLanguageSupported(e)&&e!=config.TranslationsConfig.getDefaultLanguage()?`${t}_${e}${Translations.extension}`:null},Translations.add=(t,e=null,i=null)=>{if(e??(e=config.TranslationsConfig.getLanguage()?.toLowerCase()??Constants.NONE),e!==Constants.NONE){const s=Translations.getDefaultBundle(t,e),n=Translations.getSpecialBundle(t,e),l=()=>{if(null!=n)if(i)(0,MaxXmlRequest.get)(n,(t=>{Translations.parse(t.getText()),i()}),(()=>{i()}));else try{const t=(0,MaxXmlRequest.load)(n);t.isReady()&&Translations.parse(t.getText())}catch(t){}else null!=i&&i()};if(null!=s)if(i)(0,MaxXmlRequest.get)(s,(t=>{Translations.parse(t.getText()),l()}),(()=>{l()}));else try{const t=(0,MaxXmlRequest.load)(s);t.isReady()&&Translations.parse(t.getText()),l()}catch(t){}else l()}},Translations.parse=t=>{if(null!=t){const e=t.split("\n");for(let t=0;t<e.length;t+=1)if("#"!==e[t].charAt(0)){const i=e[t].indexOf("=");if(i>0){const s=e[t].substring(0,i);let n=e[t].length;13===e[t].charCodeAt(n-1)&&n--;let l=e[t].substring(i+1,n);Translations.resourcesEncoded?(l=l.replace(/\\(?=u[a-fA-F\d]{4})/g,"%"),Translations.resources[s]=unescape(l)):Translations.resources[s]=l}}}},Translations.get=(t,e=null,i=null)=>{let s=Translations.resources[t];return null==s&&(s=i),null!=s&&null!=e&&(s=Translations.replacePlaceholders(s,e)),s},Translations.replacePlaceholders=(t,e)=>{const i=[];let s=null;for(let n=0;n<t.length;n+=1){const l=t.charAt(n);"{"===l?s="":null!=s&&"}"===l?(s=parseInt(s)-1,s>=0&&s<e.length&&i.push(e[s]),s=null):null!=s?s+=l:i.push(l)}return i.join("")},Translations.loadResources=t=>{Translations.add(`${Client.default.basePath}/resources/editor`,null,(()=>{Translations.add(`${Client.default.basePath}/resources/graph`,null,t)}))};const i18n_Translations=Translations;class ElbowEdgeHandler extends handler_EdgeHandler{constructor(t){super(t),this.flipEnabled=!0,this.doubleClickOrientationResource=config.TranslationsConfig.isEnabled()?"doubleClickOrientation":""}createBends(){const t=[];let e=this.createHandleShape(0);return this.initBend(e),e.setCursor(Constants.CURSOR.TERMINAL_HANDLE),t.push(e),t.push(this.createVirtualBend((t=>{!(0,EventUtils.isConsumed)(t)&&this.flipEnabled&&(this.graph.flipEdge(this.state.cell),InternalEvent.default.consume(t))}))),this.points.push(new Point.default(0,0)),e=this.createHandleShape(2),this.initBend(e),e.setCursor(Constants.CURSOR.TERMINAL_HANDLE),t.push(e),t}createVirtualBend(t){const e=this.createHandleShape();return this.initBend(e,t),e.setCursor(this.getCursorForBend()),this.graph.isCellBendable(this.state.cell)||(e.node.style.display="none"),e}getCursorForBend(){return this.state.style.edgeStyle===Constants.EDGESTYLE.TOPTOBOTTOM||this.state.style.edgeStyle===Constants.EDGESTYLE.ELBOW&&this.state.style.elbow===Constants.ELBOW.VERTICAL?"row-resize":"col-resize"}getTooltipForNode(t){let e=null;return null==this.bends||null==this.bends[1]||t!==this.bends[1].node&&t.parentNode!==this.bends[1].node||(e=this.doubleClickOrientationResource,e=i18n_Translations.get(e)||e),e}convertPoint(t,e){const i=this.graph.getView().getScale(),s=this.graph.getView().getTranslate(),{origin:n}=this.state;return e&&(t.x=this.graph.snap(t.x),t.y=this.graph.snap(t.y)),t.x=Math.round(t.x/i-s.x-n.x),t.y=Math.round(t.y/i-s.y-n.y),t}redrawInnerBends(t,e){const i=this.state.cell.getGeometry(),s=this.state.absolutePoints;let n=null;s.length>1?(t=s[1],e=s[s.length-2]):null!=i.points&&i.points.length>0&&(n=s[0]),n=null==n?new Point.default(t.x+(e.x-t.x)/2,t.y+(e.y-t.y)/2):new Point.default(this.graph.getView().scale*(n.x+this.graph.getView().translate.x+this.state.origin.x),this.graph.getView().scale*(n.y+this.graph.getView().translate.y+this.state.origin.y));const l=this.bends[1].bounds;let a=l.width,r=l.height,o=new Rectangle.default(Math.round(n.x-a/2),Math.round(n.y-r/2),a,r);this.manageLabelHandle?this.checkLabelHandle(o):null==this.handleImage&&this.labelShape.visible&&this.labelShape.bounds&&(0,mathUtils.intersects)(o,this.labelShape.bounds)&&(a=HandleConfig.size+3,r=a,o=new Rectangle.default(Math.floor(n.x-a/2),Math.floor(n.y-r/2),a,r)),this.bends[1].bounds=o,this.bends[1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[1].bounds)}}const handler_ElbowEdgeHandler=ElbowEdgeHandler;class EdgeSegmentHandler extends handler_ElbowEdgeHandler{constructor(t){super(t),this.points=[]}getCurrentPoints(){let t=this.state.absolutePoints;const e=Math.max(1,this.graph.view.scale);if(2===t.length&&t[0]&&t[1]||3===t.length&&t[0]&&t[1]&&t[2]&&(Math.abs(t[0].x-t[1].x)<e&&Math.abs(t[1].x-t[2].x)<e||Math.abs(t[0].y-t[1].y)<e&&Math.abs(t[1].y-t[2].y)<e)){const e=t[0].x+(t[t.length-1].x-t[0].x)/2,i=t[0].y+(t[t.length-1].y-t[0].y)/2;t=[t[0],new Point.default(e,i),new Point.default(e,i),t[t.length-1]]}return t}getPreviewPoints(t){if(this.isSource||this.isTarget)return super.getPreviewPoints(t);const e=this.getCurrentPoints();let i=this.convertPoint(e[0].clone(),!1);t=this.convertPoint(t.clone(),!1);let s=[];for(let n=1;n<e.length;n+=1){const l=this.convertPoint(e[n].clone(),!1);n===this.index&&(0===Math.round(i.x-l.x)&&(i.x=t.x,l.x=t.x),0===Math.round(i.y-l.y)&&(i.y=t.y,l.y=t.y)),n<e.length-1&&s.push(l),i=l}if(1===s.length){const e=this.state.getVisibleTerminalState(!0),i=this.state.getVisibleTerminalState(!1),n=this.state.view.getScale(),l=this.state.view.getTranslate(),a=s[0].x*n+l.x,r=s[0].y*n+l.y;(null!=e&&(0,mathUtils.contains)(e,a,r)||null!=i&&(0,mathUtils.contains)(i,a,r))&&(s=[t,t])}return s}updatePreviewState(t,e,i,s){if(super.updatePreviewState(t,e,i,s),!this.isSource&&!this.isTarget){e=this.convertPoint(e.clone(),!1);const i=t.absolutePoints;let s=i[0],n=i[1],l=[];for(let t=2;t<i.length;t+=1){const e=i[t];0===Math.round(s.x-n.x)&&0===Math.round(n.x-e.x)||0===Math.round(s.y-n.y)&&0===Math.round(n.y-e.y)||l.push(this.convertPoint(n.clone(),!1)),s=n,n=e}const a=this.state.getVisibleTerminalState(!0),r=this.state.getVisibleTerminalState(!1),o=this.state.absolutePoints,h=i[i.length-1];if(0===l.length&&i[0]&&h&&(0===Math.round(i[0].x-h.x)||0===Math.round(i[0].y-h.y)))l=[e,e];else if(5===i.length&&2===l.length&&null!=a&&null!=r&&null!=o&&0===Math.round(o[0].x-o[o.length-1].x)){const i=this.graph.getView(),s=i.getScale(),n=i.getTranslate();let o=i.getRoutingCenterY(a)/s-n.y;const h=this.graph.getConnectionConstraint(t,a,!0);if(null!=h){const t=this.graph.getConnectionPoint(a,h);null!=t&&(this.convertPoint(t,!1),o=t.y)}let d=i.getRoutingCenterY(r)/s-n.y;const u=this.graph.getConnectionConstraint(t,r,!1);if(u){const t=this.graph.getConnectionPoint(r,u);null!=t&&(this.convertPoint(t,!1),d=t.y)}l=[new Point.default(e.x,o),new Point.default(e.x,d)]}this.points=l,t.view.updateFixedTerminalPoints(t,a,r),t.view.updatePoints(t,this.points,a,r),t.view.updateFloatingTerminalPoints(t,a,r)}}connect(t,e,i,s,n){const l=this.graph.getDataModel();let a=t.getGeometry(),r=null;if(null!=a&&null!=a.points&&a.points.length>0){const t=this.abspoints;let e=t[0],i=t[1];r=[];for(let s=2;s<t.length;s+=1){const n=t[s];!(e&&i&&n)||0===Math.round(e.x-i.x)&&0===Math.round(i.x-n.x)||0===Math.round(e.y-i.y)&&0===Math.round(i.y-n.y)||r.push(this.convertPoint(i.clone(),!1)),e=i,i=n}}return this.graph.batchUpdate((()=>{null!=r&&(a=t.getGeometry(),null!=a&&(a=a.clone(),a.points=r,l.setGeometry(t,a))),t=super.connect(t,e,i,s,n)})),t}getTooltipForNode(t){return null}start(t,e,i){super.start(t,e,i),null==this.bends||null==this.bends[i]||this.isSource||this.isTarget||(0,styleUtils.setOpacity)(this.bends[i].node,100)}createBends(){const t=[];let e=this.createHandleShape(0);this.initBend(e),e.setCursor(Constants.CURSOR.TERMINAL_HANDLE),t.push(e);const i=this.getCurrentPoints();if(this.graph.isCellBendable(this.state.cell)){null==this.points&&(this.points=[]);for(let s=0;s<i.length-1;s+=1){e=this.createVirtualBend(),t.push(e);let n=0===Math.round(i[s].x-i[s+1].x);0===Math.round(i[s].y-i[s+1].y)&&s<i.length-2&&(n=0===Math.round(i[s].x-i[s+2].x)),e.setCursor(n?"col-resize":"row-resize"),this.points.push(new Point.default(0,0))}}return e=this.createHandleShape(i.length),this.initBend(e),e.setCursor(Constants.CURSOR.TERMINAL_HANDLE),t.push(e),t}redraw(){this.refresh(),super.redraw()}redrawInnerBends(t,e){if(this.graph.isCellBendable(this.state.cell)){const i=this.getCurrentPoints();if(null!=i&&i.length>1){let s=!1;if(4===i.length&&i[0]&&i[1]&&i[2]&&i[3]&&0===Math.round(i[1].x-i[2].x)&&0===Math.round(i[1].y-i[2].y))if(s=!0,0===Math.round(i[0].y-i[i.length-1].y)){const t=i[0].x+(i[i.length-1].x-i[0].x)/2;i[1]=new Point.default(t,i[1].y),i[2]=new Point.default(t,i[2].y)}else{const t=i[0].y+(i[i.length-1].y-i[0].y)/2;i[1]=new Point.default(i[1].x,t),i[2]=new Point.default(i[2].x,t)}for(let s=0;s<i.length-1;s+=1)if(null!=this.bends[s+1]){t=i[s],e=i[s+1];const n=new Point.default(t.x+(e.x-t.x)/2,t.y+(e.y-t.y)/2),l=this.bends[s+1].bounds;this.bends[s+1].bounds=new Rectangle.default(Math.floor(n.x-l.width/2),Math.floor(n.y-l.height/2),l.width,l.height),this.bends[s+1].redraw(),this.manageLabelHandle&&this.checkLabelHandle(this.bends[s+1].bounds)}s&&((0,styleUtils.setOpacity)(this.bends[1].node,EdgeHandlerConfig.virtualBendOpacity),(0,styleUtils.setOpacity)(this.bends[3].node,EdgeHandlerConfig.virtualBendOpacity))}}}}const handler_EdgeSegmentHandler=EdgeSegmentHandler;class SelectionChange{constructor(t,e=[],i=[]){this.graph=t,this.added=e.slice(),this.removed=i.slice()}execute(){const t=this.graph.getSelectionModel();for(const e of this.removed)t.cellRemoved(e);for(const e of this.added)t.cellAdded(e);[this.added,this.removed]=[this.removed,this.added],t.fireEvent(new EventObject.default(InternalEvent.default.CHANGE,{added:this.added,removed:this.removed}))}}const undoable_changes_SelectionChange=SelectionChange;class GraphSelectionModel extends EventSource.default{constructor(t){super(),this.doneResource=config.TranslationsConfig.isEnabled()?"done":"",this.updatingSelectionResource=config.TranslationsConfig.isEnabled()?"updatingSelection":"",this.singleSelection=!1,this.graph=t,this.cells=[]}isSingleSelection(){return this.singleSelection}setSingleSelection(t){this.singleSelection=t}isSelected(t){return this.cells.indexOf(t)>=0}isEmpty(){return 0===this.cells.length}clear(){this.changeSelection(null,this.cells)}setCell(t){this.setCells(t?[t]:[])}setCells(t){this.singleSelection&&(t=[this.getFirstSelectableCell(t)]);const e=[];for(let i=0;i<t.length;i+=1)this.graph.isCellSelectable(t[i])&&e.push(t[i]);this.changeSelection(e,this.cells)}getFirstSelectableCell(t){for(let e=0;e<t.length;e+=1)if(this.graph.isCellSelectable(t[e]))return t[e];return null}addCell(t){this.addCells([t])}addCells(t){let e=null;if(this.singleSelection){e=this.cells;const i=this.getFirstSelectableCell(t);t=i?[i]:[]}const i=[];for(let e=0;e<t.length;e+=1)!this.isSelected(t[e])&&this.graph.isCellSelectable(t[e])&&i.push(t[e]);this.changeSelection(i,e)}removeCell(t){this.removeCells([t])}removeCells(t){const e=[];for(let i=0;i<t.length;i+=1)this.isSelected(t[i])&&e.push(t[i]);this.changeSelection(null,e)}changeSelection(t=null,e=null){if(t&&t.length>0&&t[0]||e&&e.length>0&&e[0]){const i=new undoable_changes_SelectionChange(this.graph,t||[],e||[]);i.execute();const s=new UndoableEdit.default(this.graph,!1);s.add(i),this.fireEvent(new EventObject.default(InternalEvent.default.UNDO,{edit:s}))}}cellAdded(t){this.isSelected(t)||this.cells.push(t)}cellRemoved(t){const e=this.cells.indexOf(t);e>=0&&this.cells.splice(e,1)}}const view_GraphSelectionModel=GraphSelectionModel;class RhombusShape extends Shape.default{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}isRoundable(){return!0}paintVertexShape(t,e,i,s,n){const l=s/2,a=n/2,r=(this.style?.arcSize??Constants.LINE_ARCSIZE)/2;t.begin(),this.addPoints(t,[new Point.default(e+l,i),new Point.default(e+s,i+a),new Point.default(e+l,i+n),new Point.default(e,i+a)],this.isRounded,r,!0),t.fillAndStroke()}}const node_RhombusShape=RhombusShape;class CylinderShape extends Shape.default{constructor(t,e,i,s=1){super(),this.maxHeight=40,this.svgStrokeTolerance=0,this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintVertexShape(t,e,i,s,n){t.translate(e,i),t.begin(),this.redrawPath(t,e,i,s,n,!1),t.fillAndStroke(),this.outline&&this.style&&this.style.backgroundOutline||(t.setShadow(!1),t.begin(),this.redrawPath(t,e,i,s,n,!0),t.stroke())}getCylinderSize(t,e,i,s){return Math.min(this.maxHeight,Math.round(s/5))}redrawPath(t,e,i,s,n,l=!1){const a=this.getCylinderSize(e,i,s,n);(l&&this.fill!==Constants.NONE||!l&&this.fill===Constants.NONE)&&(t.moveTo(0,a),t.curveTo(0,2*a,s,2*a,s,a),l||(t.stroke(),t.begin())),l||(t.moveTo(0,a),t.curveTo(0,-a/3,s,-a/3,s,a),t.lineTo(s,n-a),t.curveTo(s,n+a/3,0,n+a/3,0,n-a),t.close())}}const node_CylinderShape=CylinderShape;class ActorShape extends Shape.default{constructor(t=null,e=Constants.NONE,i=Constants.NONE,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintVertexShape(t,e,i,s,n){t.translate(e,i),t.begin(),this.redrawPath(t,e,i,s,n),t.fillAndStroke()}redrawPath(t,e,i,s,n){const l=s/3;t.moveTo(0,n),t.curveTo(0,3*n/5,0,2*n/5,s/2,2*n/5),t.curveTo(s/2-l,2*n/5,s/2-l,0,s/2,0),t.curveTo(s/2+l,0,s/2+l,2*n/5,s/2,2*n/5),t.curveTo(s,2*n/5,s,3*n/5,s,n),t.close()}}const geometry_ActorShape=ActorShape;class TriangleShape extends geometry_ActorShape{constructor(){super()}isRoundable(){return!0}redrawPath(t,e,i,s,n){const l=(this.style?.arcSize??Constants.LINE_ARCSIZE)/2;this.addPoints(t,[new Point.default(0,0),new Point.default(s,.5*n),new Point.default(0,n)],this.isRounded,l,!0)}}const node_TriangleShape=TriangleShape;class HexagonShape extends geometry_ActorShape{constructor(){super()}redrawPath(t,e,i,s,n){const l=(this.style?.arcSize??Constants.LINE_ARCSIZE)/2;this.addPoints(t,[new Point.default(.25*s,0),new Point.default(.75*s,0),new Point.default(s,.5*n),new Point.default(.75*s,n),new Point.default(.25*s,n),new Point.default(0,.5*n)],this.isRounded,l,!0)}}const node_HexagonShape=HexagonShape;class CloudShape extends geometry_ActorShape{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}redrawPath(t,e,i,s,n){t.moveTo(.25*s,.25*n),t.curveTo(.05*s,.25*n,0,.5*n,.16*s,.55*n),t.curveTo(0,.66*n,.18*s,.9*n,.31*s,.8*n),t.curveTo(.4*s,n,.7*s,n,.8*s,.8*n),t.curveTo(s,.8*n,s,.6*n,.875*s,.5*n),t.curveTo(s,.3*n,.8*s,.1*n,.625*s,.2*n),t.curveTo(.5*s,.05*n,.3*s,.05*n,.25*s,.25*n),t.close()}}const node_CloudShape=CloudShape;class LineShape extends Shape.default{constructor(t,e,i=1,s=!1){super(),this.bounds=t,this.stroke=e,this.strokeWidth=i,this.vertical=s}paintVertexShape(t,e,i,s,n){if(t.begin(),this.vertical){const l=e+s/2;t.moveTo(l,i),t.lineTo(l,i+n)}else{const l=i+n/2;t.moveTo(e,l),t.lineTo(e+s,l)}t.stroke()}}const edge_LineShape=LineShape;class ArrowShape extends Shape.default{constructor(t,e,i,s=1,n=Constants.ARROW_WIDTH,l=Constants.ARROW_SPACING,a=Constants.ARROW_SIZE){super(),this.points=t,this.fill=e,this.stroke=i,this.strokeWidth=s,this.arrowWidth=n,this.spacing=l,this.endSize=a}augmentBoundingBox(t){super.augmentBoundingBox(t);const e=Math.max(this.arrowWidth,this.endSize);t.grow((e/2+this.strokeWidth)*this.scale)}paintEdgeShape(t,e){const i=Constants.ARROW_SPACING,s=Constants.ARROW_WIDTH,n=Constants.ARROW_SIZE,l=e[0],a=e[e.length-1],r=a.x-l.x,o=a.y-l.y,h=Math.sqrt(r*r+o*o),d=h-2*i-n,u=r/h,c=o/h,g=d*u,p=d*c,f=s*c/3,E=-s*u/3,C=l.x-f/2+i*u,y=l.y-E/2+i*c,v=C+f,m=y+E,S=v+g,w=m+p,_=S+f,x=w+E,T=_-3*f,b=x-3*E;t.begin(),t.moveTo(C,y),t.lineTo(v,m),t.lineTo(S,w),t.lineTo(_,x),t.lineTo(a.x-i*u,a.y-i*c),t.lineTo(T,b),t.lineTo(T+f,b+E),t.close(),t.fillAndStroke()}}const edge_ArrowShape=ArrowShape;class ArrowConnectorShape extends Shape.default{constructor(t,e,i,s=1,n=Constants.ARROW_WIDTH,l=Constants.ARROW_SPACING,a=Constants.ARROW_SIZE/5){super(),this.useSvgBoundingBox=!0,this.points=t,this.fill=e,this.stroke=i,this.strokeWidth=s,this.arrowWidth=n,this.arrowSpacing=l,this.startSize=Constants.ARROW_SIZE/5,this.endSize=a}isRoundable(){return!0}resetStyles(){super.resetStyles(),this.arrowSpacing=Constants.ARROW_SPACING}apply(t){super.apply(t),this.style&&null!=this.style.startSize&&null!=this.style.endSize&&(this.startSize=3*this.style.startSize,this.endSize=3*this.style.endSize)}augmentBoundingBox(t){super.augmentBoundingBox(t);let e=this.getEdgeWidth();this.isMarkerStart()&&(e=Math.max(e,this.getStartArrowWidth())),this.isMarkerEnd()&&(e=Math.max(e,this.getEndArrowWidth())),t.grow((e/2+this.strokeWidth)*this.scale)}paintEdgeShape(t,e){let i=this.strokeWidth;this.outline&&(i=Math.max(1,this.style?.strokeWidth??0));const s=this.getStartArrowWidth()+i,n=this.getEndArrowWidth()+i,l=this.outline?this.getEdgeWidth()+i:this.getEdgeWidth(),a=this.isOpenEnded(),r=this.isMarkerStart(),o=this.isMarkerEnd(),h=a?0:this.arrowSpacing+i/2,d=this.startSize+i,u=this.endSize+i,c=this.isArrowRounded(),g=e[e.length-1];let p=1;for(;p<e.length-1&&e[p].x===e[0].x&&e[p].y===e[0].y;)p++;const f=e[p].x-e[0].x,E=e[p].y-e[0].y,C=Math.sqrt(f*f+E*E);if(0===C)return;let y,v,m=f/C,S=m,w=E/C,_=w,x=l*w,T=-l*m;const b=[];c?t.setLineJoin("round"):e.length>2&&t.setMiterLimit(1.42),t.begin();const P=m,I=w;if(r&&!a)this.paintMarker(t,e[0].x,e[0].y,m,w,d,s,l,h,!0);else{const i=e[0].x+x/2+h*m,s=e[0].y+T/2+h*w,n=e[0].x-x/2+h*m,l=e[0].y-T/2+h*w;a?(t.moveTo(i,s),b.push((()=>{t.lineTo(n,l)}))):(t.moveTo(n,l),t.lineTo(i,s))}let M=0,O=0,A=0;for(let i=0;i<e.length-2;i+=1){const s=(0,mathUtils.relativeCcw)(e[i].x,e[i].y,e[i+1].x,e[i+1].y,e[i+2].x,e[i+2].y);if(M=e[i+2].x-e[i+1].x,O=e[i+2].y-e[i+1].y,A=Math.sqrt(M*M+O*O),0!==A){S=M/A,_=O/A;const n=m*S+w*_,a=Math.max(Math.sqrt((n+1)/2),.04);y=m+S,v=w+_;const r=Math.sqrt(y*y+v*v);if(0!==r){y/=r,v/=r;const n=Math.max(a,Math.min(this.strokeWidth/200+.04,.35)),o=0!==s&&c?Math.max(.1,n):Math.max(a,.06),h=e[i+1].x+v*l/2/o,d=e[i+1].y-y*l/2/o,u=e[i+1].x-v*l/2/o,g=e[i+1].y+y*l/2/o;if(0!==s&&c)if(-1===s){const e=u+w*l,i=g-m*l,s=u+_*l,n=g-S*l;t.lineTo(e,i),t.quadTo(h,d,s,n),((e,i)=>{b.push((()=>{t.lineTo(e,i)}))})(u,g)}else t.lineTo(h,d),((e,i)=>{const s=h-w*l,n=d+m*l,a=h-_*l,r=d+S*l;b.push((()=>{t.quadTo(e,i,s,n)})),b.push((()=>{t.lineTo(a,r)}))})(u,g);else t.lineTo(h,d),((e,i)=>{b.push((()=>{t.lineTo(e,i)}))})(u,g);m=S,w=_}}}if(x=l*_,T=-l*S,o&&!a)this.paintMarker(t,g.x,g.y,-m,-w,u,n,l,h,!1);else{t.lineTo(g.x-h*S+x/2,g.y-h*_+T/2);const e=g.x-h*S-x/2,i=g.y-h*_-T/2;a?(t.moveTo(e,i),b.splice(0,0,(()=>{t.moveTo(e,i)}))):t.lineTo(e,i)}for(let t=b.length-1;t>=0;t--)b[t]();a?(t.end(),t.stroke()):(t.close(),t.fillAndStroke()),t.setShadow(!1),t.setMiterLimit(4),c&&t.setLineJoin("flat"),e.length>2&&(t.setMiterLimit(4),r&&!a&&(t.begin(),this.paintMarker(t,e[0].x,e[0].y,P,I,d,s,l,h,!0),t.stroke(),t.end()),o&&!a&&(t.begin(),this.paintMarker(t,g.x,g.y,-m,-w,u,n,l,h,!0),t.stroke(),t.end()))}paintMarker(t,e,i,s,n,l,a,r,o,h){const d=r/a,u=r*n/2,c=-r*s/2,g=(o+l)*s,p=(o+l)*n;h?t.moveTo(e-u+g,i-c+p):t.lineTo(e-u+g,i-c+p),t.lineTo(e-u/d+g,i-c/d+p),t.lineTo(e+o*s,i+o*n),t.lineTo(e+u/d+g,i+c/d+p),t.lineTo(e+u+g,i+c+p)}isArrowRounded(){return this.isRounded}getStartArrowWidth(){return Constants.ARROW_WIDTH}getEndArrowWidth(){return Constants.ARROW_WIDTH}getEdgeWidth(){return Constants.ARROW_WIDTH/3}isOpenEnded(){return!1}isMarkerStart(){return(this.style?.startArrow??Constants.NONE)!==Constants.NONE}isMarkerEnd(){return(this.style?.endArrow??Constants.NONE)!==Constants.NONE}}const edge_ArrowConnectorShape=ArrowConnectorShape;class DoubleEllipseShape extends Shape.default{constructor(t,e,i,s=1){super(),this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}paintBackground(t,e,i,s,n){t.ellipse(e,i,s,n),t.fillAndStroke()}paintForeground(t,e,i,s,n){if(!this.outline){const l=this.style?.margin??Math.min(3+this.strokeWidth,Math.min(s/5,n/5));e+=l,i+=l,n-=2*l,(s-=2*l)>0&&n>0&&t.ellipse(e,i,s,n),t.stroke()}}getLabelBounds(t){const e=this.style?.margin??Math.min(3+this.strokeWidth,Math.min(t.width/5/this.scale,t.height/5/this.scale))*this.scale;return new Rectangle.default(t.x+e,t.y+e,t.width-2*e,t.height-2*e)}}const node_DoubleEllipseShape=DoubleEllipseShape;class SwimlaneShape extends Shape.default{constructor(t,e,i,s=1){super(),this.imageSize=16,this.imageSrc=null,this.bounds=t,this.fill=e,this.stroke=i,this.strokeWidth=s}isRoundable(t,e,i,s,n){return!0}getTitleSize(){return Math.max(0,this.style?.startSize??Constants.DEFAULT_STARTSIZE)}getLabelBounds(t){const e=this.getTitleSize(),i=new Rectangle.default(t.x,t.y,t.width,t.height),s=this.isHorizontal(),n=this.style?.flipH??!1,l=this.style?.flipV??!1,a=this.direction===Constants.DIRECTION.NORTH||this.direction===Constants.DIRECTION.SOUTH,r=s==!a,o=!r&&n!==(this.direction===Constants.DIRECTION.SOUTH||this.direction===Constants.DIRECTION.WEST),h=r&&l!==(this.direction===Constants.DIRECTION.SOUTH||this.direction===Constants.DIRECTION.WEST);if(a){const t=Math.min(i.width,e*this.scale);(o||h)&&(i.x+=i.width-t),i.width=t}else{const t=Math.min(i.height,e*this.scale);(o||h)&&(i.y+=i.height-t),i.height=t}return i}getGradientBounds(t,e,i,s,n){let l=this.getTitleSize();return this.isHorizontal()?(l=Math.min(l,n),new Rectangle.default(e,i,s,l)):(l=Math.min(l,s),new Rectangle.default(e,i,l,n))}getSwimlaneArcSize(t,e,i){return this.style?.absoluteArcSize?Math.min(t/2,Math.min(e/2,this.style?.arcSize??Constants.LINE_ARCSIZE/2)):i*((this.style?.arcSize??100*Constants.RECTANGLE_ROUNDING_FACTOR)/100)*3}isHorizontal(){return this.style?.horizontal??!0}paintVertexShape(t,e,i,s,n){let l=this.getTitleSize();const a=this.style?.swimlaneFillColor??Constants.NONE,r=this.style?.swimlaneLine??!0;let o=0;l=this.isHorizontal()?Math.min(l,n):Math.min(l,s),t.translate(e,i),this.isRounded?(o=this.getSwimlaneArcSize(s,n,l),o=Math.min((this.isHorizontal()?n:s)-l,Math.min(l,o)),this.paintRoundedSwimlane(t,e,i,s,n,l,o,a,r)):this.paintSwimlane(t,e,i,s,n,l,a,r);const h=this.style?.separatorColor??Constants.NONE;if(this.paintSeparator(t,e,i,s,n,l,h),this.imageSrc){const l=this.getImageBounds(e,i,s,n);t.image(l.x-e,l.y-i,l.width,l.height,this.imageSrc,!1,!1,!1)}this.glass&&(t.setShadow(!1),this.paintGlassEffect(t,0,0,s,l,o))}paintSwimlane(t,e,i,s,n,l,a,r){t.begin();let o=!0;this.style&&null!=this.style.pointerEvents&&(o=this.style.pointerEvents),o||this.fill!==Constants.NONE||(t.pointerEvents=!1),this.isHorizontal()?(t.moveTo(0,l),t.lineTo(0,0),t.lineTo(s,0),t.lineTo(s,l),t.fillAndStroke(),l<n&&(a!==Constants.NONE&&o||(t.pointerEvents=!1),a!==Constants.NONE&&t.setFillColor(a),t.begin(),t.moveTo(0,l),t.lineTo(0,n),t.lineTo(s,n),t.lineTo(s,l),a===Constants.NONE?t.stroke():t.fillAndStroke())):(t.moveTo(l,0),t.lineTo(0,0),t.lineTo(0,n),t.lineTo(l,n),t.fillAndStroke(),l<s&&(a!==Constants.NONE&&o||(t.pointerEvents=!1),a!==Constants.NONE&&t.setFillColor(a),t.begin(),t.moveTo(l,0),t.lineTo(s,0),t.lineTo(s,n),t.lineTo(l,n),a===Constants.NONE?t.stroke():t.fillAndStroke())),r&&this.paintDivider(t,e,i,s,n,l,a===Constants.NONE)}paintRoundedSwimlane(t,e,i,s,n,l,a,r,o){t.begin();let h=!0;this.style&&null!=this.style.pointerEvents&&(h=this.style.pointerEvents),h||this.fill!==Constants.NONE||(t.pointerEvents=!1),this.isHorizontal()?(t.moveTo(s,l),t.lineTo(s,a),t.quadTo(s,0,s-Math.min(s/2,a),0),t.lineTo(Math.min(s/2,a),0),t.quadTo(0,0,0,a),t.lineTo(0,l),t.fillAndStroke(),l<n&&(r!==Constants.NONE&&h||(t.pointerEvents=!1),r!==Constants.NONE&&t.setFillColor(r),t.begin(),t.moveTo(0,l),t.lineTo(0,n-a),t.quadTo(0,n,Math.min(s/2,a),n),t.lineTo(s-Math.min(s/2,a),n),t.quadTo(s,n,s,n-a),t.lineTo(s,l),r===Constants.NONE?t.stroke():t.fillAndStroke())):(t.moveTo(l,0),t.lineTo(a,0),t.quadTo(0,0,0,Math.min(n/2,a)),t.lineTo(0,n-Math.min(n/2,a)),t.quadTo(0,n,a,n),t.lineTo(l,n),t.fillAndStroke(),l<s&&(r!==Constants.NONE&&h||(t.pointerEvents=!1),r!==Constants.NONE&&t.setFillColor(r),t.begin(),t.moveTo(l,n),t.lineTo(s-a,n),t.quadTo(s,n,s,n-Math.min(n/2,a)),t.lineTo(s,Math.min(n/2,a)),t.quadTo(s,0,s-a,0),t.lineTo(l,0),r===Constants.NONE?t.stroke():t.fillAndStroke())),o&&this.paintDivider(t,e,i,s,n,l,r===Constants.NONE)}paintDivider(t,e,i,s,n,l,a){a||t.setShadow(!1),t.begin(),this.isHorizontal()?(t.moveTo(0,l),t.lineTo(s,l)):(t.moveTo(l,0),t.lineTo(l,n)),t.stroke()}paintSeparator(t,e,i,s,n,l,a){a!==Constants.NONE&&(t.setStrokeColor(a),t.setDashed(!0),t.begin(),this.isHorizontal()?(t.moveTo(s,l),t.lineTo(s,n)):(t.moveTo(l,0),t.lineTo(s,0)),t.stroke(),t.setDashed(!1))}getImageBounds(t,e,i,s){return this.isHorizontal()?new Rectangle.default(t+i-this.imageSize,e,this.imageSize,this.imageSize):new Rectangle.default(t,e,this.imageSize,this.imageSize)}}const node_SwimlaneShape=SwimlaneShape;class LabelShape extends RectangleShape.default{constructor(t,e,i,s){super(t,e,i,s),this.imageSize=Constants.DEFAULT_IMAGESIZE,this.imageSrc=null,this.spacing=2,this.indicatorSize=10,this.indicatorSpacing=2,this.indicatorImageSrc=null}init(t){super.init(t),this.indicatorShape&&(this.indicator=new this.indicatorShape,this.indicator.dialect=this.dialect,this.indicator.init(this.node))}redraw(){this.indicator&&(this.indicator.fill=this.indicatorColor,this.indicator.stroke=this.indicatorStrokeColor,this.indicator.gradient=this.indicatorGradientColor,this.indicator.direction=this.indicatorDirection,this.indicator.redraw()),super.redraw()}isHtmlAllowed(){return super.isHtmlAllowed()&&this.indicatorColor===Constants.NONE&&!!this.indicatorShape}paintForeground(t,e,i,s,n){this.paintImage(t,e,i,s,n),this.paintIndicator(t,e,i,s,n),super.paintForeground(t,e,i,s,n)}paintImage(t,e,i,s,n){if(this.imageSrc){const l=this.getImageBounds(e,i,s,n);t.image(l.x,l.y,l.width,l.height,this.imageSrc,!1,!1,!1)}}getImageBounds(t,e,i,s){const n=this.style?.imageAlign??Constants.ALIGN.LEFT,l=this.style?.verticalAlign??Constants.ALIGN.MIDDLE,a=this.style?.imageWidth??Constants.DEFAULT_IMAGESIZE,r=this.style?.imageHeight??Constants.DEFAULT_IMAGESIZE,o=this.style?.spacing??this.spacing+5;return n===Constants.ALIGN.CENTER?t+=(i-a)/2:n===Constants.ALIGN.RIGHT?t+=i-a-o:t+=o,l===Constants.ALIGN.TOP?e+=o:l===Constants.ALIGN.BOTTOM?e+=s-r-o:e+=(s-r)/2,new Rectangle.default(t,e,a,r)}paintIndicator(t,e,i,s,n){if(this.indicator)this.indicator.bounds=this.getIndicatorBounds(e,i,s,n),this.indicator.paint(t);else if(this.indicatorImageSrc){const l=this.getIndicatorBounds(e,i,s,n);t.image(l.x,l.y,l.width,l.height,this.indicatorImageSrc,!1,!1,!1)}}getIndicatorBounds(t,e,i,s){const n=this.style?.imageAlign??Constants.ALIGN.LEFT,l=this.style?.verticalAlign??Constants.ALIGN.MIDDLE,a=this.style?.indicatorWidth??this.indicatorSize,r=this.style?.indicatorHeight??this.indicatorSize,o=this.spacing+5;return n===Constants.ALIGN.RIGHT?t+=i-a-o:n===Constants.ALIGN.CENTER?t+=(i-a)/2:t+=o,l===Constants.ALIGN.BOTTOM?e+=s-r-o:l===Constants.ALIGN.TOP?e+=o:e+=(s-r)/2,new Rectangle.default(t,e,a,r)}redrawHtmlShape(){for(super.redrawHtmlShape();this.node.hasChildNodes();)this.node.removeChild(this.node.lastChild);if(this.imageSrc&&this.bounds){const t=document.createElement("img");t.style.position="relative",t.setAttribute("border","0");const e=this.getImageBounds(this.bounds.x,this.bounds.y,this.bounds.width,this.bounds.height);e.x-=this.bounds.x,e.y-=this.bounds.y,t.style.left=`${Math.round(e.x)}px`,t.style.top=`${Math.round(e.y)}px`,t.style.width=`${Math.round(e.width)}px`,t.style.height=`${Math.round(e.height)}px`,t.src=this.imageSrc,this.node.appendChild(t)}}}const node_LabelShape=LabelShape;let isDefaultElementsRegistered=!1;function registerDefaultShapes(){if(!isDefaultElementsRegistered){const t=[[Constants.SHAPE.ACTOR,geometry_ActorShape],[Constants.SHAPE.ARROW,edge_ArrowShape],[Constants.SHAPE.ARROW_CONNECTOR,edge_ArrowConnectorShape],[Constants.SHAPE.CONNECTOR,edge_ConnectorShape],[Constants.SHAPE.CLOUD,node_CloudShape],[Constants.SHAPE.CYLINDER,node_CylinderShape],[Constants.SHAPE.DOUBLE_ELLIPSE,node_DoubleEllipseShape],[Constants.SHAPE.ELLIPSE,node_EllipseShape],[Constants.SHAPE.HEXAGON,node_HexagonShape],[Constants.SHAPE.IMAGE,ImageShape.default],[Constants.SHAPE.LABEL,node_LabelShape],[Constants.SHAPE.LINE,edge_LineShape],[Constants.SHAPE.RECTANGLE,RectangleShape.default],[Constants.SHAPE.RHOMBUS,node_RhombusShape],[Constants.SHAPE.SWIMLANE,node_SwimlaneShape],[Constants.SHAPE.TRIANGLE,node_TriangleShape]];for(const[e,i]of t)cell_CellRenderer.registerShape(e,i);isDefaultElementsRegistered=!0}}const EllipsePerimeter=(t,e,i,s=!1)=>{const{x:n}=t,{y:l}=t,a=t.width/2,r=t.height/2,o=n+a,h=l+r,d=i.x,u=i.y,c=parseInt(String(d-o)),g=parseInt(String(u-h));if(0===c&&0!==g)return new Point.default(o,h+r*g/Math.abs(g));if(0===c&&0===g)return new Point.default(d,u);if(s){if(u>=l&&u<=l+t.height){const t=u-h;let e=Math.sqrt(a*a*(1-t*t/(r*r)))||0;return d<=n&&(e=-e),new Point.default(o+e,u)}if(d>=n&&d<=n+t.width){const t=d-o;let e=Math.sqrt(r*r*(1-t*t/(a*a)))||0;return u<=l&&(e=-e),new Point.default(d,h+e)}}const p=g/c,f=h-p*o,E=a*a*p*p+r*r,C=-2*o*E,y=a*a*p*p*o*o+r*r*o*o-a*a*r*r,v=Math.sqrt(C*C-4*E*y),m=(-C+v)/(2*E),S=(-C-v)/(2*E),w=p*m+f,_=p*S+f;let x=0,T=0;return Math.sqrt(Math.pow(m-d,2)+Math.pow(w-u,2))<Math.sqrt(Math.pow(S-d,2)+Math.pow(_-u,2))?(x=m,T=w):(x=S,T=_),new Point.default(x,T)},HexagonPerimeter=(t,e,i,s=!1)=>{const{x:n}=t,{y:l}=t,a=t.width,r=t.height,o=t.getCenterX(),h=t.getCenterY(),d=i.x,u=i.y,c=d-o,g=u-h,p=-Math.atan2(g,c),f=Math.PI,E=Math.PI/2;let C=new Point.default(o,h);const y=e?.style?.direction??Constants.DIRECTION.EAST,v=y===Constants.DIRECTION.NORTH||y===Constants.DIRECTION.SOUTH;let m=new Point.default,S=new Point.default;if((d<n&&u<l||d<n&&u>l+r||d>n+a&&u<l||d>n+a&&u>l+r)&&(s=!1),s){if(v){if(d===o){if(u<=l)return new Point.default(o,l);if(u>=l+r)return new Point.default(o,l+r)}else if(d<n){if(u===l+r/4)return new Point.default(n,l+r/4);if(u===l+3*r/4)return new Point.default(n,l+3*r/4)}else if(d>n+a){if(u===l+r/4)return new Point.default(n+a,l+r/4);if(u===l+3*r/4)return new Point.default(n+a,l+3*r/4)}else if(d===n){if(u<h)return new Point.default(n,l+r/4);if(u>h)return new Point.default(n,l+3*r/4)}else if(d===n+a){if(u<h)return new Point.default(n+a,l+r/4);if(u>h)return new Point.default(n+a,l+3*r/4)}if(u===l)return new Point.default(o,l);if(u===l+r)return new Point.default(o,l+r);d<o?u>l+r/4&&u<l+3*r/4?(m=new Point.default(n,l),S=new Point.default(n,l+r)):u<l+r/4?(m=new Point.default(n-Math.floor(.5*a),l+Math.floor(.5*r)),S=new Point.default(n+a,l-Math.floor(.25*r))):u>l+3*r/4&&(m=new Point.default(n-Math.floor(.5*a),l+Math.floor(.5*r)),S=new Point.default(n+a,l+Math.floor(1.25*r))):d>o&&(u>l+r/4&&u<l+3*r/4?(m=new Point.default(n+a,l),S=new Point.default(n+a,l+r)):u<l+r/4?(m=new Point.default(n,l-Math.floor(.25*r)),S=new Point.default(n+Math.floor(1.5*a),l+Math.floor(.5*r))):u>l+3*r/4&&(m=new Point.default(n+Math.floor(1.5*a),l+Math.floor(.5*r)),S=new Point.default(n,l+Math.floor(1.25*r))))}else{if(u===h){if(d<=n)return new Point.default(n,l+r/2);if(d>=n+a)return new Point.default(n+a,l+r/2)}else if(u<l){if(d===n+a/4)return new Point.default(n+a/4,l);if(d===n+3*a/4)return new Point.default(n+3*a/4,l)}else if(u>l+r){if(d===n+a/4)return new Point.default(n+a/4,l+r);if(d===n+3*a/4)return new Point.default(n+3*a/4,l+r)}else if(u===l){if(d<o)return new Point.default(n+a/4,l);if(d>o)return new Point.default(n+3*a/4,l)}else if(u===l+r){if(d<o)return new Point.default(n+a/4,l+r);if(u>h)return new Point.default(n+3*a/4,l+r)}if(d===n)return new Point.default(n,h);if(d===n+a)return new Point.default(n+a,h);u<h?d>n+a/4&&d<n+3*a/4?(m=new Point.default(n,l),S=new Point.default(n+a,l)):d<n+a/4?(m=new Point.default(n-Math.floor(.25*a),l+r),S=new Point.default(n+Math.floor(.5*a),l-Math.floor(.5*r))):d>n+3*a/4&&(m=new Point.default(n+Math.floor(.5*a),l-Math.floor(.5*r)),S=new Point.default(n+Math.floor(1.25*a),l+r)):u>h&&(d>n+a/4&&d<n+3*a/4?(m=new Point.default(n,l+r),S=new Point.default(n+a,l+r)):d<n+a/4?(m=new Point.default(n-Math.floor(.25*a),l),S=new Point.default(n+Math.floor(.5*a),l+Math.floor(1.5*r))):d>n+3*a/4&&(m=new Point.default(n+Math.floor(.5*a),l+Math.floor(1.5*r)),S=new Point.default(n+Math.floor(1.25*a),l)))}let t=o,e=h;d>=n&&d<=n+a?(t=d,e=u<h?l+r:l):u>=l&&u<=l+r&&(e=u,t=d<o?n+a:n),C=(0,mathUtils.intersection)(t,e,i.x,i.y,m.x,m.y,S.x,S.y)}else{if(v){const t=Math.atan2(r/4,a/2);if(p===t)return new Point.default(n+a,l+Math.floor(.25*r));if(p===E)return new Point.default(n+Math.floor(.5*a),l);if(p===f-t)return new Point.default(n,l+Math.floor(.25*r));if(p===-t)return new Point.default(n+a,l+Math.floor(.75*r));if(p===-E)return new Point.default(n+Math.floor(.5*a),l+r);if(p===-f+t)return new Point.default(n,l+Math.floor(.75*r));p<t&&p>-t?(m=new Point.default(n+a,l),S=new Point.default(n+a,l+r)):p>t&&p<E?(m=new Point.default(n,l-Math.floor(.25*r)),S=new Point.default(n+Math.floor(1.5*a),l+Math.floor(.5*r))):p>E&&p<f-t?(m=new Point.default(n-Math.floor(.5*a),l+Math.floor(.5*r)),S=new Point.default(n+a,l-Math.floor(.25*r))):p>f-t&&p<=f||p<-f+t&&p>=-f?(m=new Point.default(n,l),S=new Point.default(n,l+r)):p<-t&&p>-E?(m=new Point.default(n+Math.floor(1.5*a),l+Math.floor(.5*r)),S=new Point.default(n,l+Math.floor(1.25*r))):p<-E&&p>-f+t&&(m=new Point.default(n-Math.floor(.5*a),l+Math.floor(.5*r)),S=new Point.default(n+a,l+Math.floor(1.25*r)))}else{const t=Math.atan2(r/2,a/4);if(p===t)return new Point.default(n+Math.floor(.75*a),l);if(p===f-t)return new Point.default(n+Math.floor(.25*a),l);if(p===f||p===-f)return new Point.default(n,l+Math.floor(.5*r));if(0===p)return new Point.default(n+a,l+Math.floor(.5*r));if(p===-t)return new Point.default(n+Math.floor(.75*a),l+r);if(p===-f+t)return new Point.default(n+Math.floor(.25*a),l+r);p>0&&p<t?(m=new Point.default(n+Math.floor(.5*a),l-Math.floor(.5*r)),S=new Point.default(n+Math.floor(1.25*a),l+r)):p>t&&p<f-t?(m=new Point.default(n,l),S=new Point.default(n+a,l)):p>f-t&&p<f?(m=new Point.default(n-Math.floor(.25*a),l+r),S=new Point.default(n+Math.floor(.5*a),l-Math.floor(.5*r))):p<0&&p>-t?(m=new Point.default(n+Math.floor(.5*a),l+Math.floor(1.5*r)),S=new Point.default(n+Math.floor(1.25*a),l)):p<-t&&p>-f+t?(m=new Point.default(n,l+r),S=new Point.default(n+a,l+r)):p<-f+t&&p>-f&&(m=new Point.default(n-Math.floor(.25*a),l),S=new Point.default(n+Math.floor(.5*a),l+Math.floor(1.5*r)))}C=(0,mathUtils.intersection)(o,h,i.x,i.y,m.x,m.y,S.x,S.y)}return null==C?new Point.default(o,h):C},RectanglePerimeter=(t,e,i,s=!1)=>{const n=t.getCenterX(),l=t.getCenterY(),a=i.x-n,r=i.y-l,o=Math.atan2(r,a),h=new Point.default(0,0),d=Math.PI,u=Math.PI/2-o,c=Math.atan2(t.height,t.width);return o<-d+c||o>d-c?(h.x=t.x,h.y=l-t.width*Math.tan(o)/2):o<-c?(h.y=t.y,h.x=n-t.height*Math.tan(u)/2):o<c?(h.x=t.x+t.width,h.y=l+t.width*Math.tan(o)/2):(h.y=t.y+t.height,h.x=n+t.height*Math.tan(u)/2),s&&(i.x>=t.x&&i.x<=t.x+t.width?h.x=i.x:i.y>=t.y&&i.y<=t.y+t.height&&(h.y=i.y),i.x<t.x?h.x=t.x:i.x>t.x+t.width&&(h.x=t.x+t.width),i.y<t.y?h.y=t.y:i.y>t.y+t.height&&(h.y=t.y+t.height)),h},RhombusPerimeter=(t,e,i,s=!1)=>{const{x:n}=t,{y:l}=t,a=t.width,r=t.height,o=n+a/2,h=l+r/2,d=i.x,u=i.y;if(o===d)return h>u?new Point.default(o,l):new Point.default(o,l+r);if(h===u)return o>d?new Point.default(n,h):new Point.default(n+a,h);let c=o,g=h;return s&&(d>=n&&d<=n+a?c=d:u>=l&&u<=l+r&&(g=u)),d<o?u<h?(0,mathUtils.intersection)(d,u,c,g,o,l,n,h):(0,mathUtils.intersection)(d,u,c,g,o,l+r,n,h):u<h?(0,mathUtils.intersection)(d,u,c,g,o,l,n+a,h):(0,mathUtils.intersection)(d,u,c,g,o,l+r,n+a,h)},TrianglePerimeter=(t,e,i,s=!1)=>{const n=null!=e?e.style.direction:null,l=n===Constants.DIRECTION.NORTH||n===Constants.DIRECTION.SOUTH,{x:a}=t,{y:r}=t,o=t.width,h=t.height;let d=a+o/2,u=r+h/2,c=new Point.default(a,r),g=new Point.default(a+o,u),p=new Point.default(a,r+h);n===Constants.DIRECTION.NORTH?(c=p,g=new Point.default(d,r),p=new Point.default(a+o,r+h)):n===Constants.DIRECTION.SOUTH?(g=new Point.default(d,r+h),p=new Point.default(a+o,r)):n===Constants.DIRECTION.WEST&&(c=new Point.default(a+o,r),g=new Point.default(a,u),p=new Point.default(a+o,r+h));let f=i.x-d,E=i.y-u;const C=l?Math.atan2(f,E):Math.atan2(E,f),y=l?Math.atan2(o,h):Math.atan2(h,o);let v=!1;v=n===Constants.DIRECTION.NORTH||n===Constants.DIRECTION.WEST?C>-y&&C<y:C<-Math.PI+y||C>Math.PI-y;let m=null;if(v)m=s&&(l&&i.x>=c.x&&i.x<=p.x||!l&&i.y>=c.y&&i.y<=p.y)?l?new Point.default(i.x,c.y):new Point.default(c.x,i.y):n===Constants.DIRECTION.NORTH?new Point.default(a+o/2+h*Math.tan(C)/2,r+h):n===Constants.DIRECTION.SOUTH?new Point.default(a+o/2-h*Math.tan(C)/2,r):n===Constants.DIRECTION.WEST?new Point.default(a+o,r+h/2+o*Math.tan(C)/2):new Point.default(a,r+h/2-o*Math.tan(C)/2);else{if(s){const t=new Point.default(d,u);i.y>=r&&i.y<=r+h?(t.x=l?d:n===Constants.DIRECTION.WEST?a+o:a,t.y=i.y):i.x>=a&&i.x<=a+o&&(t.x=i.x,t.y=l?n===Constants.DIRECTION.NORTH?r+h:r:u),f=i.x-t.x,E=i.y-t.y,d=t.x,u=t.y}m=l&&i.x<=a+o/2||!l&&i.y<=r+h/2?(0,mathUtils.intersection)(i.x,i.y,d,u,c.x,c.y,g.x,g.y):(0,mathUtils.intersection)(i.x,i.y,d,u,g.x,g.y,p.x,p.y)}return null==m&&(m=new Point.default(d,u)),m},Perimeter={RectanglePerimeter,EllipsePerimeter,RhombusPerimeter,TrianglePerimeter,HexagonPerimeter},style_Perimeter=Perimeter;var StyleRegistry=__webpack_require__(127);let isDefaultsRegistered=!1;const registerDefaultStyleElements=()=>{isDefaultsRegistered||(StyleRegistry.default.putValue(Constants.EDGESTYLE.ELBOW,style_EdgeStyle.ElbowConnector),StyleRegistry.default.putValue(Constants.EDGESTYLE.ENTITY_RELATION,style_EdgeStyle.EntityRelation),StyleRegistry.default.putValue(Constants.EDGESTYLE.LOOP,style_EdgeStyle.Loop),StyleRegistry.default.putValue(Constants.EDGESTYLE.MANHATTAN,style_EdgeStyle.ManhattanConnector),StyleRegistry.default.putValue(Constants.EDGESTYLE.ORTHOGONAL,style_EdgeStyle.OrthConnector),StyleRegistry.default.putValue(Constants.EDGESTYLE.SEGMENT,style_EdgeStyle.SegmentConnector),StyleRegistry.default.putValue(Constants.EDGESTYLE.SIDETOSIDE,style_EdgeStyle.SideToSide),StyleRegistry.default.putValue(Constants.EDGESTYLE.TOPTOBOTTOM,style_EdgeStyle.TopToBottom),StyleRegistry.default.putValue(Constants.PERIMETER.ELLIPSE,style_Perimeter.EllipsePerimeter),StyleRegistry.default.putValue(Constants.PERIMETER.HEXAGON,style_Perimeter.HexagonPerimeter),StyleRegistry.default.putValue(Constants.PERIMETER.RECTANGLE,style_Perimeter.RectanglePerimeter),StyleRegistry.default.putValue(Constants.PERIMETER.RHOMBUS,style_Perimeter.RhombusPerimeter),StyleRegistry.default.putValue(Constants.PERIMETER.TRIANGLE,style_Perimeter.TrianglePerimeter),isDefaultsRegistered=!0)};var Utils=__webpack_require__(675);const CellsMixin={cellsResizable:!0,cellsBendable:!0,cellsSelectable:!0,cellsDisconnectable:!0,autoSizeCells:!1,autoSizeCellsOnAdd:!1,cellsLocked:!1,cellsCloneable:!0,cellsDeletable:!0,cellsMovable:!0,extendParents:!0,extendParentsOnAdd:!0,extendParentsOnMove:!1,getBoundingBox(t){let e=null;if(t.length>0)for(const i of t)if(i.isVertex()||i.isEdge()){const t=this.getView().getBoundingBox(this.getView().getState(i),!0);t&&(e?e.add(t):e=Rectangle.default.fromRectangle(t))}return e},removeStateForCell(t){for(const e of t.getChildren())this.removeStateForCell(e);this.getView().invalidate(t,!1,!0),this.getView().removeState(t)},getCurrentCellStyle(t,e=!1){const i=e?null:this.getView().getState(t);return i?i.style:this.getCellStyle(t)},getCellStyle(t){const e=t.getStyle(),i=this.getStylesheet(),s=t.isEdge()?i.getDefaultEdgeStyle():i.getDefaultVertexStyle();return this.postProcessCellStyle(i.getCellStyle(e,s??{}))},postProcessCellStyle(t){if(!t.image)return t;const e=t.image;let i=this.getImageFromBundles(e);if(i?t.image=i:i=e,i&&"data:image/"===i.substring(0,11)){if("data:image/svg+xml,<"===i.substring(0,20))i=i.substring(0,19)+encodeURIComponent(i.substring(19));else if("data:image/svg+xml,%3C"!==i.substring(0,22)){const t=i.indexOf(",");t>0&&";base64,"!==i.substring(t-7,t+1)&&(i=`${i.substring(0,t)};base64,${i.substring(t+1)}`)}t.image=i}return t},setCellStyle(t,e){e=e??this.getSelectionCells(),this.batchUpdate((()=>{for(const i of e)this.getDataModel().setStyle(i,t)}))},toggleCellStyle(t,e=!1,i){return i=i??this.getSelectionCell(),this.toggleCellStyles(t,e,[i])},toggleCellStyles(t,e=!1,i){let s=!1;return(i=i??this.getSelectionCells()).length>0&&(s=!(this.getCurrentCellStyle(i[0])[t]??e),this.setCellStyles(t,s,i)),s},setCellStyles(t,e,i){i=i??this.getSelectionCells(),(0,styleUtils.setCellStyles)(this.getDataModel(),i,t,e)},toggleCellStyleFlags(t,e,i){i=i??this.getSelectionCells(),this.setCellStyleFlags(t,e,null,i)},setCellStyleFlags(t,e,i=null,s){(s=s??this.getSelectionCells()).length>0&&(null===i&&(i=!(((this.getCurrentCellStyle(s[0])[t]||0)&e)===e)),(0,styleUtils.setCellStyleFlags)(this.getDataModel(),s,t,e,i))},alignCells(t,e,i=null){if((e=e??this.getSelectionCells()).length>1){if(null===i)for(const s of e){const e=this.getView().getState(s);if(e&&!s.isEdge())if(null===i){if(t===Constants.ALIGN.CENTER){i=e.x+e.width/2;break}if(t===Constants.ALIGN.RIGHT)i=e.x+e.width;else if(t===Constants.ALIGN.TOP)i=e.y;else{if(t===Constants.ALIGN.MIDDLE){i=e.y+e.height/2;break}i=t===Constants.ALIGN.BOTTOM?e.y+e.height:e.x}}else i=t===Constants.ALIGN.RIGHT?Math.max(i,e.x+e.width):t===Constants.ALIGN.TOP?Math.min(i,e.y):t===Constants.ALIGN.BOTTOM?Math.max(i,e.y+e.height):Math.min(i,e.x)}if(null!==i){const s=this.getView().scale;this.batchUpdate((()=>{const n=i;for(const i of e){const e=this.getView().getState(i);if(null!=e){let l=i.getGeometry();null==l||i.isEdge()||(l=l.clone(),t===Constants.ALIGN.CENTER?l.x+=(n-e.x-e.width/2)/s:t===Constants.ALIGN.RIGHT?l.x+=(n-e.x-e.width)/s:t===Constants.ALIGN.TOP?l.y+=(n-e.y)/s:t===Constants.ALIGN.MIDDLE?l.y+=(n-e.y-e.height/2)/s:t===Constants.ALIGN.BOTTOM?l.y+=(n-e.y-e.height)/s:l.x+=(n-e.x)/s,this.resizeCell(i,l))}}this.fireEvent(new EventObject.default(InternalEvent.default.ALIGN_CELLS,{align:t,cells:e}))}))}}return e},cloneCell(t,e=!1,i={},s=!1){return this.cloneCells([t],e,i,s)[0]},cloneCells(t,e=!0,i={},s=!1){let n;const l=new Dictionary.default,a=[];for(const e of t)l.put(e,!0),a.push(e);if(a.length>0){const{scale:a}=this.getView(),r=this.getView().translate,o=[];n=cloneCells(t,!0,i);for(let i=0;i<t.length;i+=1){const h=t[i],d=n[i];if(!e&&d.isEdge()&&null!==this.getEdgeValidationError(d,d.getTerminal(!0),d.getTerminal(!1)));else{o.push(d);const t=d.getGeometry();if(t){const e=this.getView().getState(h),i=h.getParent(),n=i?this.getView().getState(i):null;if(e&&n){const i=s?0:n.origin.x,o=s?0:n.origin.y;if(d.isEdge()){const s=e.absolutePoints;let n=h.getTerminal(!0);for(;n&&!l.get(n);)n=n.getParent();!n&&s[0]&&t.setTerminalPoint(new Point.default(s[0].x/a-r.x,s[0].y/a-r.y),!0);let d=h.getTerminal(!1);for(;d&&!l.get(d);)d=d.getParent();const u=s[s.length-1];!d&&u&&t.setTerminalPoint(new Point.default(u.x/a-r.x,u.y/a-r.y),!1);const{points:c}=t;if(c)for(const t of c)t.x+=i,t.y+=o}else t.translate(i,o)}}}}n=o}else n=[];return n},addCell(t,e=null,i=null,s=null,n=null){return this.addCells([t],e,i,s,n)[0]},addCells(t,e=null,i=null,s=null,n=null,l=!1){const a=e??this.getDefaultParent(),r=i??a.getChildCount();return this.batchUpdate((()=>{this.cellsAdded(t,a,r,s,n,l,!0),this.fireEvent(new EventObject.default(InternalEvent.default.ADD_CELLS,{cells:t,p:a,i:r,source:s,target:n}))})),t},cellsAdded(t,e,i,s=null,n=null,l=!1,a=!1,r=!0){this.batchUpdate((()=>{const o=l?this.getView().getState(e):null,h=o?o.origin:null,d=new Point.default(0,0);t.forEach(((t,l)=>{const o=t.getParent();if(h&&t!==e&&e!==o){const e=o?this.getView().getState(o):null,i=e?e.origin:d;let s=t.getGeometry();if(s){const e=i.x-h.x,n=i.y-h.y;s=s.clone(),s.translate(e,n),s.relative||!t.isVertex()||this.isAllowNegativeCoordinates()||(s.x=Math.max(0,s.x),s.y=Math.max(0,s.y)),this.getDataModel().setGeometry(t,s)}}e===o&&i+l>e.getChildCount()&&i--,this.getDataModel().add(e,t,i+l),this.autoSizeCellsOnAdd&&this.autoSizeCell(t,!0),(!r||r)&&this.isExtendParentsOnAdd(t)&&this.isExtendParent(t)&&this.extendParent(t),a&&!a||this.constrainChild(t),s&&this.cellConnected(t,s,!0),n&&this.cellConnected(t,n,!1)})),this.fireEvent(new EventObject.default(InternalEvent.default.CELLS_ADDED,{cells:t,parent:e,index:i,source:s,target:n,absolute:l}))}))},autoSizeCell(t,e=!0){if(e)for(const e of t.getChildren())this.autoSizeCell(e);t.isVertex()&&this.isAutoSizeCell(t)&&this.updateCellSize(t)},removeCells(t=null,e=!0){if(t||(t=this.getDeletableCells(this.getSelectionCells())),e)t=this.getDeletableCells(this.addAllEdges(t));else{t=t.slice();const e=this.getDeletableCells(this.getAllEdges(t)),i=new Dictionary.default;for(const e of t)i.put(e,!0);for(const s of e)this.getView().getState(s)||i.get(s)||(i.put(s,!0),t.push(s))}return this.batchUpdate((()=>{this.cellsRemoved(t),this.fireEvent(new EventObject.default(InternalEvent.default.REMOVE_CELLS,{cells:t,includeEdges:e}))})),t??[]},cellsRemoved(t){if(t.length>0){const{scale:e}=this.getView(),i=this.getView().translate;this.batchUpdate((()=>{const s=new Dictionary.default;for(const e of t)s.put(e,!0);for(const n of t){const t=this.getAllEdges([n]),l=(t,s)=>{let l=t.getGeometry();if(l){const a=t.getTerminal(s);let r=!1,o=a;for(;o;){if(n===o){r=!0;break}o=o.getParent()}if(r){l=l.clone();const n=this.getView().getState(t);if(n){const t=n.absolutePoints,a=t[s?0:t.length-1];l.setTerminalPoint(new Point.default(a.x/e-i.x-n.origin.x,a.y/e-i.y-n.origin.y),s)}else if(a){const t=this.getView().getState(a);t&&l.setTerminalPoint(new Point.default(t.getCenterX()/e-i.x,t.getCenterY()/e-i.y),s)}this.getDataModel().setGeometry(t,l),this.getDataModel().setTerminal(t,null,s)}}};for(const e of t)s.get(e)||(s.put(e,!0),l(e,!0),l(e,!1));this.getDataModel().remove(n)}this.fireEvent(new EventObject.default(InternalEvent.default.CELLS_REMOVED,{cells:t}))}))}},toggleCells(t=!1,e,i=!0){return e=e??this.getSelectionCells(),i&&(e=this.addAllEdges(e)),this.batchUpdate((()=>{this.cellsToggled(e,t),this.fireEvent(new EventObject.default(InternalEvent.default.TOGGLE_CELLS,{show:t,cells:e,includeEdges:i}))})),e},cellsToggled(t,e=!1){t.length>0&&this.batchUpdate((()=>{for(const i of t)this.getDataModel().setVisible(i,e)}))},updateCellSize(t,e=!1){return this.batchUpdate((()=>{this.cellSizeUpdated(t,e),this.fireEvent(new EventObject.default(InternalEvent.default.UPDATE_CELL_SIZE,{cell:t,ignoreChildren:e}))})),t},cellSizeUpdated(t,e=!1){this.batchUpdate((()=>{const i=this.getPreferredSizeForCell(t);let s=t.getGeometry();if(i&&s){const n=t.isCollapsed();if(s=s.clone(),this.isSwimlane(t)){const e=this.getCellStyle(t),l=t.getStyle();e.horizontal??1?(l.startSize=i.height+8,n&&(s.height=i.height+8),s.width=i.width):(l.startSize=i.width+8,n&&(s.width=i.width+8),s.height=i.height),this.getDataModel().setStyle(t,l)}else{const e=this.getView().createState(t),n=e.style.align??Constants.ALIGN.CENTER;n===Constants.ALIGN.RIGHT?s.x+=s.width-i.width:n===Constants.ALIGN.CENTER&&(s.x+=Math.round((s.width-i.width)/2));const l=e.getVerticalAlign();l===Constants.ALIGN.BOTTOM?s.y+=s.height-i.height:l===Constants.ALIGN.MIDDLE&&(s.y+=Math.round((s.height-i.height)/2)),s.width=i.width,s.height=i.height}if(!e&&!n){const e=this.getView().getBounds(t.getChildren());if(null!=e){const t=this.getView().translate,{scale:i}=this.getView(),n=(e.x+e.width)/i-s.x-t.x,l=(e.y+e.height)/i-s.y-t.y;s.width=Math.max(s.width,n),s.height=Math.max(s.height,l)}}this.cellsResized([t],[s],!1)}}))},getPreferredSizeForCell(t,e=null){let i=null;const s=this.getView().createState(t),{style:n}=s;if(!t.isEdge()){const t=n.fontSize||Constants.DEFAULT_FONTSIZE;let l=0,a=0;(s.getImageSrc()||n.image)&&n.shape===Constants.SHAPE.LABEL&&(n.verticalAlign===Constants.ALIGN.MIDDLE&&(l+=n.imageWidth||Constants.DEFAULT_IMAGESIZE),n.align!==Constants.ALIGN.CENTER&&(a+=n.imageHeight||Constants.DEFAULT_IMAGESIZE)),l+=2*(n.spacing||0),l+=n.spacingLeft||0,l+=n.spacingRight||0,a+=2*(n.spacing||0),a+=n.spacingTop||0,a+=n.spacingBottom||0;const r=this.getFoldingImage(s);r&&(l+=r.width+8);let o=this.getCellRenderer().getLabelValue(s);if(o&&o.length>0){this.isHtmlLabel(s.cell)||(o=(0,StringUtils.htmlEntities)(o,!1)),o=o.replace(/\n/g,"<br>");const r=(0,styleUtils.getSizeForString)(o,t,n.fontFamily,e,n.fontStyle);let h=r.width+l,d=r.height+a;if(!(n.horizontal??1)){const t=d;d=h,h=t}this.isGridEnabled()&&(h=this.snap(h+this.getGridSize()/2),d=this.snap(d+this.getGridSize()/2)),i=new Rectangle.default(0,0,h,d)}else{const t=4*this.getGridSize();i=new Rectangle.default(0,0,t,t)}}return i},resizeCell(t,e,i=!1){return this.resizeCells([t],[e],i)[0]},resizeCells(t,e,i){return i=i??this.isRecursiveResize(),this.batchUpdate((()=>{const s=this.cellsResized(t,e,i);this.fireEvent(new EventObject.default(InternalEvent.default.RESIZE_CELLS,{cells:t,bounds:e,prev:s}))})),t},cellsResized(t,e,i=!1){const s=[];return t.length===e.length&&this.batchUpdate((()=>{t.forEach(((t,n)=>{s.push(this.cellResized(t,e[n],!1,i)),this.isExtendParent(t)&&this.extendParent(t),this.constrainChild(t)})),this.isResetEdgesOnResize()&&this.resetEdges(t),this.fireEvent(new EventObject.default(InternalEvent.default.CELLS_RESIZED,{cells:t,bounds:e,prev:s}))})),s},cellResized(t,e,i=!1,s=!1){const n=t.getGeometry();if(n&&(n.x!==e.x||n.y!==e.y||n.width!==e.width||n.height!==e.height)){const l=n.clone();if(!i&&l.relative){const{offset:t}=l;t&&(t.x+=e.x-l.x,t.y+=e.y-l.y)}else l.x=e.x,l.y=e.y;l.width=e.width,l.height=e.height,l.relative||!t.isVertex()||this.isAllowNegativeCoordinates()||(l.x=Math.max(0,l.x),l.y=Math.max(0,l.y)),this.batchUpdate((()=>{s&&this.resizeChildCells(t,l),this.getDataModel().setGeometry(t,l),this.constrainChildCells(t)}))}return n},resizeChildCells(t,e){const i=t.getGeometry();if(i){const s=0!==i.width?e.width/i.width:1,n=0!==i.height?e.height/i.height:1;for(const e of t.getChildren())this.scaleCell(e,s,n,!0)}},constrainChildCells(t){for(const e of t.getChildren())this.constrainChild(e)},scaleCell(t,e,i,s=!1){let n=t.getGeometry();if(n){const l=this.getCurrentCellStyle(t);n=n.clone();const{x:a}=n,{y:r}=n,o=n.width,h=n.height;n.scale(e,i,"fixed"===l.aspect),l.resizeWidth?n.width=o*e:l.resizeWidth||(n.width=o),l.resizeHeight?n.height=h*i:l.resizeHeight||(n.height=h),this.isCellMovable(t)||(n.x=a,n.y=r),this.isCellResizable(t)||(n.width=o,n.height=h),t.isVertex()?this.cellResized(t,n,!0,s):this.getDataModel().setGeometry(t,n)}},extendParent(t){const e=t.getParent();let i=e?e.getGeometry():null;if(e&&i&&!e.isCollapsed()){const s=t.getGeometry();s&&!s.relative&&(i.width<s.x+s.width||i.height<s.y+s.height)&&(i=i.clone(),i.width=Math.max(i.width,s.x+s.width),i.height=Math.max(i.height,s.y+s.height),this.cellsResized([e],[i],!1))}},importCells(t,e,i,s=null,n=null,l={}){return this.moveCells(t,e,i,!0,s,n,l)},moveCells(t,e=0,i=0,s=!1,n=null,l=null,a={}){if(0!==e||0!==i||s||n){const r=t=getTopmostCells(t);this.batchUpdate((()=>{const o=new Dictionary.default;for(const e of t)o.put(e,!0);const h=t=>{for(;t;){if(o.get(t))return!0;t=t.getParent()}return!1},d=[];for(const e of t){const t=e.getGeometry(),i=e.getParent();(!t||!t.relative||i&&!i.isEdge()||i&&!h(i.getTerminal(!0))&&!h(i.getTerminal(!1)))&&d.push(e)}t=d,s&&(t=this.cloneCells(t,this.isCloneInvalidEdges(),a),n||(n=this.getDefaultParent()));const u=this.isAllowNegativeCoordinates();if(n&&this.setAllowNegativeCoordinates(!0),this.cellsMoved(t,e,i,!s&&this.isDisconnectOnMove()&&this.isAllowDanglingEdges(),!n,this.isExtendParentsOnMove()&&!n),this.setAllowNegativeCoordinates(u),n){const e=n.getChildCount();this.cellsAdded(t,n,e,null,null,!0),s&&t.forEach(((t,e)=>{const i=t.getGeometry(),s=r[e].getParent();i&&i.relative&&s&&s.isEdge()&&this.getDataModel().contains(s)&&this.getDataModel().add(s,t)}))}this.fireEvent(new EventObject.default(InternalEvent.default.MOVE_CELLS,{cells:t,dx:e,dy:i,clone:s,target:n,event:l}))}))}return t},cellsMoved(t,e,i,s=!1,n=!1,l=!1){0===e&&0===i||this.batchUpdate((()=>{s&&this.disconnectGraph(t);for(const s of t)this.translateCell(s,e,i),l&&this.isExtendParent(s)?this.extendParent(s):n&&this.constrainChild(s);this.isResetEdgesOnMove()&&this.resetEdges(t),this.fireEvent(new EventObject.default(InternalEvent.default.CELLS_MOVED,{cells:t,dx:e,dy:i,disconnect:s}))}))},translateCell(t,e,i){let s=t.getGeometry();if(s){if(s=s.clone(),s.translate(e,i),s.relative||!t.isVertex()||this.isAllowNegativeCoordinates()||(s.x=Math.max(0,s.x),s.y=Math.max(0,s.y)),s.relative&&!t.isEdge()){const n=t.getParent();let l=0;if(n.isVertex()&&(l=this.getCurrentCellStyle(n).rotation??0),0!==l){const t=(0,mathUtils.toRadians)(-l),s=Math.cos(t),n=Math.sin(t),a=(0,mathUtils.getRotatedPoint)(new Point.default(e,i),s,n,new Point.default(0,0));e=a.x,i=a.y}s.offset?(s.offset.x=s.offset.x+e,s.offset.y=s.offset.y+i):s.offset=new Point.default(e,i)}this.getDataModel().setGeometry(t,s)}},getCellContainmentArea(t){if(!t.isEdge()){const e=t.getParent();if(e&&e!==this.getDefaultParent()){const t=e.getGeometry();if(t){let i=0,s=0,n=t.width,l=t.height;if(this.isSwimlane(e)){const t=this.getStartSize(e),a=this.getCurrentCellStyle(e),r=a.direction??Constants.DIRECTION.EAST,o=a.flipH??!1,h=a.flipV??!1;if(r===Constants.DIRECTION.SOUTH||r===Constants.DIRECTION.NORTH){const e=t.width;t.width=t.height,t.height=e}(r===Constants.DIRECTION.EAST&&!h||r===Constants.DIRECTION.NORTH&&!o||r===Constants.DIRECTION.WEST&&h||r===Constants.DIRECTION.SOUTH&&o)&&(i=t.width,s=t.height),n-=t.width,l-=t.height}return new Rectangle.default(i,s,n,l)}}}return null},constrainChild(t,e=!0){let i=t.getGeometry();if(i&&(this.isConstrainRelativeChildren()||!i.relative)){const e=t.getParent();let s=this.getMaximumGraphBounds();if(s&&e){const t=this.getBoundingBoxFromGeometry([e],!1);t&&(s=Rectangle.default.fromRectangle(s),s.x-=t.x,s.y-=t.y)}if(this.isConstrainChild(t)){let e=this.getCellContainmentArea(t);if(e){const i=this.getOverlap(t);i>0&&(e=Rectangle.default.fromRectangle(e),e.x-=e.width*i,e.y-=e.height*i,e.width+=2*e.width*i,e.height+=2*e.height*i),s?(s=Rectangle.default.fromRectangle(s),s.intersect(e)):s=e}}if(s){const e=[t];if(!t.isCollapsed()){const i=t.getDescendants();for(const t of i)t.isVisible()&&e.push(t)}const n=this.getBoundingBoxFromGeometry(e,!1);if(n){i=i.clone();let e=0;i.width>s.width&&(e=i.width-s.width,i.width-=e),n.x+n.width>s.x+s.width&&(e-=n.x+n.width-s.x-s.width-e);let l=0;i.height>s.height&&(l=i.height-s.height,i.height-=l),n.y+n.height>s.y+s.height&&(l-=n.y+n.height-s.y-s.height-l),n.x<s.x&&(e-=n.x-s.x),n.y<s.y&&(l-=n.y-s.y),0===e&&0===l||(i.relative?(i.offset||(i.offset=new Point.default),i.offset.x+=e,i.offset.y+=l):(i.x+=e,i.y+=l)),this.getDataModel().setGeometry(t,i)}}}},getChildCells(t,e=!1,i=!1){const s=(t=t??this.getDefaultParent()).getChildCells(e,i),n=[];for(const t of s)t.isVisible()&&n.push(t);return n},getCellAt(t,e,i=null,s=!0,n=!0,l=null){if(i||(i=this.getCurrentRoot())||(i=this.getDataModel().getRoot()),i)for(let a=i.getChildCount()-1;a>=0;a--){const r=i.getChildAt(a),o=this.getCellAt(t,e,r,s,n,l);if(o)return o;if(r.isVisible()&&(n&&r.isEdge()||s&&r.isVertex())){const i=this.getView().getState(r);if(i&&(!l||!l(i,t,e))&&this.intersects(i,t,e))return r}}return null},getCells(t,e,i,s,n=null,l=[],a=null,r=null,o=!1){if(i>0||s>0||a){const h=this.getDataModel(),d=t+i,u=e+s;if(n||(n=this.getCurrentRoot())||(n=h.getRoot()),n)for(const h of n.getChildren()){const n=this.getView().getState(h);if(n&&h.isVisible()&&(!r||!r(n))){const c=n.style.rotation??0;let g=n;0!==c&&(g=(0,mathUtils.getBoundingBox)(g,c));const p=a&&h.isVertex()&&(0,mathUtils.intersects)(a,g)||!a&&(h.isEdge()||h.isVertex())&&g.x>=t&&g.y+g.height<=u&&g.y>=e&&g.x+g.width<=d;p&&l.push(h),p&&!o||this.getCells(t,e,i,s,h,l,a,r,o)}}}return l},getCellsBeyond(t,e,i=null,s=!1,n=!1){const l=[];if((s||n)&&(i||(i=this.getDefaultParent()),i))for(const a of i.getChildren()){const i=this.getView().getState(a);a.isVisible()&&i&&(!s||i.x>=t)&&(!n||i.y>=e)&&l.push(a)}return l},intersects(t,e,i){const s=t.absolutePoints;if(s.length>0){const t=this.getEventTolerance()*this.getEventTolerance();let n=s[0];for(let l=1;l<s.length;l+=1){const a=s[l];if(n&&a&&(0,mathUtils.ptSegDistSq)(n.x,n.y,a.x,a.y,e,i)<=t)return!0;n=a}}else{const s=(0,mathUtils.toRadians)(t.style.rotation??0);if(0!==s){const n=Math.cos(-s),l=Math.sin(-s),a=new Point.default(t.getCenterX(),t.getCenterY()),r=(0,mathUtils.getRotatedPoint)(new Point.default(e,i),n,l,a);e=r.x,i=r.y}if((0,mathUtils.contains)(t,e,i))return!0}return!1},isValidAncestor:(t,e,i=!1)=>i?e.isAncestor(t):t?.getParent()===e,isCellLocked(t){const e=t.getGeometry();return this.isCellsLocked()||!!e&&t.isVertex()&&e.relative},isCellsLocked(){return this.cellsLocked},setCellsLocked(t){this.cellsLocked=t},getCloneableCells(t){return this.getDataModel().filterCells(t,(t=>this.isCellCloneable(t)))},isCellCloneable(t){return this.isCellsCloneable()&&(this.getCurrentCellStyle(t).cloneable??!0)},isCellsCloneable(){return this.cellsCloneable},setCellsCloneable(t){this.cellsCloneable=t},getExportableCells(t){return this.getDataModel().filterCells(t,(t=>this.canExportCell(t)))},canExportCell(t=null){return this.isExportEnabled()},getImportableCells(t){return this.getDataModel().filterCells(t,(t=>this.canImportCell(t)))},canImportCell(t=null){return this.isImportEnabled()},isCellSelectable(t){return this.isCellsSelectable()},isCellsSelectable(){return this.cellsSelectable},setCellsSelectable(t){this.cellsSelectable=t},getDeletableCells(t){return this.getDataModel().filterCells(t,(t=>this.isCellDeletable(t)))},isCellDeletable(t){return this.isCellsDeletable()&&(this.getCurrentCellStyle(t).deletable??!0)},isCellsDeletable(){return this.cellsDeletable},setCellsDeletable(t){this.cellsDeletable=t},isCellRotatable(t){return this.getCurrentCellStyle(t).rotatable??!0},getMovableCells(t){return this.getDataModel().filterCells(t,(t=>this.isCellMovable(t)))},isCellMovable(t){return this.isCellsMovable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).movable??!0)},isCellsMovable(){return this.cellsMovable},setCellsMovable(t){this.cellsMovable=t},isCellResizable(t){return this.isCellsResizable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).resizable??!0)},isCellsResizable(){return this.cellsResizable},setCellsResizable(t){this.cellsResizable=t},isCellBendable(t){return this.isCellsBendable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).bendable??!0)},isCellsBendable(){return this.cellsBendable},setCellsBendable(t){this.cellsBendable=t},isAutoSizeCell(t){return this.isAutoSizeCells()||(this.getCurrentCellStyle(t).autoSize??!1)},isAutoSizeCells(){return this.autoSizeCells},setAutoSizeCells(t){this.autoSizeCells=t},isExtendParent(t){return!t.isEdge()&&this.isExtendParents()},isExtendParents(){return this.extendParents},setExtendParents(t){this.extendParents=t},isExtendParentsOnAdd(t){return this.extendParentsOnAdd},setExtendParentsOnAdd(t){this.extendParentsOnAdd=t},isExtendParentsOnMove(){return this.extendParentsOnMove},setExtendParentsOnMove(t){this.extendParentsOnMove=t},getCursorForCell:t=>null,getCellBounds(t,e=!1,i=!1){let s=[t];e&&(s=s.concat(t.getEdges()));let n=this.getView().getBounds(s);if(i)for(const i of t.getChildren()){const t=this.getCellBounds(i,e,!0);n&&t?n.add(t):n=t}return n},getBoundingBoxFromGeometry(t,e=!1){let i=null,s=null;for(const n of t)if(e||n.isVertex()){const e=n.getGeometry();if(e){let l=null;if(n.isEdge()){const t=t=>{t&&(s?s.add(new Rectangle.default(t.x,t.y,0,0)):s=new Rectangle.default(t.x,t.y,0,0))};n.getTerminal(!0)||t(e.getTerminalPoint(!0)),n.getTerminal(!1)||t(e.getTerminalPoint(!1));const i=e.points;if(i&&i.length>0){s=new Rectangle.default(i[0].x,i[0].y,0,0);for(let e=1;e<i.length;e++)t(i[e])}l=s}else{const i=n.getParent();e.relative&&i?i.isVertex()&&i!==this.getView().currentRoot&&(s=this.getBoundingBoxFromGeometry([i],!1),s&&(l=new Rectangle.default(e.x*s.width,e.y*s.height,e.width,e.height),t.indexOf(i)>=0&&(l.x+=s.x,l.y+=s.y))):(l=Rectangle.default.fromRectangle(e),i&&i.isVertex()&&t.indexOf(i)>=0&&(s=this.getBoundingBoxFromGeometry([i],!1),s&&(l.x+=s.x,l.y+=s.y))),l&&e.offset&&(l.x+=e.offset.x,l.y+=e.offset.y);const a=this.getCurrentCellStyle(n);if(l){const t=a.rotation??0;0!==t&&(l=(0,mathUtils.getBoundingBox)(l,t))}}l&&(i?i.add(l):i=Rectangle.default.fromRectangle(l))}}return i}},ConnectionsMixin={constrainChildren:!0,constrainRelativeChildren:!1,disconnectOnMove:!0,cellsDisconnectable:!0,getOutlineConstraint(t,e,i){if(e.shape){const i=this.getView().getPerimeterBounds(e),s=e.style.direction;if(s===Constants.DIRECTION.NORTH||s===Constants.DIRECTION.SOUTH){i.x+=i.width/2-i.height/2,i.y+=i.height/2-i.width/2;const t=i.width;i.width=i.height,i.height=t}const n=(0,mathUtils.toRadians)(e.shape.getShapeRotation());if(0!==n){const e=Math.cos(-n),s=Math.sin(-n),l=new Point.default(i.getCenterX(),i.getCenterY());t=(0,mathUtils.getRotatedPoint)(t,e,s,l)}let l=1,a=1,r=0,o=0;if(e.cell.isVertex()){let t=e.style.flipH,n=e.style.flipV;if(s===Constants.DIRECTION.NORTH||s===Constants.DIRECTION.SOUTH){const e=t;t=n,n=e}t&&(l=-1,r=-i.width),n&&(a=-1,o=-i.height)}t=new Point.default((t.x-i.x)*l-r+i.x,(t.y-i.y)*a-o+i.y);const h=0===i.width?0:Math.round(1e3*(t.x-i.x)/i.width)/1e3,d=0===i.height?0:Math.round(1e3*(t.y-i.y)/i.height)/1e3;return new other_ConnectionConstraint(new Point.default(h,d),!1)}return null},getAllConnectionConstraints:(t,e)=>t?.shape?.stencil?.constraints??null,getConnectionConstraint(t,e,i=!1){let s=null;const n=t.style[i?"exitX":"entryX"];if(void 0!==n){const e=t.style[i?"exitY":"entryY"];void 0!==e&&(s=new Point.default(n,e))}let l=!1,a=0,r=0;return s&&(l=t.style[i?"exitPerimeter":"entryPerimeter"]||!1,a=t.style[i?"exitDx":"entryDx"],r=t.style[i?"exitDy":"entryDy"],a=Number.isFinite(a)?a:0,r=Number.isFinite(r)?r:0),new other_ConnectionConstraint(s,l,null,a,r)},setConnectionConstraint(t,e,i=!1,s=null){s&&this.batchUpdate((()=>{s&&s.point?s.point&&(this.setCellStyles(i?"exitX":"entryX",s.point.x,[t]),this.setCellStyles(i?"exitY":"entryY",s.point.y,[t]),this.setCellStyles(i?"exitDx":"entryDx",s.dx,[t]),this.setCellStyles(i?"exitDy":"entryDy",s.dy,[t]),s.perimeter?this.setCellStyles(i?"exitPerimeter":"entryPerimeter",null,[t]):this.setCellStyles(i?"exitPerimeter":"entryPerimeter","0",[t])):(this.setCellStyles(i?"exitX":"entryX",null,[t]),this.setCellStyles(i?"exitY":"entryY",null,[t]),this.setCellStyles(i?"exitDx":"entryDx",null,[t]),this.setCellStyles(i?"exitDy":"entryDy",null,[t]),this.setCellStyles(i?"exitPerimeter":"entryPerimeter",null,[t]))}))},getConnectionPoint(t,e,i=!0){let s=null;if(e.point){const i=this.getView().getPerimeterBounds(t),n=new Point.default(i.getCenterX(),i.getCenterY()),l=t.style.direction;let a=0;t.style.anchorPointDirection&&(l===Constants.DIRECTION.NORTH?a+=270:l===Constants.DIRECTION.WEST?a+=180:l===Constants.DIRECTION.SOUTH&&(a+=90),l!==Constants.DIRECTION.NORTH&&l!==Constants.DIRECTION.SOUTH||i.rotate90());const{scale:r}=this.getView();s=new Point.default(i.x+e.point.x*i.width+e.dx*r,i.y+e.point.y*i.height+e.dy*r);let o=t.style.rotation||0;if(e.perimeter){if(0!==a){let t=0,e=0;90===a?e=1:180===a?t=-1:270===a&&(e=-1),s=(0,mathUtils.getRotatedPoint)(s,t,e,n)}s=this.getView().getPerimeterPoint(t,s,!1)}else if(o+=a,t.cell.isVertex()){let e=t.style.flipH,n=t.style.flipV;if(l===Constants.DIRECTION.NORTH||l===Constants.DIRECTION.SOUTH){const t=e;e=n,n=t}e&&(s.x=2*i.getCenterX()-s.x),n&&(s.y=2*i.getCenterY()-s.y)}if(0!==o&&s){const t=(0,mathUtils.toRadians)(o),e=Math.cos(t),i=Math.sin(t);s=(0,mathUtils.getRotatedPoint)(s,e,i,n)}}return i&&s&&(s.x=Math.round(s.x),s.y=Math.round(s.y)),s},connectCell(t,e=null,i=!1,s=null){return this.batchUpdate((()=>{const n=t.getTerminal(i);this.cellConnected(t,e,i,s),this.fireEvent(new EventObject.default(InternalEvent.default.CONNECT_CELL,"edge",t,"terminal",e,"source",i,"previous",n))})),t},cellConnected(t,e,i=!1,s=null){this.batchUpdate((()=>{const n=t.getTerminal(i);if(this.setConnectionConstraint(t,e,i,s),this.isPortsEnabled()){let s=null;e&&this.isPort(e)&&(s=e.getId(),e=this.getTerminalForPort(e,i));const n=i?"sourcePort":"targetPort";this.setCellStyles(n,s,[t])}this.getDataModel().setTerminal(t,e,i),this.isResetEdgesOnConnect()&&this.resetEdge(t),this.fireEvent(new EventObject.default(InternalEvent.default.CELL_CONNECTED,"edge",t,"terminal",e,"source",i,"previous",n))}))},disconnectGraph(t){this.batchUpdate((()=>{const{scale:e,translate:i}=this.getView(),s=new Dictionary.default;for(let e=0;e<t.length;e+=1)s.put(t[e],!0);for(const n of t)if(n.isEdge()){let t=n.getGeometry();if(t){const l=this.getView().getState(n),a=n.getParent(),r=a?this.getView().getState(a):null;if(l&&r){t=t.clone();const a=-r.origin.x,o=-r.origin.y,h=l.absolutePoints;let d=n.getTerminal(!0);if(d&&this.isCellDisconnectable(n,d,!0)){for(;d&&!s.get(d);)d=d.getParent();!d&&h[0]&&(t.setTerminalPoint(new Point.default(h[0].x/e-i.x+a,h[0].y/e-i.y+o),!0),this.getDataModel().setTerminal(n,null,!0))}let u=n.getTerminal(!1);if(u&&this.isCellDisconnectable(n,u,!1)){for(;u&&!s.get(u);)u=u.getParent();if(!u){const s=h[h.length-1];s&&(t.setTerminalPoint(new Point.default(s.x/e-i.x+a,s.y/e-i.y+o),!1),this.getDataModel().setTerminal(n,null,!1))}}this.getDataModel().setGeometry(n,t)}}}}))},getConnections(t,e=null){return this.getEdges(t,e,!0,!0,!1)},isConstrainChild(t){return this.isConstrainChildren()&&!!t.getParent()&&!t.getParent().isEdge()},isConstrainChildren(){return this.constrainChildren},setConstrainChildren(t){this.constrainChildren=t},isConstrainRelativeChildren(){return this.constrainRelativeChildren},setConstrainRelativeChildren(t){this.constrainRelativeChildren=t},isDisconnectOnMove(){return this.disconnectOnMove},setDisconnectOnMove(t){this.disconnectOnMove=t},isCellDisconnectable(t,e=null,i=!1){return this.isCellsDisconnectable()&&!this.isCellLocked(t)},isCellsDisconnectable(){return this.cellsDisconnectable},setCellsDisconnectable(t){this.cellsDisconnectable=t},isValidSource(t){return null==t&&this.isAllowDanglingEdges()||null!=t&&(!t.isEdge()||this.isConnectableEdges())&&t.isConnectable()},isValidTarget(t){return this.isValidSource(t)},isValidConnection(t,e){return this.isValidSource(t)&&this.isValidTarget(e)},setConnectable(t){const e=this.getPlugin("ConnectionHandler");e?.setEnabled(t)},isConnectable(){const t=this.getPlugin("ConnectionHandler");return t?.isEnabled()??!1}},DragDropMixin={dropEnabled:!1,splitEnabled:!0,autoScroll:!0,isAutoScroll(){return this.autoScroll},autoExtend:!0,isAutoExtend(){return this.autoExtend},isDropEnabled(){return this.dropEnabled},setDropEnabled(t){this.dropEnabled=t},isSplitEnabled(){return this.splitEnabled},setSplitEnabled(t){this.splitEnabled=t},isSplitTarget(t,e=[],i){if(t.isEdge()&&1===e.length&&e[0].isConnectable()&&!this.getEdgeValidationError(t,t.getTerminal(!0),e[0])){const i=t.getTerminal(!0),s=t.getTerminal(!1);return!e[0].isAncestor(i)&&!e[0].isAncestor(s)}return!1}},EdgeMixin={resetEdgesOnResize:!1,isResetEdgesOnResize(){return this.resetEdgesOnResize},resetEdgesOnMove:!1,isResetEdgesOnMove(){return this.resetEdgesOnMove},resetEdgesOnConnect:!0,isResetEdgesOnConnect(){return this.resetEdgesOnConnect},connectableEdges:!1,allowDanglingEdges:!0,cloneInvalidEdges:!1,alternateEdgeStyle:{},edgeLabelsMovable:!0,isEdgeLabelsMovable(){return this.edgeLabelsMovable},setEdgeLabelsMovable(t){this.edgeLabelsMovable=t},setAllowDanglingEdges(t){this.allowDanglingEdges=t},isAllowDanglingEdges(){return this.allowDanglingEdges},setConnectableEdges(t){this.connectableEdges=t},isConnectableEdges(){return this.connectableEdges},setCloneInvalidEdges(t){this.cloneInvalidEdges=t},isCloneInvalidEdges(){return this.cloneInvalidEdges},flipEdge(t){return this.alternateEdgeStyle&&this.batchUpdate((()=>{const e=t.getStyle();Object.keys(e).length?this.getDataModel().setStyle(t,this.alternateEdgeStyle):this.getDataModel().setStyle(t,{}),this.resetEdge(t),this.fireEvent(new EventObject.default(InternalEvent.default.FLIP_EDGE,{edge:t}))})),t},splitEdge(t,e,i,s=0,n=0,l,a,r=null){r=r??t.getParent();const o=t.getTerminal(!0);return this.batchUpdate((()=>{if(!i){i=this.cloneCell(t);const e=this.getView().getState(t);let l=i.getGeometry();if(l&&e){const i=this.getView().translate,a=this.getView().scale,r=(0,mathUtils.findNearestSegment)(e,(s+i.x)*a,(n+i.y)*a);l.points=l.points.slice(0,r),l=t.getGeometry(),l&&(l=l.clone(),l.points=l.points.slice(r),this.getDataModel().setGeometry(t,l))}}this.cellsMoved(e,s,n,!1,!1),this.cellsAdded(e,r,r?r.getChildCount():0,null,null,!0),this.cellsAdded([i],r,r?r.getChildCount():0,o,e[0],!1),this.cellConnected(t,e[0],!0),this.fireEvent(new EventObject.default(InternalEvent.default.SPLIT_EDGE,{edge:t,cells:e,newEdge:i,dx:s,dy:n}))})),i},insertEdge(...t){let e,i,s,n,l,a;if(1===t.length&&"object"==typeof t[0]){const r=t[0];e=r.parent,i=r.id,s=r.value,n=r.source,l=r.target,a=r.style}else[e,i,s,n,l,a]=t;const r=this.createEdge(e,i,s,n,l,a);return this.addEdge(r,e,n,l)},createEdge(t=null,e,i,s=null,n=null,l={}){const a=new Cell.default(i,new Geometry.default,l);return a.setId(e),a.setEdge(!0),a.geometry.relative=!0,a},addEdge(t,e=null,i=null,s=null,n=null){return this.addCell(t,e,n,i,s)},addAllEdges(t){const e=t.slice();return(0,arrayUtils.removeDuplicates)(e.concat(this.getAllEdges(t)))},getAllEdges(t){let e=[];if(t)for(let i=0;i<t.length;i+=1){const s=t[i].getEdgeCount();for(let n=0;n<s;n++)e.push(t[i].getEdgeAt(n));const n=t[i].getChildren();e=e.concat(this.getAllEdges(n))}return e},getIncomingEdges(t,e=null){return this.getEdges(t,e,!0,!1,!1)},getOutgoingEdges(t,e=null){return this.getEdges(t,e,!1,!0,!1)},getEdges(t,e=null,i=!0,s=!0,n=!0,l=!1){let a=[];const r=t.isCollapsed(),o=t.getChildCount();for(let e=0;e<o;e+=1){const n=t.getChildAt(e);!r&&n.isVisible()||(a=a.concat(n.getEdges(i,s)))}a=a.concat(t.getEdges(i,s));const h=[];for(let r=0;r<a.length;r+=1){const o=this.getView().getState(a[r]),d=o?o.getVisibleTerminal(!0):this.getView().getVisibleTerminal(a[r],!0),u=o?o.getVisibleTerminal(!1):this.getView().getVisibleTerminal(a[r],!1);(n&&d===u||d!==u&&(i&&u===t&&(!e||this.isValidAncestor(d,e,l))||s&&d===t&&(!e||this.isValidAncestor(u,e,l))))&&h.push(a[r])}return h},getChildEdges(t){return this.getChildCells(t,!1,!0)},getEdgesBetween(t,e,i=!1){const s=this.getEdges(t),n=[];for(let l=0;l<s.length;l+=1){const a=this.getView().getState(s[l]),r=a?a.getVisibleTerminal(!0):this.getView().getVisibleTerminal(s[l],!0),o=a?a.getVisibleTerminal(!1):this.getView().getVisibleTerminal(s[l],!1);(r===t&&o===e||!i&&r===e&&o===t)&&n.push(s[l])}return n},resetEdges(t){const e=new Dictionary.default;for(let i=0;i<t.length;i+=1)e.put(t[i],!0);this.batchUpdate((()=>{for(let i=0;i<t.length;i+=1){const s=t[i].getEdges();for(let t=0;t<s.length;t++){const i=this.getView().getState(s[t]),n=i?i.getVisibleTerminal(!0):this.getView().getVisibleTerminal(s[t],!0),l=i?i.getVisibleTerminal(!1):this.getView().getVisibleTerminal(s[t],!1);e.get(n)&&e.get(l)||this.resetEdge(s[t])}this.resetEdges(t[i].getChildren())}}))},resetEdge(t){let e=t.getGeometry();return e&&e.points&&e.points.length>0&&(e=e.clone(),e.points=[],this.getDataModel().setGeometry(t,e)),t}},EditingMixin={cellsEditable:!0,startEditing(t){this.startEditingAtCell(null,t)},startEditingAtCell(t=null,e){if(!e||!(0,EventUtils.isMultiTouchEvent)(e))if(t){this.fireEvent(new EventObject.default(InternalEvent.default.START_EDITING,{cell:t,event:e}));const i=this.getPlugin("CellEditorHandler");i?.startEditing(t,e),this.fireEvent(new EventObject.default(InternalEvent.default.EDITING_STARTED,{cell:t,event:e}))}else(t=this.getSelectionCell())&&!this.isCellEditable(t)&&(t=null)},getEditingValue(t,e){return this.convertValueToString(t)},stopEditing(t=!1){const e=this.getPlugin("CellEditorHandler");e?.stopEditing(t),this.fireEvent(new EventObject.default(InternalEvent.default.EDITING_STOPPED,{cancel:t}))},labelChanged(t,e,i){return this.batchUpdate((()=>{const s=t.value;this.cellLabelChanged(t,e,this.isAutoSizeCell(t)),this.fireEvent(new EventObject.default(InternalEvent.default.LABEL_CHANGED,{cell:t,value:e,old:s,event:i}))})),t},cellLabelChanged(t,e,i=!1){this.batchUpdate((()=>{this.getDataModel().setValue(t,e),i&&this.cellSizeUpdated(t,!1)}))},isEditing(t=null){const e=this.getPlugin("CellEditorHandler"),i=e?.getEditingCell();return t?t===i:!!i},isCellEditable(t){return this.isCellsEditable()&&!this.isCellLocked(t)&&(this.getCurrentCellStyle(t).editable??!0)},isCellsEditable(){return this.cellsEditable},setCellsEditable(t){this.cellsEditable=t}},EventsMixin={lastTouchEvent:null,doubleClickCounter:0,lastTouchCell:null,fireDoubleClick:null,tapAndHoldThread:null,lastMouseX:null,lastMouseY:null,isMouseTrigger:null,ignoreMouseEvents:null,mouseMoveRedirect:null,mouseUpRedirect:null,lastEvent:null,escapeEnabled:!0,invokesStopCellEditing:!0,enterStopsCellEditing:!1,isMouseDown:!1,nativeDblClickEnabled:!0,doubleTapEnabled:!0,doubleTapTimeout:500,doubleTapTolerance:25,lastTouchX:0,lastTouchY:0,lastTouchTime:0,tapAndHoldEnabled:!0,tapAndHoldDelay:500,tapAndHoldInProgress:!1,tapAndHoldValid:!1,initialTouchX:0,initialTouchY:0,tolerance:4,isNativeDblClickEnabled(){return this.nativeDblClickEnabled},getEventTolerance(){return this.tolerance},setEventTolerance(t){this.tolerance=t},escape(t){this.fireEvent(new EventObject.default(InternalEvent.default.ESCAPE,{event:t}))},click(t){const e=t.getEvent();let i=t.getCell();const s=new EventObject.default(InternalEvent.default.CLICK,{event:e,cell:i});if(t.isConsumed()&&s.consume(),this.fireEvent(s),this.isEnabled()&&!(0,EventUtils.isConsumed)(e)&&!s.isConsumed()){if(i){if(this.isTransparentClickEvent(e)){let e=!1;const s=this.getCellAt(t.graphX,t.graphY,null,!1,!1,(t=>{const s=this.isCellSelected(t.cell);return e=e||s,!e||s||t.cell!==i&&t.cell.isAncestor(i)}));s&&(i=s)}}else if(this.isSwimlaneSelectionEnabled()&&(i=this.getSwimlaneAt(t.getGraphX(),t.getGraphY()),!(null==i||this.isToggleEvent(e)&&(0,EventUtils.isAltDown)(e)))){let t=i,s=[];for(;null!=t;){t=t.getParent();const e=this.getView().getState(t);this.isSwimlane(t)&&null!=e&&s.push(t)}if(s.length>0){s=s.reverse(),s.splice(0,0,i),s.push(i);for(let t=0;t<s.length-1;t+=1)this.isCellSelected(s[t])&&(i=s[this.isToggleEvent(e)?t:t+1])}}i?this.selectCellForEvent(i,e):this.isToggleEvent(e)||this.clearSelection()}return!1},dblClick(t,e=null){const i=new EventObject.default(InternalEvent.default.DOUBLE_CLICK,{event:t,cell:e});this.fireEvent(i),this.isEnabled()&&!(0,EventUtils.isConsumed)(t)&&!i.isConsumed()&&e&&this.isCellEditable(e)&&!this.isEditing(e)&&(this.startEditingAtCell(e,t),InternalEvent.default.consume(t))},tapAndHold(t){const e=t.getEvent(),i=new EventObject.default(InternalEvent.default.TAP_AND_HOLD,{event:e,cell:t.getCell()}),s=this.getPlugin("PanningHandler"),n=this.getPlugin("ConnectionHandler");if(this.fireEvent(i),i.isConsumed()&&s&&(s.panningTrigger=!1),this.isEnabled()&&!(0,EventUtils.isConsumed)(e)&&!i.isConsumed()&&n&&n.isEnabled()){const e=n.marker.getCell(t);if(e){const i=this.getView().getState(e);i&&(n.marker.currentColor=n.marker.validColor,n.marker.markedState=i,n.marker.mark(),n.first=new Point.default(t.getGraphX(),t.getGraphY()),n.edgeState=n.createEdgeState(t),n.previous=i,n.fireEvent(new EventObject.default(InternalEvent.default.START,{state:n.previous})))}}},addMouseListener(t){this.mouseListeners.push(t)},removeMouseListener(t){for(let e=0;e<this.mouseListeners.length;e+=1)if(this.mouseListeners[e]===t){this.mouseListeners.splice(e,1);break}},updateMouseEvent(t,e){const i=(0,styleUtils.convertPoint)(this.getContainer(),t.getX(),t.getY());if(t.graphX=i.x-this.getPanDx(),t.graphY=i.y-this.getPanDy(),!t.getCell()&&this.isMouseDown&&e===InternalEvent.default.MOUSE_MOVE){const e=this.getCellAt(i.x,i.y,null,!0,!0,(t=>!t.shape||t.shape.paintBackground!==this.paintBackground||t.style.pointerEvents||t.shape.fill!==Constants.NONE));t.state=e?this.getView().getState(e):null}return t},getStateForTouchEvent(t){const e=(0,EventUtils.getClientX)(t),i=(0,EventUtils.getClientY)(t),s=(0,styleUtils.convertPoint)(this.getContainer(),e,i),n=this.getCellAt(s.x,s.y);return n?this.getView().getState(n):null},isEventIgnored(t,e,i){const s=(0,EventUtils.isMouseEvent)(e.getEvent());let n=!1;e.getEvent()===this.lastEvent?n=!0:this.lastEvent=e.getEvent();const l=this.getEventSource();return l&&t!==InternalEvent.default.MOUSE_MOVE?(InternalEvent.default.removeGestureListeners(l,null,this.mouseMoveRedirect,this.mouseUpRedirect),this.mouseMoveRedirect=null,this.mouseUpRedirect=null,this.setEventSource(null)):!Client.default.IS_GC&&l&&e.getSource()!==l?n=!0:l&&Client.default.IS_TOUCH&&t===InternalEvent.default.MOUSE_DOWN&&!s&&!(0,EventUtils.isPenEvent)(e.getEvent())&&(this.setEventSource(e.getSource()),this.mouseMoveRedirect=t=>{this.fireMouseEvent(InternalEvent.default.MOUSE_MOVE,new InternalMouseEvent.default(t,this.getStateForTouchEvent(t)))},this.mouseUpRedirect=t=>{this.fireMouseEvent(InternalEvent.default.MOUSE_UP,new InternalMouseEvent.default(t,this.getStateForTouchEvent(t)))},InternalEvent.default.addGestureListeners(l,null,this.mouseMoveRedirect,this.mouseUpRedirect)),this.isSyntheticEventIgnored(t,e,i)&&(n=!0),!(0,EventUtils.isPopupTrigger)(this.lastEvent)&&t!==InternalEvent.default.MOUSE_MOVE&&2===this.lastEvent.detail||(t===InternalEvent.default.MOUSE_UP&&this.isMouseDown?this.isMouseDown=!1:t!==InternalEvent.default.MOUSE_DOWN||this.isMouseDown?!n&&((!Client.default.IS_FF||t!==InternalEvent.default.MOUSE_MOVE)&&this.isMouseDown&&this.isMouseTrigger!==s||t===InternalEvent.default.MOUSE_DOWN&&this.isMouseDown||t===InternalEvent.default.MOUSE_UP&&!this.isMouseDown)&&(n=!0):(this.isMouseDown=!0,this.isMouseTrigger=s),n||t!==InternalEvent.default.MOUSE_DOWN||(this.lastMouseX=e.getX(),this.lastMouseY=e.getY()),n)},isSyntheticEventIgnored(t,e,i){let s=!1;const n=(0,EventUtils.isMouseEvent)(e.getEvent());return this.ignoreMouseEvents&&n&&t!==InternalEvent.default.MOUSE_MOVE?(this.ignoreMouseEvents=t!==InternalEvent.default.MOUSE_UP,s=!0):Client.default.IS_FF&&!n&&t===InternalEvent.default.MOUSE_UP&&(this.ignoreMouseEvents=!0),s},isEventSourceIgnored(t,e){const i=e.getSource();if(!i)return!0;const s=i.nodeName?i.nodeName.toLowerCase():"",n=!(0,EventUtils.isMouseEvent)(e.getEvent())||(0,EventUtils.isLeftMouseButton)(e.getEvent());return t===InternalEvent.default.MOUSE_DOWN&&n&&("select"===s||"option"===s||"input"===s&&"checkbox"!==i.type&&"radio"!==i.type&&"button"!==i.type&&"submit"!==i.type&&"file"!==i.type)},getEventState:t=>t,fireMouseEvent(t,e,i){if(i=i??this,this.isEventSourceIgnored(t,e)){const t=this.getPlugin("TooltipHandler");t&&t.hide()}else{if(e=this.updateMouseEvent(e,t),!this.nativeDblClickEnabled&&!(0,EventUtils.isPopupTrigger)(e.getEvent())||this.doubleTapEnabled&&Client.default.IS_TOUCH&&((0,EventUtils.isTouchEvent)(e.getEvent())||(0,EventUtils.isPenEvent)(e.getEvent()))){const i=(new Date).getTime();if(t===InternalEvent.default.MOUSE_DOWN)if(this.lastTouchEvent&&this.lastTouchEvent!==e.getEvent()&&i-this.lastTouchTime<this.doubleTapTimeout&&Math.abs(this.lastTouchX-e.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-e.getY())<this.doubleTapTolerance&&this.doubleClickCounter<2){this.doubleClickCounter+=1;let i=!1;if(t===InternalEvent.default.MOUSE_UP){if(e.getCell()===this.lastTouchCell&&this.lastTouchCell){this.lastTouchTime=0;const t=this.lastTouchCell;this.lastTouchCell=null,this.dblClick(e.getEvent(),t),i=!0}}else this.fireDoubleClick=!0,this.lastTouchTime=0;if(i)return void InternalEvent.default.consume(e.getEvent())}else this.lastTouchEvent&&this.lastTouchEvent===e.getEvent()||(this.lastTouchCell=e.getCell(),this.lastTouchX=e.getX(),this.lastTouchY=e.getY(),this.lastTouchTime=i,this.lastTouchEvent=e.getEvent(),this.doubleClickCounter=0);else if((this.isMouseDown||t===InternalEvent.default.MOUSE_UP)&&this.fireDoubleClick){this.fireDoubleClick=!1;const t=this.lastTouchCell;return this.lastTouchCell=null,this.isMouseDown=!1,void((t||((0,EventUtils.isTouchEvent)(e.getEvent())||(0,EventUtils.isPenEvent)(e.getEvent()))&&(Client.default.IS_GC||Client.default.IS_SF))&&Math.abs(this.lastTouchX-e.getX())<this.doubleTapTolerance&&Math.abs(this.lastTouchY-e.getY())<this.doubleTapTolerance?this.dblClick(e.getEvent(),t):InternalEvent.default.consume(e.getEvent()))}}if(!this.isEventIgnored(t,e,i)){const s=e.getState();if(e.state=s?this.getEventState(s):null,this.fireEvent(new EventObject.default(InternalEvent.default.FIRE_MOUSE_EVENT,{eventName:t,event:e})),Client.default.IS_SF||Client.default.IS_GC||e.getEvent().target!==this.getContainer()){const s=this.getContainer();if(t===InternalEvent.default.MOUSE_MOVE&&this.isMouseDown&&this.isAutoScroll()&&!(0,EventUtils.isMultiTouchEvent)(e.getEvent()))this.scrollPointToVisible(e.getGraphX(),e.getGraphY(),this.isAutoExtend());else if(t===InternalEvent.default.MOUSE_UP&&this.isIgnoreScrollbars()&&this.isTranslateToScrollPosition()&&(0!==s.scrollLeft||0!==s.scrollTop)){const t=this.getView().scale,e=this.getView().translate;this.getView().setTranslate(e.x-s.scrollLeft/t,e.y-s.scrollTop/t),s.scrollLeft=0,s.scrollTop=0}const n=this.mouseListeners;e.getEvent().preventDefault||(e.getEvent().returnValue=!0);for(const s of n)t===InternalEvent.default.MOUSE_DOWN?s.mouseDown(i,e):t===InternalEvent.default.MOUSE_MOVE?s.mouseMove(i,e):t===InternalEvent.default.MOUSE_UP&&s.mouseUp(i,e);t===InternalEvent.default.MOUSE_UP&&this.click(e)}if(((0,EventUtils.isTouchEvent)(e.getEvent())||(0,EventUtils.isPenEvent)(e.getEvent()))&&t===InternalEvent.default.MOUSE_DOWN&&this.tapAndHoldEnabled&&!this.tapAndHoldInProgress){this.tapAndHoldInProgress=!0,this.initialTouchX=e.getGraphX(),this.initialTouchY=e.getGraphY();const t=()=>{this.tapAndHoldValid&&this.tapAndHold(e),this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1};this.tapAndHoldThread&&window.clearTimeout(this.tapAndHoldThread),this.tapAndHoldThread=window.setTimeout(t,this.tapAndHoldDelay),this.tapAndHoldValid=!0}else t===InternalEvent.default.MOUSE_UP?(this.tapAndHoldInProgress=!1,this.tapAndHoldValid=!1):this.tapAndHoldValid&&(this.tapAndHoldValid=Math.abs(this.initialTouchX-e.getGraphX())<this.tolerance&&Math.abs(this.initialTouchY-e.getGraphY())<this.tolerance);const n=this.getPlugin("CellEditorHandler");t===InternalEvent.default.MOUSE_DOWN&&this.isEditing()&&!n?.isEventSource(e.getEvent())&&this.stopEditing(!this.isInvokesStopCellEditing()),this.consumeMouseEvent(t,e,i)}}},consumeMouseEvent(t,e,i){i=i??this,t===InternalEvent.default.MOUSE_DOWN&&(0,EventUtils.isTouchEvent)(e.getEvent())&&e.consume(!1)},fireGestureEvent(t,e=null){this.lastTouchTime=0,this.fireEvent(new EventObject.default(InternalEvent.default.GESTURE,{event:t,cell:e}))},sizeDidChange(){const t=this.getGraphBounds(),e=this.getBorder();let i=Math.max(0,t.x)+t.width+2*e,s=Math.max(0,t.y)+t.height+2*e;const n=this.getMinimumContainerSize();if(n&&(i=Math.max(i,n.width),s=Math.max(s,n.height)),this.isResizeContainer()&&this.doResizeContainer(i,s),this.isPreferPageSize()||this.isPageVisible()){const e=this.getPreferredPageSize(t,Math.max(1,i),Math.max(1,s));i=e.width*this.getView().scale,s=e.height*this.getView().scale}const l=this.getMinimumGraphSize();l&&(i=Math.max(i,l.width*this.getView().scale),s=Math.max(s,l.height*this.getView().scale)),i=Math.ceil(i),s=Math.ceil(s);const a=this.getView().getDrawPane().ownerSVGElement;a&&(a.style.minWidth=`${Math.max(1,i)}px`,a.style.minHeight=`${Math.max(1,s)}px`,a.style.width="100%",a.style.height="100%"),this.updatePageBreaks(this.isPageBreaksVisible(),i,s),this.fireEvent(new EventObject.default(InternalEvent.default.SIZE,{bounds:t}))},isCloneEvent:t=>(0,EventUtils.isControlDown)(t),isTransparentClickEvent:t=>!1,isToggleEvent:t=>Client.default.IS_MAC?(0,EventUtils.isMetaDown)(t):(0,EventUtils.isControlDown)(t),isGridEnabledEvent:t=>!(0,EventUtils.isAltDown)(t),isConstrainedEvent:t=>(0,EventUtils.isShiftDown)(t),isIgnoreTerminalEvent:t=>!1,getPointForEvent(t,e=!0){const i=(0,styleUtils.convertPoint)(this.getContainer(),(0,EventUtils.getClientX)(t),(0,EventUtils.getClientY)(t)),s=this.getView().scale,n=this.getView().translate,l=e?this.getGridSize()/2:0;return i.x=this.snap(i.x/s-n.x-l),i.y=this.snap(i.y/s-n.y-l),i},isEscapeEnabled(){return this.escapeEnabled},setEscapeEnabled(t){this.escapeEnabled=t},isInvokesStopCellEditing(){return this.invokesStopCellEditing},setInvokesStopCellEditing(t){this.invokesStopCellEditing=t},isEnterStopsCellEditing(){return this.enterStopsCellEditing},setEnterStopsCellEditing(t){this.enterStopsCellEditing=t},getCursorForMouseEvent(t){const e=t.getCell();return e?this.getCursorForCell(e):null}},FoldingMixin={options:{foldingEnabled:!0,collapsedImage:new image_ImageBox(`${Client.default.imageBasePath}/collapsed.gif`,9,9),expandedImage:new image_ImageBox(`${Client.default.imageBasePath}/expanded.gif`,9,9),collapseToPreferredSize:!0},collapseExpandResource:config.TranslationsConfig.isEnabled()?"collapse-expand":"",getCollapseExpandResource(){return this.collapseExpandResource},isFoldingEnabled(){return this.options.foldingEnabled},getFoldableCells(t,e=!1){return this.getDataModel().filterCells(t,(t=>this.isCellFoldable(t,e)))},isCellFoldable(t,e){return t.getChildCount()>0&&(this.getCurrentCellStyle(t).foldable??!0)},getFoldingImage(t){if(null!=t&&this.isFoldingEnabled()&&!t.cell.isEdge()){const e=t.cell.isCollapsed();if(this.isCellFoldable(t.cell,!e))return e?this.options.collapsedImage:this.options.expandedImage}return null},foldCells(t=!1,e=!1,i=null,s=!1,n=null){return null==i&&(i=this.getFoldableCells(this.getSelectionCells(),t)),this.stopEditing(!1),this.batchUpdate((()=>{this.cellsFolded(i,t,e,s),this.fireEvent(new EventObject.default(InternalEvent.default.FOLD_CELLS,"collapse",t,"recurse",e,"cells",i))})),i},cellsFolded(t=null,e=!1,i=!1,s=!1){null!=t&&t.length>0&&this.batchUpdate((()=>{for(let n=0;n<t.length;n+=1)if((!s||this.isCellFoldable(t[n],e))&&e!==t[n].isCollapsed()){if(this.getDataModel().setCollapsed(t[n],e),this.swapBounds(t[n],e),this.isExtendParent(t[n])&&this.extendParent(t[n]),i){const s=t[n].getChildren();this.cellsFolded(s,e,i)}this.constrainChild(t[n])}this.fireEvent(new EventObject.default(InternalEvent.default.CELLS_FOLDED,{cells:t,collapse:e,recurse:i}))}))},swapBounds(t,e=!1){let i=t.getGeometry();null!=i&&(i=i.clone(),this.updateAlternateBounds(t,i,e),i.swap(),this.getDataModel().setGeometry(t,i))},updateAlternateBounds(t=null,e=null,i=!1){if(null!=t&&null!=e){const i=this.getCurrentCellStyle(t);if(null==e.alternateBounds){let s=e;if(this.options.collapseToPreferredSize){const e=this.getPreferredSizeForCell(t);if(null!=e){s=e;const t=i.startSize??0;t>0&&(s.height=Math.max(s.height,t))}}e.alternateBounds=new Rectangle.default(0,0,s.width,s.height)}if(null!=e.alternateBounds){e.alternateBounds.x=e.x,e.alternateBounds.y=e.y;const t=(0,mathUtils.toRadians)(i.rotation||0);if(0!==t){const i=e.alternateBounds.getCenterX()-e.getCenterX(),s=e.alternateBounds.getCenterY()-e.getCenterY(),n=Math.cos(t),l=Math.sin(t),a=n*i-l*s,r=l*i+n*s;e.alternateBounds.x+=a-i,e.alternateBounds.y+=r-s}}}}},GroupingMixin={groupCells(t,e=0,i){i||(i=(0,styleUtils.sortCells)(this.getSelectionCells(),!0)),i||(i=this.getCellsForGroup(i)),null==t&&(t=this.createGroupCell(i));const s=this.getBoundsForGroup(t,i,e);if(i.length>1&&null!=s){let n=t.getParent();null==n&&(n=i[0].getParent()),this.batchUpdate((()=>{null==t.getGeometry()&&this.getDataModel().setGeometry(t,new Geometry.default);let l=n.getChildCount();this.cellsAdded([t],n,l,null,null,!1,!1,!1),l=t.getChildCount(),this.cellsAdded(i,t,l,null,null,!1,!1,!1),this.cellsMoved(i,-s.x,-s.y,!1,!1,!1),this.cellsResized([t],[s],!1),this.fireEvent(new EventObject.default(InternalEvent.default.GROUP_CELLS,{group:t,border:e,cells:i}))}))}return t},getCellsForGroup(t){const e=[];if(null!=t&&t.length>0){const i=t[0].getParent();e.push(t[0]);for(let s=1;s<t.length;s+=1)t[s].getParent()===i&&e.push(t[s])}return e},getBoundsForGroup(t,e,i){const s=this.getBoundingBoxFromGeometry(e,!0);if(null!=s){if(this.isSwimlane(t)){const e=this.getStartSize(t);s.x-=e.width,s.y-=e.height,s.width+=e.width,s.height+=e.height}null!=i&&(s.x-=i,s.y-=i,s.width+=2*i,s.height+=2*i)}return s},createGroupCell(t){const e=new Cell.default("");return e.setVertex(!0),e.setConnectable(!1),e},ungroupCells(t){let e=[];return null==t&&(t=this.getCellsForUngroup()),null!=t&&t.length>0&&this.batchUpdate((()=>{const i=t;for(let t=0;t<i.length;t+=1){let s=i[t].getChildren();if(null!=s&&s.length>0){s=s.slice();const n=i[t].getParent(),l=n.getChildCount();this.cellsAdded(s,n,l,null,null,!0),e=e.concat(s);for(const t of s){const e=this.getView().getState(t);let i=t.getGeometry();null!=e&&null!=i&&i.relative&&(i=i.clone(),i.x=e.origin.x,i.y=e.origin.y,i.relative=!1,this.getDataModel().setGeometry(t,i))}}}this.removeCellsAfterUngroup(i),this.fireEvent(new EventObject.default(InternalEvent.default.UNGROUP_CELLS,{cells:t}))})),e},getCellsForUngroup(){const t=this.getSelectionCells(),e=[];for(let i=0;i<t.length;i+=1)t[i].isVertex()&&t[i].getChildCount()>0&&e.push(t[i]);return e},removeCellsAfterUngroup(t){this.cellsRemoved(this.addAllEdges(t))},removeCellsFromParent(t){return null==t&&(t=this.getSelectionCells()),this.batchUpdate((()=>{const e=this.getDefaultParent(),i=e.getChildCount();this.cellsAdded(t,e,i,null,null,!0),this.fireEvent(new EventObject.default(InternalEvent.default.REMOVE_CELLS_FROM_PARENT,{cells:t}))})),t},updateGroupBounds(t,e=0,i=!1,s=0,n=0,l=0,a=0){return null==t&&(t=this.getSelectionCells()),e=null!=e?e:0,i=null!=i&&i,s=null!=s?s:0,n=null!=n?n:0,l=null!=l?l:0,a=null!=a?a:0,this.batchUpdate((()=>{for(let r=t.length-1;r>=0;r--){let o=t[r].getGeometry();if(null==o)continue;const h=this.getChildCells(t[r]);if(null!=h&&h.length>0){const d=this.getBoundingBoxFromGeometry(h,!0);if(null!=d&&d.width>0&&d.height>0){const u=this.isSwimlane(t[r])?this.getActualStartSize(t[r],!0):new Rectangle.default;o=o.clone(),i&&(o.x=Math.round(o.x+d.x-e-u.x-a),o.y=Math.round(o.y+d.y-e-u.y-s)),o.width=Math.round(d.width+2*e+u.x+a+n+u.width),o.height=Math.round(d.height+2*e+u.y+s+l+u.height),this.getDataModel().setGeometry(t[r],o),this.moveCells(h,e+u.x-d.x+a,e+u.y-d.y+s)}}}})),t},enterGroup(t){null!=(t=t||this.getSelectionCell())&&this.isValidRoot(t)&&(this.getView().setCurrentRoot(t),this.clearSelection())},exitGroup(){const t=this.getDataModel().getRoot(),e=this.getCurrentRoot();if(null!=e){let i=e.getParent();for(;i!==t&&!this.isValidRoot(i)&&i.getParent()!==t;)i=i.getParent();i===t||i.getParent()===t?this.getView().setCurrentRoot(null):this.getView().setCurrentRoot(i),null!=this.getView().getState(e)&&this.setSelectionCell(e)}}},ImageMixin={addImageBundle(t){this.imageBundles.push(t)},removeImageBundle(t){const e=[];for(let i=0;i<this.imageBundles.length;i+=1)this.imageBundles[i]!==t&&e.push(this.imageBundles[i]);this.imageBundles=e},getImageFromBundles(t){if(t)for(let e=0;e<this.imageBundles.length;e+=1){const i=this.imageBundles[e].getImage(t);if(i)return i}return null}},LabelMixin={getLabel(t){let e="";return this.isLabelsVisible()&&null!=t&&(this.getCurrentCellStyle(t).noLabel||(e=this.convertValueToString(t))),e},isHtmlLabel(t){return this.isHtmlLabels()},labelsVisible:!0,isLabelsVisible(){return this.labelsVisible},htmlLabels:!1,isHtmlLabels(){return this.htmlLabels},setHtmlLabels(t){this.htmlLabels=t},isWrapping(t){return"wrap"===this.getCurrentCellStyle(t).whiteSpace},isLabelClipped(t){return"hidden"===this.getCurrentCellStyle(t).overflow},isLabelMovable(t){return!this.isCellLocked(t)&&(t.isEdge()&&this.isEdgeLabelsMovable()||t.isVertex()&&this.isVertexLabelsMovable())}},OrderMixin={orderCells(t=!1,e){return e||(e=this.getSelectionCells()),e||(e=(0,styleUtils.sortCells)(this.getSelectionCells(),!0)),this.batchUpdate((()=>{this.cellsOrdered(e,t);const i=new EventObject.default(InternalEvent.default.ORDER_CELLS,"back",t,"cells",e);this.fireEvent(i)})),e},cellsOrdered(t,e=!1){this.batchUpdate((()=>{for(let i=0;i<t.length;i+=1){const s=t[i].getParent();e?this.getDataModel().add(s,t[i],i):this.getDataModel().add(s,t[i],s?s.getChildCount()-1:0)}this.fireEvent(new EventObject.default(InternalEvent.default.CELLS_ORDERED,{back:e,cells:t}))}))}};class CellOverlay extends EventSource.default{constructor(t,e=null,i="right",s="bottom",n=new Point.default,l="help"){super(),this.align="right",this.verticalAlign="bottom",this.offset=new Point.default,this.cursor="help",this.defaultOverlap=.5,this.image=t,this.tooltip=e,this.align=i,this.verticalAlign=s,this.offset=n,this.cursor=l}getBounds(t){const e=t.cell.isEdge(),i=t.view.scale;let s=null;const n=this.image,l=n.width,a=n.height;if(e){const e=t.absolutePoints;if(e.length%2==1)s=e[Math.floor(e.length/2)];else{const t=e.length/2,i=e[t-1],n=e[t];s=new Point.default(i.x+(n.x-i.x)/2,i.y+(n.y-i.y)/2)}}else{if(s=new Point.default,"left"===this.align)s.x=t.x;else if("center"===this.align)s.x=t.x+t.width/2;else{if("right"!==this.align)throw new Error;s.x=t.x+t.width}if("top"===this.verticalAlign)s.y=t.y;else if("middle"===this.verticalAlign)s.y=t.y+t.height/2;else{if("bottom"!==this.verticalAlign)throw new Error;s.y=t.y+t.height}}return new Rectangle.default(Math.round(s.x-(l*this.defaultOverlap-this.offset.x)*i),Math.round(s.y-(a*this.defaultOverlap-this.offset.y)*i),l*i,a*i)}toString(){return this.tooltip}}const cell_CellOverlay=CellOverlay,OverlaysMixin={addCellOverlay(t,e){t.overlays.push(e);const i=this.getView().getState(t);return i&&this.getCellRenderer().redraw(i),this.fireEvent(new EventObject.default(InternalEvent.default.ADD_OVERLAY,{cell:t,overlay:e})),e},getCellOverlays:t=>t.overlays,removeCellOverlay(t,e=null){if(e){const i=t.overlays.indexOf(e);if(i>=0){t.overlays.splice(i,1);const s=this.getView().getState(t);s&&this.getCellRenderer().redraw(s),this.fireEvent(new EventObject.default(InternalEvent.default.REMOVE_OVERLAY,{cell:t,overlay:e}))}else e=null}else this.removeCellOverlays(t);return e},removeCellOverlays(t){const{overlays:e}=t;t.overlays=[];const i=this.getView().getState(t);i&&this.getCellRenderer().redraw(i);for(let i=0;i<e.length;i+=1)this.fireEvent(new EventObject.default(InternalEvent.default.REMOVE_OVERLAY,"cell",t,"overlay",e[i]));return e},clearCellOverlays(t=null){if(!(t=t??this.getDataModel().getRoot()))return;this.removeCellOverlays(t);const e=t.getChildCount();for(let i=0;i<e;i+=1){const e=t.getChildAt(i);this.clearCellOverlays(e)}},setCellWarning(t,e=null,i,s=!1){if(i=i??this.getWarningImage(),e&&e.length>0){const n=new cell_CellOverlay(i,`<font color=red>${e}</font>`);return s&&n.addListener(InternalEvent.default.CLICK,((e,i)=>{this.isEnabled()&&this.setSelectionCell(t)})),this.addCellOverlay(t,n)}return this.removeCellOverlays(t),null}},PageBreaksMixin={horizontalPageBreaks:null,verticalPageBreaks:null,updatePageBreaks(t,e,i){const{scale:s,translate:n}=this.getView(),l=this.getPageFormat(),a=s*this.getPageScale(),r=new Rectangle.default(0,0,l.width*a,l.height*a),o=Rectangle.default.fromRectangle(this.getGraphBounds());o.width=Math.max(1,o.width),o.height=Math.max(1,o.height),r.x=Math.floor((o.x-n.x*s)/r.width)*r.width+n.x*s,r.y=Math.floor((o.y-n.y*s)/r.height)*r.height+n.y*s,o.width=Math.ceil((o.width+(o.x-r.x))/r.width)*r.width,o.height=Math.ceil((o.height+(o.y-r.y))/r.height)*r.height;const h=(t=t&&Math.min(r.width,r.height)>this.getMinPageBreakDist())?Math.ceil(o.height/r.height)+1:0,d=t?Math.ceil(o.width/r.width)+1:0,u=(d-1)*r.width,c=(h-1)*r.height;null==this.horizontalPageBreaks&&h>0&&(this.horizontalPageBreaks=[]),null==this.verticalPageBreaks&&d>0&&(this.verticalPageBreaks=[]);const g=t=>{if(null!=t){const e=t===this.horizontalPageBreaks?h:d;for(let i=0;i<=e;i+=1){const e=t===this.horizontalPageBreaks?[new Point.default(Math.round(r.x),Math.round(r.y+i*r.height)),new Point.default(Math.round(r.x+u),Math.round(r.y+i*r.height))]:[new Point.default(Math.round(r.x+i*r.width),Math.round(r.y)),new Point.default(Math.round(r.x+i*r.width),Math.round(r.y+c))];if(null!=t[i])t[i].points=e,t[i].redraw();else{const s=new edge_PolylineShape(e,this.getPageBreakColor());s.dialect=this.getDialect(),s.pointerEvents=!1,s.isDashed=this.isPageBreakDashed(),s.init(this.getView().backgroundPane),s.redraw(),t[i]=s}}for(let i=e;i<t.length;i+=1)t[i].destroy();t.splice(e,t.length-e)}};g(this.horizontalPageBreaks),g(this.verticalPageBreaks)}},PanningMixin={shiftPreview1:null,shiftPreview2:null,useScrollbarsForPanning:!0,isUseScrollbarsForPanning(){return this.useScrollbarsForPanning},timerAutoScroll:!1,isTimerAutoScroll(){return this.timerAutoScroll},allowAutoPanning:!1,isAllowAutoPanning(){return this.allowAutoPanning},panDx:0,getPanDx(){return this.panDx},setPanDx(t){this.panDx=t},panDy:0,getPanDy(){return this.panDy},setPanDy(t){this.panDy=t},panGraph(t,e){const i=this.getContainer();if(this.useScrollbarsForPanning&&(0,styleUtils.hasScrollbars)(i))i.scrollLeft=-t,i.scrollTop=-e;else{const s=this.getView().getCanvas();if(0===t&&0===e){if(s.removeAttribute("transform"),this.shiftPreview1){let t=this.shiftPreview1.firstChild;for(;t;){const e=t.nextSibling;i.appendChild(t),t=e}this.shiftPreview1.parentNode&&this.shiftPreview1.parentNode.removeChild(this.shiftPreview1),this.shiftPreview1=null,i.appendChild(s.parentNode);const e=this.shiftPreview2;for(t=e.firstChild;t;){const e=t.nextSibling;i.appendChild(t),t=e}e.parentNode&&e.parentNode.removeChild(e),this.shiftPreview2=null}}else{if(s.setAttribute("transform",`translate(${t},${e})`),!this.shiftPreview1){this.shiftPreview1=document.createElement("div"),this.shiftPreview1.style.position="absolute",this.shiftPreview1.style.overflow="visible",this.shiftPreview2=document.createElement("div"),this.shiftPreview2.style.position="absolute",this.shiftPreview2.style.overflow="visible";let t=this.shiftPreview1,e=i.firstChild;for(;e;){const i=e.nextSibling;e!==s.parentNode?t.appendChild(e):t=this.shiftPreview2,e=i}this.shiftPreview1.firstChild&&i.insertBefore(this.shiftPreview1,s.parentNode),this.shiftPreview2.firstChild&&i.appendChild(this.shiftPreview2)}this.shiftPreview1.style.left=`${t}px`,this.shiftPreview1.style.top=`${e}px`,this.shiftPreview2&&(this.shiftPreview2.style.left=`${t}px`,this.shiftPreview2.style.top=`${e}px`)}this.panDx=t,this.panDy=e,this.fireEvent(new EventObject.default(InternalEvent.default.PAN))}},scrollCellToVisible(t,e=!1){const i=-this.getView().translate.x,s=-this.getView().translate.y,n=this.getView().getState(t);if(n){const t=new Rectangle.default(i+n.x,s+n.y,n.width,n.height);if(e&&this.getContainer()){const e=this.getContainer().clientWidth,i=this.getContainer().clientHeight;t.x=t.getCenterX()-e/2,t.width=e,t.y=t.getCenterY()-i/2,t.height=i}const l=new Point.default(this.getView().translate.x,this.getView().translate.y);if(this.scrollRectToVisible(t)){const t=new Point.default(this.getView().translate.x,this.getView().translate.y);this.getView().translate.x=l.x,this.getView().translate.y=l.y,this.getView().setTranslate(t.x,t.y)}}},scrollRectToVisible(t){let e=!1;const i=this.getContainer(),s=i.offsetWidth,n=i.offsetHeight,l=Math.min(s,t.width),a=Math.min(n,t.height);if((0,styleUtils.hasScrollbars)(i)){t.x+=this.getView().translate.x,t.y+=this.getView().translate.y;let e=i.scrollLeft-t.x;const s=Math.max(e-i.scrollLeft,0);e>0?i.scrollLeft-=e+2:(e=t.x+l-i.scrollLeft-i.clientWidth,e>0&&(i.scrollLeft+=e+2));let n=i.scrollTop-t.y;const r=Math.max(0,n-i.scrollTop);n>0?i.scrollTop-=n+2:(n=t.y+a-i.scrollTop-i.clientHeight,n>0&&(i.scrollTop+=n+2)),this.useScrollbarsForPanning||0==s&&0==r||this.getView().setTranslate(s,r)}else{const i=-this.getView().translate.x,r=-this.getView().translate.y,o=this.getView().scale;if(t.x+l>i+s&&(this.getView().translate.x-=(t.x+l-s-i)/o,e=!0),t.y+a>r+n&&(this.getView().translate.y-=(t.y+a-n-r)/o,e=!0),t.x<i&&(this.getView().translate.x+=(i-t.x)/o,e=!0),t.y<r&&(this.getView().translate.y+=(r-t.y)/o,e=!0),e){this.getView().refresh();const t=this.getPlugin("SelectionCellsHandler");t&&t.refresh()}}return e},setPanning(t){const e=this.getPlugin("PanningHandler");e&&(e.panningEnabled=t)}},PortsMixin={portsEnabled:!0,isPort:t=>!1,getTerminalForPort:(t,e=!1)=>t.getParent(),isPortsEnabled(){return this.portsEnabled},setPortsEnabled(t){this.portsEnabled=t}},SelectionMixin={selectionModel:null,getSelectionModel(){return this.selectionModel},setSelectionModel(t){this.selectionModel=t},isCellSelected(t){return this.selectionModel.isSelected(t)},isSelectionEmpty(){return this.selectionModel.isEmpty()},clearSelection(){this.selectionModel.clear()},getSelectionCount(){return this.selectionModel.cells.length},getSelectionCell(){return this.selectionModel.cells[0]},getSelectionCells(){return this.selectionModel.cells.slice()},setSelectionCell(t){this.selectionModel.setCell(t)},setSelectionCells(t){this.selectionModel.setCells(t)},addSelectionCell(t){this.selectionModel.addCell(t)},addSelectionCells(t){this.selectionModel.addCells(t)},removeSelectionCell(t){this.selectionModel.removeCell(t)},removeSelectionCells(t){this.selectionModel.removeCells(t)},selectRegion(t,e){const i=this.getCells(t.x,t.y,t.width,t.height);return this.selectCellsForEvent(i,e),i},selectNextCell(){this.selectCell(!0)},selectPreviousCell(){this.selectCell()},selectParentCell(){this.selectCell(!1,!0)},selectChildCell(){this.selectCell(!1,!1,!0)},selectCell(t=!1,e=!1,i=!1){const s=this.selectionModel.cells.length>0?this.selectionModel.cells[0]:null;this.selectionModel.cells.length>1&&this.selectionModel.clear();const n=s?s.getParent():this.getDefaultParent(),l=n.getChildCount();if(!s&&l>0){const t=n.getChildAt(0);this.setSelectionCell(t)}else if(n&&(!s||e)&&this.getView().getState(n)&&n.getGeometry())this.getCurrentRoot()!==n&&this.setSelectionCell(n);else if(s&&i){if(s.getChildCount()>0){const t=s.getChildAt(0);this.setSelectionCell(t)}}else if(l>0){let e=n.getIndex(s);if(t){e++;const t=n.getChildAt(e%l);this.setSelectionCell(t)}else{e--;const t=e<0?l-1:e,i=n.getChildAt(t);this.setSelectionCell(i)}}},selectAll(t,e=!1){t=t??this.getDefaultParent();const i=e?t.filterDescendants((e=>e!==t&&!!this.getView().getState(e))):t.getChildren();this.setSelectionCells(i)},selectVertices(t,e=!1){this.selectCells(!0,!1,t,e)},selectEdges(t){this.selectCells(!1,!0,t)},selectCells(t=!1,e=!1,i,s=!1){const n=(i=i??this.getDefaultParent()).filterDescendants((i=>{const n=i.getParent();return!!this.getView().getState(i)&&((s||0===i.getChildCount())&&i.isVertex()&&t&&n&&!n.isEdge()||i.isEdge()&&e)}));this.setSelectionCells(n)},selectCellForEvent(t,e){const i=this.isCellSelected(t);this.isToggleEvent(e)?i?this.removeSelectionCell(t):this.addSelectionCell(t):i&&1===this.getSelectionCount()||this.setSelectionCell(t)},selectCellsForEvent(t,e){this.isToggleEvent(e)?this.addSelectionCells(t):this.setSelectionCells(t)},isSiblingSelected(t){const e=t.getParent(),i=e.getChildCount();for(let s=0;s<i;s+=1){const i=e.getChildAt(s);if(t!==i&&this.isCellSelected(i))return!0}return!1},getSelectionCellsForChanges(t,e=null){const i=new Dictionary.default,s=[],n=t=>{if(!i.get(t)&&this.getDataModel().contains(t))if(t.isEdge()||t.isVertex())i.put(t,!0),s.push(t);else{const e=t.getChildCount();for(let i=0;i<e;i+=1)n(t.getChildAt(i))}};for(let i=0;i<t.length;i+=1){const s=t[i];if(!(s.constructor===undoable_changes_RootChange||e&&e(s))){let t=null;s instanceof undoable_changes_ChildChange?t=s.child:s.cell&&s.cell instanceof Cell.default&&(t=s.cell),t&&n(t)}}return s},updateSelection(){const t=this.getSelectionCells(),e=[];for(const i of t)if(this.getDataModel().contains(i)&&i.isVisible()){let t=i.getParent();for(;t&&t!==this.getView().currentRoot;){if(t.isCollapsed()||!t.isVisible()){e.push(i);break}t=t.getParent()}}else e.push(i);this.removeSelectionCells(e)}},SnapMixin={snapTolerance:0,getSnapTolerance(){return this.snapTolerance},gridSize:10,gridEnabled:!0,snap(t){return this.gridEnabled&&(t=Math.round(t/this.gridSize)*this.gridSize),t},snapDelta(t,e,i=!1,s=!1,n=!1){const l=this.getView().translate,a=this.getView().scale;if(!i&&this.gridEnabled){const i=this.gridSize*a*.5;if(!s){const s=e.x-(this.snap(e.x/a-l.x)+l.x)*a;Math.abs(t.x-s)<i?t.x=0:t.x=this.snap(t.x/a)*a-s}if(!n){const s=e.y-(this.snap(e.y/a-l.y)+l.y)*a;Math.abs(t.y-s)<i?t.y=0:t.y=this.snap(t.y/a)*a-s}}else{const i=.5*a;if(!s){const s=e.x-(Math.round(e.x/a-l.x)+l.x)*a;Math.abs(t.x-s)<i?t.x=0:t.x=Math.round(t.x/a)*a-s}if(!n){const s=e.y-(Math.round(e.y/a-l.y)+l.y)*a;Math.abs(t.y-s)<i?t.y=0:t.y=Math.round(t.y/a)*a-s}}return t},isGridEnabled(){return this.gridEnabled},setGridEnabled(t){this.gridEnabled=t},getGridSize(){return this.gridSize},setGridSize(t){this.gridSize=t}},SwimlaneMixin={swimlaneSelectionEnabled:!0,swimlaneNesting:!0,swimlaneIndicatorColorAttribute:"fillColor",getSwimlane(t=null){for(;t&&!this.isSwimlane(t);)t=t.getParent();return t},getSwimlaneAt(t,e,i){if(i||(i=this.getCurrentRoot())||(i=this.getDataModel().getRoot()),i){const s=i.getChildCount();for(let n=0;n<s;n+=1){const s=i.getChildAt(n);if(s){const i=this.getSwimlaneAt(t,e,s);if(null!=i)return i;if(s.isVisible()&&this.isSwimlane(s)){const i=this.getView().getState(s);if(i&&this.intersects(i,t,e))return s}}}}return null},hitsSwimlaneContent(t,e,i){const s=this.getView().getState(t),n=this.getStartSize(t);if(s){const t=this.getView().getScale();if(e-=s.x,i-=s.y,n.width>0&&e>0&&e>n.width*t)return!0;if(n.height>0&&i>0&&i>n.height*t)return!0}return!1},getStartSize(t,e=!1){const i=new Rectangle.default,s=this.getCurrentCellStyle(t,e),n=s.startSize??Constants.DEFAULT_STARTSIZE;return s.horizontal??1?i.height=n:i.width=n,i},getSwimlaneDirection(t){const e=t.direction??Constants.DIRECTION.EAST,i=t.flipH,s=t.flipV;let n=t.horizontal??1?0:3;e===Constants.DIRECTION.NORTH?n--:e===Constants.DIRECTION.WEST?n+=2:e===Constants.DIRECTION.SOUTH&&(n+=1);const l=(0,mathUtils.mod)(n,2);return i&&1===l&&(n+=2),s&&0===l&&(n+=2),[Constants.DIRECTION.NORTH,Constants.DIRECTION.EAST,Constants.DIRECTION.SOUTH,Constants.DIRECTION.WEST][(0,mathUtils.mod)(n,4)]},getActualStartSize(t,e=!1){const i=new Rectangle.default;if(this.isSwimlane(t,e)){const s=this.getCurrentCellStyle(t,e),n=s.startSize??Constants.DEFAULT_STARTSIZE,l=this.getSwimlaneDirection(s);l===Constants.DIRECTION.NORTH?i.y=n:l===Constants.DIRECTION.WEST?i.x=n:l===Constants.DIRECTION.SOUTH?i.height=n:i.width=n}return i},isSwimlane(t,e=!1){return!(!t||t.getParent()===this.getDataModel().getRoot()||t.isEdge())&&this.getCurrentCellStyle(t,e).shape===Constants.SHAPE.SWIMLANE},isValidDropTarget(t,e,i){return t&&(this.isSplitEnabled()&&this.isSplitTarget(t,e,i)||!t.isEdge()&&(this.isSwimlane(t)||t.getChildCount()>0&&!t.isCollapsed()))},getDropTarget(t,e,i=null,s=!1){if(!this.isSwimlaneNesting())for(let e=0;e<t.length;e+=1)if(this.isSwimlane(t[e]))return null;const n=(0,styleUtils.convertPoint)(this.getContainer(),(0,EventUtils.getClientX)(e),(0,EventUtils.getClientY)(e));n.x-=this.getPanDx(),n.y-=this.getPanDy();const l=this.getSwimlaneAt(n.x,n.y);if(i){if(l){let t=l.getParent();for(;t&&this.isSwimlane(t)&&t!==i;)t=t.getParent();t===i&&(i=l)}}else i=l;for(;i&&!this.isValidDropTarget(i,t,e)&&!this.getDataModel().isLayer(i);)i=i.getParent();let a=i;if(!s)for(;a&&t.indexOf(a)<0;)a=a.getParent();return this.getDataModel().isLayer(i)||a?null:i},isSwimlaneNesting(){return this.swimlaneNesting},setSwimlaneNesting(t){this.swimlaneNesting=t},isSwimlaneSelectionEnabled(){return this.swimlaneSelectionEnabled},setSwimlaneSelectionEnabled(t){this.swimlaneSelectionEnabled=t}},TerminalMixin={isTerminalPointMovable:(t,e)=>!0,getOpposites(t,e=null,i=!0,s=!0){const n=[],l=new Dictionary.default;for(let a=0;a<t.length;a+=1){const r=this.getView().getState(t[a]),o=r?r.getVisibleTerminal(!0):this.getView().getVisibleTerminal(t[a],!0),h=r?r.getVisibleTerminal(!1):this.getView().getVisibleTerminal(t[a],!1);o===e&&h&&h!==e&&s?l.get(h)||(l.put(h,!0),n.push(h)):h===e&&o&&o!==e&&i&&(l.get(o)||(l.put(o,!0),n.push(o)))}return n}},TooltipMixin={getTooltip(t,e,i,s){let n=null;if(!t.control||e!==t.control.node&&e.parentNode!==t.control.node||(n=this.getCollapseExpandResource(),n=(0,StringUtils.htmlEntities)(i18n_Translations.get(n)||n,!0).replace(/\\n/g,"<br>")),!n&&t.overlays&&t.overlays.visit(((t,i)=>{n||e!==i.node&&e.parentNode!==i.node||(n=i.overlay?i.overlay.toString()??null:null)})),!n){const i=this.getPlugin("SelectionCellsHandler"),s=i?.getHandler(t.cell);s&&"getTooltipForNode"in s&&"function"==typeof s.getTooltipForNode&&(n=s.getTooltipForNode(e))}return n||(n=this.getTooltipForCell(t.cell)),n},getTooltipForCell(t){let e=null;return e=t&&"getTooltip"in t?t.getTooltip():this.convertValueToString(t),e},setTooltips(t){const e=this.getPlugin("TooltipHandler");e?.setEnabled(t)}},ValidationMixin={validationAlert(t){alert(t)},isEdgeValid(t,e,i){return!this.getEdgeValidationError(t,e,i)},getEdgeValidationError(t=null,e=null,i=null){if(t&&!this.isAllowDanglingEdges()&&(!e||!i))return"";if(t&&!t.getTerminal(!0)&&!t.getTerminal(!1))return null;if(!this.isAllowLoops()&&e===i&&e)return"";if(!this.isValidConnection(e,i))return"";if(e&&i){let s="";if(!this.isMultigraph()){const n=this.getDataModel().getEdgesBetween(e,i,!0);(n.length>1||1===n.length&&n[0]!==t)&&(s+=`${i18n_Translations.get(this.getAlreadyConnectedResource())||this.getAlreadyConnectedResource()}\n`)}const n=e.getDirectedEdgeCount(!0,t),l=i.getDirectedEdgeCount(!1,t);for(const a of this.multiplicities){const r=a.check(this,t,e,i,n,l);null!=r&&(s+=r)}const a=this.validateEdge(t,e,i);return null!=a&&(s+=a),s.length>0?s:null}return this.isAllowDanglingEdges()?null:""},validateEdge:(t=null,e=null,i=null)=>null,validateGraph(t=null,e){if(!(t=t??this.getDataModel().getRoot()))return"The root does not exist!";e=e??{};let i=!0;const s=t.getChildCount();for(let n=0;n<s;n+=1){const s=t.getChildAt(n);let l=e;this.isValidRoot(s)&&(l={});const a=this.validateGraph(s,l);a?this.setCellWarning(s,a.replace(/\n/g,"<br>")):this.setCellWarning(s,null),i=i&&null==a}let n="";t&&t.isCollapsed()&&!i&&(n+=`${i18n_Translations.get(this.getContainsValidationErrorsResource())||this.getContainsValidationErrorsResource()}\n`),t&&t.isEdge()?n+=this.getEdgeValidationError(t,t.getTerminal(!0),t.getTerminal(!1))||"":n+=this.getCellValidationError(t)||"";const l=this.validateCell(t,e);return null!=l&&(n+=l),null==t.getParent()&&this.getView().validate(),n.length>0||!i?n:null},getCellValidationError(t){const e=t.getDirectedEdgeCount(!0),i=t.getDirectedEdgeCount(!1),s=t.getValue();let n="";for(let t=0;t<this.multiplicities.length;t+=1){const l=this.multiplicities[t];(l.source&&(0,domUtils.isNode)(s,l.type,l.attr,l.value)&&(e>l.max||e<l.min)||!l.source&&(0,domUtils.isNode)(s,l.type,l.attr,l.value)&&(i>l.max||i<l.min))&&(n+=`${l.countError}\n`)}return n.length>0?n:null},validateCell:(t,e)=>null},VertexMixin={vertexLabelsMovable:!1,allowNegativeCoordinates:!0,isAllowNegativeCoordinates(){return this.allowNegativeCoordinates},setAllowNegativeCoordinates(t){this.allowNegativeCoordinates=t},insertVertex(...t){let e,i,s,n,l,a,r,o,h,d;if(1===t.length&&"object"==typeof t[0]){const u=t[0];e=u.parent,i=u.id,s=u.value,n="x"in u?u.x:u.position?.[0],l="y"in u?u.y:u.position?.[1],a="width"in u?u.width:u.size?.[0],r="height"in u?u.height:u.size?.[1],o=u.style,h=u.relative,d=u.geometryClass}else[e,i,s,n,l,a,r,o,h,d]=t;const u=this.createVertex(e,i,s,n,l,a,r,o,h,d);return this.addCell(u,e)},createVertex(t,e,i,s,n,l,a,r,o=!1,h=Geometry.default){const d=new h(s,n,l,a);d.relative=o;const u=new Cell.default(i,d,r);return u.setId(e),u.setVertex(!0),u.setConnectable(!0),u},getChildVertices(t){return this.getChildCells(t,!0,!1)},isVertexLabelsMovable(){return this.vertexLabelsMovable},setVertexLabelsMovable(t){this.vertexLabelsMovable=t}},ZoomMixin={zoomFactor:1.2,keepSelectionVisibleOnZoom:!1,centerZoom:!0,zoomIn(){this.zoom(this.zoomFactor)},zoomOut(){this.zoom(1/this.zoomFactor)},zoomActual(){1===this.getView().scale?this.getView().setTranslate(0,0):(this.getView().translate.x=0,this.getView().translate.y=0,this.getView().setScale(1))},zoomTo(t,e=!1){this.zoom(t/this.getView().scale,e)},zoom(t,e){e=e??this.centerZoom;const i=Math.round(this.getView().scale*t*100)/100,s=this.getView().getState(this.getSelectionCell()),n=this.getContainer();if(t=i/this.getView().scale,this.keepSelectionVisibleOnZoom&&null!=s){const e=new Rectangle.default(s.x*t,s.y*t,s.width*t,s.height*t);this.getView().scale=i,this.scrollRectToVisible(e)||(this.getView().revalidate(),this.getView().setScale(i))}else{const s=(0,styleUtils.hasScrollbars)(this.getContainer());if(e&&!s){let e=n.offsetWidth,s=n.offsetHeight;if(t>1){const n=(t-1)/(2*i);e*=-n,s*=-n}else{const i=(1/t-1)/(2*this.getView().scale);e*=i,s*=i}this.getView().scaleAndTranslate(i,this.getView().translate.x+e,this.getView().translate.y+s)}else{const l=this.getView().translate.x,a=this.getView().translate.y,r=n.scrollLeft,o=n.scrollTop;if(this.getView().setScale(i),s){let i=0,s=0;e&&(i=n.offsetWidth*(t-1)/2,s=n.offsetHeight*(t-1)/2),n.scrollLeft=(this.getView().translate.x-l)*this.getView().scale+Math.round(r*t+i),n.scrollTop=(this.getView().translate.y-a)*this.getView().scale+Math.round(o*t+s)}}}},zoomToRect(t){const e=this.getContainer(),i=e.clientWidth/t.width/(e.clientHeight/t.height);t.x=Math.max(0,t.x),t.y=Math.max(0,t.y);let s=Math.min(e.scrollWidth,t.x+t.width),n=Math.min(e.scrollHeight,t.y+t.height);if(t.width=s-t.x,t.height=n-t.y,i<1){const s=t.height/i,l=(s-t.height)/2;t.height=s;const a=Math.min(t.y,l);t.y-=a,n=Math.min(e.scrollHeight,t.y+t.height),t.height=n-t.y}else{const n=t.width*i,l=(n-t.width)/2;t.width=n;const a=Math.min(t.x,l);t.x-=a,s=Math.min(e.scrollWidth,t.x+t.width),t.width=s-t.x}const l=e.clientWidth/t.width,a=this.getView().scale*l;(0,styleUtils.hasScrollbars)(this.getContainer())?(this.getView().setScale(a),e.scrollLeft=Math.round(t.x*l),e.scrollTop=Math.round(t.y*l)):this.getView().scaleAndTranslate(a,this.getView().translate.x-t.x/this.getView().scale,this.getView().translate.y-t.y/this.getView().scale)}},applyGraphMixins=t=>{const e=(0,Utils.mixInto)(t);for(const t of[CellsMixin,ConnectionsMixin,DragDropMixin,EdgeMixin,EditingMixin,EventsMixin,FoldingMixin,GroupingMixin,ImageMixin,LabelMixin,OrderMixin,PageBreaksMixin,OverlaysMixin,PanningMixin,PortsMixin,SelectionMixin,SnapMixin,SwimlaneMixin,TerminalMixin,TooltipMixin,ValidationMixin,VertexMixin,ZoomMixin])e(t)};class CellEditorHandler{constructor(t){this.clearOnChange=!1,this.bounds=null,this.resizeThread=null,this.textDirection=null,this.textarea=null,this.editingCell=null,this.trigger=null,this.modified=!1,this.autoSize=!0,this.selectText=!0,this.emptyLabelText=Client.default.IS_FF?"<br>":"",this.escapeCancelsEditing=!0,this.textNode=null,this.zIndex=5,this.minResize=new Rectangle.default(0,20),this.wordWrapPadding=0,this.blurEnabled=!1,this.initialValue=null,this.align=null,this.graph=t,this.zoomHandler=()=>{this.graph.isEditing()&&this.resize()},this.changeHandler=t=>{this.editingCell&&!this.graph.getView().getState(this.editingCell,!1)&&this.stopEditing(!0)},this.graph.getView().addListener(InternalEvent.default.SCALE,this.zoomHandler),this.graph.getView().addListener(InternalEvent.default.SCALE_AND_TRANSLATE,this.zoomHandler),this.graph.getDataModel().addListener(InternalEvent.default.CHANGE,this.changeHandler)}init(){this.textarea=document.createElement("div"),this.textarea.className="mxCellEditor mxPlainTextEditor",this.textarea.contentEditable=String(!0),Client.default.IS_GC&&(this.textarea.style.minHeight="1em"),this.textarea.style.position="absolute",this.installListeners(this.textarea)}applyValue(t,e){this.graph.labelChanged(t.cell,e,this.trigger)}setAlign(t){this.textarea&&(this.textarea.style.textAlign=t),this.align=t,this.resize()}getInitialValue(t,e){let i=(0,StringUtils.htmlEntities)(this.graph.getEditingValue(t.cell,e),!1);return i=(0,StringUtils.replaceTrailingNewlines)(i,"<div><br></div>"),i.replace(/\n/g,"<br>")}getCurrentValue(t){return this.textarea?(0,domUtils.extractTextWithWhitespace)(Array.from(this.textarea.childNodes)):null}isCancelEditingKeyEvent(t){return this.escapeCancelsEditing||(0,EventUtils.isShiftDown)(t)||(0,EventUtils.isControlDown)(t)||(0,EventUtils.isMetaDown)(t)}installListeners(t){InternalEvent.default.addListener(t,"dragstart",(t=>{this.graph.stopEditing(!1),InternalEvent.default.consume(t)})),InternalEvent.default.addListener(t,"blur",(t=>{this.blurEnabled&&this.focusLost()})),InternalEvent.default.addListener(t,"keydown",(t=>{(0,EventUtils.isConsumed)(t)||(this.isStopEditingEvent(t)?(this.graph.stopEditing(!1),InternalEvent.default.consume(t)):27===t.keyCode&&(this.graph.stopEditing(this.isCancelEditingKeyEvent(t)),InternalEvent.default.consume(t)))}));const e=e=>{null!=this.editingCell&&this.clearOnChange&&t.innerHTML===this.getEmptyLabelText()&&(!Client.default.IS_FF||8!==e.keyCode&&46!==e.keyCode)&&(this.clearOnChange=!1,t.innerHTML="")};InternalEvent.default.addListener(t,"keypress",e),InternalEvent.default.addListener(t,"paste",e);const i=t=>{if(null!=this.editingCell){const t=this.textarea;0===t.innerHTML.length||"<br>"===t.innerHTML?(t.innerHTML=this.getEmptyLabelText(),this.clearOnChange=t.innerHTML.length>0):this.clearOnChange=!1}};InternalEvent.default.addListener(t,"input",i),InternalEvent.default.addListener(t,"cut",i),InternalEvent.default.addListener(t,"paste",i);const s=t=>{null!=this.editingCell&&this.autoSize&&!(0,EventUtils.isConsumed)(t)&&(null!=this.resizeThread&&window.clearTimeout(this.resizeThread),this.resizeThread=window.setTimeout((()=>{this.resizeThread=null,this.resize()}),0))};InternalEvent.default.addListener(t,"input",s),InternalEvent.default.addListener(window,"resize",s),InternalEvent.default.addListener(t,"cut",s),InternalEvent.default.addListener(t,"paste",s)}isStopEditingEvent(t){return 113===t.keyCode||this.graph.isEnterStopsCellEditing()&&13===t.keyCode&&!(0,EventUtils.isControlDown)(t)&&!(0,EventUtils.isShiftDown)(t)}isEventSource(t){return(0,EventUtils.getSource)(t)===this.textarea}resize(){const t=this.editingCell?this.graph.getView().getState(this.editingCell):null;if(t){if(null!=this.textarea){const e=t.cell.isEdge(),{scale:i}=this.graph.getView();let s=null;if(this.autoSize&&"fill"!==t.style.overflow){const n=t.style.labelWidth??null;if(s=null!=t.text&&null==this.align?t.text.margin:null,null==s&&(s=(0,styleUtils.getAlignmentAsPoint)(this.align??t.style.align??Constants.ALIGN.CENTER,t.style.verticalAlign??Constants.ALIGN.MIDDLE)),e){if(this.bounds=new Rectangle.default(t.absoluteOffset.x,t.absoluteOffset.y,0,0),null!=n){const t=(n+2)*i;this.bounds.width=t,this.bounds.x+=s.x*t}}else{let e=Rectangle.default.fromRectangle(t),s=t.style.labelPosition??Constants.ALIGN.CENTER,l=t.style.verticalLabelPosition??Constants.ALIGN.MIDDLE;if(e=null!=t.shape&&"center"===s&&"middle"===l?t.shape.getLabelBounds(e):e,null!=n&&(e.width=n*i),!t.view.graph.cellRenderer.legacySpacing||"width"!==t.style.overflow){const a=new node_TextShape,r=(t.style.spacing??2)*i,o=((t.style.spacingTop??0)+a.baseSpacingTop)*i+r,h=((t.style.spacingRight??0)+a.baseSpacingRight)*i+r,d=((t.style.spacingBottom??0)+a.baseSpacingBottom)*i+r,u=((t.style.spacingLeft??0)+a.baseSpacingLeft)*i+r;s=null!=t.style.labelPosition?t.style.labelPosition:"center",l=null!=t.style.verticalLabelPosition?t.style.verticalLabelPosition:"middle",e=new Rectangle.default(e.x+u,e.y+o,e.width-(s===Constants.ALIGN.CENTER&&null==n?u+h:0),e.height-(l===Constants.ALIGN.MIDDLE?o+d:0))}this.bounds=new Rectangle.default(e.x+t.absoluteOffset.x,e.y+t.absoluteOffset.y,e.width,e.height)}if(this.graph.isWrapping(t.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!==this.getEmptyLabelText()){this.textarea.style.wordWrap=Constants.WORD_WRAP,this.textarea.style.whiteSpace="normal";const t=Math.round(this.bounds.width/i)+this.wordWrapPadding;"relative"!==this.textarea.style.position?(this.textarea.style.width=`${t}px`,this.textarea.scrollWidth>t&&(this.textarea.style.width=`${this.textarea.scrollWidth}px`)):this.textarea.style.maxWidth=`${t}px`}else this.textarea.style.whiteSpace="nowrap",this.textarea.style.width="";this.textarea.scrollWidth,this.textarea.scrollHeight,this.textarea.style.left=`${Math.max(0,Math.round(this.bounds.x-s.x*(this.bounds.width-2))+1)}px`,this.textarea.style.top=`${Math.max(0,Math.round(this.bounds.y-s.y*(this.bounds.height-4)+(-1===s.y?3:0))+1)}px`}else this.bounds=this.getEditorBounds(t),this.textarea.style.width=`${Math.round(this.bounds.width/i)}px`,this.textarea.style.height=`${Math.round(this.bounds.height/i)}px`,this.textarea.style.left=`${Math.max(0,Math.round(this.bounds.x+1))}px`,this.textarea.style.top=`${Math.max(0,Math.round(this.bounds.y+1))}px`,this.graph.isWrapping(t.cell)&&(this.bounds.width>=2||this.bounds.height>=2)&&this.textarea.innerHTML!==this.getEmptyLabelText()?(this.textarea.style.wordWrap=Constants.WORD_WRAP,this.textarea.style.whiteSpace="normal","fill"!==t.style.overflow&&(this.textarea.style.width=`${Math.round(this.bounds.width/i)+this.wordWrapPadding}px`)):(this.textarea.style.whiteSpace="nowrap","fill"!==t.style.overflow&&(this.textarea.style.width=""));(0,styleUtils.setPrefixedStyle)(this.textarea.style,"transformOrigin","0px 0px"),(0,styleUtils.setPrefixedStyle)(this.textarea.style,"transform",`scale(${i},${i})${null==s?"":` translate(${100*s.x}%,${100*s.y}%)`}`)}}else this.stopEditing(!0)}focusLost(){this.stopEditing(!this.graph.isInvokesStopCellEditing())}getBackgroundColor(t){return Constants.NONE}startEditing(t,e=null){this.stopEditing(!0),this.align=null,null==this.textarea&&this.init();const i=this.graph.getPlugin("TooltipHandler");i?.hideTooltip();const s=this.graph.getView().getState(t);if(s){const{scale:i}=this.graph.getView(),n=s.style.fontSize??Constants.DEFAULT_FONTSIZE,l=s.style.fontFamily??Constants.DEFAULT_FONTFAMILY,a=s.style.fontColor??"black",r=s.style.align??Constants.ALIGN.LEFT,o=(s.style.fontStyle||0)&Constants.FONT.BOLD,h=(s.style.fontStyle||0)&Constants.FONT.ITALIC,d=[];(s.style.fontStyle||0)&Constants.FONT.UNDERLINE&&d.push("underline"),(s.style.fontStyle||0)&Constants.FONT.STRIKETHROUGH&&d.push("line-through");const u=this.textarea;u.style.lineHeight=Constants.ABSOLUTE_LINE_HEIGHT?`${Math.round(n*Constants.LINE_HEIGHT)}px`:String(Constants.LINE_HEIGHT),u.style.backgroundColor=this.getBackgroundColor(s)||"transparent",u.style.textDecoration=d.join(" "),u.style.fontWeight=o?"bold":"normal",u.style.fontStyle=h?"italic":"",u.style.fontSize=`${Math.round(n)}px`,u.style.zIndex=String(this.zIndex),u.style.fontFamily=l,u.style.textAlign=r,u.style.outline="none",u.style.color=a;let c=this.textDirection=s.style.textDirection??Constants.DEFAULT_TEXT_DIRECTION;"auto"===c&&(null===s.text||s.text.dialect===Constants.DIALECT.STRICTHTML||(0,domUtils.isNode)(s.text.value)||(c=s.text.getAutoDirection())),"ltr"===c||"rtl"===c?u.setAttribute("dir",c):u.removeAttribute("dir"),u.innerHTML=this.getInitialValue(s,e)||"",this.initialValue=u.innerHTML,0===u.innerHTML.length||"<br>"===u.innerHTML?(u.innerHTML=this.getEmptyLabelText(),this.clearOnChange=!0):this.clearOnChange=u.innerHTML===this.getEmptyLabelText(),this.graph.container.appendChild(u),this.editingCell=t,this.trigger=e,this.textNode=null,null!==s.text&&this.isHideLabel(s)&&(this.textNode=s.text.node,this.textNode.style.visibility="hidden"),this.autoSize&&(s.cell.isEdge()||"fill"!==s.style.overflow)&&window.setTimeout((()=>{this.resize()}),0),this.resize();try{u.focus(),this.isSelectText()&&u.innerHTML.length>0&&(u.innerHTML!==this.getEmptyLabelText()||!this.clearOnChange)&&document.execCommand("selectAll",!1)}catch(t){}}}isSelectText(){return this.selectText}stopEditing(t=!1){if(this.editingCell){this.textNode&&(this.textNode.style.visibility="visible",this.textNode=null);const e=t?null:this.graph.view.getState(this.editingCell),i=this.textarea,s=this.initialValue;if(this.initialValue=null,this.editingCell=null,this.bounds=null,i.blur(),(0,domUtils.clearSelection)(),i.parentNode&&i.parentNode.removeChild(i),this.clearOnChange&&i.innerHTML===this.getEmptyLabelText()&&(i.innerHTML="",this.clearOnChange=!1),e&&(i.innerHTML!==s||null!==this.align)){this.prepareTextarea();const t=this.getCurrentValue(e);this.graph.batchUpdate((()=>{null!==t&&this.applyValue(e,t),null!==this.align&&this.graph.setCellStyles("align",this.align,[e.cell])}))}this.trigger=null,this.textarea&&InternalEvent.default.release(this.textarea),this.textarea=null,this.align=null}}prepareTextarea(){const t=this.textarea;t.lastChild&&"BR"===t.lastChild.nodeName&&t.removeChild(t.lastChild)}isHideLabel(t=null){return!0}getMinimumSize(t){const{scale:e}=this.graph.getView(),i=this.textarea;return new Rectangle.default(0,0,null===t.text?30:t.text.size*e+20,"left"===i.style.textAlign?120:40)}getEditorBounds(t){const e=t.cell.isEdge(),{scale:i}=this.graph.getView(),s=this.getMinimumSize(t),n=s.width,l=s.height;let a=null;if(!e&&t.view.graph.cellRenderer.legacySpacing&&"fill"===t.style.overflow)a=t.shape.getLabelBounds(Rectangle.default.fromRectangle(t));else{const s=new node_TextShape,r=(t.style.spacing??0)*i,o=((t.style.spacingTop??0)+s.baseSpacingTop)*i+r,h=((t.style.spacingRight??0)+s.baseSpacingRight)*i+r,d=((t.style.spacingBottom??0)+s.baseSpacingBottom)*i+r,u=((t.style.spacingLeft??0)+s.baseSpacingLeft)*i+r;a=new Rectangle.default(t.x,t.y,Math.max(n,t.width-u-h),Math.max(l,t.height-o-d));const c=null!=t.style.labelPosition?t.style.labelPosition:"center",g=null!=t.style.verticalLabelPosition?t.style.verticalLabelPosition:"middle";if(a=null!=t.shape&&"center"===c&&"middle"===g?t.shape.getLabelBounds(a):a,e?(a.x=t.absoluteOffset.x,a.y=t.absoluteOffset.y,null!=t.text&&null!=t.text.boundingBox&&(t.text.boundingBox.x>0&&(a.x=t.text.boundingBox.x),t.text.boundingBox.y>0&&(a.y=t.text.boundingBox.y))):null!=t.text&&null!=t.text.boundingBox&&(a.x=Math.min(a.x,t.text.boundingBox.x),a.y=Math.min(a.y,t.text.boundingBox.y)),a.x+=u,a.y+=o,null!=t.text&&null!=t.text.boundingBox&&(e?(a.width=Math.max(n,t.text.boundingBox.width),a.height=Math.max(l,t.text.boundingBox.height)):(a.width=Math.max(a.width,t.text.boundingBox.width),a.height=Math.max(a.height,t.text.boundingBox.height))),t.cell.isVertex()){const e=t.style.labelPosition??Constants.ALIGN.CENTER;"left"===e?a.x-=t.width:"right"===e&&(a.x+=t.width);const i=null!=t.style.verticalLabelPosition?t.style.verticalLabelPosition:"middle";"top"===i?a.y-=t.height:"bottom"===i&&(a.y+=t.height)}}return new Rectangle.default(Math.round(a.x),Math.round(a.y),Math.round(a.width),Math.round(a.height))}getEmptyLabelText(t=null){return this.emptyLabelText??""}getEditingCell(){return this.editingCell}onDestroy(){this.textarea&&(InternalEvent.default.release(this.textarea),this.textarea.parentNode&&this.textarea.parentNode.removeChild(this.textarea),this.textarea=null),this.graph.getDataModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.zoomHandler)}}CellEditorHandler.pluginId="CellEditorHandler";const handler_CellEditorHandler=CellEditorHandler;class TooltipHandler{init(){document.body&&(this.div=document.createElement("div"),this.div.className="mxTooltip",this.div.style.visibility="hidden",document.body.appendChild(this.div),InternalEvent.default.addGestureListeners(this.div,(t=>{const e=(0,EventUtils.getSource)(t);e&&"A"!==e.nodeName&&this.hideTooltip()})),InternalEvent.default.addListener(this.graph.getContainer(),"mouseleave",(t=>{this.div!==t.relatedTarget&&this.hide()})))}constructor(t){this.zIndex=10005,this.delay=500,this.ignoreTouchEvents=!0,this.hideOnHover=!1,this.destroyed=!1,this.lastX=0,this.lastY=0,this.state=null,this.stateSource=!1,this.thread=null,this.enabled=!1,this.graph=t,this.graph.addMouseListener(this)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isHideOnHover(){return this.hideOnHover}setHideOnHover(t){this.hideOnHover=t}getStateForEvent(t){return t.getState()}mouseDown(t,e){this.reset(e,!1),this.hideTooltip()}mouseMove(t,e){if(e.getX()!==this.lastX||e.getY()!==this.lastY){this.reset(e,!0);const t=this.getStateForEvent(e);(this.isHideOnHover()||t!==this.state||e.getSource()!==this.node&&(!this.stateSource||null!=t&&this.stateSource===(e.isSource(t.shape)||!e.isSource(t.text))))&&this.hideTooltip()}this.lastX=e.getX(),this.lastY=e.getY()}mouseUp(t,e){this.reset(e,!0),this.hideTooltip()}resetTimer(){this.thread&&(window.clearTimeout(this.thread),this.thread=null)}reset(t,e,i=null){if((!this.ignoreTouchEvents||(0,EventUtils.isMouseEvent)(t.getEvent()))&&(this.resetTimer(),i=i??this.getStateForEvent(t),e&&this.isEnabled()&&i&&(!this.div||"hidden"==this.div.style.visibility))){const e=t.getSource(),s=t.getX(),n=t.getY(),l=t.isSource(i.shape)||t.isSource(i.text),a=this.graph.getPlugin("PopupMenuHandler");this.thread=window.setTimeout((()=>{if(i&&e&&!this.graph.isEditing()&&a&&!a.isMenuShowing()&&!this.graph.isMouseDown){const t=this.graph.getTooltip(i,e,s,n);this.show(t,s,n),this.state=i,this.node=e,this.stateSource=l}}),this.delay)}}hide(){this.resetTimer(),this.hideTooltip()}hideTooltip(){this.div&&(this.div.style.visibility="hidden",this.div.innerHTML="")}show(t,e,i){if(!this.destroyed&&t&&""!==t){const s=(0,styleUtils.getScrollOrigin)();this.div||this.init(),this.div.style.zIndex=String(this.zIndex),this.div.style.left=`${e+s.x}px`,this.div.style.top=`${i+Constants.TOOLTIP_VERTICAL_OFFSET+s.y}px`,(0,domUtils.isNode)(t)?(this.div.innerHTML="",this.div.appendChild(t)):this.div.innerHTML=t.replace(/\n/g,"<br>"),this.div.style.visibility="",(0,styleUtils.fit)(this.div)}}onDestroy(){this.destroyed||(this.resetTimer(),this.graph.removeMouseListener(this),this.div&&InternalEvent.default.release(this.div),this.div?.parentNode&&this.div.parentNode.removeChild(this.div),this.destroyed=!0,this.div=null)}}TooltipHandler.pluginId="TooltipHandler";const handler_TooltipHandler=TooltipHandler;class SelectionCellsHandler extends EventSource.default{constructor(t){super(),this.enabled=!0,this.maxHandlers=100,this.graph=t,this.handlers=new Dictionary.default,this.graph.addMouseListener(this),this.refreshHandler=(t,e)=>{this.isEnabled()&&this.refresh()},this.graph.getSelectionModel().addListener(InternalEvent.default.CHANGE,this.refreshHandler),this.graph.getDataModel().addListener(InternalEvent.default.CHANGE,this.refreshHandler),this.graph.getView().addListener(InternalEvent.default.SCALE,this.refreshHandler),this.graph.getView().addListener(InternalEvent.default.TRANSLATE,this.refreshHandler),this.graph.getView().addListener(InternalEvent.default.SCALE_AND_TRANSLATE,this.refreshHandler),this.graph.getView().addListener(InternalEvent.default.DOWN,this.refreshHandler),this.graph.getView().addListener(InternalEvent.default.UP,this.refreshHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}getHandler(t){return this.handlers.get(t)}isHandled(t){return!!this.getHandler(t)}reset(){this.handlers.visit(((t,e)=>{e.reset.apply(e)}))}getHandledSelectionCells(){return this.graph.getSelectionCells()}refresh(){const t=this.handlers;this.handlers=new Dictionary.default;const e=(0,styleUtils.sortCells)(this.getHandledSelectionCells(),!1);for(let i=0;i<e.length;i+=1){const s=this.graph.view.getState(e[i]);if(s){let n=t.remove(e[i]);n&&(n.state!==s?(n.onDestroy(),n=null):this.isHandlerActive(n)||(n.refresh&&n.refresh(),n.redraw())),n&&this.handlers.put(e[i],n)}}t.visit(((t,e)=>{this.fireEvent(new EventObject.default(InternalEvent.default.REMOVE,{state:e.state})),e.onDestroy()}));for(let t=0;t<e.length;t+=1){const i=this.graph.view.getState(e[t]);if(i){let s=this.handlers.get(e[t]);s?s.updateParentHighlight():(s=this.graph.createHandler(i),this.fireEvent(new EventObject.default(InternalEvent.default.ADD,{state:i})),this.handlers.put(e[t],s))}}}isHandlerActive(t){return null!==t.index}updateHandler(t){let e=this.handlers.remove(t.cell);if(e){const{index:i}=e,s=e.startX,n=e.startY;e.onDestroy(),e=this.graph.createHandler(t),e&&(this.handlers.put(t.cell,e),null!==i&&e.start(s,n,i))}}mouseDown(t,e){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.visit(((i,s)=>{s.mouseDown(t,e)}))}mouseMove(t,e){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.visit(((i,s)=>{s.mouseMove(t,e)}))}mouseUp(t,e){this.graph.isEnabled()&&this.isEnabled()&&this.handlers.visit(((i,s)=>{s.mouseUp(t,e)}))}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.refreshHandler),this.graph.getDataModel().removeListener(this.refreshHandler),this.graph.getView().removeListener(this.refreshHandler)}}SelectionCellsHandler.pluginId="SelectionCellsHandler";const handler_SelectionCellsHandler=SelectionCellsHandler;class MaxPopupMenu extends EventSource.default{constructor(t){super(),this.activeRow=null,this.eventReceiver=null,this.submenuImage=`${Client.default.imageBasePath}/submenu.gif`,this.zIndex=10006,this.useLeftButtonForPopup=!1,this.enabled=!0,this.itemCount=0,this.autoExpand=!1,this.smartSeparators=!1,this.labels=!0,this.willAddSeparator=!1,this.containsItems=!1,t&&(this.factoryMethod=t),this.table=document.createElement("table"),this.table.className="mxPopupMenu",this.tbody=document.createElement("tbody"),this.table.appendChild(this.tbody),this.div=document.createElement("div"),this.div.className="mxPopupMenu",this.div.style.display="inline",this.div.style.zIndex=String(this.zIndex),this.div.appendChild(this.table),InternalEvent.default.disableContextMenu(this.div)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isPopupTrigger(t){return t.isPopupTrigger()||this.useLeftButtonForPopup&&(0,EventUtils.isLeftMouseButton)(t.getEvent())}addItem(t,e,i,s=null,n=null,l=!0,a=!0,r=!1){s=s??this,this.itemCount++,s.willAddSeparator&&(s.containsItems&&this.addSeparator(s,!0),s.willAddSeparator=!1),s.containsItems=!0;const o=document.createElement("tr");o.className="mxPopupMenuItem";const h=document.createElement("td");if(h.className="mxPopupMenuIcon",e){const t=document.createElement("img");t.src=e,h.appendChild(t)}else if(n){const t=document.createElement("div");t.className=n,h.appendChild(t)}if(o.appendChild(h),this.labels){const e=document.createElement("td");e.className="mxPopupMenuItem"+(l?"":" mxDisabled"),(0,domUtils.write)(e,t),e.align="left",o.appendChild(e);const i=document.createElement("td");i.className="mxPopupMenuItem"+(l?"":" mxDisabled"),i.style.paddingRight="6px",i.style.textAlign="right",o.appendChild(i),null==s.div&&this.createSubmenu(s)}return s.tbody?.appendChild(o),a&&l&&(InternalEvent.default.addGestureListeners(o,(t=>{this.eventReceiver=o,s&&s.activeRow!=o&&s.activeRow!=s&&(s.activeRow&&s.activeRow.div.parentNode&&this.hideSubmenu(s),o.div&&(this.showSubmenu(s,o),s.activeRow=o)),InternalEvent.default.consume(t)}),(t=>{s&&s.activeRow!=o&&s.activeRow!=s&&(s.activeRow&&s.activeRow.div.parentNode&&this.hideSubmenu(s),this.autoExpand&&o.div&&(this.showSubmenu(s,o),s.activeRow=o)),r||(o.className="mxPopupMenuItemHover")}),(t=>{this.eventReceiver==o&&(s&&s.activeRow!=o&&this.hideMenu(),i?.(t)),this.eventReceiver=null,InternalEvent.default.consume(t)})),r||InternalEvent.default.addListener(o,"mouseout",(t=>{o.className="mxPopupMenuItem"}))),o}addCheckmark(t,e){if(t.firstChild){const i=t.firstChild.nextSibling;i.style.backgroundImage=`url('${e}')`,i.style.backgroundRepeat="no-repeat",i.style.backgroundPosition="2px 50%"}}createSubmenu(t){t.table=document.createElement("table"),t.table.className="mxPopupMenu",t.tbody=document.createElement("tbody"),t.table.appendChild(t.tbody),t.div=document.createElement("div"),t.div.className="mxPopupMenu",t.div.style.position="absolute",t.div.style.display="inline",t.div.style.zIndex=String(this.zIndex),t.div.appendChild(t.table);const e=document.createElement("img");e.setAttribute("src",this.submenuImage),t.firstChild?.nextSibling?.nextSibling&&t.firstChild.nextSibling.nextSibling.appendChild(e)}showSubmenu(t,e){if(e.div){e.div.style.left=t.div.offsetLeft+e.offsetLeft+e.offsetWidth-1+"px",e.div.style.top=`${t.div.offsetTop+e.offsetTop}px`,document.body.appendChild(e.div);const i=e.div.offsetLeft,s=e.div.offsetWidth,n=(0,styleUtils.getDocumentScrollOrigin)(document),l=document.body,a=document.documentElement;i+s>n.x+(l.clientWidth||a.clientWidth)&&(e.div.style.left=`${Math.max(0,t.div.offsetLeft-s-6)}px`),(0,styleUtils.fit)(e.div)}}addSeparator(t=null,e=!1){if(t=t||this,this.smartSeparators&&!e)t.willAddSeparator=!0;else if(t.tbody){t.willAddSeparator=!1;const e=document.createElement("tr"),i=document.createElement("td");i.className="mxPopupMenuIcon",i.style.padding="0 0 0 0px",e.appendChild(i);const s=document.createElement("td");s.style.padding="0 0 0 0px",s.setAttribute("colSpan","2");const n=document.createElement("hr");n.setAttribute("size","1"),s.appendChild(n),e.appendChild(s),t.tbody.appendChild(e)}}popup(t,e,i,s){if(this.div&&this.tbody&&this.factoryMethod){for(this.div.style.left=`${t}px`,this.div.style.top=`${e}px`;this.tbody.firstChild;)InternalEvent.default.release(this.tbody.firstChild),this.tbody.removeChild(this.tbody.firstChild);this.itemCount=0,this.factoryMethod(this,i,s),this.itemCount>0&&(this.showMenu(),this.fireEvent(new EventObject.default(InternalEvent.default.SHOW)))}}isMenuShowing(){return this.div&&this.div.parentNode==document.body}showMenu(){document.body.appendChild(this.div),(0,styleUtils.fit)(this.div)}hideMenu(){this.div&&(this.div.parentNode?.removeChild(this.div),this.hideSubmenu(this),this.containsItems=!1,this.fireEvent(new EventObject.default(InternalEvent.default.HIDE)))}hideSubmenu(t){t.activeRow&&(this.hideSubmenu(t.activeRow),t.activeRow.div.parentNode?.removeChild(t.activeRow.div),t.activeRow=null)}destroy(){this.div&&(InternalEvent.default.release(this.div),this.div.parentNode?.removeChild(this.div))}}const gui_MaxPopupMenu=MaxPopupMenu;class PopupMenuHandler extends gui_MaxPopupMenu{constructor(t){super(),this.inTolerance=!1,this.popupTrigger=!1,this.selectOnPopup=!0,this.clearSelectionOnBackground=!0,this.triggerX=null,this.triggerY=null,this.screenX=null,this.screenY=null,this.graph=t,this.graph.addMouseListener(this),this.gestureHandler=(t,e)=>{this.inTolerance=!1},this.graph.addListener(InternalEvent.default.GESTURE,this.gestureHandler),this.init()}init(){InternalEvent.default.addGestureListeners(this.div,(t=>{const e=this.graph.getPlugin("TooltipHandler");e?.hide()}))}isSelectOnPopup(t){return this.selectOnPopup}mouseDown(t,e){this.isEnabled()&&!(0,EventUtils.isMultiTouchEvent)(e.getEvent())&&(this.hideMenu(),this.triggerX=e.getGraphX(),this.triggerY=e.getGraphY(),this.screenX=(0,EventUtils.getMainEvent)(e.getEvent()).screenX,this.screenY=(0,EventUtils.getMainEvent)(e.getEvent()).screenY,this.popupTrigger=this.isPopupTrigger(e),this.inTolerance=!0)}mouseMove(t,e){this.inTolerance&&null!=this.screenX&&null!=this.screenY&&(Math.abs((0,EventUtils.getMainEvent)(e.getEvent()).screenX-this.screenX)>this.graph.getEventTolerance()||Math.abs((0,EventUtils.getMainEvent)(e.getEvent()).screenY-this.screenY)>this.graph.getEventTolerance())&&(this.inTolerance=!1)}mouseUp(t,e){if(this.popupTrigger&&this.inTolerance&&null!=this.triggerX&&null!=this.triggerY){const t=this.getCellForPopupEvent(e);this.graph.isEnabled()&&this.isSelectOnPopup(e)&&null!=t&&!this.graph.isCellSelected(t)?this.graph.setSelectionCell(t):this.clearSelectionOnBackground&&null==t&&this.graph.clearSelection();const i=this.graph.getPlugin("TooltipHandler");i?.hide();const s=(0,styleUtils.getScrollOrigin)();this.popup(e.getX()+s.x+1,e.getY()+s.y+1,t,e.getEvent()),e.consume()}this.popupTrigger=!1,this.inTolerance=!1}getCellForPopupEvent(t){return t.getCell()}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.gestureHandler),super.destroy()}}PopupMenuHandler.pluginId="PopupMenuHandler";const handler_PopupMenuHandler=PopupMenuHandler;var util_config=__webpack_require__(272);class ConnectionHandler extends EventSource.default{constructor(t,e=null){super(),this.previous=null,this.iconState=null,this.icons=[],this.cell=null,this.currentPoint=null,this.sourceConstraint=null,this.shape=null,this.icon=null,this.originalPoint=null,this.currentState=null,this.selectedIcon=null,this.waypoints=[],this.factoryMethod=null,this.moveIconFront=!1,this.moveIconBack=!1,this.connectImage=null,this.targetConnectImage=!1,this.enabled=!1,this.select=!0,this.createTarget=!1,this.error=null,this.waypointsEnabled=!1,this.ignoreMouseDown=!1,this.first=null,this.connectIconOffset=new Point.default(0,Constants.TOOLTIP_VERTICAL_OFFSET),this.edgeState=null,this.mouseDownCounter=0,this.movePreviewAway=!1,this.outlineConnect=!1,this.livePreview=!1,this.cursor=null,this.insertBeforeSource=!1,this.graph=t,this.factoryMethod=e,this.graph.addMouseListener(this),this.marker=this.createMarker(),this.constraintHandler=new handler_ConstraintHandler(this.graph),this.changeHandler=t=>{this.iconState&&(this.iconState=this.graph.getView().getState(this.iconState.cell)),this.iconState?(this.redrawIcons(this.icons,this.iconState),this.constraintHandler.reset()):this.previous&&!this.graph.view.getState(this.previous.cell)&&this.reset()},this.graph.getDataModel().addListener(InternalEvent.default.CHANGE,this.changeHandler),this.graph.getView().addListener(InternalEvent.default.SCALE,this.changeHandler),this.graph.getView().addListener(InternalEvent.default.TRANSLATE,this.changeHandler),this.graph.getView().addListener(InternalEvent.default.SCALE_AND_TRANSLATE,this.changeHandler),this.drillHandler=t=>{this.reset()},this.graph.addListener(InternalEvent.default.START_EDITING,this.drillHandler),this.graph.getView().addListener(InternalEvent.default.DOWN,this.drillHandler),this.graph.getView().addListener(InternalEvent.default.UP,this.drillHandler),this.escapeHandler=()=>{this.reset()},this.graph.addListener(InternalEvent.default.ESCAPE,this.escapeHandler)}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isInsertBefore(t,e,i,s,n){return this.insertBeforeSource&&e!==i}isCreateTarget(t){return this.createTarget}setCreateTarget(t){this.createTarget=t}createShape(){const t=this.livePreview&&this.edgeState?this.graph.cellRenderer.createShape(this.edgeState):new edge_PolylineShape([],Constants.INVALID_COLOR);return t&&t.node&&(t.dialect=Constants.DIALECT.SVG,t.scale=this.graph.view.scale,t.pointerEvents=!1,t.isDashed=!0,t.init(this.graph.getView().getOverlayPane()),InternalEvent.default.redirectMouseEvents(t.node,this.graph,null)),t}isConnectableCell(t){return!0}createMarker(){return new ConnectionHandlerCellMarker(this.graph,this)}start(t,e,i,s){this.previous=t,this.first=new Point.default(e,i),this.edgeState=s??this.createEdgeState(),this.marker.currentColor=this.marker.validColor,this.marker.markedState=t,this.marker.mark(),this.fireEvent(new EventObject.default(InternalEvent.default.START,{state:this.previous}))}isConnecting(){return!!this.first&&!!this.shape}isValidSource(t,e){return this.graph.isValidSource(t)}isValidTarget(t){return!0}validateConnection(t,e){return this.isValidTarget(e)?this.graph.getEdgeValidationError(null,t,e):""}getConnectImage(t){return this.connectImage}isMoveIconToFrontForState(t){return!(!t.text||t.text.node.parentNode!==this.graph.container)||this.moveIconFront}createIcons(t){const e=this.getConnectImage(t);if(e){this.iconState=t;const i=[],s=new Rectangle.default(0,0,e.width,e.height),n=new ImageShape.default(s,e.src,void 0,void 0,0);n.preserveImageAspect=!1,this.isMoveIconToFrontForState(t)?(n.dialect=Constants.DIALECT.STRICTHTML,n.init(this.graph.container)):(n.dialect=Constants.DIALECT.SVG,n.init(this.graph.getView().getOverlayPane()),this.moveIconBack&&n.node.parentNode&&n.node.previousSibling&&n.node.parentNode.insertBefore(n.node,n.node.parentNode.firstChild)),n.node.style.cursor=Constants.CURSOR.CONNECT;const l=()=>this.currentState??t,a=t=>{(0,EventUtils.isConsumed)(t)||(this.icon=n,this.graph.fireMouseEvent(InternalEvent.default.MOUSE_DOWN,new InternalMouseEvent.default(t,l())))};return InternalEvent.default.redirectMouseEvents(n.node,this.graph,l,a),i.push(n),this.redrawIcons(i,this.iconState),i}return[]}redrawIcons(t,e){if(t[0]&&t[0].bounds){const i=this.getIconPosition(t[0],e);t[0].bounds.x=i.x,t[0].bounds.y=i.y,t[0].redraw()}}getIconPosition(t,e){const{scale:i}=this.graph.getView();let s=e.getCenterX(),n=e.getCenterY();if(this.graph.isSwimlane(e.cell)){const t=this.graph.getStartSize(e.cell);s=0!==t.width?e.x+t.width*i/2:s,n=0!==t.height?e.y+t.height*i/2:n;const l=(0,mathUtils.toRadians)(e.style.rotation??0);if(0!==l){const t=Math.cos(l),i=Math.sin(l),a=new Point.default(e.getCenterX(),e.getCenterY()),r=(0,mathUtils.getRotatedPoint)(new Point.default(s,n),t,i,a);s=r.x,n=r.y}}return new Point.default(s-t.bounds.width/2,n-t.bounds.height/2)}destroyIcons(){for(let t=0;t<this.icons.length;t+=1)this.icons[t].destroy();this.icons=[],this.icon=null,this.selectedIcon=null,this.iconState=null}isStartEvent(t){return null!==this.constraintHandler.currentFocus&&null!==this.constraintHandler.currentConstraint||null!==this.previous&&null===this.error&&(0===this.icons.length||null!==this.icon)}mouseDown(t,e){if(this.mouseDownCounter+=1,this.isEnabled()&&this.graph.isEnabled()&&!e.isConsumed()&&!this.isConnecting()&&this.isStartEvent(e)){if(this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&this.constraintHandler.currentPoint?(this.sourceConstraint=this.constraintHandler.currentConstraint,this.previous=this.constraintHandler.currentFocus,this.first=this.constraintHandler.currentPoint.clone()):this.first=new Point.default(e.getGraphX(),e.getGraphY()),this.edgeState=this.createEdgeState(e),this.mouseDownCounter=1,this.waypointsEnabled&&!this.shape&&(this.waypoints=[],this.shape=this.createShape(),this.edgeState&&this.shape.apply(this.edgeState)),!this.previous&&this.edgeState&&this.edgeState.cell.geometry){const t=this.graph.getPointForEvent(e.getEvent());this.edgeState.cell.geometry.setTerminalPoint(t,!0)}this.fireEvent(new EventObject.default(InternalEvent.default.START,{state:this.previous})),e.consume()}this.selectedIcon=this.icon,this.icon=null}isImmediateConnectSource(t){return!this.graph.isCellMovable(t.cell)}createEdgeState(t){return null}isOutlineConnectEvent(t){if(!this.currentPoint)return!1;const e=(0,styleUtils.getOffset)(this.graph.container),i=t.getEvent(),s=(0,EventUtils.getClientX)(i),n=(0,EventUtils.getClientY)(i),l=document.documentElement,a=(window.pageXOffset||l.scrollLeft)-(l.clientLeft||0),r=(window.pageYOffset||l.scrollTop)-(l.clientTop||0),o=this.currentPoint.x-this.graph.container.scrollLeft+e.x-a,h=this.currentPoint.y-this.graph.container.scrollTop+e.y-r;return this.outlineConnect&&!(0,EventUtils.isShiftDown)(t.getEvent())&&(t.isSource(this.marker.highlight.shape)||(0,EventUtils.isAltDown)(t.getEvent())&&null!=t.getState()||this.marker.highlight.isHighlightAt(s,n)||(o!==s||h!==n)&&null==t.getState()&&this.marker.highlight.isHighlightAt(o,h))}updateCurrentState(t,e){if(this.constraintHandler.update(t,!this.first,!1,!this.first||t.isSource(this.marker.highlight.shape)?null:e),null!=this.constraintHandler.currentFocus&&null!=this.constraintHandler.currentConstraint)this.marker.highlight&&this.marker.highlight.state&&this.marker.highlight.state.cell===this.constraintHandler.currentFocus.cell&&this.marker.highlight.shape?"transparent"!==this.marker.highlight.shape.stroke&&(this.marker.highlight.shape.stroke="transparent",this.marker.highlight.repaint()):this.marker.markCell(this.constraintHandler.currentFocus.cell,"transparent"),this.previous&&(this.error=this.validateConnection(this.previous.cell,this.constraintHandler.currentFocus.cell),this.error||(this.currentState=this.constraintHandler.currentFocus),(this.error||this.currentState&&!this.isCellEnabled(this.currentState.cell))&&this.constraintHandler.reset());else{this.graph.isIgnoreTerminalEvent(t.getEvent())?(this.marker.reset(),this.currentState=null):(this.marker.process(t),this.currentState=this.marker.getValidState()),null==this.currentState||this.isCellEnabled(this.currentState.cell)||(this.constraintHandler.reset(),this.marker.reset(),this.currentState=null);const i=this.isOutlineConnectEvent(t);if(null!=this.currentState&&i){t.isSource(this.marker.highlight.shape)&&(e=new Point.default(t.getGraphX(),t.getGraphY()));const i=this.graph.getOutlineConstraint(e,this.currentState,t);this.constraintHandler.setFocus(t,this.currentState,!1),this.constraintHandler.currentConstraint=i,this.constraintHandler.currentPoint=e}if(this.outlineConnect&&null!=this.marker.highlight&&null!=this.marker.highlight.shape){const e=this.graph.view.scale;if(null!=this.constraintHandler.currentConstraint&&null!=this.constraintHandler.currentFocus)this.marker.highlight.shape.stroke=Constants.OUTLINE_HIGHLIGHT_COLOR,this.marker.highlight.shape.strokeWidth=Constants.OUTLINE_HIGHLIGHT_STROKEWIDTH/e/e,this.marker.highlight.repaint();else if(this.marker.hasValidState()){const i=t.getCell();i&&i.isConnectable()&&this.marker.getValidState()!==t.getState()?(this.marker.highlight.shape.stroke="transparent",this.currentState=null):this.marker.highlight.shape.stroke=Constants.DEFAULT_VALID_COLOR,this.marker.highlight.shape.strokeWidth=Constants.HIGHLIGHT_STROKEWIDTH/e/e,this.marker.highlight.repaint()}}}}isCellEnabled(t){return!0}convertWaypoint(t){const e=this.graph.getView().getScale(),i=this.graph.getView().getTranslate();t.x=t.x/e-i.x,t.y=t.y/e-i.y}snapToPreview(t,e){if(!(0,EventUtils.isAltDown)(t.getEvent())&&this.previous){const i=this.graph.getGridSize()*this.graph.view.scale/2,s=this.sourceConstraint&&this.first?this.first:new Point.default(this.previous.getCenterX(),this.previous.getCenterY());Math.abs(s.x-t.getGraphX())<i&&(e.x=s.x),Math.abs(s.y-t.getGraphY())<i&&(e.y=s.y)}}mouseMove(t,e){if(e.isConsumed()||!this.ignoreMouseDown&&!this.first&&this.graph.isMouseDown)this.constraintHandler.reset();else{!this.isEnabled()&&this.currentState&&(this.destroyIcons(),this.currentState=null);const t=this.graph.getView(),{scale:i}=t,s=t.translate;let n=new Point.default(e.getGraphX(),e.getGraphY());if(this.error=null,this.graph.isGridEnabledEvent(e.getEvent())&&(n=new Point.default((this.graph.snap(n.x/i-s.x)+s.x)*i,(this.graph.snap(n.y/i-s.y)+s.y)*i)),this.snapToPreview(e,n),this.currentPoint=n,(this.first||this.isEnabled()&&this.graph.isEnabled())&&(this.shape||!this.first||Math.abs(e.getGraphX()-this.first.x)>this.graph.getEventTolerance()||Math.abs(e.getGraphY()-this.first.y)>this.graph.getEventTolerance())&&this.updateCurrentState(e,n),this.first){let t=null,i=n;this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&this.constraintHandler.currentPoint?(t=this.constraintHandler.currentConstraint,i=this.constraintHandler.currentPoint.clone()):this.previous&&!this.graph.isIgnoreTerminalEvent(e.getEvent())&&(0,EventUtils.isShiftDown)(e.getEvent())&&(Math.abs(this.previous.getCenterX()-n.x)<Math.abs(this.previous.getCenterY()-n.y)?n.x=this.previous.getCenterX():n.y=this.previous.getCenterY());let s=this.first;if(this.selectedIcon&&this.selectedIcon.bounds){const t=this.selectedIcon.bounds.width,i=this.selectedIcon.bounds.height;if(this.currentState&&this.targetConnectImage){const t=this.getIconPosition(this.selectedIcon,this.currentState);this.selectedIcon.bounds.x=t.x,this.selectedIcon.bounds.y=t.y}else{const s=new Rectangle.default(e.getGraphX()+this.connectIconOffset.x,e.getGraphY()+this.connectIconOffset.y,t,i);this.selectedIcon.bounds=s}this.selectedIcon.redraw()}if(this.edgeState)this.updateEdgeState(i,t),i=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-1],s=this.edgeState.absolutePoints[0];else{if(this.currentState&&!this.constraintHandler.currentConstraint){const t=this.getTargetPerimeterPoint(this.currentState,e);null!=t&&(i=t)}if(!this.sourceConstraint&&this.previous){const t=this.waypoints.length>0?this.waypoints[0]:i,n=this.getSourcePerimeterPoint(this.previous,t,e);n&&(s=n)}}if(!this.currentState&&this.movePreviewAway&&i){let t=s;if(this.edgeState&&this.edgeState.absolutePoints.length>=2){const e=this.edgeState.absolutePoints[this.edgeState.absolutePoints.length-2];e&&(t=e)}if(t){const e=i.x-t.x,s=i.y-t.y,n=Math.sqrt(e*e+s*s);if(0===n)return;this.originalPoint=i.clone(),i.x-=4*e/n,i.y-=4*s/n}}else this.originalPoint=null;if(!this.shape){const t=Math.abs(e.getGraphX()-this.first.x),i=Math.abs(e.getGraphY()-this.first.y);(t>this.graph.getEventTolerance()||i>this.graph.getEventTolerance())&&(this.shape=this.createShape(),this.edgeState&&this.shape.apply(this.edgeState),this.updateCurrentState(e,n))}if(this.shape){if(this.edgeState)this.shape.points=this.edgeState.absolutePoints;else{let t=[s];this.waypoints.length>0&&(t=t.concat(this.waypoints)),t.push(i),this.shape.points=t}this.drawPreview()}this.cursor&&(this.graph.container.style.cursor=this.cursor),InternalEvent.default.consume(e.getEvent()),e.consume()}else this.isEnabled()&&this.graph.isEnabled()?this.previous===this.currentState||this.edgeState?this.previous!==this.currentState||null==this.currentState||0!==this.icons.length||this.graph.isMouseDown||e.consume():(this.destroyIcons(),!this.currentState||this.error||this.constraintHandler.currentConstraint||(this.icons=this.createIcons(this.currentState),0===this.icons.length&&(this.currentState.setCursor(Constants.CURSOR.CONNECT),e.consume())),this.previous=this.currentState):this.constraintHandler.reset();if(!this.graph.isMouseDown&&null!=this.currentState&&null!=this.icons){let t=!1;const i=e.getSource();for(let e=0;e<this.icons.length&&!t;e+=1)t=i===this.icons[e].node||!!i&&i.parentNode===this.icons[e].node;t||this.updateIcons(this.currentState,this.icons,e)}}}updateEdgeState(t,e){if(!this.edgeState)return;this.sourceConstraint&&this.sourceConstraint.point&&(this.edgeState.style.exitX=this.sourceConstraint.point.x,this.edgeState.style.exitY=this.sourceConstraint.point.y),e&&e.point?(this.edgeState.style.entryX=e.point.x,this.edgeState.style.entryY=e.point.y):(this.edgeState.style.entryX=0,this.edgeState.style.entryY=0),this.edgeState.absolutePoints=[null,null!=this.currentState?null:t],this.sourceConstraint&&this.graph.view.updateFixedTerminalPoint(this.edgeState,this.previous,!0,this.sourceConstraint),null!=this.currentState&&(null==e&&(e=this.graph.getConnectionConstraint(this.edgeState,this.previous,!1)),this.edgeState.setAbsoluteTerminalPoint(null,!1),this.graph.view.updateFixedTerminalPoint(this.edgeState,this.currentState,!1,e));const i=[];for(let t=0;t<this.waypoints.length;t+=1){const e=this.waypoints[t].clone();this.convertWaypoint(e),i[t]=e}this.graph.view.updatePoints(this.edgeState,i,this.previous,this.currentState),this.graph.view.updateFloatingTerminalPoints(this.edgeState,this.previous,this.currentState)}getTargetPerimeterPoint(t,e){let i=null;const{view:s}=t,n=s.getPerimeterFunction(t);if(n&&this.previous&&this.edgeState){const e=this.waypoints.length>0?this.waypoints[this.waypoints.length-1]:new Point.default(this.previous.getCenterX(),this.previous.getCenterY()),l=n(s.getPerimeterBounds(t),this.edgeState,e,!1);l&&(i=l)}else i=new Point.default(t.getCenterX(),t.getCenterY());return i}getSourcePerimeterPoint(t,e,i){let s=null;const{view:n}=t,l=n.getPerimeterFunction(t),a=new Point.default(t.getCenterX(),t.getCenterY());if(l){const i=t.style.rotation??0,r=-i*(Math.PI/180);0!==i&&(e=(0,mathUtils.getRotatedPoint)(new Point.default(e.x,e.y),Math.cos(r),Math.sin(r),a));let o=l(n.getPerimeterBounds(t),t,e,!1);o&&(0!==i&&(o=(0,mathUtils.getRotatedPoint)(new Point.default(o.x,o.y),Math.cos(-r),Math.sin(-r),a)),s=o)}else s=a;return s}updateIcons(t,e,i){}isStopEvent(t){return!!t.getState()}addWaypointForEvent(t){if(!this.first)return;let e=(0,styleUtils.convertPoint)(this.graph.container,t.getX(),t.getY());const i=Math.abs(e.x-this.first.x),s=Math.abs(e.y-this.first.y);if(this.waypoints.length>0||this.mouseDownCounter>1&&(i>this.graph.getEventTolerance()||s>this.graph.getEventTolerance())){const{scale:i}=this.graph.view;e=new Point.default(this.graph.snap(t.getGraphX()/i)*i,this.graph.snap(t.getGraphY()/i)*i),this.waypoints.push(e)}}checkConstraints(t,e){return!(t&&e&&t.point&&e.point&&t.point.equals(e.point)&&t.dx===e.dx&&t.dy===e.dy&&t.perimeter===e.perimeter)}mouseUp(t,e){if(!e.isConsumed()&&this.isConnecting()){if(this.waypointsEnabled&&!this.isStopEvent(e))return this.addWaypointForEvent(e),void e.consume();const t=this.sourceConstraint,i=this.constraintHandler.currentConstraint,s=this.previous?this.previous.cell:null;let n=null;this.constraintHandler.currentConstraint&&this.constraintHandler.currentFocus&&(n=this.constraintHandler.currentFocus.cell),!n&&this.currentState&&(n=this.currentState.cell),this.error||s&&n&&s===n&&!this.checkConstraints(t,i)?(null!=this.previous&&null!=this.marker.validState&&this.previous.cell===this.marker.validState.cell&&this.graph.selectCellForEvent(this.marker.validState.cell,e.getEvent()),null!=this.error&&this.error.length>0&&this.graph.validationAlert(this.error)):this.connect(s,n,e.getEvent(),e.getCell()),this.destroyIcons(),e.consume()}null!=this.first&&this.reset()}reset(){null!=this.shape&&(this.shape.destroy(),this.shape=null),null!=this.cursor&&null!=this.graph.container&&(this.graph.container.style.cursor=""),this.destroyIcons(),this.marker.reset(),this.constraintHandler.reset(),this.originalPoint=null,this.currentPoint=null,this.edgeState=null,this.previous=null,this.error=null,this.sourceConstraint=null,this.mouseDownCounter=0,this.first=null,this.fireEvent(new EventObject.default(InternalEvent.default.RESET))}drawPreview(){this.updatePreview(null===this.error),this.shape&&this.shape.redraw()}updatePreview(t){this.shape&&(this.shape.strokeWidth=this.getEdgeWidth(t),this.shape.stroke=this.getEdgeColor(t))}getEdgeColor(t){return t?Constants.VALID_COLOR:Constants.INVALID_COLOR}getEdgeWidth(t){return t?3:1}connect(t,e,i,s=null){if(e||this.isCreateTarget(i)||this.graph.isAllowDanglingEdges()){const n=this.graph.getDataModel();let l=!1,a=null;n.beginUpdate();try{if(t&&!e&&!this.graph.isIgnoreTerminalEvent(i)&&this.isCreateTarget(i)&&(e=this.createTargetVertex(i,t))){if(s=this.graph.getDropTarget([e],i,s),l=!0,null!=s&&s.isEdge())s=this.graph.getDefaultParent();else{const t=s?this.graph.getView().getState(s):null;if(t){const i=e.getGeometry();i&&(i.x-=t.origin.x,i.y-=t.origin.y)}}this.graph.addCell(e,s)}let r=this.graph.getDefaultParent();t&&e&&t.getParent()===e.getParent()&&t.getParent()?.getParent()!==n.getRoot()&&(r=t.getParent(),t.geometry&&t.geometry.relative&&e.geometry&&e.geometry.relative&&(r=r.getParent()));let o=null,h={};if(this.edgeState?.cell&&(o=this.edgeState.cell.value,h=this.edgeState.cell.style??{}),a=this.insertEdge(r,"",o,t,e,h),a&&t){if(this.graph.setConnectionConstraint(a,t,!0,this.sourceConstraint),this.graph.setConnectionConstraint(a,e,!1,this.constraintHandler.currentConstraint),this.edgeState?.cell?.geometry&&n.setGeometry(a,this.edgeState.cell.geometry),r=t.getParent(),this.isInsertBefore(a,t,e,i,s)){let e=t;for(;e&&null!=e.parent&&null!=e.geometry&&e.geometry.relative&&e.parent!==a.parent;)e=e.getParent();null!=e&&null!=e.parent&&e.parent===a.parent&&n.add(r,a,e.parent.getIndex(e))}let o=a.getGeometry();if(null==o&&(o=new Geometry.default,o.relative=!0,n.setGeometry(a,o)),this.waypoints.length>0){const t=this.graph.view.scale,e=this.graph.view.translate;o.points=[];for(let i=0;i<this.waypoints.length;i+=1){const s=this.waypoints[i];o.points.push(new Point.default(s.x/t-e.x,s.y/t-e.y))}}if(!e&&this.currentPoint){const t=this.graph.view.translate,e=this.graph.view.scale,i=null!=this.originalPoint?new Point.default(this.originalPoint.x/e-t.x,this.originalPoint.y/e-t.y):new Point.default(this.currentPoint.x/e-t.x,this.currentPoint.y/e-t.y);i.x-=this.graph.getPanDx()/this.graph.view.scale,i.y-=this.graph.getPanDy()/this.graph.view.scale,o.setTerminalPoint(i,!1)}this.fireEvent(new EventObject.default(InternalEvent.default.CONNECT,"cell",a,"terminal",e,"event",i,"target",s,"terminalInserted",l))}}catch(t){util_config.GlobalConfig.logger.show();const e="Error in ConnectionHandler: "+(t instanceof Error?t.message+"\n"+t.stack:"unknown cause");util_config.GlobalConfig.logger.debug(e)}finally{n.endUpdate()}this.select&&this.selectCells(a,l?e:null)}}selectCells(t,e){this.graph.setSelectionCell(t)}insertEdge(t,e,i,s,n,l){if(!this.factoryMethod)return this.graph.insertEdge(t,e,i,s,n,l);let a=this.createEdge(i,s,n,l);return a=this.graph.addEdge(a,t,s,n),a}createTargetVertex(t,e){let i=e.getGeometry();for(;i&&i.relative;)i=(e=e.getParent()).getGeometry();const s=this.graph.cloneCell(e);if(i=s.getGeometry(),i&&this.currentPoint){const t=this.graph.view.translate,s=this.graph.view.scale,n=new Point.default(this.currentPoint.x/s-t.x,this.currentPoint.y/s-t.y);i.x=Math.round(n.x-i.width/2-this.graph.getPanDx()/s),i.y=Math.round(n.y-i.height/2-this.graph.getPanDy()/s);const l=this.getAlignmentTolerance();if(l>0){const n=this.graph.view.getState(e);if(null!=n){const e=n.x/s-t.x,a=n.y/s-t.y;Math.abs(e-i.x)<=l&&(i.x=Math.round(e)),Math.abs(a-i.y)<=l&&(i.y=Math.round(a))}}}return s}getAlignmentTolerance(t){return this.graph.isGridEnabled()?this.graph.getGridSize()/2:this.graph.getSnapTolerance()}createEdge(t,e,i,s={}){let n=null;if(null!=this.factoryMethod&&(n=this.factoryMethod(e,i,s)),null==n){n=new Cell.default(t||""),n.setEdge(!0),n.setStyle(s);const e=new Geometry.default;e.relative=!0,n.setGeometry(e)}return n}onDestroy(){this.graph.removeMouseListener(this),this.shape&&(this.shape.destroy(),this.shape=null),this.marker&&(this.marker.destroy(),this.marker=null),this.constraintHandler&&this.constraintHandler.onDestroy(),this.changeHandler&&(this.graph.getDataModel().removeListener(this.changeHandler),this.graph.getView().removeListener(this.changeHandler)),this.drillHandler&&(this.graph.removeListener(this.drillHandler),this.graph.getView().removeListener(this.drillHandler)),this.escapeHandler&&this.graph.removeListener(this.escapeHandler)}}ConnectionHandler.pluginId="ConnectionHandler";class ConnectionHandlerCellMarker extends cell_CellMarker{constructor(t,e,i=Constants.DEFAULT_VALID_COLOR,s=Constants.DEFAULT_INVALID_COLOR,n=Constants.DEFAULT_HOTSPOT){super(t,i,s,n),this.hotspotEnabled=!0,this.connectionHandler=e}getCell(t){let e=super.getCell(t);if(this.connectionHandler.error=null,!e&&this.connectionHandler.currentPoint&&(e=this.connectionHandler.graph.getCellAt(this.connectionHandler.currentPoint.x,this.connectionHandler.currentPoint.y)),e&&!e.isConnectable()&&this.connectionHandler.cell){const t=this.connectionHandler.cell.getParent();t&&t.isVertex()&&t.isConnectable()&&(e=t)}return e&&(this.connectionHandler.graph.isSwimlane(e)&&null!=this.connectionHandler.currentPoint&&this.connectionHandler.graph.hitsSwimlaneContent(e,this.connectionHandler.currentPoint.x,this.connectionHandler.currentPoint.y)||!this.connectionHandler.isConnectableCell(e))&&(e=null),e?this.connectionHandler.isConnecting()?this.connectionHandler.previous&&(this.connectionHandler.error=this.connectionHandler.validateConnection(this.connectionHandler.previous.cell,e),null!==this.connectionHandler.error&&0===this.connectionHandler.error.length&&(e=null,this.connectionHandler.isCreateTarget(t.getEvent())&&(this.connectionHandler.error=null))):this.connectionHandler.isValidSource(e,t)||(e=null):!this.connectionHandler.isConnecting()||this.connectionHandler.isCreateTarget(t.getEvent())||this.connectionHandler.graph.isAllowDanglingEdges()||(this.connectionHandler.error=""),e}isValidState(t){return this.connectionHandler.isConnecting()?!this.connectionHandler.error:super.isValidState(t)}getMarkerColor(t,e,i){return!this.connectionHandler.connectImage||this.connectionHandler.isConnecting()?super.getMarkerColor(t,e,i):Constants.NONE}intersects(t,e){return!(!this.connectionHandler.connectImage&&!this.connectionHandler.isConnecting())||super.intersects(t,e)}}const handler_ConnectionHandler=ConnectionHandler;class Guide{constructor(t,e){this.states=[],this.horizontal=!0,this.vertical=!0,this.guideX=null,this.guideY=null,this.rounded=!1,this.tolerance=2,this.graph=t,this.setStates(e)}setStates(t){this.states=t}isEnabledForEvent(t){return!0}getGuideTolerance(t=!1){return t&&this.graph.isGridEnabled()?this.graph.getGridSize()/2:this.tolerance}createGuideShape(t=!1){const e=new edge_PolylineShape([],Constants.GUIDE_COLOR,Constants.GUIDE_STROKEWIDTH);return e.isDashed=!0,e}isStateIgnored(t){return!1}move(t=null,e,i=!1,s=!1){if((this.horizontal||this.vertical)&&t){const{scale:s}=this.graph.getView(),n=this.getGuideTolerance(i)*s,l=t.clone();l.x+=e.x,l.y+=e.y;let a=!1,r=null,o=null,h=!1,d=null,u=null,c=n,g=n;const p=l.x,f=l.x+l.width,E=l.getCenterX(),C=l.y,y=l.y+l.height,v=l.getCenterY(),m=(i,s,n)=>{let l=!1;n&&Math.abs(i-E)<c?(e.x=i-t.getCenterX(),c=Math.abs(i-E),l=!0):n||(Math.abs(i-p)<c?(e.x=i-t.x,c=Math.abs(i-p),l=!0):Math.abs(i-f)<c&&(e.x=i-t.x-t.width,c=Math.abs(i-f),l=!0)),l&&(r=s,o=i,this.guideX||(this.guideX=this.createGuideShape(!0),this.guideX.dialect=Constants.DIALECT.SVG,this.guideX.pointerEvents=!1,this.guideX.init(this.graph.getView().getOverlayPane()))),a=a||l},S=(i,s,n)=>{let l=!1;n&&Math.abs(i-v)<g?(e.y=i-t.getCenterY(),g=Math.abs(i-v),l=!0):n||(Math.abs(i-C)<g?(e.y=i-t.y,g=Math.abs(i-C),l=!0):Math.abs(i-y)<g&&(e.y=i-t.y-t.height,g=Math.abs(i-y),l=!0)),l&&(d=s,u=i,this.guideY||(this.guideY=this.createGuideShape(!1),this.guideY.dialect=Constants.DIALECT.SVG,this.guideY.pointerEvents=!1,this.guideY.init(this.graph.getView().getOverlayPane()))),h=h||l};for(let t=0;t<this.states.length;t+=1){const e=this.states[t];e&&!this.isStateIgnored(e)&&(this.horizontal&&(m(e.getCenterX(),e,!0),m(e.x,e,!1),m(e.x+e.width,e,!1),e.cell||m(e.getCenterX(),e,!1)),this.vertical&&(S(e.getCenterY(),e,!0),S(e.y,e,!1),S(e.y+e.height,e,!1),e.cell||S(e.getCenterY(),e,!1)))}this.graph.snapDelta(e,t,!i,a,h),e=this.getDelta(t,r,e.x,d,e.y);const w=this.graph.container;if(!a&&this.guideX)this.guideX.node.style.visibility="hidden";else if(this.guideX){let i=null,s=null;r&&(i=Math.min(t.y+e.y-this.graph.getPanDy(),r.y),s=Math.max(t.y+t.height+e.y-this.graph.getPanDy(),r.y+r.height)),this.guideX.points=null!==i&&null!==s?[new Point.default(o,i),new Point.default(o,s)]:[new Point.default(o,-this.graph.getPanDy()),new Point.default(o,w.scrollHeight-3-this.graph.getPanDy())],this.guideX.stroke=this.getGuideColor(r,!0),this.guideX.node.style.visibility="visible",this.guideX.redraw()}if(h||null==this.guideY){if(null!=this.guideY){let i=null,s=null;null!=d&&null!=t&&(i=Math.min(t.x+e.x-this.graph.getPanDx(),d.x),s=Math.max(t.x+t.width+e.x-this.graph.getPanDx(),d.x+d.width)),null!=i&&null!=s&&null!==u?this.guideY.points=[new Point.default(i,u),new Point.default(s,u)]:null!==u&&(this.guideY.points=[new Point.default(-this.graph.getPanDx(),u),new Point.default(w.scrollWidth-3-this.graph.getPanDx(),u)]),this.guideY.stroke=this.getGuideColor(d,!1),this.guideY.node.style.visibility="visible",this.guideY.redraw()}}else this.guideY.node.style.visibility="hidden"}return e}getDelta(t,e=null,i,s=null,n){const l=this.graph.view.scale;return(this.rounded||null!=e&&null==e.cell)&&(i=Math.round((t.x+i)/l)*l-t.x),(this.rounded||null!=s&&null==s.cell)&&(n=Math.round((t.y+n)/l)*l-t.y),new Point.default(i,n)}getGuideColor(t,e){return Constants.GUIDE_COLOR}hide(){this.setVisible(!1)}setVisible(t){this.guideX&&(this.guideX.node.style.visibility=t?"visible":"hidden"),this.guideY&&(this.guideY.node.style.visibility=t?"visible":"hidden")}destroy(){this.guideX&&(this.guideX.destroy(),this.guideX=null),this.guideY&&(this.guideY.destroy(),this.guideY=null)}}const other_Guide=Guide;class SelectionHandler{constructor(t){this.refreshThread=null,this.maxCells=50,this.enabled=!0,this.highlightEnabled=!0,this.cloneEnabled=!0,this.moveEnabled=!0,this.guidesEnabled=!1,this.handlesVisible=!0,this.guide=null,this.currentDx=0,this.currentDy=0,this.updateCursor=!0,this.selectEnabled=!0,this.removeCellsFromParent=!0,this.removeEmptyParents=!1,this.connectOnDrop=!1,this.scrollOnMove=!0,this.minimumSize=6,this.previewColor="black",this.htmlPreview=!1,this.shape=null,this.scaleGrid=!1,this.rotationEnabled=!0,this.maxLivePreview=0,this.allowLivePreview=Client.default.IS_SVG,this.cell=null,this.delayedSelection=!1,this.first=null,this.cells=null,this.bounds=null,this.pBounds=null,this.allCells=new Dictionary.default,this.cellWasClicked=!1,this.cloning=!1,this.cellCount=0,this.target=null,this.suspended=!1,this.livePreviewActive=!1,this.livePreviewUsed=!1,this.highlight=null,this.graph=t,this.graph.addMouseListener(this),this.panHandler=()=>{this.suspended||(this.updatePreview(),this.updateHint())},this.graph.addListener(InternalEvent.default.PAN,this.panHandler),this.escapeHandler=(t,e)=>{this.reset()},this.graph.addListener(InternalEvent.default.ESCAPE,this.escapeHandler),this.refreshHandler=(t,e)=>{this.refreshThread&&window.clearTimeout(this.refreshThread),this.refreshThread=window.setTimeout((()=>{if(this.refreshThread=null,this.first&&!this.suspended&&this.cells){const t=this.currentDx,e=this.currentDy;if(this.currentDx=0,this.currentDy=0,this.updatePreview(),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),null!=this.pBounds||this.livePreviewUsed){if(this.currentDx=t,this.currentDy=e,this.updatePreview(),this.updateHint(),this.livePreviewUsed){const t=this.graph.getPlugin("SelectionCellsHandler");this.setHandlesVisibleForCells(t?.getHandledSelectionCells()??[],!1,!0),this.updatePreview()}}else this.reset()}}),0)},this.graph.getDataModel().addListener(InternalEvent.default.CHANGE,this.refreshHandler),this.graph.addListener(InternalEvent.default.REFRESH,this.refreshHandler),this.keyHandler=t=>{if(null!=this.graph.container&&"hidden"!==this.graph.container.style.visibility&&null!=this.first&&!this.suspended){const e=this.graph.isCloneEvent(t)&&this.graph.isCellsCloneable()&&this.isCloneEnabled();e!==this.cloning&&(this.cloning=e,this.checkPreview(),this.updatePreview())}},"undefined"!=typeof document&&(InternalEvent.default.addListener(document,"keydown",this.keyHandler),InternalEvent.default.addListener(document,"keyup",this.keyHandler))}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isCloneEnabled(){return this.cloneEnabled}setCloneEnabled(t){this.cloneEnabled=t}isMoveEnabled(){return this.moveEnabled}setMoveEnabled(t){this.moveEnabled=t}isSelectEnabled(){return this.selectEnabled}setSelectEnabled(t){this.selectEnabled=t}isRemoveCellsFromParent(){return this.removeCellsFromParent}setRemoveCellsFromParent(t){this.removeCellsFromParent=t}isPropagateSelectionCell(t,e,i){const s=t.getParent();if(e){const e=t.isEdge()?null:t.getGeometry();return!this.graph.isSiblingSelected(t)&&e&&e.relative||!this.graph.isSwimlane(s)}return(!this.graph.isToggleEvent(i.getEvent())||!this.graph.isSiblingSelected(t)&&!this.graph.isCellSelected(t)&&!this.graph.isSwimlane(s)||this.graph.isCellSelected(s))&&(this.graph.isToggleEvent(i.getEvent())||!this.graph.isCellSelected(s))}getInitialCellForEvent(t){let e=t.getState();if((!this.graph.isToggleEvent(t.getEvent())||!(0,EventUtils.isAltDown)(t.getEvent()))&&e&&!this.graph.isCellSelected(e.cell)){let i=e.cell.getParent(),s=i?this.graph.view.getState(i):null;for(;s&&!this.graph.isCellSelected(s.cell)&&(s.cell.isVertex()||s.cell.isEdge())&&this.isPropagateSelectionCell(e.cell,!0,t);)e=s,i=e.cell.getParent(),s=i?this.graph.view.getState(i):null}return e?e.cell:null}isDelayedSelection(t,e){let i=t;const s=this.graph.getPlugin("SelectionCellsHandler");if(!this.graph.isToggleEvent(e.getEvent())||!(0,EventUtils.isAltDown)(e.getEvent()))for(;i;){if(s?.isHandled(i)){const t=this.graph.getPlugin("CellEditorHandler");return t?.getEditingCell()!==i}i=i.getParent()}return this.graph.isToggleEvent(e.getEvent())&&!(0,EventUtils.isAltDown)(e.getEvent())}selectDelayed(t){const e=this.graph.getPlugin("PopupMenuHandler");if(!e||!e.isPopupTrigger(t)){let e=t.getCell();null===e&&(e=this.cell),e&&this.selectCellForEvent(e,t)}}selectCellForEvent(t,e){const i=this.graph.view.getState(t);if(i)if(e.isSource(i.control))this.graph.selectCellForEvent(t,e.getEvent());else{if(!this.graph.isToggleEvent(e.getEvent())||!(0,EventUtils.isAltDown)(e.getEvent())){let i=t.getParent();for(;i&&this.graph.view.getState(i)&&(i.isVertex()||i.isEdge())&&this.isPropagateSelectionCell(t,!1,e);)i=(t=i).getParent()}this.graph.selectCellForEvent(t,e.getEvent())}return t}consumeMouseEvent(t,e){e.consume()}mouseDown(t,e){if(!e.isConsumed()&&this.isEnabled()&&this.graph.isEnabled()&&e.getState()&&!(0,EventUtils.isMultiTouchEvent)(e.getEvent())){const t=this.getInitialCellForEvent(e);if(t&&(this.delayedSelection=this.isDelayedSelection(t,e),this.cell=null,this.isSelectEnabled()&&!this.delayedSelection&&this.graph.selectCellForEvent(t,e.getEvent()),this.isMoveEnabled())){const i=t.getGeometry();i&&this.graph.isCellMovable(t)&&(!t.isEdge()||this.graph.getSelectionCount()>1||i.points&&i.points.length>0||!t.getTerminal(!0)||!t.getTerminal(!1)||this.graph.isAllowDanglingEdges()||this.graph.isCloneEvent(e.getEvent())&&this.graph.isCellsCloneable())?this.start(t,e.getX(),e.getY()):this.delayedSelection&&(this.cell=t),this.cellWasClicked=!0,this.consumeMouseEvent(InternalEvent.default.MOUSE_DOWN,e)}}}getGuideStates(){const t=this.graph.getDefaultParent();return this.graph.view.getCellStates(t.filterDescendants((t=>{const e=t.getGeometry();return!!this.graph.view.getState(t)&&t.isVertex()&&!!e&&!e.relative})))}getCells(t){return!this.delayedSelection&&this.graph.isCellMovable(t)?[t]:this.graph.getMovableCells(this.graph.getSelectionCells())}getPreviewBounds(t){const e=this.getBoundingBox(t);if(e){if(e.width=Math.max(0,e.width-1),e.height=Math.max(0,e.height-1),e.width<this.minimumSize){const t=this.minimumSize-e.width;e.x-=t/2,e.width=this.minimumSize}else e.x=Math.round(e.x),e.width=Math.ceil(e.width);if(e.height<this.minimumSize){const t=this.minimumSize-e.height;e.y-=t/2,e.height=this.minimumSize}else e.y=Math.round(e.y),e.height=Math.ceil(e.height)}return e}getBoundingBox(t){let e=null;if(t.length>0)for(let i=0;i<t.length;i+=1)if(t[i].isVertex()||t[i].isEdge()){const s=this.graph.view.getState(t[i]);if(s){let n=null;t[i].isVertex()&&s.shape&&s.shape.boundingBox&&(n=s.shape.boundingBox),n&&(e?e.add(n):e=Rectangle.default.fromRectangle(n))}}return e}createPreviewShape(t){const e=new RectangleShape.default(t,Constants.NONE,this.previewColor);return e.isDashed=!0,this.htmlPreview?(e.dialect=Constants.DIALECT.STRICTHTML,e.init(this.graph.container)):(e.dialect=Constants.DIALECT.SVG,e.init(this.graph.getView().getOverlayPane()),e.pointerEvents=!1,Client.default.IS_IOS&&(e.getSvgScreenOffset=()=>0)),e}createGuide(){return new other_Guide(this.graph,this.getGuideStates())}start(t,e,i,s){this.cell=t,this.first=(0,styleUtils.convertPoint)(this.graph.container,e,i),this.cells=s||this.getCells(this.cell),this.bounds=this.graph.getView().getBounds(this.cells),this.pBounds=this.getPreviewBounds(this.cells),this.cloning=!1,this.cellCount=0;for(let t=0;t<this.cells.length;t+=1)this.cellCount+=this.addStates(this.cells[t],this.allCells);if(this.guidesEnabled){this.guide=this.createGuide();const e=t.getParent(),i=e.getChildCount()<2,s=new Dictionary.default,n=this.graph.getOpposites(this.graph.getEdges(this.cell),this.cell);for(let t=0;t<n.length;t+=1){const e=this.graph.view.getState(n[t]);e&&!s.get(e)&&s.put(e,!0)}this.guide.isStateIgnored=t=>{const n=t.cell.getParent();return!!t.cell&&(!this.cloning&&!!this.isCellMoving(t.cell)||t.cell!==(this.target||e)&&!i&&!s.get(t)&&(!this.target||this.target.getChildCount()>=2)&&n!==(this.target||e))}}}addStates(t,e){const i=this.graph.view.getState(t);let s=0;if(i&&!e.get(t)){e.put(t,i),s++;const n=t.getChildCount();for(let i=0;i<n;i+=1)s+=this.addStates(t.getChildAt(i),e)}return s}isCellMoving(t){return this.allCells.get(t)}useGuidesForEvent(t){return!this.guide||this.guide.isEnabledForEvent(t.getEvent())&&!this.graph.isConstrainedEvent(t.getEvent())}snap(t){const e=this.scaleGrid?this.graph.view.scale:1;return t.x=this.graph.snap(t.x/e)*e,t.y=this.graph.snap(t.y/e)*e,t}getDelta(t){const e=(0,styleUtils.convertPoint)(this.graph.container,t.getX(),t.getY());return this.first?new Point.default(e.x-this.first.x-this.graph.getPanDx(),e.y-this.first.y-this.graph.getPanDy()):new Point.default}updateHint(t){}removeHint(){}roundLength(t){return Math.round(100*t)/100}isValidDropTarget(t,e){return!!this.cell&&this.cell.getParent()!==t}checkPreview(){this.livePreviewActive&&this.cloning?(this.resetLivePreview(),this.livePreviewActive=!1):this.maxLivePreview>=this.cellCount&&!this.livePreviewActive&&this.allowLivePreview?this.cloning&&this.livePreviewActive||(this.livePreviewActive=!0,this.livePreviewUsed=!0):this.livePreviewUsed||this.shape||!this.bounds||(this.shape=this.createPreviewShape(this.bounds))}mouseMove(t,e){const{graph:i}=this;if(!e.isConsumed()&&i.isMouseDown&&this.cell&&this.first&&this.bounds&&!this.suspended){if((0,EventUtils.isMultiTouchEvent)(e.getEvent()))return void this.reset();let t=this.getDelta(e);const s=i.getEventTolerance();if(this.shape||this.livePreviewActive||Math.abs(t.x)>s||Math.abs(t.y)>s){this.highlight||(this.highlight=new cell_CellHighlight(this.graph,Constants.DROP_TARGET_COLOR,3));const s=i.isCloneEvent(e.getEvent())&&i.isCellsCloneable()&&this.isCloneEnabled(),n=i.isGridEnabledEvent(e.getEvent()),l=e.getCell();let a=!0,r=null;this.cloning=s,i.isDropEnabled()&&this.highlightEnabled&&this.cells&&(r=i.getDropTarget(this.cells,e.getEvent(),l,s));let o=r?i.getView().getState(r):null,h=!1;if(o&&(s||r&&this.isValidDropTarget(r,e)))this.target!==r&&(this.target=r,this.setHighlightColor(Constants.DROP_TARGET_COLOR)),h=!0;else if(this.target=null,this.connectOnDrop&&l&&this.cells&&1===this.cells.length&&l.isVertex()&&l.isConnectable()&&(o=i.getView().getState(l),o)){const t=null===i.getEdgeValidationError(null,this.cell,l)?Constants.VALID_COLOR:Constants.INVALID_CONNECT_TARGET_COLOR;this.setHighlightColor(t),h=!0}o&&h?this.highlight.highlight(o):this.highlight.hide(),this.guide&&this.useGuidesForEvent(e)?(t=this.guide.move(this.bounds,t,n,s),a=!1):t=this.graph.snapDelta(t,this.bounds,!n,!1,!1),this.guide&&a&&this.guide.hide(),i.isConstrainedEvent(e.getEvent())&&(Math.abs(t.x)>Math.abs(t.y)?t.y=0:t.x=0),this.checkPreview(),this.currentDx===t.x&&this.currentDy===t.y||(this.currentDx=t.x,this.currentDy=t.y,this.updatePreview())}this.updateHint(e),this.consumeMouseEvent(InternalEvent.default.MOUSE_MOVE,e),InternalEvent.default.consume(e.getEvent())}else if((this.isMoveEnabled()||this.isCloneEnabled())&&this.updateCursor&&!e.isConsumed()&&(e.getState()||e.sourceState)&&!i.isMouseDown){let t=i.getCursorForMouseEvent(e);const s=e.getCell();!t&&s&&i.isEnabled()&&i.isCellMovable(s)&&(t=s.isEdge()?Constants.CURSOR.MOVABLE_EDGE:Constants.CURSOR.MOVABLE_VERTEX),t&&e.sourceState&&e.sourceState.setCursor(t)}}updatePreview(t=!1){if(this.livePreviewUsed&&!t){if(this.cells){const t=this.graph.getPlugin("SelectionCellsHandler");this.setHandlesVisibleForCells(t?.getHandledSelectionCells()??[],!1),this.updateLivePreview(this.currentDx,this.currentDy)}}else this.updatePreviewShape()}updatePreviewShape(){this.shape&&this.pBounds&&(this.shape.bounds=new Rectangle.default(Math.round(this.pBounds.x+this.currentDx),Math.round(this.pBounds.y+this.currentDy),this.pBounds.width,this.pBounds.height),this.shape.redraw())}updateLivePreview(t,e){if(!this.suspended){const i=[];if(this.allCells&&this.allCells.visit(((s,n)=>{const l=n?this.graph.view.getState(n.cell):null;if(l!==n&&n&&(n.destroy(),l?this.allCells.put(n.cell,l):this.allCells.remove(n.cell),n=l),n){const s=n.clone();i.push([n,s]),n.shape&&(null===n.shape.originalPointerEvents&&(n.shape.originalPointerEvents=n.shape.pointerEvents),n.shape.pointerEvents=!1,n.text&&(null===n.text.originalPointerEvents&&(n.text.originalPointerEvents=n.text.pointerEvents),n.text.pointerEvents=!1)),n.cell.isVertex()&&(n.x+=t,n.y+=e,this.cloning?n.text&&(n.text.updateBoundingBox(),n.text.boundingBox&&(n.text.boundingBox.x+=t,n.text.boundingBox.y+=e),n.text.unrotatedBoundingBox&&(n.text.unrotatedBoundingBox.x+=t,n.text.unrotatedBoundingBox.y+=e)):(n.view.graph.cellRenderer.redraw(n,!0),n.view.invalidate(n.cell),n.invalid=!1,n.control&&n.control.node&&(n.control.node.style.visibility="hidden")))}})),0===i.length)this.reset();else{const s=this.graph.view.scale;for(let n=0;n<i.length;n+=1){const l=i[n][0];if(l.cell.isEdge()){const a=l.cell.getGeometry(),r=[];if(a&&a.points)for(let i=0;i<a.points.length;i++)a.points[i]&&r.push(new Point.default(a.points[i].x+t/s,a.points[i].y+e/s));let o=l.visibleSourceState,h=l.visibleTargetState;const d=i[n][1].absolutePoints;if(null!=o&&this.isCellMoving(o.cell))l.view.updateFixedTerminalPoint(l,o,!0,this.graph.getConnectionConstraint(l,o,!0));else{const i=d[0];i&&(l.setAbsoluteTerminalPoint(new Point.default(i.x+t,i.y+e),!0),o=null)}if(null!=h&&this.isCellMoving(h.cell))l.view.updateFixedTerminalPoint(l,h,!1,this.graph.getConnectionConstraint(l,h,!1));else{const i=d[d.length-1];i&&(l.setAbsoluteTerminalPoint(new Point.default(i.x+t,i.y+e),!1),h=null)}l.view.updatePoints(l,r,o,h),l.view.updateFloatingTerminalPoints(l,o,h),l.view.updateEdgeLabelOffset(l),l.invalid=!1,this.cloning||l.view.graph.cellRenderer.redraw(l,!0)}}this.graph.view.validate(),this.redrawHandles(i),this.resetPreviewStates(i)}}}redrawHandles(t){const e=this.graph.getPlugin("SelectionCellsHandler");for(let i=0;i<t.length;i+=1){const s=e?.getHandler(t[i][0].cell);s?.redraw(!0)}}resetPreviewStates(t){for(let e=0;e<t.length;e+=1)t[e][0].setState(t[e][1])}suspend(){this.suspended||(this.livePreviewUsed&&this.updateLivePreview(0,0),this.shape&&(this.shape.node.style.visibility="hidden"),this.guide&&this.guide.setVisible(!1),this.suspended=!0)}resume(){this.suspended&&(this.suspended=!1,this.livePreviewUsed&&(this.livePreviewActive=!0),this.shape&&(this.shape.node.style.visibility="visible"),this.guide&&this.guide.setVisible(!0))}resetLivePreview(){this.allCells.visit(((t,e)=>{e.shape&&null!==e.shape.originalPointerEvents&&(e.shape.pointerEvents=e.shape.originalPointerEvents,e.shape.originalPointerEvents=null,e.shape.bounds=null,e.text&&null!==e.text.originalPointerEvents&&(e.text.pointerEvents=e.text.originalPointerEvents,e.text.originalPointerEvents=null)),e.control&&e.control.node&&"hidden"===e.control.node.style.visibility&&(e.control.node.style.visibility=""),this.cloning||e.text&&e.text.updateBoundingBox(),e.view.invalidate(e.cell)})),this.graph.view.validate()}setHandlesVisibleForCells(t,e,i=!1){if(i||this.handlesVisible!==e){this.handlesVisible=e;const i=this.graph.getPlugin("SelectionCellsHandler");for(let s=0;s<t.length;s+=1){const n=i?.getHandler(t[s]);n&&(n.setHandlesVisible(e),e&&n.redraw())}}}setHighlightColor(t){this.highlight&&this.highlight.setHighlightColor(t)}mouseUp(t,e){if(!e.isConsumed())if(this.livePreviewUsed&&this.resetLivePreview(),this.cell&&this.first&&(this.shape||this.livePreviewUsed)&&(0,mathUtils.isNumeric)(this.currentDx)&&(0,mathUtils.isNumeric)(this.currentDy)){const{graph:t}=this,i=e.getCell();if(this.connectOnDrop&&!this.target&&i&&i.isVertex()&&i.isConnectable()&&t.isEdgeValid(null,this.cell,i)){const s=t.getPlugin("ConnectionHandler");s?.connect(this.cell,i,e.getEvent())}else{const i=t.isCloneEvent(e.getEvent())&&t.isCellsCloneable()&&this.isCloneEnabled(),{scale:s}=t.getView(),n=this.roundLength(this.currentDx/s),l=this.roundLength(this.currentDy/s),a=this.target;a&&t.isSplitEnabled()&&this.cells&&t.isSplitTarget(a,this.cells,e.getEvent())?t.splitEdge(a,this.cells,null,n,l,e.getGraphX(),e.getGraphY()):this.cells&&this.moveCells(this.cells,n,l,i,this.target,e.getEvent())}}else this.isSelectEnabled()&&this.delayedSelection&&null!=this.cell&&this.selectDelayed(e);this.cellWasClicked&&this.consumeMouseEvent(InternalEvent.default.MOUSE_UP,e),this.reset()}reset(){if(this.livePreviewUsed){this.resetLivePreview();const t=this.graph.getPlugin("SelectionCellsHandler");this.setHandlesVisibleForCells(t?.getHandledSelectionCells()??[],!0)}this.destroyShapes(),this.removeHint(),this.delayedSelection=!1,this.livePreviewActive=!1,this.livePreviewUsed=!1,this.cellWasClicked=!1,this.suspended=!1,this.currentDx=0,this.currentDy=0,this.cellCount=0,this.cloning=!1,this.allCells.clear(),this.pBounds=null,this.target=null,this.first=null,this.cells=null,this.cell=null}shouldRemoveCellsFromParent(t,e,i){if(t.isVertex()){const e=this.graph.getView().getState(t);if(e){let t=(0,styleUtils.convertPoint)(this.graph.container,(0,EventUtils.getClientX)(i),(0,EventUtils.getClientY)(i));const s=(0,mathUtils.toRadians)(e.style.rotation??0);if(0!==s){const i=Math.cos(-s),n=Math.sin(-s),l=new Point.default(e.getCenterX(),e.getCenterY());t=(0,mathUtils.getRotatedPoint)(t,i,n,l)}return!(0,mathUtils.contains)(e,t.x,t.y)}}return!1}moveCells(t,e,i,s,n,l){if(!this.cell)return;s&&(t=this.graph.getCloneableCells(t));const a=this.cell.getParent();!n&&a&&this.isRemoveCellsFromParent()&&this.shouldRemoveCellsFromParent(a,t,l)&&(n=this.graph.getDefaultParent()),s=!!s&&!this.graph.isCellLocked(n||this.graph.getDefaultParent()),this.graph.batchUpdate((()=>{const a=[];if(!s&&n&&this.removeEmptyParents){const e=new Dictionary.default;for(let i=0;i<t.length;i+=1)e.put(t[i],!0);for(let i=0;i<t.length;i+=1){const s=t[i].getParent();s&&!e.get(s)&&(e.put(s,!0),a.push(s))}}t=this.graph.moveCells(t,e,i,s,n,l);const r=[];for(let t=0;t<a.length;t+=1)this.shouldRemoveParent(a[t])&&r.push(a[t]);this.graph.removeCells(r,!1)})),s&&this.graph.setSelectionCells(t),this.isSelectEnabled()&&this.scrollOnMove&&this.graph.scrollCellToVisible(t[0])}shouldRemoveParent(t){const e=this.graph.view.getState(t);return null!=e&&(e.cell.isEdge()||e.cell.isVertex())&&this.graph.isCellDeletable(e.cell)&&0===e.cell.getChildCount()&&e.isTransparentState()}destroyShapes(){this.shape&&(this.shape.destroy(),this.shape=null),this.guide&&(this.guide.destroy(),this.guide=null),this.highlight&&(this.highlight.destroy(),this.highlight=null)}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.panHandler),this.graph.removeListener(this.escapeHandler),this.graph.getDataModel().removeListener(this.refreshHandler),this.graph.removeListener(this.refreshHandler),InternalEvent.default.removeListener(document,"keydown",this.keyHandler),InternalEvent.default.removeListener(document,"keyup",this.keyHandler),this.destroyShapes(),this.removeHint()}}SelectionHandler.pluginId="SelectionHandler";const handler_SelectionHandler=SelectionHandler;class PanningManager{constructor(t){this.damper=1/6,this.delay=10,this.handleMouseOut=!0,this.border=0,this.thread=null,this.active=!1,this.tdx=0,this.tdy=0,this.t0x=0,this.t0y=0,this.dx=0,this.dy=0,this.scrollbars=!1,this.scrollLeft=0,this.scrollTop=0,this.thread=null,this.active=!1,this.tdx=0,this.tdy=0,this.t0x=0,this.t0y=0,this.dx=0,this.dy=0,this.scrollbars=!1,this.scrollLeft=0,this.scrollTop=0,this.mouseListener={mouseDown:(t,e)=>{},mouseMove:(t,e)=>{},mouseUp:(t,e)=>{this.active&&this.stop()}},t.addMouseListener(this.mouseListener),this.mouseUpListener=()=>{this.active&&this.stop()},InternalEvent.default.addListener(document,"mouseup",this.mouseUpListener);const e=()=>(this.scrollbars=(0,styleUtils.hasScrollbars)(t.container),this.scrollLeft=t.container.scrollLeft,this.scrollTop=t.container.scrollTop,window.setInterval((()=>{if(this.tdx-=this.dx,this.tdy-=this.dy,this.scrollbars){const e=-t.container.scrollLeft-Math.ceil(this.dx),i=-t.container.scrollTop-Math.ceil(this.dy);t.panGraph(e,i),t.setPanDx(this.scrollLeft-t.container.scrollLeft),t.setPanDy(this.scrollTop-t.container.scrollTop),t.fireEvent(new EventObject.default(InternalEvent.default.PAN))}else t.panGraph(this.getDx(),this.getDy())}),this.delay));this.isActive=()=>this.active,this.getDx=()=>Math.round(this.tdx),this.getDy=()=>Math.round(this.tdy),this.start=()=>{this.t0x=t.view.translate.x,this.t0y=t.view.translate.y,this.active=!0},this.panTo=(i,s,n=0,l=0)=>{this.active||this.start(),this.scrollLeft=t.container.scrollLeft,this.scrollTop=t.container.scrollTop;const a=t.container;this.dx=i+n-a.scrollLeft-a.clientWidth,this.dx<0&&Math.abs(this.dx)<this.border?this.dx=this.border+this.dx:this.handleMouseOut?this.dx=Math.max(this.dx,0):this.dx=0,0==this.dx&&(this.dx=i-a.scrollLeft,this.dx>0&&this.dx<this.border?this.dx-=this.border:this.handleMouseOut?this.dx=Math.min(0,this.dx):this.dx=0),this.dy=s+l-a.scrollTop-a.clientHeight,this.dy<0&&Math.abs(this.dy)<this.border?this.dy=this.border+this.dy:this.handleMouseOut?this.dy=Math.max(this.dy,0):this.dy=0,0==this.dy&&(this.dy=s-a.scrollTop,this.dy>0&&this.dy<this.border?this.dy-=this.border:this.handleMouseOut?this.dy=Math.min(0,this.dy):this.dy=0),0!=this.dx||0!=this.dy?(this.dx*=this.damper,this.dy*=this.damper,null==this.thread&&(this.thread=e())):null!=this.thread&&(window.clearInterval(this.thread),this.thread=null)},this.stop=()=>{if(this.active)if(this.active=!1,null!=this.thread&&(window.clearInterval(this.thread),this.thread=null),this.tdx=0,this.tdy=0,this.scrollbars)t.setPanDx(0),t.setPanDy(0),t.fireEvent(new EventObject.default(InternalEvent.default.PAN));else{const e=t.getPanDx(),i=t.getPanDy();0==e&&0==i||(t.panGraph(0,0),t.view.setTranslate(this.t0x+e/t.view.scale,this.t0y+i/t.view.scale))}},this.destroy=()=>{t.removeMouseListener(this.mouseListener),InternalEvent.default.removeListener(document,"mouseup",this.mouseUpListener)}}}const other_PanningManager=PanningManager;class PanningHandler extends EventSource.default{constructor(t){super(),this.getPanningManager=()=>this.panningManager,this.useLeftButtonForPanning=!1,this.usePopupTrigger=!0,this.ignoreCell=!1,this.previewEnabled=!0,this.useGrid=!1,this.panningEnabled=!1,this.pinchEnabled=!0,this.initialScale=0,this.maxScale=8,this.minScale=.01,this.dx=0,this.dy=0,this.startX=0,this.startY=0,this.dx0=0,this.dy0=0,this.panningTrigger=!1,this.active=!1,this.mouseDownEvent=null,this.graph=t,this.graph.addMouseListener(this),this.forcePanningHandler=(t,e)=>{const i=e.getProperty("eventName"),s=e.getProperty("event");i===InternalEvent.default.MOUSE_DOWN&&this.isForcePanningEvent(s)&&(this.start(s),this.active=!0,this.fireEvent(new EventObject.default(InternalEvent.default.PAN_START,{event:s})),s.consume())},this.graph.addListener(InternalEvent.default.FIRE_MOUSE_EVENT,this.forcePanningHandler),this.gestureHandler=(t,e)=>{if(this.isPinchEnabled()){const t=e.getProperty("event");(0,EventUtils.isConsumed)(t)||"gesturestart"!==t.type?"gestureend"===t.type&&0!==this.initialScale&&(this.initialScale=0):(this.initialScale=this.graph.view.scale,!this.active&&this.mouseDownEvent&&(this.start(this.mouseDownEvent),this.mouseDownEvent=null)),0!==this.initialScale&&this.zoomGraph(t)}},this.graph.addListener(InternalEvent.default.GESTURE,this.gestureHandler),this.mouseUpListener=()=>{this.active&&this.reset()},InternalEvent.default.addListener(document,"mouseup",this.mouseUpListener),this.panningManager=new other_PanningManager(t)}isActive(){return this.active||null!==this.initialScale}isPanningEnabled(){return this.panningEnabled}setPanningEnabled(t){this.panningEnabled=t}isPinchEnabled(){return this.pinchEnabled}setPinchEnabled(t){this.pinchEnabled=t}isPanningTrigger(t){const e=t.getEvent();return this.useLeftButtonForPanning&&!t.getState()&&(0,EventUtils.isLeftMouseButton)(e)||(0,EventUtils.isControlDown)(e)&&(0,EventUtils.isShiftDown)(e)||this.usePopupTrigger&&(0,EventUtils.isPopupTrigger)(e)}isForcePanningEvent(t){return this.ignoreCell||(0,EventUtils.isMultiTouchEvent)(t.getEvent())}mouseDown(t,e){this.mouseDownEvent=e,!e.isConsumed()&&this.isPanningEnabled()&&!this.active&&this.isPanningTrigger(e)&&(this.start(e),this.consumePanningTrigger(e))}start(t){this.dx0=-this.graph.container.scrollLeft,this.dy0=-this.graph.container.scrollTop,this.startX=t.getX(),this.startY=t.getY(),this.dx=0,this.dy=0,this.panningTrigger=!0}consumePanningTrigger(t){t.consume()}mouseMove(t,e){if(this.dx=e.getX()-this.startX,this.dy=e.getY()-this.startY,this.active)this.previewEnabled&&(this.useGrid&&(this.dx=this.graph.snap(this.dx),this.dy=this.graph.snap(this.dy)),this.graph.panGraph(this.dx+this.dx0,this.dy+this.dy0)),this.fireEvent(new EventObject.default(InternalEvent.default.PAN,{event:e}));else if(this.panningTrigger){const t=this.active;this.active=Math.abs(this.dx)>this.graph.getSnapTolerance()||Math.abs(this.dy)>this.graph.getSnapTolerance(),!t&&this.active&&this.fireEvent(new EventObject.default(InternalEvent.default.PAN_START,{event:e}))}(this.active||this.panningTrigger)&&e.consume()}mouseUp(t,e){if(this.active){if(0!==this.dx&&0!==this.dy){if(!this.graph.isUseScrollbarsForPanning()||!(0,styleUtils.hasScrollbars)(this.graph.container)){const{scale:t}=this.graph.getView(),e=this.graph.getView().translate;this.graph.panGraph(0,0),this.panGraph(e.x+this.dx/t,e.y+this.dy/t)}e.consume()}this.fireEvent(new EventObject.default(InternalEvent.default.PAN_END,{event:e}))}this.reset()}zoomGraph(t){let e=Math.round(this.initialScale*t.scale*100)/100;e=Math.max(this.minScale,e),e=Math.min(this.maxScale,e),this.graph.view.scale!==e&&(this.graph.zoomTo(e),InternalEvent.default.consume(t))}reset(){this.panningTrigger=!1,this.mouseDownEvent=null,this.active=!1,this.dx=0,this.dy=0}panGraph(t,e){this.graph.getView().setTranslate(t,e)}onDestroy(){this.graph.removeMouseListener(this),this.graph.removeListener(this.forcePanningHandler),this.graph.removeListener(this.gestureHandler),InternalEvent.default.removeListener(document,"mouseup",this.mouseUpListener)}}PanningHandler.pluginId="PanningHandler";const handler_PanningHandler=PanningHandler,getDefaultPlugins=()=>[handler_CellEditorHandler,handler_TooltipHandler,handler_SelectionCellsHandler,handler_PopupMenuHandler,handler_ConnectionHandler,handler_SelectionHandler,handler_PanningHandler];class Graph extends EventSource.default{createCellRenderer(){return new cell_CellRenderer}createEdgeHandlerInstance(t){return new handler_EdgeHandler(t)}createEdgeSegmentHandler(t){return new handler_EdgeSegmentHandler(t)}createElbowEdgeHandler(t){return new handler_ElbowEdgeHandler(t)}createGraphDataModel(){return new view_GraphDataModel}createGraphView(){return new GraphView.default(this)}createSelectionModel(){return new view_GraphSelectionModel(this)}createStylesheet(){return new Stylesheet}createVertexHandler(t){return new handler_VertexHandler(t)}registerDefaults(){registerDefaultShapes(),registerDefaultStyleElements(),registerDefaultEdgeMarkers()}constructor(t,e,i=getDefaultPlugins(),s=null){super(),this.destroyed=!1,this.graphModelChangeListener=null,this.paintBackground=null,this.isConstrainedMoving=!1,this.cells=[],this.imageBundles=[],this.mouseListeners=[],this.multiplicities=[],this.plugins={},this.renderHint=null,this.dialect="svg",this.defaultOverlap=.5,this.defaultParent=null,this.backgroundImage=null,this.pageVisible=!1,this.pageBreaksVisible=!1,this.pageBreakColor="gray",this.pageBreakDashed=!0,this.minPageBreakDist=20,this.preferPageSize=!1,this.pageFormat=new Rectangle.default(...Constants.PAGE_FORMAT_A4_PORTRAIT),this.pageScale=1.5,this.enabled=!0,this.exportEnabled=!0,this.importEnabled=!0,this.ignoreScrollbars=!1,this.translateToScrollPosition=!1,this.maximumGraphBounds=null,this.minimumGraphSize=null,this.minimumContainerSize=null,this.maximumContainerSize=null,this.resizeContainer=!1,this.border=0,this.keepEdgesInForeground=!1,this.keepEdgesInBackground=!1,this.recursiveResize=!1,this.resetViewOnRootChange=!0,this.allowLoops=!1,this.defaultLoopStyle=style_EdgeStyle.Loop,this.multigraph=!0,this.minFitScale=.1,this.maxFitScale=8,this.warningImage=new image_ImageBox(`${Client.default.imageBasePath}/warning${Client.default.IS_MAC?".png":".gif"}`,16,16),this.alreadyConnectedResource=config.TranslationsConfig.isEnabled()?"alreadyConnected":"",this.containsValidationErrorsResource=config.TranslationsConfig.isEnabled()?"containsValidationErrors":"",this.getContainer=()=>this.container,this.getPlugin=t=>this.plugins[t],this.getCellRenderer=()=>this.cellRenderer,this.getDialect=()=>this.dialect,this.isPageVisible=()=>this.pageVisible,this.isPageBreaksVisible=()=>this.pageBreaksVisible,this.getPageBreakColor=()=>this.pageBreakColor,this.isPageBreakDashed=()=>this.pageBreakDashed,this.getMinPageBreakDist=()=>this.minPageBreakDist,this.isPreferPageSize=()=>this.preferPageSize,this.getPageFormat=()=>this.pageFormat,this.getPageScale=()=>this.pageScale,this.isExportEnabled=()=>this.exportEnabled,this.isImportEnabled=()=>this.importEnabled,this.isIgnoreScrollbars=()=>this.ignoreScrollbars,this.isTranslateToScrollPosition=()=>this.translateToScrollPosition,this.getMinimumGraphSize=()=>this.minimumGraphSize,this.setMinimumGraphSize=t=>this.minimumGraphSize=t,this.getMinimumContainerSize=()=>this.minimumContainerSize,this.setMinimumContainerSize=t=>this.minimumContainerSize=t,this.getAlreadyConnectedResource=()=>this.alreadyConnectedResource,this.getContainsValidationErrorsResource=()=>this.containsValidationErrorsResource,this.registerDefaults(),this.container=t??document.createElement("div"),this.model=e??this.createGraphDataModel(),this.cellRenderer=this.createCellRenderer(),this.setStylesheet(s??this.createStylesheet()),this.view=this.createGraphView(),this.graphModelChangeListener=(t,e)=>{this.graphModelChanged(e.getProperty("edit").changes)},this.getDataModel().addListener(InternalEvent.default.CHANGE,this.graphModelChangeListener),this.view.init(),this.sizeDidChange(),this.setSelectionModel(this.createSelectionModel()),i.forEach((t=>this.plugins[t.pluginId]=new t(this))),this.view.revalidate()}getWarningImage(){return this.warningImage}batchUpdate(t){this.getDataModel().batchUpdate(t)}getDataModel(){return this.model}getView(){return this.view}getStylesheet(){return this.stylesheet}setStylesheet(t){this.stylesheet=t}graphModelChanged(t){for(const e of t)this.processChange(e);this.updateSelection(),this.view.validate(),this.sizeDidChange()}processChange(t){if(t instanceof undoable_changes_RootChange)this.clearSelection(),this.setDefaultParent(null),t.previous&&this.removeStateForCell(t.previous),this.resetViewOnRootChange&&(this.view.scale=1,this.view.translate.x=0,this.view.translate.y=0),this.fireEvent(new EventObject.default(InternalEvent.default.ROOT));else if(t instanceof undoable_changes_ChildChange){const e=t.child.getParent();this.view.invalidate(t.child,!0,!0),e&&this.getDataModel().contains(e)&&!e.isCollapsed()||(this.view.invalidate(t.child,!0,!0),this.removeStateForCell(t.child),this.view.currentRoot==t.child&&this.home()),e!=t.previous&&(null!=e&&this.view.invalidate(e,!1,!1),null!=t.previous&&this.view.invalidate(t.previous,!1,!1))}else if(t instanceof undoable_changes_TerminalChange||t instanceof undoable_changes_GeometryChange)(t instanceof undoable_changes_TerminalChange||null==t.previous&&null!=t.geometry||null!=t.previous&&!t.previous.equals(t.geometry))&&this.view.invalidate(t.cell);else if(t instanceof undoable_changes_ValueChange)this.view.invalidate(t.cell,!1,!1);else if(t instanceof undoable_changes_StyleChange){this.view.invalidate(t.cell,!0,!0);const e=this.view.getState(t.cell);null!=e&&(e.invalidStyle=!0)}else null!=t.cell&&t.cell instanceof Cell.default&&this.removeStateForCell(t.cell)}scrollPointToVisible(t,e,i=!1,s=20){const n=this.getPlugin("PanningHandler");if(this.isTimerAutoScroll()||!this.ignoreScrollbars&&!(0,styleUtils.hasScrollbars)(this.container))this.isAllowAutoPanning()&&n&&!n.isActive()&&n.getPanningManager().panTo(t+this.getPanDx(),e+this.getPanDy());else{const n=this.container;if(t>=n.scrollLeft&&e>=n.scrollTop&&t<=n.scrollLeft+n.clientWidth&&e<=n.scrollTop+n.clientHeight){let l=n.scrollLeft+n.clientWidth-t;if(l<s){const t=n.scrollLeft;if(n.scrollLeft+=s-l,i&&t===n.scrollLeft){const t=this.view.getDrawPane().ownerSVGElement,e=n.scrollWidth+s-l;t.style.width=`${e}px`,n.scrollLeft+=s-l}}else l=t-n.scrollLeft,l<s&&(n.scrollLeft-=s-l);let a=n.scrollTop+n.clientHeight-e;if(a<s){const t=n.scrollTop;if(n.scrollTop+=s-a,t==n.scrollTop&&i){const t=this.view.getDrawPane().ownerSVGElement,e=n.scrollHeight+s-a;t.style.height=`${e}px`,n.scrollTop+=s-a}}else a=e-n.scrollTop,a<s&&(n.scrollTop-=s-a)}}}getBorderSizes(){const t=(0,styleUtils.getCurrentStyle)(this.container);return new Rectangle.default((0,styleUtils.parseCssNumber)(t.paddingLeft)+("none"!=t.borderLeftStyle?(0,styleUtils.parseCssNumber)(t.borderLeftWidth):0),(0,styleUtils.parseCssNumber)(t.paddingTop)+("none"!=t.borderTopStyle?(0,styleUtils.parseCssNumber)(t.borderTopWidth):0),(0,styleUtils.parseCssNumber)(t.paddingRight)+("none"!=t.borderRightStyle?(0,styleUtils.parseCssNumber)(t.borderRightWidth):0),(0,styleUtils.parseCssNumber)(t.paddingBottom)+("none"!=t.borderBottomStyle?(0,styleUtils.parseCssNumber)(t.borderBottomWidth):0))}getPreferredPageSize(t,e,i){const s=this.view.translate,n=this.pageFormat,l=this.pageScale,a=new Rectangle.default(0,0,Math.ceil(n.width*l),Math.ceil(n.height*l)),r=this.pageBreaksVisible?Math.ceil(e/a.width):1,o=this.pageBreaksVisible?Math.ceil(i/a.height):1;return new Rectangle.default(0,0,r*a.width+2+s.x,o*a.height+2+s.y)}fit(t=this.getBorder(),e=!1,i=0,s=!0,n=!1,l=!1,a=null){if(null!=this.container){const r=this.getBorderSizes();let o=this.container.offsetWidth-r.x-r.width-1,h=null!=a?a:this.container.offsetHeight-r.y-r.height-1,d=this.view.getGraphBounds();if(d.width>0&&d.height>0){e&&null!=d.x&&null!=d.y&&(d=d.clone(),d.width+=d.x,d.height+=d.y,d.x=0,d.y=0);const a=this.view.scale;let r=d.width/a,u=d.height/a;null!=this.backgroundImage&&(r=Math.max(r,this.backgroundImage.width-d.x/a),u=Math.max(u,this.backgroundImage.height-d.y/a));const c=(e?t:2*t)+i+1;o-=c,h-=c;let g=n?h/u:l?o/r:Math.min(o/r,h/u);if(null!=this.minFitScale&&(g=Math.max(g,this.minFitScale)),null!=this.maxFitScale&&(g=Math.min(g,this.maxFitScale)),!s)return g;if(e)this.view.scale!=g&&this.view.setScale(g);else if((0,styleUtils.hasScrollbars)(this.container)){this.view.setScale(g);const t=this.getGraphBounds();null!=t.x&&(this.container.scrollLeft=t.x),null!=t.y&&(this.container.scrollTop=t.y)}else{const e=null!=d.x?Math.floor(this.view.translate.x-d.x/a+t/g+i/2):t,s=null!=d.y?Math.floor(this.view.translate.y-d.y/a+t/g+i/2):t;this.view.scaleAndTranslate(g,e,s)}}}return this.view.scale}doResizeContainer(t,e){null!=this.maximumContainerSize&&(t=Math.min(this.maximumContainerSize.width,t),e=Math.min(this.maximumContainerSize.height,e));const i=this.container;i.style.width=`${Math.ceil(t)}px`,i.style.height=`${Math.ceil(e)}px`}createHandler(t){let e=null;if(t.cell.isEdge()){const i=t.getVisibleTerminalState(!0),s=t.getVisibleTerminalState(!1),n=t.cell.getGeometry(),l=this.getView().getEdgeStyle(t,n&&n.points||void 0,i,s);e=this.createEdgeHandler(t,l)}else e=this.createVertexHandler(t);return e}createEdgeHandler(t,e){let i=null;return i=e==style_EdgeStyle.Loop||e==style_EdgeStyle.ElbowConnector||e==style_EdgeStyle.SideToSide||e==style_EdgeStyle.TopToBottom?this.createElbowEdgeHandler(t):e==style_EdgeStyle.SegmentConnector||e==style_EdgeStyle.OrthConnector?this.createEdgeSegmentHandler(t):this.createEdgeHandlerInstance(t),i}getCurrentRoot(){return this.view.currentRoot}getTranslateForRoot(t){return null}getChildOffsetForCell(t){return null}home(){const t=this.getCurrentRoot();null!=t&&(this.view.setCurrentRoot(null),null!=this.view.getState(t)&&this.setSelectionCell(t))}isValidRoot(t){return!!t}getGraphBounds(){return this.view.getGraphBounds()}getMaximumGraphBounds(){return this.maximumGraphBounds}refresh(t=null){t?this.view.clear(t,!1):this.view.clear(void 0,!0),this.view.validate(),this.sizeDidChange(),this.fireEvent(new EventObject.default(InternalEvent.default.REFRESH))}center(t=!0,e=!0,i=.5,s=.5){const n=this.container,l=(0,styleUtils.hasScrollbars)(this.container),a=2*this.getBorder(),r=n.clientWidth-a,o=n.clientHeight-a,h=this.getGraphBounds(),d=this.view.translate,u=this.view.scale;let c=t?r-h.width:0,g=e?o-h.height:0;if(l){h.x-=d.x,h.y-=d.y;const t=n.scrollWidth,e=n.scrollHeight;t>r&&(c=0),e>o&&(g=0),this.view.setTranslate(Math.floor(c/2-h.x),Math.floor(g/2-h.y)),n.scrollLeft=(t-r)/2,n.scrollTop=(e-o)/2}else this.view.setTranslate(t?Math.floor(d.x-h.x/u+c*i/u):d.x,e?Math.floor(d.y-h.y/u+g*s/u):d.y)}isOrthogonal(t){const e=t.style.orthogonal;if(null!=e)return e;const i=this.view.getEdgeStyle(t);return i===style_EdgeStyle.SegmentConnector||i===style_EdgeStyle.ElbowConnector||i===style_EdgeStyle.SideToSide||i===style_EdgeStyle.TopToBottom||i===style_EdgeStyle.EntityRelation||i===style_EdgeStyle.OrthConnector}getBackgroundImage(){return this.backgroundImage}setBackgroundImage(t){this.backgroundImage=t}convertValueToString(t){const e=t.getValue();if(null!=e){if((0,domUtils.isNode)(e))return e.nodeName;if("function"==typeof e.toString)return e.toString()}return""}getLinkForCell(t){return null}getBorder(){return this.border}setBorder(t){this.border=t}isResizeContainer(){return this.resizeContainer}setResizeContainer(t){this.resizeContainer=t}isEnabled(){return this.enabled}setEnabled(t){this.enabled=t}isMultigraph(){return this.multigraph}setMultigraph(t){this.multigraph=t}isAllowLoops(){return this.allowLoops}setAllowLoops(t){this.allowLoops=t}isRecursiveResize(t=null){return this.recursiveResize}setRecursiveResize(t){this.recursiveResize=t}getOverlap(t){return this.isAllowOverlapParent(t)?this.defaultOverlap:0}isAllowOverlapParent(t){return!1}getDefaultParent(){let t=this.getCurrentRoot();return t||(t=this.defaultParent,t)||(t=this.getDataModel().getRoot().getChildAt(0)),t}setDefaultParent(t){this.defaultParent=t}destroy(){this.destroyed||(this.destroyed=!0,Object.values(this.plugins).forEach((t=>t.onDestroy())),this.view.destroy(),this.model&&this.graphModelChangeListener&&(this.getDataModel().removeListener(this.graphModelChangeListener),this.graphModelChangeListener=null))}}applyGraphMixins(Graph);class SchemeCellType{}SchemeCellType.Table={name:"table",cellShape:"rectangle"},SchemeCellType.Select={name:"select",cellShape:"rhombus"},SchemeCellType.Join={name:"join",cellShape:"ellipse"},SchemeCellType.Union={name:"union",cellShape:"ellipse"},SchemeCellType.GroupBy={name:"groupby",cellShape:"hexagon"},SchemeCellType.Where={name:"where",cellShape:"hexagon"};class SchemeTooltip{constructor(t,e){this.showTooltip=(t,e)=>{const i=this.graph.getCellBounds(t);null!==i&&(this.tooltip.innerHTML=e,this.tooltip.style.left=`${i.x}px`,this.tooltip.style.top=`${i.y+i.height+10}px`,this.tooltip.style.visibility="visible")},this.hideTooltip=()=>{this.tooltip.style.visibility="hidden"},this.isVisible=()=>"visible"===this.tooltip.style.visibility,this.container=t,this.graph=e,this.tooltip=document.createElement("div"),this.tooltip.classList.add("scheme-tooltip"),this.tooltip.style.visibility="hidden",this.container.appendChild(this.tooltip),console.log(this.tooltip)}}class GraphLayout{constructor(t){this.useBoundingBox=!0,this.parent=null,this.graph=t}moveCell(t,e,i){}resizeCell(t,e,i){}execute(t){}getGraph(){return this.graph}getConstraint(t,e,i,s){return this.graph.getCurrentCellStyle(e)[t]}traverse({vertex:t,directed:e,func:i,edge:s,visited:n}){if(null!=i&&null!=t&&(e=null==e||e,!(n=n||new Dictionary.default).get(t))){n.put(t,!0);const l=i(t,s);if(null==l||l){const s=t.getEdgeCount();if(s>0)for(let l=0;l<s;l+=1){const s=t.getEdgeAt(l),a=s.getTerminal(!0)===t;if(!e||a){const t=this.graph.view.getVisibleTerminal(s,!a);this.traverse({vertex:t,directed:e,func:i,edge:s,visited:n})}}}}}isAncestor(t,e,i){if(!i)return e.getParent()===t;if(e===t)return!1;for(;null!=e&&e!==t;)e=e.getParent();return e===t}isVertexMovable(t){return this.graph.isCellMovable(t)}isVertexIgnored(t){return!t.isVertex()||!t.isVisible()}isEdgeIgnored(t){return!t.isEdge()||!t.isVisible()||null==t.getTerminal(!0)||null==t.getTerminal(!1)}setEdgeStyleEnabled(t,e){this.graph.setCellStyles("noEdgeStyle",e?"0":"1",[t])}setOrthogonalEdge(t,e){this.graph.setCellStyles("orthogonal",e?"1":"0",[t])}getParentOffset(t){const e=new Point.default;if(null!=t&&t!==this.parent&&(this.graph.getDataModel(),this.parent&&this.parent.isAncestor(t))){let i=t.getGeometry();for(;t!==this.parent;)e.x+=i.x,e.y+=i.y,i=(t=t.getParent()).getGeometry()}return e}setEdgePoints(t,e){if(null!=t){const{model:i}=this.graph;let s=t.getGeometry();if(null==s?(s=new Geometry.default,s.setRelative(!0)):s=s.clone(),null!=this.parent&&null!=e){const i=t.getParent(),s=this.getParentOffset(i);for(let t=0;t<e.length;t+=1)e[t].x=e[t].x-s.x,e[t].y=e[t].y-s.y}s.points=e,i.setGeometry(t,s)}}setVertexLocation(t,e,i){const s=this.graph.getDataModel();let n=t.getGeometry(),l=null;if(null!=n){if(l=new Rectangle.default(e,i,n.width,n.height),this.useBoundingBox){const s=this.graph.getView().getState(t);if(null!=s&&null!=s.text&&null!=s.text.boundingBox){const{scale:t}=this.graph.getView(),n=s.text.boundingBox;s.text.boundingBox.x<s.x&&(e+=(s.x-n.x)/t,l.width=n.width),s.text.boundingBox.y<s.y&&(i+=(s.y-n.y)/t,l.height=n.height)}}if(null!=this.parent){const s=t.getParent();if(null!=s&&s!==this.parent){const t=this.getParentOffset(s);e-=t.x,i-=t.y}}n.x===e&&n.y===i||(n=n.clone(),n.x=e,n.y=i,s.setGeometry(t,n))}return l}getVertexBounds(t){let e=t.getGeometry();if(this.useBoundingBox){const i=this.graph.getView().getState(t);if(null!=i&&null!=i.text&&null!=i.text.boundingBox){const{scale:t}=this.graph.getView(),s=i.text.boundingBox,n=Math.max(i.x-s.x,0)/t,l=Math.max(i.y-s.y,0)/t,a=Math.max(s.x+s.width-(i.x+i.width),0)/t,r=Math.max(s.y+s.height-(i.y+i.height),0)/t;e=new Rectangle.default(e.x-n,e.y-l,e.width+n+a,e.height+l+r)}}if(null!=this.parent){const i=t.getParent();if(e=e.clone(),null!=i&&i!==this.parent){const t=this.getParentOffset(i);e.x+=t.x,e.y+=t.y}}return new Rectangle.default(e.x,e.y,e.width,e.height)}arrangeGroups(t,e,i,s,n,l){return this.graph.updateGroupBounds(t,e,!0,i,s,n,l)}}const layout_GraphLayout=GraphLayout;class WeightedCellSorter{constructor(t,e=0){this.weightedValue=0,this.nudge=!1,this.visited=!1,this.rankIndex=null,this.cell=t,this.weightedValue=e}static compare(t,e){return null!=t&&null!=e?e.weightedValue>t.weightedValue?-1:e.weightedValue<t.weightedValue?1:e.nudge?-1:1:0}}const util_WeightedCellSorter=WeightedCellSorter;function findTreeRoots(t,e,i=!1,s=!1){const n=[];if(null!=e){let l=null,a=0;for(const r of e.getChildren())if(r.isVertex()&&r.isVisible()){const o=t.getConnections(r,i?e:null);let h=0,d=0;for(let e=0;e<o.length;e++)t.view.getVisibleTerminal(o[e],!0)==r?h++:d++;(s&&0==h&&d>0||!s&&0==d&&h>0)&&n.push(r);const u=s?d-h:h-d;u>a&&(a=u,l=r)}0==n.length&&null!=l&&n.push(l)}return n}function traverse(t=null,e=!0,i=null,s=null,n=null,l=!1){if(null!=i&&null!=t&&(e=null==e||e,l=null!=l&&l,!(n=n||new Dictionary.default).get(t))){n.put(t,!0);const a=i(t,s);if(null==a||a){const s=t.getEdgeCount();if(s>0)for(let a=0;a<s;a+=1){const s=t.getEdgeAt(a),r=s.getTerminal(!0)==t;e&&!l!=r||traverse(s.getTerminal(!r),e,i,s,n,l)}}}}class CompactTreeLayout extends layout_GraphLayout{constructor(t,e=!0,i=!1){super(t),this.parentX=null,this.parentY=null,this.visited={},this.horizontal=!0,this.invert=!1,this.resizeParent=!0,this.maintainParentLocation=!1,this.groupPadding=10,this.groupPaddingTop=0,this.groupPaddingRight=0,this.groupPaddingBottom=0,this.groupPaddingLeft=0,this.parentsChanged=null,this.moveTree=!1,this.levelDistance=10,this.nodeDistance=20,this.resetEdges=!0,this.prefHozEdgeSep=5,this.prefVertEdgeOff=4,this.minEdgeJetty=8,this.channelBuffer=4,this.edgeRouting=!0,this.sortEdges=!1,this.alignRanks=!1,this.maxRankHeight=[],this.root=null,this.node=null,this.horizontal=e,this.invert=i}isVertexIgnored(t){return super.isVertexIgnored(t)||0===t.getConnections().length}isHorizontal(){return this.horizontal}execute(t,e){this.parent=t;const i=this.graph.getDataModel();if(null==e)if(this.graph.getEdges(t,t.getParent(),this.invert,!this.invert,!1).length>0)this.root=t;else{const e=findTreeRoots(this.graph,t,!0,this.invert);if(e.length>0)for(let t=0;t<e.length;t+=1)if(!this.isVertexIgnored(e[t])&&this.graph.getEdges(e[t],null,this.invert,!this.invert,!1).length>0){this.root=e[t];break}}else this.root=e;if(null!=this.root){if(this.resizeParent?this.parentsChanged={}:this.parentsChanged=null,this.parentX=null,this.parentY=null,t!==this.root&&null!=t.isVertex()&&this.maintainParentLocation){const e=t.getGeometry();null!=e&&(this.parentX=e.x,this.parentY=e.y)}i.beginUpdate();try{if(this.visited={},this.node=this.dfs(this.root,t),this.alignRanks&&(this.maxRankHeight=[],this.findRankHeights(this.node,0),this.setCellHeights(this.node,0)),null!=this.node){this.layout(this.node);let e=this.graph.gridSize,s=e;if(!this.moveTree){const t=this.getVertexBounds(this.root);null!=t&&(e=t.x,s=t.y)}let n=null;if(n=this.isHorizontal()?this.horizontalLayout(this.node,e,s):this.verticalLayout(this.node,null,e,s),null!=n){let t=0,i=0;n.x<0&&(t=Math.abs(e-n.x)),n.y<0&&(i=Math.abs(s-n.y)),0===t&&0===i||this.moveNode(this.node,t,i),this.resizeParent&&this.adjustParents(),this.edgeRouting&&this.localEdgeProcessing(this.node)}if(null!=this.parentX&&null!=this.parentY){let e=t.getGeometry();null!=e&&(e=e.clone(),e.x=this.parentX,e.y=this.parentY,i.setGeometry(t,e))}}}finally{i.endUpdate()}}}moveNode(t,e,i){t.x+=e,t.y+=i,this.apply(t);let{child:s}=t;for(;null!=s;)this.moveNode(s,e,i),s=s.next}sortOutgoingEdges(t,e){const i=new Dictionary.default;e.sort(((e,s)=>{const n=e.getTerminal(e.getTerminal(!1)==t);let l=i.get(n);null==l&&(l=CellPath.default.create(n).split(CellPath.default.PATH_SEPARATOR),i.put(n,l));const a=s.getTerminal(s.getTerminal(!1)===t);let r=i.get(a);return null==r&&(r=CellPath.default.create(a).split(CellPath.default.PATH_SEPARATOR),i.put(a,r)),CellPath.default.compare(l,r)}))}findRankHeights(t,e){const i=this.maxRankHeight;(null==i[e]||i[e]<t.height)&&(i[e]=t.height);let{child:s}=t;for(;null!=s;)this.findRankHeights(s,e+1),s=s.next}setCellHeights(t,e){const i=this.maxRankHeight;null!=i[e]&&i[e]>t.height&&(t.height=i[e]);let{child:s}=t;for(;null!=s;)this.setCellHeights(s,e+1),s=s.next}dfs(t,e){const i=CellPath.default.create(t);let s=null;if(null!=t&&null==this.visited[i]&&!this.isVertexIgnored(t)){this.visited[i]=t,s=this.createNode(t),this.graph.getDataModel();let n=null;const l=this.graph.getEdges(t,e,this.invert,!this.invert,!1,!0),a=this.graph.getView();this.sortEdges&&this.sortOutgoingEdges(t,l);for(let t=0;t<l.length;t+=1){const i=l[t];if(!this.isEdgeIgnored(i)){this.resetEdges&&this.setEdgePoints(i,null),this.edgeRouting&&(this.setEdgeStyleEnabled(i,!1),this.setEdgePoints(i,null));const t=a.getState(i),l=null!=t?t.getVisibleTerminal(this.invert):a.getVisibleTerminal(i,this.invert),r=this.dfs(l,e);null!=r&&null!=l.getGeometry()&&(null==n?s.child=r:n.next=r,n=r)}}}return s}layout(t){let{child:e}=t;for(;null!=e;)this.layout(e),e=e.next;null!=t.child?this.attachParent(t,this.join(t)):this.layoutLeaf(t)}horizontalLayout(t,e,i,s=null){t.x+=e+t.offsetX,t.y+=i+t.offsetY,s=this.apply(t,s);const{child:n}=t;if(null!=n){s=this.horizontalLayout(n,t.x,t.y,s);let e=t.y+n.offsetY,i=n.next;for(;null!=i;)s=this.horizontalLayout(i,t.x+n.offsetX,e,s),e+=i.offsetY,i=i.next}return s}verticalLayout(t,e,i,s,n=null){t.x=t.x+i+t.offsetY,t.y=t.y+s+t.offsetX,n=this.apply(t,n);const{child:l}=t;if(null!=l){n=this.verticalLayout(l,t,t.x,t.y,n);let e=t.x+l.offsetY,i=l.next;for(;null!=i;)n=this.verticalLayout(i,t,e,t.y+l.offsetX,n),e+=i.offsetY,i=i.next}return n}attachParent(t,e){const i=this.nodeDistance+this.levelDistance,s=(e-t.width)/2-this.nodeDistance,n=s+t.width+2*this.nodeDistance-e;t.child.offsetX=i+t.height,t.child.offsetY=n,t.contour.upperHead=this.createLine(t.height,0,this.createLine(i,n,t.contour.upperHead)),t.contour.lowerHead=this.createLine(t.height,0,this.createLine(i,s,t.contour.lowerHead))}layoutLeaf(t){const e=2*this.nodeDistance;t.contour.upperTail=this.createLine(t.height+e,0),t.contour.upperHead=t.contour.upperTail,t.contour.lowerTail=this.createLine(0,-t.width-e),t.contour.lowerHead=this.createLine(t.height+e,0,t.contour.lowerTail)}join(t){const e=2*this.nodeDistance;let{child:i}=t;t.contour=i.contour;let s=i.width+e,n=s;for(i=i.next;null!=i;){const l=this.merge(t.contour,i.contour);i.offsetY=l+s,i.offsetX=0,s=i.width+e,n+=l+s,i=i.next}return n}merge(t,e){let i=0,s=0,n=0,l=t.lowerHead,a=e.upperHead;for(;null!=a&&null!=l;){const t=this.offset(i,s,a.dx,a.dy,l.dx,l.dy);s+=t,n+=t,i+a.dx<=l.dx?(i+=a.dx,s+=a.dy,a=a.next):(i-=l.dx,s-=l.dy,l=l.next)}if(null!=a){const n=this.bridge(t.upperTail,0,0,a,i,s);t.upperTail=null!=n.next?e.upperTail:n,t.lowerTail=e.lowerTail}else{const n=this.bridge(e.lowerTail,i,s,l,0,0);null==n.next&&(t.lowerTail=n)}return t.lowerHead=e.lowerHead,n}offset(t,e,i,s,n,l){let a=0;return n<=t||t+i<=0?0:(a=n*s-i*l>0?t<0?t*s/i-e:t>0?t*l/n-e:-e:n<t+i?l-(e+(n-t)*s/i):n>t+i?(i+t)*l/n-(e+s):l-(e+s),a>0?a:0)}bridge(t,e,i,s,n,l){const a=n+s.dx-e;let r=0,o=0;0===s.dx?r=s.dy:(o=a*s.dy,r=o/s.dx);const h=this.createLine(a,r,s.next);return t.next=this.createLine(0,l+s.dy-r-i,h),h}createNode(t){const e={};e.cell=t,e.x=0,e.y=0,e.width=0,e.height=0;const i=this.getVertexBounds(t);return null!=i&&(this.isHorizontal()?(e.width=i.height,e.height=i.width):(e.width=i.width,e.height=i.height)),e.offsetX=0,e.offsetY=0,e.contour={},e}apply(t,e=null){this.graph.getDataModel();const i=t.cell;let s=i.getGeometry();if(null!=i&&null!=s){if(this.isVertexMovable(i)&&(s=this.setVertexLocation(i,t.x,t.y),this.resizeParent)){const t=i.getParent(),e=CellPath.default.create(t),s=this.parentsChanged;null==s[e]&&(s[e]=t)}e=null==e?new Rectangle.default(s.x,s.y,s.width,s.height):new Rectangle.default(Math.min(e.x,s.x),Math.min(e.y,s.y),Math.max(e.x+e.width,s.x+s.width),Math.max(e.y+e.height,s.y+s.height))}return e}createLine(t,e,i=null){return{dx:t,dy:e,next:i}}adjustParents(){const t=[];for(const e in this.parentsChanged)t.push(this.parentsChanged[e]);this.arrangeGroups((0,styleUtils.sortCells)(t,!0),this.groupPadding,this.groupPaddingTop,this.groupPaddingRight,this.groupPaddingBottom,this.groupPaddingLeft)}localEdgeProcessing(t){this.processNodeOutgoing(t);let{child:e}=t;for(;null!=e;)this.localEdgeProcessing(e),e=e.next}processNodeOutgoing(t){let{child:e}=t;const i=t.cell;let s=0;const n=[];for(;null!=e;){let t;s++,t=this.horizontal?e.y:e.x,n.push(new util_WeightedCellSorter(e,t)),e=e.next}n.sort(util_WeightedCellSorter.compare);let l=t.width;const a=(s+1)*this.prefHozEdgeSep;l>a+2*this.prefHozEdgeSep&&(l-=2*this.prefHozEdgeSep);const r=l/s;let o=r/2;l>a+2*this.prefHozEdgeSep&&(o+=this.prefHozEdgeSep);let h=this.minEdgeJetty-this.prefVertEdgeOff,d=0;const u=this.getVertexBounds(i);e=t.child;for(let t=0;t<n.length;t++){const e=n[t].cell.cell,l=this.getVertexBounds(e),a=this.graph.getEdgesBetween(i,e,!1),c=[];let g=0,p=0;for(let t=0;t<a.length;t+=1)this.horizontal?(g=u.x+u.width,p=u.y+o,c.push(new Point.default(g,p)),g=u.x+u.width+h,c.push(new Point.default(g,p)),p=l.y+l.height/2,c.push(new Point.default(g,p)),this.setEdgePoints(a[t],c)):(g=u.x+o,p=u.y+u.height,c.push(new Point.default(g,p)),p=u.y+u.height+h,c.push(new Point.default(g,p)),g=l.x+l.width/2,c.push(new Point.default(g,p)),this.setEdgePoints(a[t],c));t<s/2?h+=this.prefVertEdgeOff:t>s/2&&(h-=this.prefVertEdgeOff),o+=r,d=Math.max(d,h)}}}const layout_CompactTreeLayout=CompactTreeLayout;class SchemeLayout{constructor(t){this.layoutGraph=()=>{this.layout.execute(this.graph.getDefaultParent())},this.graph=t,this.layout=new layout_CompactTreeLayout(this.graph),this.layout.nodeDistance=50,this.layout.levelDistance=10,this.layout.horizontal=!1,this.layoutGraph()}}class SchemeGraph{constructor(t){this.drawGraph=t=>{this.graph.batchUpdate((()=>{this.makeScheme(t)}))},this.makeScheme=t=>{const e=t.queries;for(const t of Object.keys(e)){const i=e[t];console.log(i),i.type===DSQueryType.constant?this.processConstantQuery(i,t):i.type===DSQueryType.select?this.processSelectQuery(i,t):i.type===DSQueryType.join?this.processJoinQuery(i,t):i.type===DSQueryType.union&&this.processUnionQuery(i,t)}},this.cellExists=t=>{for(const e of this.schemeCells)if(e.info.id===t)return!0;return!1},this.processConstantQuery=(t,e)=>{if(!this.cellExists(e)){const i=[];for(const e of t.select)i.push(e.expression);this.createCell({id:e,name:"SELECT",type:SchemeCellType.Select,hint:i.join(", ")})}this.layout.layoutGraph()},this.processSelectQuery=(t,e)=>{let i=t.from;if(this.cellExists(i)||this.createCell({id:i,name:t.fromAs,type:SchemeCellType.Table}),void 0!==t.groupBy){const s=e+"-g",n=[];for(const e of t.groupBy)n.push(t.select[e].expression);this.createCell({id:s,name:"GROUP BY",type:SchemeCellType.GroupBy,hint:n.join(", ")}),this.makeGroupBy(i,s),i=s}if(void 0!==t.where){const s=e+"-w",n=[];for(const e of t.where)n.push(e.expression);this.createCell({id:s,name:"WHERE",type:SchemeCellType.Where,hint:n.join(", ")}),this.makeWhere(i,s),i=s}if(!this.cellExists(e)){const i=[];for(const e of t.select)i.push(e.expression);this.createCell({id:e,name:"SELECT",type:SchemeCellType.Select,hint:i.join(", ")})}this.makeSelect(i,e),this.layout.layoutGraph()},this.processJoinQuery=(t,e)=>{const i=t.joinSources,s=i.root.source.from;this.cellExists(s)||this.createCell({id:s,name:i.root.source.fromAs,type:SchemeCellType.Table});for(const t of i.root.relations){const e=i.relationIndex[t];this.cellExists(t)||this.createCell({id:t,name:e.type.toUpperCase()+" JOIN",type:SchemeCellType.Join,hint:e.condition});const n=e.source.from;this.cellExists(n)||this.createCell({id:n,name:e.source.fromAs,type:SchemeCellType.Table}),this.makeJoin(s,n,t)}let n=t.joinSources.root.relations.slice(-1)[0];if(void 0!==t.groupBy){const i=e+"-g",s=[];for(const e of t.groupBy)s.push(t.select[e].expression);this.createCell({id:i,name:"GROUP BY",type:SchemeCellType.GroupBy,hint:s.join(", ")}),this.makeGroupBy(n,i),n=i}if(!this.cellExists(e)){const i=[];for(const e of t.select)i.push(e.expression);this.createCell({id:e,name:"SELECT",type:SchemeCellType.Select,hint:i.join(", ")})}this.makeSelect(n,e),this.layout.layoutGraph()},this.processUnionQuery=(t,e)=>{const i=[];for(const e of t.unions){const t=e.from;this.cellExists(t)||this.createCell({id:t,name:e.fromAs,type:SchemeCellType.Table}),i.push(e.from)}const s=e+"-u";if(this.cellExists(s)||this.createCell({id:s,name:"UNION",type:SchemeCellType.Union}),this.makeUnion(i,s),!this.cellExists(e)){const i=[];for(let e=0;e<t.select[0].expressionUnion.length;e++){const s=[];for(let i=0;i<t.select.length;i++)null!==t.select[i].expressionUnion[e]?s.push(t.unions[i].fromAs+"."+t.select[i].expressionUnion[e]):s.push("null");i.push(s.join(", "))}this.createCell({id:e,name:"SELECT",type:SchemeCellType.Select,hint:i.join("; ")})}this.makeSelect(s,e),this.layout.layoutGraph()},this.createCell=t=>{const e=this.graph.getDefaultParent(),i={cell:this.graph.insertVertex({parent:e,position:[10,10],size:[100,25],value:t.name,style:{shape:t.type.cellShape}}),info:t};return this.schemeCells.push(i),i},this.makeSelect=(t,e)=>{const i=this.getSchemeCellById(t),s=this.getSchemeCellById(e);void 0!==i&&void 0!==s&&this.addEdge(s.cell,i.cell)},this.makeWhere=(t,e)=>{const i=this.getSchemeCellById(t),s=this.getSchemeCellById(e);void 0!==i&&void 0!==s&&this.addEdge(s.cell,i.cell)},this.makeGroupBy=(t,e)=>{const i=this.getSchemeCellById(t),s=this.getSchemeCellById(e);void 0!==i&&void 0!==s&&this.addEdge(s.cell,i.cell)},this.makeJoin=(t,e,i)=>{const s=this.getSchemeCellById(t),n=this.getSchemeCellById(e),l=this.getSchemeCellById(i);void 0!==s&&void 0!==n&&void 0!==l&&(this.addEdge(l.cell,s.cell),this.addEdge(l.cell,n.cell))},this.makeUnion=(t,e)=>{const i=[];for(const e of t){const t=this.getSchemeCellById(e);void 0!==t&&i.push(t)}const s=this.getSchemeCellById(e);if(void 0!==s&&0!==i.length)for(const t of i)this.addEdge(s.cell,t.cell)},this.addEdge=(t,e)=>{const i=this.graph.getDefaultParent();this.graph.insertEdge({parent:i,source:t,target:e,style:{edgeStyle:"orthogonalEdgeStyle",rounded:!0,verticalAlign:"top",verticalLabelPosition:"top"}})},this.getSchemeCellByCell=t=>{for(const e of this.schemeCells)if(e.cell===t)return e},this.getSchemeCellById=t=>{for(const e of this.schemeCells)if(e.info.id===t)return e},this.graph=new Graph(t),this.graph.setPanning(!0),this.graph.setEnabled(!1),this.tooltip=new SchemeTooltip(t,this.graph),this.layout=new SchemeLayout(this.graph),this.graph.addListener(InternalEvent.default.CLICK,((t,e)=>{const i=e.properties.cell;if(null!==i){const t=this.getSchemeCellByCell(i);void 0!==t&&void 0!==t.info.hint&&this.tooltip.showTooltip(i,t.info.hint)}else this.tooltip.hideTooltip()})),this.schemeCells=[]}}const appModelVisualizer=t=>{const e=document.getElementById(t);e?new SchemeGraph(e).drawGraph(model):console.error("Приложение не может работать, т.к. не был найден контейнер с id "+t)};window.appModelVisualizer=appModelVisualizer})();